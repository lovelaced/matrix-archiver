<!doctype html><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'>
<title>#graypaper:polkadot.io – archive</title>

<style>
body{margin:0 auto;max-width:75ch;font:15px/1.55 system-ui,-apple-system,'Segoe UI',Helvetica,Arial,sans-serif;
     background:#141414;color:#e6e6e6;padding:2rem}
.msg{white-space:pre-wrap;margin:.3em 0}
.reply{margin-left:2ch}
.edited{opacity:.65;font-style:italic;font-size:.9em}
pre{background:#1e1e1e;padding:.6em;border-radius:4px;overflow:auto}
code{font-family:ui-monospace,monospace}
.u{font-weight:600}
time{color:#888}
a{color:#9cf;text-decoration:none}
i,em{font-style:normal}         /* reset */
em{font-style:italic}
@media(max-width:480px){
 body{padding:1rem;font-size:14px}
 pre{font-size:13px}
}
</style>
<h1>#graypaper:polkadot.io</h1>
<p><small>last updated 2025-08-15 03:38 UTC</small></p>
<p><a href='room_log.txt'>⇩ plaintext</a> · <a href='../../'>⇦ all rooms</a></p>
<hr>
<div class='msg'><time>2024-04-17 20:29</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: <a href="https://matrix.to/#/!hyzRkDqDthePbodYFz:parity.io/$f_DMsIEcDXZegw6Sabnehzc-LrdDQkmq5MbxDDyoZxY?via=parity.io&amp;via=web3.foundation" target="_blank" rel="noopener">https://matrix.to/#/!hyzRkDqDthePbodYFz:parity.io/$f_DMsIEcDXZegw6Sabnehzc-LrdDQkmq5MbxDDyoZxY?via=parity.io&amp;via=web3.foundation</a>
</div>
<div class='msg'><time>2024-04-17 20:29</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: 
hmm it requires that each shard is diviasible by 64 not the number of available shards.</div>
<div class='msg'><time>2024-04-17 20:32</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: If we want to decode shards/segment that  are smaller than 64bytes then we have problem with using SIMD I think. Because neighbouring bytes are not encoded in the same polynomial. </div>
<div class='msg'><time>2024-04-17 20:33</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: so 64 bytes are encoded in 32 polynomials but each recover bytes with 32 bytes gap between them. </div>
<div class='msg'><time>2024-04-17 20:34</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: obviously we can rearrange the bytes before encoding but that kill the whole purpose of the SIMD.</div>
<div class='msg'><time>2024-04-17 20:37</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: If we are insisting on recovering less than 64-bytes at the time then maybe we shouldn&#x27;t use SIMD or we should use smaller registers perhaps.</div>
<div class='msg'><time>2024-04-17 21:00</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: gav: ^</div>
<div class='msg'><time>2024-04-18 06:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I just don&#x27;t see how you can have 341 of 1023 validators recover 64 bytes.</div>
<div class='msg'><time>2024-04-18 06:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: there&#x27;s not enough granularity.</div>
<div class='msg'><time>2024-04-18 06:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: how many bytes would they each store to recover those 64 bytes?</div>
<div class='msg'><time>2024-04-18 06:48</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: They each store 64*3 each have 3 shards</div>
<div class='msg'><time>2024-04-18 06:49</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: They recover 64*1023</div>
<div class='msg'><time>2024-04-18 06:49</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: Bytes in one go</div>
<div class='msg'><time>2024-04-18 06:50</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: They could get only two bytes out of those 64 and recover 1024*2</div>
<div class='msg'><time>2024-04-18 06:51</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: But those bytes are not consecutives</div>
<div class='msg'><time>2024-04-18 06:51</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: Two recover two consecutive bytes you need to recover 4</div>
<div class='msg'><time>2024-04-18 06:52</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: And they are part of the 1024 polynomial </div>
<div class='msg'><time>2024-04-18 06:52</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: So you recover 4*1024 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-04-18 07:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: ok so this is the minimal size you can recover at a time? 4*1024
</div>
<div class='msg'><time>2024-04-18 08:34</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: You can recover 2*1024 but they are non-consecative bytes</div>
<div class='msg'><time>2024-04-18 08:35</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: So you can recover 1024 and throw out the other 1024</div>
<div class='msg'><time>2024-04-18 08:35</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: That way you recover one byte from each sharf</div>
<div class='msg'><time>2024-04-18 08:42</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: It is just that up to 32 consecutive bytes you have to recover double amount but you get the next consecutive bytes for free.</div>
<div class='msg'><time>2024-04-18 10:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ok. Hence the minimum sensible amount to recover is 4KB</div>
<div class='msg'><time>2024-04-19 06:36</time>&ensp;<span class='u' style='color:#c5378a'>aedigix</span>: How will metering be implemented in the RISC-V PVM?  

</div>
<div class='msg'><time>2024-04-19 07:06</time>&ensp;<span class='u' style='color:#c5378a'>aedigix</span>: <a href="https://docs.openhwgroup.org/projects/cv32e40x-user-manual/en/latest/perf_counters.html" target="_blank" rel="noopener">https://docs.openhwgroup.org/projects/cv32e40x-user-manual/en/latest/perf_counters.html</a>   </div>
<div class='msg'><time>2024-04-19 11:47</time>&ensp;<span class='u' style='color:#2979b3'>hitchhooker</span>: i dont think that current spec defines the metering methods. <a href="https://github.com/koute/polkavm/blob/4ca06cc1b7cb435b2b92e81e30c2eb0e988f563e/crates/polkavm/src/compiler.rs#L88" target="_blank" rel="noopener">reference implementation</a> of pvm has currently options for asyncronous and synchronous gas metering. async being nondeterministic and a bit faster running in separate core checking in if program is done. gas metering is still somewhat simple and imperfect(<a href="https://forum.polkadot.network/t/announcing-polkavm-a-new-risc-v-based-vm-for-smart-contracts-and-possibly-more/3811#appendix-bonus-section-or-why-does-it-smell-like-gas-here-18" target="_blank" rel="noopener">see initial posts bonus appendix dilemma</a>), but <a href="https://github.com/koute/polkavm/blob/4ca06cc1b7cb435b2b92e81e30c2eb0e988f563e/BENCHMARKS.md?plain=1#L13" target="_blank" rel="noopener">benchmarks</a> have shown it to be fast enough to proceed. one [idea]((<a href="https://forum.polkadot.network/t/announcing-polkavm-a-new-risc-v-based-vm-for-smart-contracts-and-possibly-more/3811/21))" target="_blank" rel="noopener">https://forum.polkadot.network/t/announcing-polkavm-a-new-risc-v-based-vm-for-smart-contracts-and-possibly-more/3811/21))</a> thrown out there was to use CPUs FPU for more exact/efficient deterministic metering.</div>
<div class='msg'><time>2024-04-19 18:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: the final metering spec is still being determined. it is heavily dependent on practical implementation speed on realistic hardware, so will necessarily be in flux for some time as implementations arrive and evolve and hardware requirements are decided. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-04-19 18:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (for ethereum it was the very last protocol element we finalized, and did so through performance analysis of the 3 impls; i expect we&#x27;ll do something fairly similar here, but with some research over how memory usage interacts with instruction speed) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-04-19 18:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: we don&#x27;t expect async metering to be used.</div>
<div class='msg'><time>2024-04-19 18:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (and it&#x27;s not a reference implementation - it just happens to be the first:)</div>
<div class='msg'><time>2024-04-28 06:39</time>&ensp;<span class='u' style='color:#c5378a'>aedigix</span>: Is there any concerns with endianness for the choice of VM?  EVM is big-endian (not really sure the justification for this as I can&#x27;t find it in the YP)  </div>
<div class='msg'><time>2024-04-29 16:21</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Any concern about services intentionally inserting keys into the state trie whose hashes have a long common prefix? With the trie as specified this will result in long trie paths, with a bunch of branch nodes which have one half empty. Possibly could change the definition of M so that instead of always branching on b0 in the branch case you branch on the first bit such that l and r are non-empty? This would of course make the trie implementation more complicated and possibly ruin some optimisations.</div>
<div class='msg'><time>2024-04-29 16:57</time>&ensp;<span class='u' style='color:#c74b98'>alistair</span>: That doesn&#x27;t really solve the problem because if you can use brute force to find two hashes which agree on n bits then you can also with an extra 50% hash computations in expectation, find hashes with 1,2,3,..,n-1 bits of prefix agreeing with the first two hashes.  Now you still have a depth n trie. The only downside is that you now have to get n+1 hashes included instead of 2. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-04-29 17:26</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: No it doesn&#x27;t solve the problem, but it reduces it to the same problem that currently exists in polkadot, so at least it&#x27;s not making it worse</div>
<div class='msg'><time>2024-04-29 17:28</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Maybe not the &quot;same&quot; problem as services don&#x27;t exist in polkadot, but you can do similar things with eg account keys</div>
<div class='msg'><time>2024-04-29 17:45</time>&ensp;<span class='u' style='color:#b9329c'>jeff</span>: I&#x27;d expect scale covers this.

Afaik big endian aka network byte order is used in network protocols because it makes testing more robust:  If you omit an endianness conversion in only one place then protocol implementations typically fail in testing on little endian machines.  The bad situation this avoids is going into production with code that doesn&#x27;t work when ported to a big endian machine.  There is no reason to use network byte order if everyone uses some library that enforces a particular convention, like say protobuf, which likely covers our case more or less.  Also, you could skip network byte when you have a very tightly specified protocol, like djb&#x27;s crypto like ed25519 uses little endian, because he&#x27;s fighting much bigger implementor risks, while older crypto specifications like secp256k1 often used big endian, just because they didn&#x27;t understand implementation risks, so they addresses only minor ones. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-04-29 20:02</time>&ensp;<span class='u' style='color:#8dbe5c'>arkadiy</span>: (127) <code>C(s,h)</code> definition Interleaves the hash of the key with the service id to create the trie key. So that a service won&#x27;t be able to create common prefix chains in other service subtries with this kind of attack. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-04-30 00:39</time>&ensp;<span class='u' style='color:#449ad3'>eclesiomelo</span>: just saw that the definition of header judgement mark is not accurate given that <code>t != 0</code> will include valid judgments also, so 107. <code>Hj ≡ [r | (r, t) &amp;lt;− J, t ≠ ⌊2/3V⌋ + 1]</code> looks correct, right? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-05-02 17:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes thanks - well spotted! that&#x27;ll be corrected in the next revision:) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-05-08 09:18</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: <code>(17) β′ ≺(H,EG,β†,C)</code> what is the <code>C</code> here?</div>
<div class='msg'><time>2024-05-08 09:18</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-05-08 at 9.18.28 PM.png</div>
<div class='msg'><time>2024-05-08 09:18</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: this is the only other reference of C that I can find <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-05-08 09:25</time>&ensp;<span class='u' style='color:#d06a65'>karim</span>: Screenshot from 2024-05-08 11-24-37.png</div>
<div class='msg reply'><time>2024-05-08 09:25</time>&ensp;<span class='u' style='color:#d06a65'>karim</span>: Maybe this? <code>\mathbf{C}</code> in the LaTeX for easier search / mapping.</div>
<div class='msg reply'><time>2024-05-08 09:52</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Thanks. That&#x27;s it.</div>
<div class='msg'><time>2024-05-08 09:19</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: so it is just an intermediate variable? some output from <code>(EA,ρ′,δ†,χ,ι,φ)</code>?</div>
<div class='msg'><time>2024-05-10 03:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-05-10 at 3.43.10 PM.png</div>
<div class='msg'><time>2024-05-10 03:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: is this a typo? because the total length should be 336 bytes?</div>
<div class='msg'><time>2024-05-10 03:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-05-10 at 3.43.37 PM.png</div>
<div class='msg'><time>2024-05-11 10:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; so it is just an intermediate variable? some output from <code>(EA,ρ′,δ†,χ,ι,φ)</code>?

Exactly.</div>
<div class='msg'><time>2024-05-11 10:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; is this a typo? because the total length should be 336 bytes?

yes - thanks!</div>
<div class='msg'><time>2024-05-11 10:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: that&#x27;ll be fixed in the next revision.</div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: Hi, at the bottom of the left column of page 6, the set of all dictionaries, D, is defined as:</div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: <code>D ⊂ {{(k ↦ v)}}</code></div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: Since D contains all dictionaries, shouldn&#x27;t it be:</div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: <code>D ⊃ {{(k ↦ v)}}</code></div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: Or maybe even:</div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: <code>D ≡ {{(k ↦ v)}}</code></div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: And on the right column of the same page, D is defined as:</div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: <code>D⟨K → V⟩ ⊂ D</code></div>
<div class='msg'><time>2024-05-23 08:42</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: which I think validates the initial correction. Thanks!</div>
<div class='msg'><time>2024-05-23 11:13</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: D excludes sets with duplicate keys, so seems like subset is accurate</div>
<div class='msg'><time>2024-05-23 11:44</time>&ensp;<span class='u' style='color:#349bb7'>helikon</span>: Ah, got it now thanks, I assumed uniqueness of keys. Actually the following (4) just explains that. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-05-23 20:12</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Will there be some more explanation on the 2/3+1 honesty assumption?  
What time-window is to be considered when evaluating this? Current session? Or something like current session + past session?</div>
<div class='msg'><time>2024-05-23 20:53</time>&ensp;<span class='u' style='color:#b9329c'>jeff</span>: I&#x27;d think the jam paper could just say &quot;byzantine assumptions, including 2/3rd honest, for the current and previous sessions&quot;.

It&#x27;ll be the (machine) elves paper that clarifies our assumptions, but maybe not something jam should discuss to precisely, due to some technicalities: 

We make &quot;synchronous&quot; byzantine assumptions for the current session and all previous sessions, which includes that less than 1/3 of validators were miss-behaving, including being off-line.  We uses the &quot;network synchrony&quot; assumption only narrowly, and make a serious effort (no shows) to mitigate its weakness, which makes it less bad than it sounds. 

Arguably, we only require these assumption for the current and immediately previous session, so long as all parachains are all somehow appropriately publicly monitored.  We should not discuss this however since we cannot define this monitoring, and we&#x27;ll do things like elections on parachains, which probably do not satisfy such a monitoring condition.  And non-turnstiled zk parachains are likely eventually too.  It&#x27;s not worth discussing this.
 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-05-27 07:27</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-05-27 at 7.25.01 PM.png</div>
<div class='msg'><time>2024-05-27 07:27</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: The formula doesn&#x27;t appear to be matching with the description?</div>
<div class='msg'><time>2024-05-27 08:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: the formula is correct; the text needs to be reworded slightly. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-05-27 08:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The intention was that <code>a</code> always has 3 elements, but the last element, and only the last, may potentially be None. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-05-27 09:02</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: so it is something like<code>((Sig, Idx), (Sig, Idx), Optional&amp;lt;(Sig, Idx)&amp;gt;)</code>?</div>
<div class='msg'><time>2024-05-27 09:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Implementation wise, sure</div>
<div class='msg'><time>2024-05-27 09:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Or you can have an array/vec 2 or 3 items large <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-04 10:04</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: </div>
<div class='msg'><time>2024-06-04 10:05</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-06-04 at 10.05.34 PM.png</div>
<div class='msg'><time>2024-06-04 10:06</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Just to confirm, the Bandersnatch public key size is 32 bytes?</div>
<div class='msg'><time>2024-06-04 10:07</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: <a href="https://github.com/paritytech/polkadot-sdk/blob/f0ac3310eed91bd4f72811136b685b4a80a06c45/substrate/primitives/core/src/bandersnatch.rs#L46" target="_blank" rel="noopener">https://github.com/paritytech/polkadot-sdk/blob/f0ac3310eed91bd4f72811136b685b4a80a06c45/substrate/primitives/core/src/bandersnatch.rs#L46</a> it is 33 here</div>
<div class='msg'><time>2024-06-04 10:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://matrix.to/#/@davxy:matrix.org" target="_blank" rel="noopener">@davxy:matrix.org</a>^^^?</div>
<div class='msg'><time>2024-06-04 10:17</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: &gt; &lt;@xlchen:matrix.org&gt; Just to confirm, the Bandersnatch public key size is 32 bytes?

Yes</div>
<div class='msg'><time>2024-06-04 10:18</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: It is in compressed twisted Edwards form.</div>
<div class='msg'><time>2024-06-04 10:18</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: Similar to Zcash</div>
<div class='msg'><time>2024-06-04 10:19</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: We are moving to twisted Edwards form partially to save that one byte</div>
<div class='msg'><time>2024-06-04 11:53</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Confirmed. </div>
<div class='msg'><time>2024-06-06 08:15</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-06-06 at 8.15.18 PM.png</div>
<div class='msg'><time>2024-06-06 08:16</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: it said there are 3 items in the judgement state but the formula have 4?</div>
<div class='msg'><time>2024-06-06 08:16</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-06-06 at 8.16.35 PM.png</div>
<div class='msg'><time>2024-06-06 08:16</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: so does the serialization formula</div>
<div class='msg'><time>2024-06-06 08:17</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: <code>We store the last epoch’s validator set in ψk:</code></div>
<div class='msg'><time>2024-06-06 08:17</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: and <code>λ: The validator keys and metadata which were active in the prior epoch.</code></div>
<div class='msg'><time>2024-06-06 08:19</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: what&#x27;s the difference between those?</div>
<div class='msg'><time>2024-06-06 09:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah that&#x27;s old - the stuff about psi\_k should have been removed. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-06 09:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (It used to contain what lambda now contains)</div>
<div class='msg'><time>2024-06-06 09:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be removed shortly.</div>
<div class='msg'><time>2024-06-10 10:14</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-06-10 at 10.14.02 PM.png</div>
<div class='msg'><time>2024-06-10 10:15</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I guess one of it is wrong?</div>
<div class='msg'><time>2024-06-10 12:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah - the top one needs removing</div>
<div class='msg'><time>2024-06-10 12:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be done in the next update</div>
<div class='msg'><time>2024-06-10 18:19</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Bryan Chen | Laminar &amp; Acala: <a href="https://github.com/gavofyork/graypaper/pull/13" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/13</a></div>
<div class='msg'><time>2024-06-11 20:49</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: While this is a minor point, I think it is aligned with the intention of maintaining the formal rigor intended in the graypaper.

I feel there is some inconsistency in terminology concerning &quot;integer&quot; versus &quot;natural numbers.&quot; Specifically, when adhering to Section 3.4 (numbers), I believe that the text in sections like 3.6 should use use natural instead of &quot;integer&quot; to be consistent with the corresponding math expressions ($\\N$, etc.). This happens in various other sections as well, where talking about natural numbers or positive integers (unsigned?) would be more appropriate than just &quot;integers&quot;

Generally, the mathematical expressions are accurate, but the narrative often uses &quot;integer&quot; in a broader sense. I think this is due to how the term is used in programming (unsigned integers, etc.) rather than math.

This inconsistency becomes particularly evident in Appendix C.1.2, where the encoding is defined solely for natural numbers, and there is no mention at all about how negative values should be handled. Also, I don&#x27;t seem to find any real need for serializing negative integers. Probably this section could be restricted to only encoding natural numbers and this shoud be enough.

If useful, I am glad to review and make a PR with suggestions addressing this along the text. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-11 21:09</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: ...
I have also a few of questions about C.2. .. (262) (263)

- why is H\_j not included when serializing the header? is that correct or an unintentional omission?
- why there is a claim that E\_U(H) has &quot;no inverse&quot;? wouldn&#x27;t that imply that there is no way to decode a serialized header? (In C.1. &quot;...We define the deserialization function E−1 = E−1 as the inverse of E and able to decode some sequence into the original value....&quot; <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-11 21:21</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: ....
5. Header
&quot;... Excepting the Genesis header, all block headers H have an associated parent header, whose hash is H\_p...&quot;

but expression (263) for header serialization does not indicate optionality (?H\_p). So should there be some exception or fixed value for the genesis case? For instance, like H\_p for H^0 is defined as some fixed preestablished value?

or instead, the serialization of H^0 is a special case that should be explicitely indicated in C.2 that H\_p should not be encoded for H^0? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-11 21:39</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: image.png</div>
<div class='msg'><time>2024-06-11 21:40</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: in the case of 38, the hash is done over the encoded Extrinsic...  H(E(E)), which makes sense..
I believe that 36 is missing the encoding function E to be consistent.. so... H_p = H(E(P(H)))
otherwise, maybe it would be worth indicating somewhere that hashing implies encoding? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-12 04:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: - H\_j is not serialized but implied by E\_J.
- where exactly does it say E\_U(H) cannot have an inverse? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-12 04:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah. It’s not optional; genesis is a very special case and it makes no sense to complicate the protocol due to it. It will likely just be defined as zeroes. The genesis header and state are not yet defined in the protocol.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-12 04:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@purpletentacle:matrix.org&gt; in the case of 38, the hash is done over the encoded Extrinsic...  H(E(E)), which makes sense..
&gt; I believe that 36 is missing the encoding function E to be consistent.. so... H_p = H(E(P(H)))
&gt; otherwise, maybe it would be worth indicating somewhere that hashing implies encoding?

I believe it is mentioned previously that when hashing, values are assumed to be encoded with the regular serialisation function if they are not explicitly so. </div>
<div class='msg'><time>2024-06-12 04:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I think I’ve generally made it explicit but as it is unambiguous I gave the option for omission particularly to help improve readability of some longer formulae. </div>
<div class='msg'><time>2024-06-16 12:53</time>&ensp;<span class='u' style='color:#39bc2a'>ltfschoen</span>: it says here <a href="https://jam.web3.foundation/rules" target="_blank" rel="noopener">https://jam.web3.foundation/rules</a> that &quot;Clean-room implementation using the Graypaper and public implementor chat channels as the only resources.&quot;.

it is my understanding that the Graypaper chat channel is <a href="https://matrix.to/#/#graypaper:polkadot.io" target="_blank" rel="noopener">https://matrix.to/#/#graypaper:polkadot.io</a>

where are the &quot;public implementer&quot; chat channels?

and is there a reason why it doesn&#x27;t include the Jam chat channel here <a href="https://matrix.to/#/#jam:polkadot.io?" target="_blank" rel="noopener">https://matrix.to/#/#jam:polkadot.io?</a>

also, it says &quot;Each team is only allowed to work on one implementation&quot;, but in the application form it says &quot;What programming language(s) are you using and which language set are you applying for? e.g. &quot;Rust, set B&quot;, so i don&#x27;t understand why it&#x27;s asking us &quot;What programming language(s) are you using&quot;. is it just wanting to know if we&#x27;ll be using multiple languages in the our single implementation (e.g. if we&#x27;ll be doing an implementation in Rust and using FFI from Ruby and Python then we&#x27;d answer <code>Rust, Ruby, Python, set B</code>?

i was actually going to try and work on multiple implementations using multiple language sets (e.g. Rust, Swift Ruby, Python, TS) in parallel as a contingency incase i got stuck and couldn&#x27;t get support with one of them. after submission of our initial application form, will be possible for us to later on change what programming language(s) and language set that we&#x27;ll be using for the one implementation that could be eligible for the JAM prize? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-16 14:48</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Definitions 284 and 291 both define function M_S, just with different arity. The definition section also mentions it twice:  
</div>
<div class='msg'><time>2024-06-16 14:48</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Screenshot 2024-06-16 at 16.48.36.png</div>
<div class='msg'><time>2024-06-16 14:48</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Screenshot 2024-06-16 at 16.48.46.png</div>
<div class='msg'><time>2024-06-16 14:49</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Screenshot 2024-06-16 at 16.48.57.png</div>
<div class='msg'><time>2024-06-16 14:50</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Is it supposed to be disambiguated by their arity, or is it a name clash?</div>
<div class='msg'><time>2024-06-16 16:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: They’re meant to be different functions. The name clash is an oversight. </div>
<div class='msg'><time>2024-06-18 03:05</time>&ensp;<span class='u' style='color:#abc062'>mkalohood</span>: </div>
<div class='msg'><time>2024-06-18 03:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@aedigix:matrix.org&gt; Is there any concerns with endianness for the choice of VM?  EVM is big-endian (not really sure the justification for this as I can&#x27;t find it in the YP)

AFAIK there wasn&#x27;t an especially good reason for it other than it made sense from a mathematician&#x27;s perspective.</div>
<div class='msg'><time>2024-06-18 03:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In any case modern architectures are either natively LE or have LE-compatibility modes, so it makes sense on the VM side to stick with LE.</div>
<div class='msg'><time>2024-06-18 03:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As for serialization, it&#x27;ll be SCALE, so LE also. This can already be seen via the definitions for the encode function. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-18 03:15</time>&ensp;<span class='u' style='color:#abc062'>mkalohood</span>: miss deleting.  The big endian and the little endian have two related concepts: 1. Host order: Different CPUs process data with different byte order types.  Intel X86 CPU is little endian, mips architecture CPU is big endian. 
2, network order, the network transmits data in the way of byte stream, and the byte order type in the transmission process is called network order. It is independent of the CPU/OS type of other specific devices, ensuring that it can be resolved correctly when transferred between different devices. it defines the byte order as the big endian. 

So basically the big endian is used before the network data is sent.

But , I don&#x27;t think the big endian is the deciding factor in VM selection. I think we can take it apart. The VM communication layer and data operation management can be separated.</div>
<div class='msg'><time>2024-06-18 03:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@purpletentacle:matrix.org&gt; ...
&gt; I have also a few of questions about C.2. .. (262) (263)
&gt; 
&gt; - why is H\_j not included when serializing the header? is that correct or an unintentional omission?
&gt; - why there is a claim that E\_U(H) has &quot;no inverse&quot;? wouldn&#x27;t that imply that there is no way to decode a serialized header? (In C.1. &quot;...We define the deserialization function E−1 = E−1 as the inverse of E and able to decode some sequence into the original value....&quot;

On the first point, H_j is not serialized - it&#x27;s auxilliary data implied through E_J. </div>
<div class='msg'><time>2024-06-18 03:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@gav:polkadot.io&gt; - H\_j is not serialized but implied by E\_J.
&gt; - where exactly does it say E\_U(H) cannot have an inverse?

On the second point &quot;the latter has no inverse&quot;, it was merely meant to state that no function <code>D_U(Y) -&amp;gt; H</code> was defined explicitly. However, I removed it as it&#x27;s clearly misleading.</div>
<div class='msg'><time>2024-06-18 03:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@gav:polkadot.io&gt; I believe it is mentioned previously that when hashing, values are assumed to be encoded with the regular serialisation function if they are not explicitly so.

I made this explicit now.</div>
<div class='msg'><time>2024-06-19 13:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 0.2.1 of the paper is tagged and released. </div>
<div class='msg'><time>2024-06-19 20:15</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: image.png</div>
<div class='msg'><time>2024-06-19 20:15</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: sorry to insist on this point.. but it is not 100% clear to me
36) defines the header as including H_J

but later it is not included

 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-19 20:16</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: image.png</div>
<div class='msg'><time>2024-06-19 20:17</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: and when deserializing, it should be kept as ?H\_j = None (optional) if the corresponding extrinsic E\_J is not available? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-19 20:18</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: I find a bit odd that H is defined as &quot;containing&quot; H\_j when it is actually always external to it   <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-19 20:18</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: Btw, I see the definition later at 10.3 but I am still a bit confused and unsure about this value being part of the header or not.. 
is it fair to assume that the seal applies to the encoded header, an as a consequence, it will never include H\_j ?
if that is the case, when is H\_j relevant or useful?
 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-19 23:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes it’s not especially clear and I’ll clarify it for the next minor revision. As of 0.2.1, it doesn’t get serialised or deserialised but is just defined as an equivalence based on the value of E_J. It is used in the definition of Safrole, equation 56. However, in future versions of the spec this may change and it may be featured in the encoding of the header. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-21 04:17</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: image.png</div>
<div class='msg'><time>2024-06-21 04:17</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: something missing here for 0.2.1</div>
<div class='msg'><time>2024-06-21 08:37</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: <pre><code class=''>The judgements state includes three items, an allow-set ($\psi_\mathbf{a}$), a ban-set ($\psi_\mathbf{b}$) and a punish-set ($\psi_\mathbf{p}$). The allow-set contains the hashes of all work-reports which were disputed and judged to be accurate. The ban-set contains the hashes of all work-reports which were disputed and whose accuracy could not be confidently confirmed. The punish-set is a set of keys of Bandersnatch keys which were found to have guaranteed a report which was confidently found to be invalid.
\begin{equation}
  \psi \equiv \tup{\psi_\mathbf{a}, \psi_\mathbf{b}, \psi_\mathbf{p}, \psi_\mathbf{k}}
\end{equation}

`\subsection{Extrinsic}


</code></pre>

it looks like a misplaced backtick.. I would say it can be ignored </div>
<div class='msg reply'><time>2024-06-21 09:29</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: I see, from the <a href="https://github.com/gavofyork/graypaper/commit/973ca32b7fa6e52e3d19eda7bfb1c7019067f32a" target="_blank" rel="noopener">commit history</a>, maybe there are a few other occurences of <code>\psi_\mathbf{k}</code> need to be removed</div>
<div class='msg'><time>2024-06-21 09:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@qiwei:matrix.org&gt; something missing here for 0.2.1

Yes there’s an error there, the latter component should have been removed. </div>
<div class='msg'><time>2024-06-21 09:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It will be fixed in the next revision but feel free to place an issue. </div>
<div class='msg'><time>2024-06-21 09:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@purpletentacle:matrix.org&gt; <pre><code class=''>&gt; The judgements state includes three items, an allow-set ($\psi_\mathbf{a}$), a ban-set ($\psi_\mathbf{b}$) and a punish-set ($\psi_\mathbf{p}$). The allow-set contains the hashes of all work-reports which were disputed and judged to be accurate. The ban-set contains the hashes of all work-reports which were disputed and whose accuracy could not be confidently confirmed. The punish-set is a set of keys of Bandersnatch keys which were found to have guaranteed a report which was confidently found to be invalid.
&gt; \begin{equation}
&gt;   \psi \equiv \tup{\psi_\mathbf{a}, \psi_\mathbf{b}, \psi_\mathbf{p}, \psi_\mathbf{k}}
&gt; \end{equation}
&gt; 
&gt; `\subsection{Extrinsic}
&gt; 
&gt; 
&gt; </code></pre>
&gt; 
&gt; it looks like a misplaced backtick.. I would say it can be ignored 

Again, will be fixed in next revision. </div>
<div class='msg'><time>2024-06-23 13:40</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: For Appendix B.6 (General), B.7 (Accumulate) and Appendix B.8 (Refine) functions:

1. For ω parameter inputs, I did not understand why the number of parameters on the left hand side did not equal that of the right hand side:

- lookup \[h\_o, b\_0, b\_z\] = ω\_{1..4}  (3 vs 4) but then ω\_0 is used so ... ok
- read \[k\_o, k\_z, b\_o, b\_z\] = ω\_{1..5} (4 vs 5) but then w\_0 is used so .. ok
- write \[k\_o, k\_z, v\_o, v\_z\] = ω\_{0..4} (4 vs 5) but there is no w\_4 ... huh?
- new  \[o,l,g\_l, g\_h, m\_l, m\_h\] = ω\_{0..6} (6 vs 7) ... huh?
...
- machine \[p\_o, p\_z, i\] = ω\_{0..3} (3 vs 4) ... huh?
- peek \[n,a,b,l\] = ω\_{0..4} (4 vs 5) ... huh?
... and so on
Then you use ω\_0&#x27; as a return parameter which has nothing to do with the input ω\_0, huh.    ω isn&#x27;t really doing that much for you it seems except to group the inputs, maybe just describe the inputs and output?

2. At least a line or two describing the each function, specifically referencing these ω parameter inputs would help a lot!  Whereas PVM opcode semantics are quite common place and need little additional explication, these functions are the heart of JAM and the additional explication would increase speed of comprehension and reduce guesswork.
3. I believe most of the functions probably deserve at least a passing reference in the main body, or solid exposition around present (242), (246), (252).  We can guess import+export+historical\_lookup but nothing references what peek, poke, machine, assign, delegate, quit (?), ... do yet.
4. invoke = 13 is a copy of solicit and surely deserves a different name to the invoke = 20, like invoke\_accumulate vs invoke\_refine.
5. Not clear what&#x27;s going on with numbers:

- new&#x27;s bump function 42, 9
- designate&#x27;s 176
- invoke=20&#x27;s 13 and 60

6. Not clear why all these 64-bit parameters (g, a, m) have to be split into 2 32-bit and joined back together?
7. A diagram for the whole DA system would be worth a thousand words.  I imagine you have them in your JAM slides.
8. If you don&#x27;t want to add more exposition because you want hyper compactness  ok I get it but maybe using <a href="https://en.wikibooks.org/wiki/LaTeX/Macros" target="_blank" rel="noopener">https://en.wikibooks.org/wiki/LaTeX/Macros</a> will allow implementers to disambiguate notation by just reading latex (?!) -- especially for any overloaded notation (E, W, s, C, c, t, ...) that is used to reference more than one concept, implementers can go look at the LaTeX source, where the macros would be unambiguous.

(Feel free to ignore most of the above, not very confident, just learning =).  Will of course take any edits you make and follow up with deep look to check if I understand in our stubs) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-24 01:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Regarding the use of omega, did you understand that the range is inclusive on the lower bound and exclusive on the upper?</div>
<div class='msg reply'><time>2024-06-24 01:59</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Yes, for the cases that appear to be ranges.   Not all your ω parameters are ranges though.  </div>
<div class='msg reply'><time>2024-06-24 02:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;m not sure what you think the issue is.</div>
<div class='msg reply'><time>2024-06-24 02:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: let [a, b, c] = X_{1..4} seems perfectly comprehensible.</div>
<div class='msg reply'><time>2024-06-24 02:23</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Got it, its clear.  [Normies will think X_{1..4} will have 4 elements.   You obviously think it should have just 3] </div>
<div class='msg reply'><time>2024-06-24 02:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I would draw your attention to Section 3 Notational Conventions:</div>
<div class='msg reply'><time>2024-06-24 02:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: A range may be denoted using an ellipsis for example: \[0, 1, 2, 3\]...2 = \[0, 1\] and \[0, 1, 2, 3\]1⋅⋅⋅+2 = \[1, 2\] <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-06-24 02:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I believe it is not uncommon in computer programming to use (inclusive...exclusive) ranges. Rust, notably, does this. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-06-24 02:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In any case, regardless of convention I have endeavoured to make my notation clear. But it is very important that anyone serious about interpreting the GP thoroughly read and understand Section 3. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-06-24 02:37</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Alright that explication is clear.  Thanks!</div>
<div class='msg'><time>2024-06-24 01:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I’m not sure what your point is when you say “Then you use…”</div>
<div class='msg reply'><time>2024-06-24 02:03</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: My point is that people would expect ω_0 and ω_0&#x27; to be related, of the same rough type -- you take pains in most other cases to have them be the same type.   So, its an expectation violation.</div>
<div class='msg reply'><time>2024-06-24 02:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: ω_0&#x27; is always the return code.</div>
<div class='msg reply'><time>2024-06-24 02:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: ω is always the argument values.</div>
<div class='msg reply'><time>2024-06-24 02:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I see no such violation. Perhaps you were misinterpreting my intentions. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-24 02:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I have intentionally avoided attempting to document the host functions in the GP. They will inevitably get documented eventually as a user-resource. But at present the host function definitions are explicit and unambiguous, the primary point of the GP&#x27;s appendix. Defining them in English as well might lead to people who are less well able to read maths instead relying solely on the English description which will inevitably be more ambiguous and less well defined, increasing the speed of miscomprehension. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-24 02:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; Not clear why all these 64-bit parameters (g, a, m) have to be split into 2 32-bit and joined back together?

How else do you expect to be able to represent a 64-bit value across 32-bit registers? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-06-24 03:47</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: I expected the caller to do this nitty gritty mapping -- I see you mean 100% of ω_{i...j}  are 32-bit registers, now the ω_0&#x27; vs ω_0 being unrelated types makes sense.   </div>
<div class='msg'><time>2024-06-24 02:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Macros have been used on occasion (see e.g. preamble.tex). I will likely increase the usage in time.</div>
<div class='msg'><time>2024-06-24 02:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There will be no diagrams in the GP.</div>
<div class='msg'><time>2024-06-24 02:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; invoke = 13 is a copy of solicit and surely deserves a different name to the invoke = 20, like invoke\_accumulate vs invoke\_refine.

Unintended. <code>invoke = 13</code> will be removed in the next revision. Thanks for reporting this. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-26 13:27</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: &quot;Boolean values. Bs denotes the set of Boolean strings of length s, thus Bs = ⟦{, ⊺}⟧s. When dealing with Boolean values we may assume an implicit equivalence mapping to a bit whereby ⊺ = 1 and  = 0, thus B◻ = ⟦N2⟧◻. We use the function bits(Y) ∈ B to denote the sequence of bits, ordered with the least significant first, which represent the octet sequence Y, thus bits([5, 0]) = [1, 0, 1, 0, 0,...]. &quot;
I didn&#x27;t understand why bits([5, 0]) and not simple bits(5)? What this 0 represent in the [5, 0] sequence? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-26 13:49</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: bits takes an octet (=byte) _sequence_, not just a single byte. 0 is simply the second byte in the sequence.</div>
<div class='msg'><time>2024-06-26 15:48</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: So bits([5]) would be [1,0,1,0,0,0,0,0] and bits([5,0]) would be [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0]?</div>
<div class='msg'><time>2024-06-26 21:20</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-06-26 at 18.19.53.png</div>
<div class='msg'><time>2024-06-26 21:20</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: what is C here?</div>
<div class='msg'><time>2024-06-27 01:26</time>&ensp;<span class='u' style='color:#7fc52e'>sergei_astapov</span>: &gt; &lt;@danicuki:matrix.org&gt; what is C here?

&gt; gav
It’s the beefy commitment set. 
It should be mentioned in the definitions section. 
It’s defined at the end of the accumulation definitions. 
Section 14 iirc. </div>
<div class='msg'><time>2024-06-27 19:56</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Potential issues in Appendix A:

1. <code>sub_imm</code> is missing in A.5.9 - not sure what the opcode is (<code>add_imm</code> is 2) but see: <a href="https://github.com/koute/jamtestvectors/blob/master\_pvm\_initial/pvm/programs/inst\_sub\_imm.json" target="_blank" rel="noopener">https://github.com/koute/jamtestvectors/blob/master\_pvm\_initial/pvm/programs/inst\_sub\_imm.json</a>
vs
<a href="https://github.com/koute/jamtestvectors/blob/master\_pvm\_initial/pvm/programs/inst\_add\_imm.json" target="_blank" rel="noopener">https://github.com/koute/jamtestvectors/blob/master\_pvm\_initial/pvm/programs/inst\_add\_imm.json</a>
2. <code>cmov_imm_iz</code>  appears here as Opcode 85 but is missing in Appendix A
<a href="https://github.com/koute/jamtestvectors/blob/master\_pvm\_initial/pvm/programs/inst\_cmov\_if\_zero\_imm\_ok.json" target="_blank" rel="noopener">https://github.com/koute/jamtestvectors/blob/master\_pvm\_initial/pvm/programs/inst\_cmov\_if\_zero\_imm\_ok.json</a>
3. the family of &quot;branch&quot; opcodes { 24, 30, 47, 48, 41, 43 } are repeated in A.5.9 and A.5.10 -- is this intended?
4. The &quot;above condition&quot; referenced in &quot;In the case that the above condition is not met, then the instruction is considered invalid, and it results in a panic&quot; after (224-227) is not clear to me.
5. <code>mov_reg</code> (op code 82) and <code>sbrk</code> (op code 87) seems to need B and D swapped in some way either in 223 or in the Mutations, whatever works \[but, not sure what <code>sbrk</code> does though\].
6. You have to finish the sentence around (213) &quot;This allows for compact representation of both positive and negative encoded values, important as .&quot;
7. Based on <a href="https://github.com/koute/jamtestvectors/blob/master\_pvm\_initial/pvm/programs/inst\_add.json" target="_blank" rel="noopener">https://github.com/koute/jamtestvectors/blob/master\_pvm\_initial/pvm/programs/inst\_add.json</a> (and many &quot;ALU&quot; operations I think you have a mix up of A, B, D (the <code>inst_add.json</code> has 1+2 =&gt; 3 r\_A = 7, r\_D = 9, r\_B = 8 where w\[r\_A\] = 1, w\[r\_B\] = 2, w\[r\_D\] = 3).  Not sure if its the test vectors that are incorrect or the GP here.
8. The mutations of  <code>cmov_iz</code> (opcode 85) and <code>cmov_nz</code> (opcode 84) appear to be swapped in A.5.11. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-28 05:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Point 6 will be sorted in the next revision.</div>
<div class='msg'><time>2024-06-28 05:59</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. <code>sub_imm</code> doesn&#x27;t exist.</div>
<div class='msg'><time>2024-06-28 07:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 2. Will be fixed.
3. Will be fixed.
4. This refers to the implied decode of the immediate value which could conceivably fail. If the condition cannot fail, then the statement is redundant and you need not pay it any attention.
5. Will be fixed.
6. Will be sorted in the next revision.
7. Not sure what the issue is here. The example you gave seems in line with the GP.
8. Will be fixed. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-28 07:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (Fixed in main) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-28 07:24</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Ok, for 7, the test vector for <code>add</code> is computing 1+2 = 3 with inputs w_7 (1) + w_8 (2) going into w_9 (3) as is easily seen here: <a href="https://github.com/koute/jamtestvectors/blob/master_pvm_initial/pvm/programs/inst_add.json#L28" target="_blank" rel="noopener">https://github.com/koute/jamtestvectors/blob/master_pvm_initial/pvm/programs/inst_add.json#L28</a>  
but looking closely at the test vector code:
(a) decimal 121 is hexadecimal 0x79  (so w_7 are the high order 4 bits INPUT, while the <em>OUTPUT</em> w_9 is the low order 4 bits)  
(b) the byte following (a) is &quot;8&quot; which is the other INPUT 
Basically r_A+r_D are together in one byte with r_B following. 

In contrast, the GP in (227) has both  r_A+r_B put together in one byte and with a byte holding r_D following that byte.  

The fix, I believe, is to adjust (227) subscripts from 
_A, _B, _D 
to 
_D, _A, _B
  </div>
<div class='msg'><time>2024-06-28 07:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I see - for this the tests will be altered (GP stays as is) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-06-30 19:55</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: This is more like a question than some specific correction..  but I feel that there are some information gaps that I am not able to fill and probably other may find in the same situation. Hopefully is not purely because of my lack of knowledge. 

I am confused by how the Bandersnatch ring root function O is defined in 3.0 and/or Appendix G.
This is required to complete the update of the key root in safrole.

...
    \where z &amp;= \mathcal{O}([k_b \mid k \orderedin \gamma&#x27;_\mathbf{k}]) \\
...

The appendix defines:

O(⟦HB ⟧) ≡ PCS_commitment(⟦HB ⟧)

GP points to <a href="https://github.com/davxy/bandersnatch-vrfs-spec/blob/main/specification.pdf" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/blob/main/specification.pdf</a> ( which seems to be work in progress, A few TODOs, etc.). The document briefly defines <code>prove</code> and <code>verify</code>. Proving requires a secret key.. so it could not be applicable to key root update. Verify does not seem to be aplicable either.

- I cannot link with confidence what is PCS_Commitment in Galassi&#x27;s document.
- It is allowed to use external code (FFI) for bandersnatch VRF.

Would it he possible to provide more information about this step in Safrole, expand a bit more the appendix about Bandersnatch VRF or provide some reference on how the test vectors used the reference crate that was used for this purpose?
</div>
<div class='msg'><time>2024-06-30 21:09</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Indeed. I&#x27;m going to update the Bandernatch with some extra info about the procedure used to construct the verifier and how to use it. The real meat of ring proof spec should be delivered by a dedicated document BTW. But apparently this one has not been made public yet. I&#x27;ll try to push for some progress.
For the moment, I think the brst route is to use the reference impl and have a look at the ring proof tests in ark-ec-vrf:
- <a href="https://github.com/davxy/ark-ec-vrfs/blob/3b4b3591aba62d206408052f6ffd5d5aba6d60a5/src/suites/bandersnatch.rs#L206" target="_blank" rel="noopener">https://github.com/davxy/ark-ec-vrfs/blob/3b4b3591aba62d206408052f6ffd5d5aba6d60a5/src/suites/bandersnatch.rs#L206</a>
- <a href="https://github.com/davxy/ark-ec-vrfs/blob/3b4b3591aba62d206408052f6ffd5d5aba6d60a5/src/testing.rs#L70" target="_blank" rel="noopener">https://github.com/davxy/ark-ec-vrfs/blob/3b4b3591aba62d206408052f6ffd5d5aba6d60a5/src/testing.rs#L70</a>
This gives you an idea of how the data in the test vectors (the ring verifier key) is constructed and the used to verify some proof.</div>
<div class='msg'><time>2024-07-01 00:51</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: davxy: gav  Some freshman questions on Safrole:

1. For your Safrole test vectors (&quot;tiny&quot;), what are the values of
$jam\_entropy  (was BYTES( &quot;sassafras\_randomness&quot;))
$jam\_ticket\_seal  (was BYTES(&quot;sassafras\_ticket\_seal&quot;))
$jam\_fallback\_seal (was BYTES(&quot;sassafras\_fallback\_seal&quot;))
and what  term in the GP does &quot;entropy&quot; (documented with&quot;Per block entropy (originated from block entropy source VRF)&quot;) refer to from the test vector
<a href="https://github.com/w3f/jamtestvectors/blob/master/safrole/publish-tickets-no-mark-6.json#L4" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/master/safrole/publish-tickets-no-mark-6.json#L4</a>
?
2. I see &quot;attempt&quot; and &quot;attempts\_number&quot; was renamed to &quot;entry index&quot; and &quot;N&quot; in GP, but what happened to the &quot;ticket threshold&quot; and &quot;redundancy\_factor&quot; - are those \[what I thought key\] concepts gone (in which case, how?) or to be documented still?
3. Since a high level goal of JAM Implementation is to get NON-Rust implementations for Safrole almost everyone will surely use FFI into your recommended crypto package.  Can you ( @davxy) provide a single working test case like say this one
<a href="https://github.com/w3f/jamtestvectors/blob/master/safrole/publish-tickets-no-mark-6.json" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/master/safrole/publish-tickets-no-mark-6.json</a>
(or the scale equivalent) to set up the ring verifier, get the ring vrf output, and get the entropy buffer updated?  With a single well-worked out test case in Rust handing the &quot;Bare VRF&quot; and &quot;Ring VRF&quot; (specifically making the specific flavors exceptionally clear to &quot;I&#x27;m not a cryptographer, I just use cryptography&quot; engineers), I&#x27;ll bet everyone can use that to set up their <code>extern &amp;quot;C&amp;quot;</code> type FFI and pass most of the cases in rapid order.  Is this possible?
4. For the &quot;tickets\_verifier\_key&quot; eg
<a href="https://github.com/w3f/jamtestvectors/blob/master/safrole/publish-tickets-no-mark-6.json#L210" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/master/safrole/publish-tickets-no-mark-6.json#L210</a>
they are 384 bytes and it is labeled as &quot;gamma\_z: The Bandersnatch ring root.&quot; in <code>safrole.asn</code>. However in GP it is documented as being element Y\_R in (47) but in I.1.2 it says it is 144 bytes.  Can you explain further what this discrepancy could be due to? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-01 08:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @davxy ^^^</div>
<div class='msg'><time>2024-07-01 09:01</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: sourabhniyogi:

1. For Safrole test vectors the only thing we use is $jam\_ticket\_seal.
In particular this is used for the ring-vrf input construction (context in the GP) to obtain the ticket score (aka ticket-id)  during the candidate ticket verification procedure.
The value of $jam\_ticket\_seal&quot; is constant and defined as &quot;jam\_ticket\_seal&quot; ASCII string.
This is a thing that applies in general for values starting with <code>$</code> (e.g. <code>$foo</code> in the GP =&gt; <code>&amp;quot;foo&amp;quot;</code> ascii string).
(Thank you BTW as I&#x27;ve just spotted that I was using &quot;jam\_seal&quot; instead of &quot;jam\_ticket\_seal&quot;, I&#x27;ll add the fix to the upcoming vectors PR)
The other constant strings ($jam\_fallback\_seal and $jam\_entropy) are used for block verification and per-block entropy production (which is passed as input to Safrole).
NOTE: The actual value of per-block entropy used by the Safrole test vectors is not relevant to have been really produced using the signature in the header. Here we abstract away from the value&#x27;s origin, we don&#x27;t really care for the sake of the Safrole test vectors and Safrole STF. In the specific case I&#x27;ve used:

    - entropy\_0 = blake2b(\[42\_u8; 32\])\[..32\]
    - entropy\_i+1 = blake2b(entropy\_i)\[..32\]
2. If you take as a reference the Sassafras RFC then there some differences.
One of these is the attempts number and redundancy factor, which in the GP are in practice simplified to one single thing (attempts number).
Threshold is gone.
Even though reading Sassafras RFC can help (as it is a quite similar protocol), always take the GP as the source of truth for JAM.
3. Sure thing. I&#x27;ll post here as soon as it is ready.
4. This is a very interesting observation. Current implementation serializes 3 extra fields (part of the SNARK SRS).
Serialization of these fields may be important **in a general application**, but here these values are constant.
I will definitely get rid of these from serialized data (I&#x27;m on it). The final size will be 144 (i.e. the last 144 bytes of what you see right now) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-01 09:16</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: &gt; &lt;@davxy:matrix.org&gt; sourabhniyogi:
&gt; 
&gt; 1. For Safrole test vectors the only thing we use is $jam\_ticket\_seal.
&gt; In particular this is used for the ring-vrf input construction (context in the GP) to obtain the ticket score (aka ticket-id)  during the candidate ticket verification procedure.
&gt; The value of $jam\_ticket\_seal&quot; is constant and defined as &quot;jam\_ticket\_seal&quot; ASCII string.
&gt; This is a thing that applies in general for values starting with <code>$</code> (e.g. <code>$foo</code> in the GP =&gt; <code>&amp;quot;foo&amp;quot;</code> ascii string).
&gt; (Thank you BTW as I&#x27;ve just spotted that I was using &quot;jam\_seal&quot; instead of &quot;jam\_ticket\_seal&quot;, I&#x27;ll add the fix to the upcoming vectors PR)
&gt; The other constant strings ($jam\_fallback\_seal and $jam\_entropy) are used for block verification and per-block entropy production (which is passed as input to Safrole).
&gt; NOTE: The actual value of per-block entropy used by the Safrole test vectors is not relevant to have been really produced using the signature in the header. Here we abstract away from the value&#x27;s origin, we don&#x27;t really care for the sake of the Safrole test vectors and Safrole STF. In the specific case I&#x27;ve used:
&gt; 
&gt;     - entropy\_0 = blake2b(\[42\_u8; 32\])\[..32\]
&gt;     - entropy\_i+1 = blake2b(entropy\_i)\[..32\]
&gt; 2. If you take as a reference the Sassafras RFC then there some differences.
&gt; One of these is the attempts number and redundancy factor, which in the GP are in practice simplified to one single thing (attempts number).
&gt; Threshold is gone.
&gt; Even though reading Sassafras RFC can help (as it is a quite similar protocol), always take the GP as the source of truth for JAM.
&gt; 3. Sure thing. I&#x27;ll post here as soon as it is ready.
&gt; 4. This is a very interesting observation. Current implementation serializes 3 extra fields (part of the SNARK SRS).
&gt; Serialization of these fields may be important **in a general application**, but here these values are constant.
&gt; I will definitely get rid of these from serialized data (I&#x27;m on it). The final size will be 144 (i.e. the last 144 bytes of what you see right now)

I think the <code>[..32]</code> after the blake2b is not correct, see <a href="https://github.com/w3f/jamtestvectors/issues/6" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/issues/6</a></div>
<div class='msg'><time>2024-07-01 09:18</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: I&#x27;ve just seen your issue. Yeah truncated Blake2b-512 has been used for the test vectors. Need to change to blake2b 256. Thank you <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-01 09:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.2.2" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.2.2</a> is tagged and download available.</div>
<div class='msg'><time>2024-07-01 11:06</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: &gt; Blake2b-512 has been used for the test vectors. Need to change to blake2b 256.
&gt; &quot;jam_seal&quot; instead of &quot;jam_ticket_seal&quot;, I&#x27;ll add the fix to the upcoming vectors PR)

Should we then assume that current test vectors are incorrect and wait for the next release?
As @sourabhniyogi explained, having access to something like 3) as primitives could be very useful... because it can also help to detect these subtle issues in the test vectors themselves

Thank you again for the great responsiveness</div>
<div class='msg'><time>2024-07-01 11:56</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: &gt; &lt;@davxy:matrix.org&gt; sourabhniyogi:
&gt; 
&gt; 1. For Safrole test vectors the only thing we use is $jam\_ticket\_seal.
&gt; In particular this is used for the ring-vrf input construction (context in the GP) to obtain the ticket score (aka ticket-id)  during the candidate ticket verification procedure.
&gt; The value of $jam\_ticket\_seal&quot; is constant and defined as &quot;jam\_ticket\_seal&quot; ASCII string.
&gt; This is a thing that applies in general for values starting with <code>$</code> (e.g. <code>$foo</code> in the GP =&gt; <code>&amp;quot;foo&amp;quot;</code> ascii string).
&gt; (Thank you BTW as I&#x27;ve just spotted that I was using &quot;jam\_seal&quot; instead of &quot;jam\_ticket\_seal&quot;, I&#x27;ll add the fix to the upcoming vectors PR)
&gt; The other constant strings ($jam\_fallback\_seal and $jam\_entropy) are used for block verification and per-block entropy production (which is passed as input to Safrole).
&gt; NOTE: The actual value of per-block entropy used by the Safrole test vectors is not relevant to have been really produced using the signature in the header. Here we abstract away from the value&#x27;s origin, we don&#x27;t really care for the sake of the Safrole test vectors and Safrole STF. In the specific case I&#x27;ve used:
&gt; 
&gt;     - entropy\_0 = blake2b(\[42\_u8; 32\])\[..32\]
&gt;     - entropy\_i+1 = blake2b(entropy\_i)\[..32\]
&gt; 2. If you take as a reference the Sassafras RFC then there some differences.
&gt; One of these is the attempts number and redundancy factor, which in the GP are in practice simplified to one single thing (attempts number).
&gt; Threshold is gone.
&gt; Even though reading Sassafras RFC can help (as it is a quite similar protocol), always take the GP as the source of truth for JAM.
&gt; 3. Sure thing. I&#x27;ll post here as soon as it is ready.
&gt; 4. This is a very interesting observation. Current implementation serializes 3 extra fields (part of the SNARK SRS).
&gt; Serialization of these fields may be important **in a general application**, but here these values are constant.
&gt; I will definitely get rid of these from serialized data (I&#x27;m on it). The final size will be 144 (i.e. the last 144 bytes of what you see right now)

Thank you!  </div>
<div class='msg'><time>2024-07-01 16:41</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Alright we&#x27;re getting there.

I&#x27;ve updated the <a href="https://github.com/w3f/jamtestvectors/pull/5" target="_blank" rel="noopener">PR</a> with all the fixes we&#x27;ve discussed so far. Check the description for the changes.
(if you find / suspect something else please tell)

In order to reduce the ring keys commitment to 144 (as per GP) I had to patch an upstream dependency. So I&#x27;ll temporarily point ark-ec-vrfs to the patched <code>ring-proof</code> for the moment (not pushed yet, I&#x27;ll notify here when ready).

Juan Leni | zondax.ch Yeah. Unfortunately there was the blake2b thing that invalidated tickets data and some pseudo randomly constructed things that were depending on the hash previously used.

For tomorrow you&#x27;ll have a clear example of how to use ring vrf (maybe I&#x27;ll put it in the bandersnatch-specs repo) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-02 18:04</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: <a href="https://github.com/davxy/bandersnatch-vrfs-spec/commit/9bf454693a8e27776bd1bdde551dda4b51f22451" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/commit/9bf454693a8e27776bd1bdde551dda4b51f22451</a>

A couple of trivial examples pushed in the specs repo.</div>
<div class='msg'><time>2024-07-02 19:43</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Thank you, this simplifies &quot;which flavor&quot; questions a lot!  But how can we construct <code>_vrf_output</code> not from 
<pre><code class=''>let _vrf_output = &amp;output.hash()[..32];
</code></pre>
(which uses one of the randomly generated secrets
<pre><code class=''>let output = secret.output(input);
</code></pre>
) but instead from the extrinsic signature ALONE
<a href="https://github.com/w3f/jamtestvectors/blob/master/safrole/publish-tickets-no-mark-2.json#L8" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/master/safrole/publish-tickets-no-mark-2.json#L8</a>
(and the verifier key and/or the set of authorities that can submit tickets)

This expectation of  <code>vrf_signed_output(signature)</code> being possible was set by this line here
<a href="https://github.com/polkadot-fellows/RFCs/blob/main/text/0026-sassafras-consensus.md?plain=1#L228C34-L228C62" target="_blank" rel="noopener">https://github.com/polkadot-fellows/RFCs/blob/main/text/0026-sassafras-consensus.md?plain=1#L228C34-L228C62</a>
and codified in 
GP 0.2.2 (303)+(306)
I think we would like a &quot;fn ring_verify()&quot; [and &quot;fn ietf_verify()&quot;] that does NOT set up a prover with any secret generation at all.  Is this reasonable?</div>
<div class='msg'><time>2024-07-02 21:52</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: It is quite easy. The signature you see in the extrinsic is a ring signature.
You can deserialize it into the <code>RingSignature</code> struct you see in the example (the one who contain the output+ring proof).
Once deserialized you can:
- validate the proof constructing the Verifier as the example show
- use the struct&#x27;s output entry to actually generate the vrf output hash

Does this help? 
To be more concrete, I&#x27;ll add an example as you suggested <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-02 22:30</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: &gt; &lt;@davxy:matrix.org&gt; It is quite easy. The signature you see in the extrinsic is a ring signature.
&gt; You can deserialize it into the <code>RingSignature</code> struct you see in the example (the one who contain the output+ring proof).
&gt; Once deserialized you can:
&gt; - validate the proof constructing the Verifier as the example show
&gt; - use the struct&#x27;s output entry to actually generate the vrf output hash
&gt; 
&gt; Does this help? 
&gt; To be more concrete, I&#x27;ll add an example as you suggested

Yes that final example should do it, wonderful</div>
<div class='msg'><time>2024-07-02 23:20</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: I&#x27;ve updated the example in the spec repo. Check that out</div>
<div class='msg reply'><time>2024-07-03 16:36</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: is 20-24 secs the typical time for ring\_prove\_verify? 
running in a macbook with M3
.. wow.. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-03 17:34</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Not really. Is a bit too much :-)
<pre><code class=''>❯ cargo run  --release
   Compiling ark-ec-vrfs-bandersnatch-example v0.1.0 (/mnt/ssd/develop/bandersnatch-vrfs-spec/example)
    Finished `release` profile [optimized] target(s) in 1.48s
     Running `target/release/ark-ec-vrfs-bandersnatch-example`
* Time taken by ring-vrf-sign: 629.248169ms
Ring signature verified
 vrf-output-hash: 6b260bfda2e3ef118c529f30b60dfa4678fbeef3682b55ba002aa8633f1b0364
* Time taken by ring-vrf-verify: 6.105183ms
* Time taken by ietf-vrf-sign: 394.206µs
Ietf signature verified
 vrf-output-hash: 6b260bfda2e3ef118c529f30b60dfa4678fbeef3682b55ba002aa8633f1b0364
* Time taken by ietf-vrf-verify: 599.059µs
</code></pre>

I have a beefy threadripper 3970X, but I don&#x27;t expect 24s

See here latest benchmarks: <a href="https://github.com/davxy/crypto-benches/blob/main/vrf/README.md#verify" target="_blank" rel="noopener">https://github.com/davxy/crypto-benches/blob/main/vrf/README.md#verify</a></div>
<div class='msg reply'><time>2024-07-03 17:38</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Proving is expected to be slow (well not that slow). But proving is done once per epoch, offchain and by powerful enough candidate validators</div>
<div class='msg reply'><time>2024-07-03 17:46</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Verification is more critical. Number of tickets per block is limited to 16 (by the GP) and multiple tickets verification can be done in parallel.</div>
<div class='msg reply'><time>2024-07-03 17:50</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Oh. I also forgot to add the &quot;parallel&quot; feature to <code>ark-ec-vrfs</code>.

These are the timings (as you can see proving is a lot faster):

<pre><code class=''>❯ cargo run --release
* Time taken by ring-vrf-sign: 156.818104ms
Ring signature verified
 vrf-output-hash: 6b260bfda2e3ef118c529f30b60dfa4678fbeef3682b55ba002aa8633f1b0364
* Time taken by ring-vrf-verify: 6.4541ms
* Time taken by ietf-vrf-sign: 412.089µs
Ietf signature verified
 vrf-output-hash: 6b260bfda2e3ef118c529f30b60dfa4678fbeef3682b55ba002aa8633f1b0364
* Time taken by ietf-vrf-verify: 613.725µs
</code></pre> <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-23 00:46</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: The key insight, we found, is from RFC 26 \[which we&#x27;re not supposed to read and get too confused by because Safrole != Sassafras, but is an excellent introduction nevertheless \] in these:

(a)

<pre><code class=''>ietf_vrf_output (Non anonymous VRF): vrf_output(secret, input) == vrf_signed_output(signature) 
</code></pre>

(b)

<pre><code class=''>ring_vrf_output (Anonymous VRF): vrf_signed_output(signature) == ring_vrf_signed_output(ring_signature);
</code></pre>

The (a) case has the block author reveal himself through the signature of (a) in block authoring, and you can consider that &quot;Non anonymous VRF&quot;

The (b) does NOT reveal the ticket submitter, you can consider that a &quot;Anonymous VRF&quot;, which is the beauty of RingVRFs, an important invention.

The key AHA I think for people is you will put (a)+(b) together with the same Bandersnatch key like so:

vrf\_output(secret, input) == vrf\_signed\_output(signature) == ring\_vrf\_signed\_output(ring\_signature)

and this basically maps onto this line here from davxy :

<a href="https://github.com/davxy/bandersnatch-vrfs-spec/blob/1ec75e9a3af3a2be7dbca5090171c01e29ac5854/example/src/main.rs#L268C33-L268C48" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/blob/1ec75e9a3af3a2be7dbca5090171c01e29ac5854/example/src/main.rs#L268C33-L268C48</a>

Once you understand that, all the GP notation will fall into place for you I hope.  The ticket submitter uses (b) _anonymously_ and once its time to author blocks (assuming its the non-fallback case, and his ticket submission is among the lowest), he uses (a) _non-anonymously_.  The ticketid is the VRF output common to both (a)+(b). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-03 00:08</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Perfect, thank you!  I think most non-cryptographer non-Rust engineers can jump into this and execute now.  [We will proceed to try to pass our first few tiny tests with a FFI, hope others will do the same] <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-04 00:20</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: davxy: We succeeded with our FFI, but did not get a &quot;tiny&quot; extrinsic verification to work yet:

<a href="https://github.com/w3f/jamtestvectors/pull/5#issuecomment-2207625234" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/5#issuecomment-2207625234</a>

What did we miss?</div>
<div class='msg'><time>2024-07-04 10:28</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Test vectors PR updated to make use of a not &quot;random&quot; SRS (the stuff used to construct the RingContext).
Check the README for some pointers and update ark-ec-vrfs for new constructor.</div>
<div class='msg reply'><time>2024-07-04 12:26</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Got it -- I got the new ring_context and am pulling the binary of &quot;zcash-srs-2-11-uncompressed.bin&quot; but still no verification yet: <a href="https://github.com/w3f/jamtestvectors/pull/5#issuecomment-2208850402" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/5#issuecomment-2208850402</a>
What did we miss?</div>
<div class='msg reply'><time>2024-07-04 13:16</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Replied in the PR</div>
<div class='msg reply'><time>2024-07-04 14:34</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Woohoo!  Thank you!</div>
<div class='msg reply'><time>2024-07-06 05:27</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: We are succeeding with most of the STF successfully thanks to your example, but have a few outstanding cases in &quot;tiny&quot; to address: 

<a href="https://github.com/w3f/jamtestvectors/pull/5#issuecomment-2211649983" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/5#issuecomment-2211649983</a>

Can you kindly advise?</div>
<div class='msg'><time>2024-07-04 12:34</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Question: In Section 15 Guaranteeing &quot;With two guarantor signatures, the work-report may be distributed to the forthcoming Jam chain block author in order to be used in the E_G, which leads to a reward for the guarantors.&quot; .. but how could  a work-report be distributed to a _forthcoming_ block author if via Safrole block authors are only knowable when they actually reveal themselves when they actually author the block?</div>
<div class='msg'><time>2024-07-04 12:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: By distributing to all possible block authors (i.e. all validators). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-04 12:59</time>&ensp;<span class='u' style='color:#2fbc2e'>purpletentacle</span>: I know networking is still not fully defined.. but I have a quick follow up question on that.. the idea in jam is that every node will connect to every other node and there will be no gossip at all, right? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-04 15:56</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Here is working verification in Rust (with matching &quot;gamma_z&quot; =)) for &quot;tiny&quot; case in @davxy PR:  <a href="https://gist.github.com/sourabhniyogi/7097609935fc7a584d71731acdf32027" target="_blank" rel="noopener">https://gist.github.com/sourabhniyogi/7097609935fc7a584d71731acdf32027</a>

Thank you davxy !</div>
<div class='msg'><time>2024-07-04 16:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@purpletentacle:matrix.org&gt; I know networking is still not fully defined.. but I have a quick follow up question on that.. the idea in jam is that every node will connect to every other node and there will be no gossip at all, right?

Yes indeed.</div>
<div class='msg'><time>2024-07-04 16:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;s still a WiP, but you can get a feel for the basic networking protocol <a href="https://hackmd.io/@polkadot/jamsnp" target="_blank" rel="noopener">https://hackmd.io/@polkadot/jamsnp</a></div>
<div class='msg'><time>2024-07-04 16:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There will likely be two revisions of the protocol - one initial JAMSNP focusing on simplicity and speed of implementation and a second JAMNP focussed on optimisation and security. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-04 22:59</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Thank you for this sketch, its very helpful!  Is it reasonable to have a &quot;tiny&quot; setup (like 6 validators, single team with  _maybe_ another team, enabling Milestone 1 &quot;solo&quot; networking PoC, easy to simulate and then run QUIC for real), &quot;medium&quot; setup (like 16-32 validators, enabling Milestone 2 &quot;multi-team&quot; networking PoC with like 4-5 teams, possible to simulate and do for real for a single team though with some basic resources) WELL before the 1023 validator set up (which few teams will have resources for, not sure if its even possible to simulate?).  I am wondering if a &quot;lite Appendix H&quot; (not in GP, but suitable for Milestone 1+2) Erasure coding would be worth it to support tiny and medium cases for simplicity / speed of implementation in this tiny vs medium situation, and could have significant utility in the next 6-9 months?   <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-05 00:23</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: we will have JAM Toaster for the 1023 validators setup</div>
<div class='msg'><time>2024-07-05 00:24</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: those constants should be configurable and in theory all we need to do is config the node with corresponding values</div>
<div class='msg'><time>2024-07-05 00:25</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: (I had the mistake to hardcoded the constants and later need to refactor the code to make them configurable)</div>
<div class='msg'><time>2024-07-05 02:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Absolutely!  I mean to ask if before 341\*3=1023 (JAM Toaster sized) we can have

- tiny C=2 x 3 = 6 validators
- xsmall  C = 4 x 3 = 12 validators
- small C = 6 x 3 = 18 validators
- medium  C = 10 x 3 = 30 validators
- large C = 30 x 3 = 90 validators
- xlarge C = 50 x 3 =150 validators
- xxlarge C = 100 x 3 = 300 validators
- The Toaster C = 341 x 3 = 1023 validators
where we can just have different RS codes in various JAM configurations to match.  I believe we only need 3 configurations (one for the first 3 milestones), but I think the RS code of 342:1026 is &quot;impedance matched&quot; to C=341+1 so probably there are more perfect values of C than others for smaller C?

Is the concept of a &quot;bootnode&quot; gone?  Where does the 18 byte per validator directory live? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-05 02:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: there is a 32 bytes metadata in the validator key</div>
<div class='msg'><time>2024-07-05 02:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: which contains the ipv6 address</div>
<div class='msg'><time>2024-07-05 02:44</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: but I guess we still need some bootnodes, it is just that technically the network doesn’t need it to be alive so it doesn&#x27;t need to be specified? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-05 02:45</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: we can still have some implementation specific genesis config that includes some bootnodes and could make it such way that all implementations to support such format. it is just that this doesn&#x27;t need to be defined in GP</div>
<div class='msg'><time>2024-07-05 04:45</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: &gt; &lt;@gav:polkadot.io&gt; There will likely be two revisions of the protocol - one initial JAMSNP focusing on simplicity and speed of implementation and a second JAMNP focussed on optimisation and security.

What&#x27;s the plan for in-browser light clients? Would be good to have something web socket based (or maybe even REST 🤪) since nothing more fancy can be initiated from the browser context afair.
Alternatively I can imagine a websocket&lt;&gt;jam gateway but if it&#x27;s not part of major client implementations we are risking heavy centralization and/or monoculture of implementations that one can connect to.</div>
<div class='msg'><time>2024-07-05 11:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: bootnodes are always a painpoint. JAM won&#x27;t address them directly, but we might use something like IPFS or WebTorrent to distribute them in a resilient way. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-05 11:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: yes indeed - this should be figured out and standardised fairly early on, but it&#x27;s not crucial for the (validator) protocol per se. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-05 12:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room another new release <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.2.3" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.2.3</a></div>
<div class='msg'><time>2024-07-06 13:55</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Hi everyone! In Appendix H of the Gray paper, we are trying to understand what GF(16) means.  In the latest version of the Gray paper, it is mentioned that 16-bit GF points are selected, so we believe that the GF(16) here should refer to GF(2^16).  -- do we understand this correctly?</div>
<div class='msg'><time>2024-07-06 14:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: yes :)</div>
<div class='msg'><time>2024-07-07 03:04</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: &gt; &lt;@gav:polkadot.io&gt; yes :)

Thank you!</div>
<div class='msg'><time>2024-07-07 10:53</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: I dont understand how the selection of fallback keys works here. It looks like <code>k</code> is being indexed with a random index (i assume <code>u32</code>).  
But <code>k</code> only has 600 elements, so it will try to access invalid indices? Is there a hidden modulo somewhere? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-07 10:53</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Screenshot 2024-07-07 at 12.49.08.png</div>
<div class='msg'><time>2024-07-07 11:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The little circular arrow functions as a modulus. </div>
<div class='msg'><time>2024-07-07 11:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: See the definition in the notation section. </div>
<div class='msg'><time>2024-07-08 05:36</time>&ensp;<span class='u' style='color:#c42eb3'>bhcme</span>: Hi everyone! 👋 

I wonder why the rate of 342:1026 is used for erasure coding, as stated in the opening sentence of Appendix H, Erasure Coding: “The foundation of the data-availability and distribution system of Jam is a systematic Reed-Solomon erasure coding function in gf(16) of rate 342:1026, as defined by Lin, Chung, and Han 2014.”

In particular, the precondition for the efficient implementation of the Reed-Solomon encoding and erasure decoding algorithm mentioned in the above paper only applies for (n = 2^r, k)</div>
<div class='msg'><time>2024-07-08 06:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Can we get PVM Host function test cases soon?  Here is my wish:
<a href="https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2212706605" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2212706605</a>

Some candidate typo fixes for Appendix B: \[for GP v0.2.3\]

1. For <code>info</code>, it has <code>b_o</code> instead of <code>o</code> on the 4th mutation 
2. For <code>designate</code>, does the 176 (144+32 I gather?) need to be 336 to match (51)-(55)?  If not, what is the content of the 176 bytes per validator?
3. For <code>peek</code>, it seems to need <code>l</code> instead of <code>i</code>  on 2nd and 3rd mutation lines
4. Similarly for <code>poke</code>, it seems to need <code>l</code> instead of <code>i</code> on 3rd and 4th mutation lines <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-08 08:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Appendix A and B are rather different things so it makes little sense to comment on that PR.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-08 08:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Can we get PVM Host function test cases soon?  Here is my wish:
&gt; <a href="https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2212706605" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2212706605</a>
&gt; 
&gt; Some candidate typo fixes for Appendix B: [for GP v0.2.3]
&gt; 1. For <code>info</code>, it has <code>b_o</code> instead of <code>o</code> on the 4th mutation lin3
&gt; 2.  For <code>designate</code>, does the 176 (144+32 I gather?) might need to be 336 to match (51)-(55)?  If not, what is the content of the 176 bytes per validator?
&gt; 3. For <code>peek</code>, it seems to need <code>l</code> instead of <code>i</code>  on 2nd and 3rd mutation lines 
&gt; 4. Similarly for <code>poke</code>, it seems to need <code>l</code> instead of <code>i</code> on 3rd and 4th mutation lines
&gt; 

Test vectors will arrive when they’re ready and in the order that they’re ready. I’d caution you not to be pushy about it. Doing so will not aid their swift arrival. </div>
<div class='msg'><time>2024-07-12 14:31</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: </div>
<div class='msg'><time>2024-07-12 14:32</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: jam-dependencies.jpeg</div>
<div class='msg reply'><time>2024-07-12 14:34</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: here is the source code for it (generate image at: <a href="https://yuml.me/)" target="_blank" rel="noopener">https://yuml.me/)</a>

<pre><code class=''>// greek letters
// -----------------------
[τ&#x27;] -&gt; [H]

[β&#x27;] -&gt; [H]
[β&#x27;] -&gt; [EG]
[β&#x27;] -&gt; [C]

[γ&#x27;] -&gt; [H]
[γ&#x27;] -&gt; [τ]
[γ&#x27;] -&gt; [ET]
[γ&#x27;] -&gt; [γ]
[γ&#x27;] -&gt; [ι]
[γ&#x27;] -&gt; [η&#x27;]
[γ&#x27;] -&gt; [κ&#x27;]

[η&#x27;] -&gt; [H]
[η&#x27;] -&gt; [η]
[η&#x27;] -&gt; [τ]

[κ&#x27;] -&gt; [H]
[κ&#x27;] -&gt; [τ]
[κ&#x27;] -&gt; [κ]
[κ&#x27;] -&gt; [γ]
[κ&#x27;] -&gt; [ψ&#x27;]

[λ&#x27;] -&gt; [H]
[λ&#x27;] -&gt; [τ]
[λ&#x27;] -&gt; [λ]
[λ&#x27;] -&gt; [κ]

[ψ&#x27;] -&gt; [EJ]
[ψ&#x27;] -&gt; [ψ]

[δ†] -&gt; [EP]
[δ†] -&gt; [δ]
[δ†] -&gt; [τ&#x27;]

[ρ†] -&gt; [EJ]
[ρ†] -&gt; [ρ]

[ρ‡] -&gt; [EA]
[ρ‡] -&gt; [ρ†]

[ρ&#x27;] -&gt; [EG]
[ρ&#x27;] -&gt; [ρ‡]
[ρ&#x27;] -&gt; [κ]
[ρ&#x27;] -&gt; [τ&#x27;]

[δ&#x27;
χ&#x27;
ι&#x27;] -&gt; [EA]
[δ&#x27;
χ&#x27;
ι&#x27;] -&gt; [ρ&#x27;]
[δ&#x27;
χ&#x27;
ι&#x27;] -&gt; [δ†]
[δ&#x27;
χ&#x27;
ι&#x27;] -&gt; [χ]
[δ&#x27;
χ&#x27;
ι&#x27;] -&gt; [ι]
[δ&#x27;
χ&#x27;
ι&#x27;] -&gt; [φ] 

[φ&#x27;] -&gt; [EA]
[φ&#x27;] -&gt; [ρ&#x27;]
[φ&#x27;] -&gt; [δ†]
[φ&#x27;] -&gt; [χ]
[φ&#x27;] -&gt; [ι]
[φ&#x27;] -&gt; [φ] 

[C] -&gt; [EA]
[C] -&gt; [ρ&#x27;]
[C] -&gt; [ρ†]
[C] -&gt; [χ]
[C] -&gt; [ι]
[C] -&gt; [φ] 

[α&#x27;] -&gt; [EG]
[α&#x27;] -&gt; [φ&#x27;] 
[α&#x27;] -&gt; [α] 

[π&#x27;] -&gt; [EG]
[π&#x27;] -&gt; [EP]
[π&#x27;] -&gt; [EA]
[π&#x27;] -&gt; [ET]
[π&#x27;] -&gt; [τ&#x27;]
[π&#x27;] -&gt; [τ]
[π&#x27;] -&gt; [π]
</code></pre> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-12 14:33</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I have created a diagram mapping all state transition components dependencies. I hope it is useful.</div>
<div class='msg'><time>2024-07-13 19:19</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hello everyone,

I have some questions, I don&#x27;t know if I should post them here or on the Jam Chat channel but 🤷‍♂️ here we go :

### Appendix G:

1. **Signature Set and Key Generation:**
    - To confirm, is ( F\_{m,k} ) the set of signatures using the IETF VRF (as per Goldberg 2023) where keys are generated from the Bandersnatch curve?
2. **Size of Y:**
    - Why is ( Y ) of size 96 bytes? We perform <code>decode(x:32)</code> and <code>decode(x32:)</code>. Does this mean that the first 32 bytes are the public key and the rest is additional data?
3. **Merkle Root and Public Keys:**
    - To confirm, is ( O(\[H\_B\]) ) the Merkle root of the Merkle tree where the leaves are the authors&#x27; public keys?
4. **Use of RingVRF:**
    - To confirm, do we use the ring VRF from the Jeffrey 2023 paper, with the first ring VRF construction (part 4 of the paper) and with \( \text{Com}^*.\text{Commit}(\text{ring}) = O([H_B]) \)
5. **Size of Y (second instance):**
    - Why is ( Y ) of size 784 bytes? We perform <code>decode(x:32)</code> and <code>decode(x32:)</code> again. Does this mean that the first 32 bytes are the public key and the rest is additional data? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-13 19:20</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: ### Appendix I.4.5:

1. **$jam_fallback_seal:**
   - For <code>$jam_fallback_seal</code>, do we create an output with the VRF Bandersnatch as mentioned in the questions above? If yes, what arguments, context, and additional data are required?

2. **$jam_ticket_seal:**
   - For <code>$jam_ticket_seal</code>, do we use the VRF RingVRF? If yes, what arguments, context, and additional data are required?

3. **$jam_entropy:**
   - For <code>$jam_entropy</code>, related to on-chain entropy generation, what does it mean, and how do we compute it?

### Equation (59):

1. **Understanding Components:**
   - What are \( i_y \), \( i_r \), \( H_a \), \( H \), and \( E_U(H) \)?

### Equation (60):

1. **Defining \( H_a \):**
   - Do we define \( H_a \) with the \( i \) from the equation &quot;let \( i = \gamma_s&#x27;[H_t]^{\circlearrow}&quot;?

2. **Understanding \( H \) and \( E_U(H) \):**
   - What is \( H \) and \( E_U(H) \)?


</div>
<div class='msg'><time>2024-07-13 19:20</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Let me know if I should move them to other channel or if you need more precisions
Thank you in advance</div>
<div class='msg'><time>2024-07-14 06:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@celadari:matrix.org&gt; Hello everyone,
&gt; 
&gt; I have some questions, I don&#x27;t know if I should post them here or on the Jam Chat channel but 🤷‍♂️ here we go :
&gt; 
&gt; ### Appendix G:
&gt; 
&gt; 1. **Signature Set and Key Generation:**
&gt;     - To confirm, is ( F\_{m,k} ) the set of signatures using the IETF VRF (as per Goldberg 2023) where keys are generated from the Bandersnatch curve?
&gt; 2. **Size of Y:**
&gt;     - Why is ( Y ) of size 96 bytes? We perform <code>decode(x:32)</code> and <code>decode(x32:)</code>. Does this mean that the first 32 bytes are the public key and the rest is additional data?
&gt; 3. **Merkle Root and Public Keys:**
&gt;     - To confirm, is ( O(\[H\_B\]) ) the Merkle root of the Merkle tree where the leaves are the authors&#x27; public keys?
&gt; 4. **Use of RingVRF:**
&gt;     - To confirm, do we use the ring VRF from the Jeffrey 2023 paper, with the first ring VRF construction (part 4 of the paper) and with \( \text{Com}^*.\text{Commit}(\text{ring}) = O([H_B]) \)
&gt; 5. **Size of Y (second instance):**
&gt;     - Why is ( Y ) of size 784 bytes? We perform <code>decode(x:32)</code> and <code>decode(x32:)</code> again. Does this mean that the first 32 bytes are the public key and the rest is additional data?

Your interpretation of the use of the colon in subscripting is correct. </div>
<div class='msg'><time>2024-07-14 06:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The rest will need <a href="https://matrix.to/#/@davxy:matrix.org" target="_blank" rel="noopener">@davxy:matrix.org</a>to chime in. </div>
<div class='msg'><time>2024-07-14 06:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@celadari:matrix.org&gt; ### Appendix I.4.5:
&gt; 
&gt; 1. **$jam_fallback_seal:**
&gt;    - For <code>$jam_fallback_seal</code>, do we create an output with the VRF Bandersnatch as mentioned in the questions above? If yes, what arguments, context, and additional data are required?
&gt; 
&gt; 2. **$jam_ticket_seal:**
&gt;    - For <code>$jam_ticket_seal</code>, do we use the VRF RingVRF? If yes, what arguments, context, and additional data are required?
&gt; 
&gt; 3. **$jam_entropy:**
&gt;    - For <code>$jam_entropy</code>, related to on-chain entropy generation, what does it mean, and how do we compute it?
&gt; 
&gt; ### Equation (59):
&gt; 
&gt; 1. **Understanding Components:**
&gt;    - What are \( i_y \), \( i_r \), \( H_a \), \( H \), and \( E_U(H) \)?
&gt; 
&gt; ### Equation (60):
&gt; 
&gt; 1. **Defining \( H_a \):**
&gt;    - Do we define \( H_a \) with the \( i \) from the equation &quot;let \( i = \gamma_s&#x27;[H_t]^{\circlearrow}&quot;?
&gt; 
&gt; 2. **Understanding \( H \) and \( E_U(H) \):**
&gt;    - What is \( H \) and \( E_U(H) \)?
&gt; 
&gt; 
&gt; 

Appendix I is the index. Maybe ask your questions in terms of the actual protocol specification?</div>
<div class='msg'><time>2024-07-14 07:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Re 59, you can find all the information in the text around it. E.g. i is determined from subscripting gamma’_s, a member of the sequence of tickets, telling you that it’s a ticket and thus that i_y is a VRF output, used as a ticket identifier (see (50) and text around it). </div>
<div class='msg'><time>2024-07-14 07:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Don’t expect to be spoon fed this stuff. It’s not playschool. You need to read carefully. </div>
<div class='msg'><time>2024-07-14 07:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://youtu.be/QS9buJLt5jo?si=5Sh8Qc-teI-dxVJ_" target="_blank" rel="noopener">https://youtu.be/QS9buJLt5jo?si=5Sh8Qc-teI-dxVJ_</a> might be helpful to watch as well as others in the series. </div>
<div class='msg'><time>2024-07-14 07:05</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: &gt; &lt;@gav:polkadot.io&gt; Appendix I is the index. Maybe ask your questions in terms of the actual protocol specification?

I&#x27;m not sure to understand what you mean by &quot;Appendix I is the index&quot; 🤔

At least the term <code>$jam_entropy</code> =&gt; can you give pointer to this term please ?</div>
<div class='msg'><time>2024-07-14 07:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I’m not sure why you think it reasonable to ask for someone else to do a PDF text search for you like they’ve nothing better to be doing Sunday morning.. anyway (62) X_E  = $jam_entropy <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-14 07:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As i say do not expect to be spoon fed. Any more such questions may elicit little response. </div>
<div class='msg'><time>2024-07-15 10:50</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-07-15 at 10.50.10 PM.png</div>
<div class='msg'><time>2024-07-15 10:50</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: just to confirm, a validator key can be selected multiple times right</div>
<div class='msg'><time>2024-07-15 11:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: That is indeed an implication of the formula <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-15 11:59</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room v0.3.0 is out; mostly corrections but with some reworking of the Guarantees and Verdicts (né Judgements) extrinsic. <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.0" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.3.0</a></div>
<div class='msg'><time>2024-07-15 12:08</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: &gt; &lt;@gav:polkadot.io&gt; @room v0.3.0 is out; mostly corrections but with some reworking of the Guarantees and Verdicts (né Judgements) extrinsic. <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.0" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.3.0</a>

I think only the version on the file header was updated, not the version on the first page: <a href="https://github.com/gavofyork/graypaper/pull/40/files" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/40/files</a></div>
<div class='msg'><time>2024-07-15 12:08</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Screenshot 2024-07-15 at 14.08.23.png</div>
<div class='msg'><time>2024-07-15 12:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@oliver.tale-yazdi:parity.io&gt; I think only the version on the file header was updated, not the version on the first page: <a href="https://github.com/gavofyork/graypaper/pull/40/files" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/40/files</a>

Should be good now</div>
<div class='msg'><time>2024-07-15 13:40</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: Reading integer encoding in appendix C, I&#x27;m unable to understand how x=0 is handled by the general natural serialization rule 274; if x is 0, I can&#x27;t apply the first <code>if</code> since <code>(2**0 == 1) &amp;gt; 0</code> (so it does not exist a valid <code>l</code>), but applying the second <code>if</code> doesn&#x27;t seems correct either.
Am I missing something, or the case where x=0 is not present? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-15 13:59</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: image.png</div>
<div class='msg'><time>2024-07-15 13:59</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: You mean this function right ?</div>
<div class='msg'><time>2024-07-15 14:00</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I think $l$ is supposed to be fixed here no ?</div>
<div class='msg'><time>2024-07-15 14:00</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: image.png</div>
<div class='msg'><time>2024-07-15 14:01</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: &gt; &lt;@dakkk:matrix.org&gt; sent an image.

then in this case, 0 &lt; 2**64 no ?</div>
<div class='msg'><time>2024-07-15 14:04</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: yes, but following this path, 0 is encoded as \xff\x00\x00\x00\x00\x00\x00\x00\x00; it doesn&#x27;t seem right to me </div>
<div class='msg'><time>2024-07-15 14:08</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I think you might be right, let me just check something</div>
<div class='msg'><time>2024-07-15 14:10</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: what happens when you generate several elements from 1 to 2**7</div>
<div class='msg'><time>2024-07-15 14:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; yes, but following this path, 0 is encoded as \xff\x00\x00\x00\x00\x00\x00\x00\x00; it doesn&#x27;t seem right to me

yeah, zero is a special case and should be in the first branch</div>
<div class='msg'><time>2024-07-15 14:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: i&#x27;ll correct now.</div>
<div class='msg'><time>2024-07-15 14:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg'><time>2024-07-15 14:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/45" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/45</a></div>
<div class='msg'><time>2024-07-15 21:00</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: In-depth question about erasure coding:

<a href="https://github.com/w3f/jamtestvectors/pull/4#issuecomment-2229422696" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/4#issuecomment-2229422696</a>

where we see a discrepancy between GP Appendix H and the test vector PR.  </div>
<div class='msg'><time>2024-07-16 07:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Typo: 648 bytes should be 684 bytes <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-16 18:07</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Right sorry -- 684 is still not a multiple of 64 or power of 2.</div>
<div class='msg reply'><time>2024-07-17 13:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No it’s 342 x 2 bytes. 
It’s therefore the minimum reconstructible datum. </div>
<div class='msg reply'><time>2024-07-18 03:38</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Right, we understand that is what the GP says but that&#x27;s not what cheme&#x27;s PR test vectors are doing.  We have our encoder + decoder FFI using the Rust libraries (and &quot;passing&quot; for arbitrary blob sizes), but the process by which cheme&#x27;s erasure coding test vectors are generated are clearly on a different page than the GP&#x27;s Appendix H.   <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-18 07:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Right, we understand that is what the GP says but that&#x27;s not what cheme&#x27;s PR test vectors are doing.  We have our encoder + decoder FFI using the Rust libraries (and &quot;passing&quot; for arbitrary blob sizes), but the process by which cheme&#x27;s erasure coding test vectors are generated are clearly on a different page than the GP&#x27;s Appendix H.  

Ok. Is it possible that “Parity implementation (serialized)” is just 6 of the graypaper ECs concatenated?</div>
<div class='msg'><time>2024-07-16 07:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://matrix.to/#/@emeric:parity.io" target="_blank" rel="noopener">@emeric:parity.io</a>^^</div>
<div class='msg'><time>2024-07-16 09:21</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-07-16 at 9.21.10 PM.png</div>
<div class='msg'><time>2024-07-16 09:22</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I don&#x27;t get this. what does it mean by &quot;the lowest items of the sorted union &quot;?</div>
<div class='msg'><time>2024-07-16 09:23</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: is the tickets accumulator a sorted array by the ticket id?</div>
<div class='msg'><time>2024-07-16 09:34</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: ok after read the sassafras RFC, I think I get it. Please confirm. This is basically a PoW-ish mining process and validators are trying to mine ticket with lowest VRF output and they have limited submission allowance and only EPOCH-LENGTH number of tickets will be accepted</div>
<div class='msg'><time>2024-07-16 09:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; ok after read the sassafras RFC, I think I get it. Please confirm. This is basically a PoW-ish mining process and validators are trying to mine ticket with lowest VRF output and they have limited submission allowance and only EPOCH-LENGTH number of tickets will be accepted

That&#x27;s about right.</div>
<div class='msg'><time>2024-07-16 09:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &quot;union&quot; =&gt; combining two sets. &quot;sorted&quot; =&gt; sorting that. &quot;lowest items&quot; =&gt; take only the first N items.</div>
<div class='msg'><time>2024-07-16 09:38</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I see. So the ticket extrinsic shouldn&#x27;t contain invalid ticket (when pool is full and high VRF output) otherwise the block become invalid? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-16 09:40</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: &gt; &lt;@xlchen:matrix.org&gt; I see. So the ticket extrinsic shouldn&#x27;t contain invalid ticket (when pool is full and high VRF output) otherwise the block become invalid?

or incorrectly sorted. The conformance tests cover these cases</div>
<div class='msg'><time>2024-07-16 09:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, broadly speaking we always put the onus on the block-producer to make blocks which don&#x27;t waste the block importer&#x27;s time.</div>
<div class='msg'><time>2024-07-16 12:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Some fixes just went in especially for disputes/judgements/verdicts; if you&#x27;re working on that, best to use <code>main</code>. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-16 19:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-07-16 19:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-07-17 09:19</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-07-17 at 9.19.35 PM.png</div>
<div class='msg'><time>2024-07-17 09:19</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: for serialization of numbers, what is the default serialization method?</div>
<div class='msg'><time>2024-07-17 09:20</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-07-17 at 9.19.59 PM.png</div>
<div class='msg'><time>2024-07-17 09:20</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I guess when unspecified, it is the general natural number serialization method which is a variable length one?</div>
<div class='msg'><time>2024-07-17 09:21</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: also I can&#x27;t find where (273) is used?</div>
<div class='msg'><time>2024-07-17 11:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It was used in an older version of the PVM. It might be used again in the future, but right now it&#x27;s superfluous.</div>
<div class='msg'><time>2024-07-17 14:33</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: equation (59) is for the normal lottery case (header &quot;anonymously&quot; signed with ringVRF) right ?
so shouldn&#x27;t it be
$$\\mathbf{H}_s \\in \\bar{\\mathbb{F}}_{\\gamma\_z}^{\[\]}\\langle{X\_T\\frown \\eta\_3^{&#x27;} ++ i\_r }\\rangle$$ ? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-17 15:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No - neither case is anonymous at the point of seal verification. It’s only anonymous at the point of ticket submission.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-17 15:18</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Oh I see</div>
<div class='msg'><time>2024-07-17 16:11</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: Probably just a minor detail, two lines after (214): The PVM exit reason <code>r</code>. Shouldn&#x27;t this be $\varepsilon$?</div>
<div class='msg'><time>2024-07-17 17:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@subotic:matrix.org&gt; Probably just a minor detail, two lines after (214): The PVM exit reason <code>r</code>. Shouldn&#x27;t this be $\varepsilon$?

yes - typo. will be fixed in the next release. thanks</div>
<div class='msg'><time>2024-07-17 20:06</time>&ensp;<span class='u' style='color:#74d8d2'>proxy720</span>: Hi @gav, I&#x27;m looking at the latest version of the paper (DRAFT 0.3.0). I think there is a typo in a couple of equations in appendix C (the scale encoder):
- (273): first case: ... ^ E_l(x mod 2*8l), should it be E_{l-1} ?
- (273): second case: ... ^ E_3, I think it wants to be E_2
- (274): the same, I think the indices should be decreasing
But maybe I&#x27;m wrong...</div>
<div class='msg'><time>2024-07-17 20:14</time>&ensp;<span class='u' style='color:#74d8d2'>proxy720</span>: &gt; &lt;@proxy720:matrix.org&gt; Hi @gav, I&#x27;m looking at the latest version of the paper (DRAFT 0.3.0). I think there is a typo in a couple of equations in appendix C (the scale encoder):
&gt; - (273): first case: ... ^ E_l(x mod 2*8l), should it be E_{l-1} ?
&gt; - (273): second case: ... ^ E_3, I think it wants to be E_2
&gt; - (274): the same, I think the indices should be decreasing
&gt; But maybe I&#x27;m wrong...

Yes, I am wrong the expressions are not recursive but refer to (272). Sorry, my bad.</div>
<div class='msg'><time>2024-07-17 23:27</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: A small annoyance, all the formula are numbered which is obviously very useful for many reasons. However, the number are not fixed and subject to change between versions. This makes referring to a particular formula from code a bit harder as it also needs to fixed to a specific GP version as well and then eventually the repo will contain references to multiple GP versions and just makes things harder. I don&#x27;t know if there is a solution to this but it will be great if we have a good way to reference to GP from code comment / docs / chats</div>
<div class='msg'><time>2024-07-18 07:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; A small annoyance, all the formula are numbered which is obviously very useful for many reasons. However, the number are not fixed and subject to change between versions. This makes referring to a particular formula from code a bit harder as it also needs to fixed to a specific GP version as well and then eventually the repo will contain references to multiple GP versions and just makes things harder. I don&#x27;t know if there is a solution to this but it will be great if we have a good way to reference to GP from code comment / docs / chats

Once there is a 1.0 then this should be better. Until then if you want a fixed reference you could use the latex label, where there is one (and if there isn’t, then let me know or make a pr)</div>
<div class='msg'><time>2024-07-18 08:31</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Cheme&#x27;s erasure coding process (now ours, via FFI into the same Rust libs) is as follows:

Encoding:

- blob is split into 4096-byte segments
- each 4096-byte segment is erasure coded into 12-byte subshards shared among 1026 (342 x 3) validators, ie 12,312 bytes

Decoding:

- available 12-byte subshards in a 12,312 byte encoding (only 342 of which are needed for reconstruction) are used to reconstruct the 4096-byte segment
- each of the 4096-byte segments are put together to reconstruct the blob

GP wants 4104-byte segments (W\_C = 684 x W\_S = 6) instead of 4096.   This is a real discrepancy. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 09:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ok - yeah cheme&#x27;s current system is incorrect and the test vectors shouldn&#x27;t have been generated.</div>
<div class='msg'><time>2024-07-18 09:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If you&#x27;re confident you have the GP properly implemented, feel free to create your own test vectors and submit them as a PR.</div>
<div class='msg'><time>2024-07-18 09:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The lowest reconstructible datum of EC should be 684 bytes, reconstructible from 342 parties out of a total generated during EC of 1026, each presenting 2 bytes.</div>
<div class='msg'><time>2024-07-18 09:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So 342 byte-pairs gets expanded to 1026 byte-pairs and from this any 342 byte-pairs can be used to reconstruct the original 342 byte-pairs.

For ECing segments (4104 bytes, 2052 byte-pairs), then we basically do the ECing above 6 times in parallel and concatenate.</div>
<div class='msg'><time>2024-07-18 09:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For ECing the Work-Bundle, then we do the above N times in parallel and concatenate, where N is <code>CEIL(WORK_BUNDLE_SIZE / 684)</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 09:17</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Understood!  But I think we&#x27;re up against the fact that Lin, Chung, and Han 2014 referenced in GP only works with powers of 2, and need to get down into like &quot;what package can do _that_&quot; nitty gritty. </div>
<div class='msg'><time>2024-07-18 09:30</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: This paper (who Han pointed one of our team to) appears to get over the &quot;powers of 2&quot; limitations and gets to what the GP wants:
 <a href="https://ieeexplore.ieee.org/document/8955804" target="_blank" rel="noopener">https://ieeexplore.ieee.org/document/8955804</a>
but I don&#x27;t believe its reasonable for teams to be implementing it independently.   IMHO every team should have an FFI into a very widely used erasure coding package, or (similar to davxy Bandersnatch repo, I imagine) we all just use the same one, implemented once, well? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 09:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Agreed, implementation of the underlying RS EC is not something which is needed for the prize. I&#x27;d be very happy to see an high quality treasury-funded implementation for use across client implementations. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 10:43</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Before we go down that (not as resilient?!) rabbit-hole, here are two solutions:

- **Solution A: Change 342:1026 to powers of 2 (e.g., 256:1024).**  Instead of using the leopard package
<a href="https://github.com/catid/leopard/tree/master" target="_blank" rel="noopener">https://github.com/catid/leopard/tree/master</a>
we use the original author&#x27;s package:
<a href="https://github.com/SianJhengLin/Fast-algorithms-of-Reed-Solomon-erasure-codes" target="_blank" rel="noopener">https://github.com/SianJhengLin/Fast-algorithms-of-Reed-Solomon-erasure-codes</a>
- **Solution B: Change Y\_2 in GP**
This could be Y\_64, or Y\_192 as implemented by Parity here:
<a href="https://github.com/paritytech/erasure-coding/blob/6c22e28a7402cfc75381e430483defe8189df486/src/subshard.rs#L317" target="_blank" rel="noopener">https://github.com/paritytech/erasure-coding/blob/6c22e28a7402cfc75381e430483defe8189df486/src/subshard.rs#L317</a>
or any multiple of 64 as per the docs:
<a href="https://github.com/catid/leopard/blob/6e5725ebdf9da4370b0bcc4f70fa8eb66f4e6198/README.md?plain=1#L27" target="_blank" rel="noopener">https://github.com/catid/leopard/blob/6e5725ebdf9da4370b0bcc4f70fa8eb66f4e6198/README.md?plain=1#L27</a>
where n and k represent &quot;original data length&quot; and &quot;recovery data length&quot;.

Neither solution requires building new packages (good!) but both require some parameter changes to the GP. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 10:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://gist.github.com/gavofyork/4cde92327cd91eff3e2ab91d316cb83a" target="_blank" rel="noopener">https://gist.github.com/gavofyork/4cde92327cd91eff3e2ab91d316cb83a</a></div>
<div class='msg'><time>2024-07-18 10:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: here&#x27;s a test vector for the &quot;atomic&quot; EC.</div>
<div class='msg'><time>2024-07-18 10:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 684 bytes split out into 1026 \* 2 bytes, any 342 of which can be used to reconstruct. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 10:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: once you&#x27;ve got this to match, the rest should be straightforward.</div>
<div class='msg'><time>2024-07-18 10:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: no. please stick to the spec. thanks. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 11:36</time>&ensp;<span class='u' style='color:#c74b98'>alistair</span>: &gt; &lt;@gav:polkadot.io&gt; 684 bytes split out into 1026 \* 2 bytes, any 342 of which can be used to reconstruct.

This could be 1024*2. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 11:36</time>&ensp;<span class='u' style='color:#c74b98'>alistair</span>: </div>
<div class='msg'><time>2024-07-18 11:59</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: &gt; &lt;@gav:polkadot.io&gt; once you&#x27;ve got this to match, the rest should be straightforward.

yep i can recover it from a random 342 subset of these</div>
<div class='msg'><time>2024-07-18 12:02</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: image.png</div>
<div class='msg'><time>2024-07-18 12:02</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: I&#x27;ll briefly explain the method from the paper mentioned in GP Appendix H, using 256:1024 as an example:
1. Use the original 256 GF points as the values of the evaluation points, and then reverse-generate a polynomial expression, which is defined by the authors.
2. Therefore, substituting the 0th to 255th elements into this polynomial will give us the original data we need.
3. Next, substitute the 256th to 1023th elements sequentially into the polynomial to obtain the redundancy data we need.
And this method for quickly computing the values of the evaluation points is a recursive formula. inverse tranform is a recursive formula too



 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 12:04</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: 
Could you explain more clearly how you generated this vector? No matter how I look at it, it doesn&#x27;t seem like it can be used for 342:1026.</div>
<div class='msg'><time>2024-07-18 12:10</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: The provided test vector contains original data with 1026 bytes, which is 513 octet pairs (Y_2). According to GP, every 342 octet pairs will be packed into 1 &quot;segment&quot; for encoding. Therefore, in this case, we should get 2 &quot;segments&quot; of codewords, totaling 1026 * 2 = 2052 octet pairs.

However, this provided test vector only contains 1 segment (1026 octet pairs) of codewords.

Please let me know if I got anything wrong.</div>
<div class='msg'><time>2024-07-18 12:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Which test vector?</div>
<div class='msg'><time>2024-07-18 12:25</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: This one

<a href="https://gist.github.com/gavofyork/4cde92327cd91eff3e2ab91d316cb83a" target="_blank" rel="noopener">https://gist.github.com/gavofyork/4cde92327cd91eff3e2ab91d316cb83a</a></div>
<div class='msg'><time>2024-07-18 12:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The <code>data</code> I provided in the gist <code>9c07...a574</code> is 1368 nibbles, which is 684 bytes (342 byte-pairs). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 12:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This gets ECed into 1026 byte-pairs (<code>segment_ec</code>) - concatenating the first 342 result in the <code>data</code>. The other 684 byte-pairs are the additional redundancy. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 12:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Once you can do this, then you just need to glue 6 of them together to do segment encoding (4104 = 684 * 6).</div>
<div class='msg'><time>2024-07-18 12:31</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: </div>
<div class='msg'><time>2024-07-18 12:39</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Sorry for that. I originally thought it was base64 (because the other vectors are encoded using base64), but this doesn&#x27;t answer my question. The paper has strict limitation of (n,k)should be 2^r, so how did you apply them to generate this vector?

</div>
<div class='msg'><time>2024-07-18 12:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah, that paper probably shouldn&#x27;t be referenced.</div>
<div class='msg'><time>2024-07-18 12:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;ll remove the reference in the next revision.</div>
<div class='msg'><time>2024-07-18 12:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For now just assume it&#x27;s a normal systematic RS EC in GF(2^16)</div>
<div class='msg'><time>2024-07-18 12:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://ieeexplore.ieee.org/document/8955804" target="_blank" rel="noopener">https://ieeexplore.ieee.org/document/8955804</a> might be an interesting paper when you come to optimisation, assuming there is no existing impl which can come via FFI.</div>
<div class='msg'><time>2024-07-18 12:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We have found that the crate parity uses for EC can parallelise effectively if you&#x27;re careful about which shards are which and you ensure indices are equivalent for all shards. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 12:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We&#x27;ll probably improve this in the future to allow for 32x parallelism using 4 indices (8 shards per index), which should get very close to the theoretical maximum performance without necessitating a fresh implementation.</div>
<div class='msg'><time>2024-07-18 12:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: However, for M1/M2 performance is not especially relevant - you just need to be able to get the right EC results. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 12:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As for hex/base64, yeah I switched it - I&#x27;m not sure why base64 was ever used as it makes it largely unreadable to human eyes. I&#x27;ll push people to stick to hex so it&#x27;s trivial to see things like string lengths right in a text editor and not worry about weird padding artefacts. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 13:18</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Got it, thanks for clarifying.

However, we still have some concerns: the term &quot;normal systematic RS EC&quot; is quite ambiguous. 
In our understanding, RS coding (Reed Solomon) are more likely a &quot;category&quot; of coding algorithm, there&#x27;re at least two type of RS coding: original view and BCH view. See: <a href="https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction#:~:text=There%20are%20two%20basic%20types%20of%20Reed%E2%80%93Solomon%20codes%C2%A0%E2%80%93%20original%20view%20and%20BCH%20view%C2%A0%E2%80%93%20with%20BCH%20view%20being%20the%20most%20common%2C%20as%20BCH%20view%20decoders%20are%20faster%20and%20require%20less%20working%20storage%20than%20original%20view%20decoders." target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction#:~:text=There%20are%20two%20basic%20types%20of%20Reed%E2%80%93Solomon%20codes%C2%A0%E2%80%93%20original%20view%20and%20BCH%20view%C2%A0%E2%80%93%20with%20BCH%20view%20being%20the%20most%20common%2C%20as%20BCH%20view%20decoders%20are%20faster%20and%20require%20less%20working%20storage%20than%20original%20view%20decoders.</a>

Different algorithms (or even just different implementations) of RS coding could lead to different encoding results. Therefore, if RS coding doesn&#x27;t align among each JAM implementation, the encoding results might not be compatible with each other and may not decode correctly.</div>
<div class='msg'><time>2024-07-18 13:19</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: So in the future, it is possible that there will be changes in the encoding rate and data segmentation, right? When will this be confirmed, and what would you recommend we do for our implementation in the meantime?</div>
<div class='msg'><time>2024-07-18 13:29</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Regarding the recovery of the test vector you provided earlier, Can you provide us with more relevant implementation details?
I want to make sure that our approach is correct.</div>
<div class='msg'><time>2024-07-18 14:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No changes are planned and I don&#x27;t view any changes as likely. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 14:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I believe this is the paper describing the underlying EC schema: D. G. Cantor, &quot;On arithmetical algorithms over finite fields&quot;,
    Journal of Combinatorial Theory, Series A, vol. 50, no. 2, pp. 285-300, 1989.

Systematic Reed Solomon Finite-Field Erasure Codec, GF(2^16), Cantor basis 2

 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 14:46</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: ok! Thank u!</div>
<div class='msg'><time>2024-07-18 14:48</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-07-18 14:56</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: hello when trying to implement the codec for the <code>dictionary encoding</code> &quot;method 1&quot;. or this formal definition, i find it hard to write a generic codec. let me explain better.

the notation seems to indicate that when the dictionary then the following steps should be taken:

- encode number of keys/valuepairs ( formula 275 )
- then for each key value pair
- concatenate the encoded key
- concatenate the encoded corresponding value

if my understanding is true, then lets think about a dict with different keytypes and value types each with variable length. There is no explicit mechanism in the formal specification that would allow an implementation to properly encode &amp; decode the key value pairs.

I would&#x27;ve expected to also see some kind of <code>E(k*) = E(|k|) concatenated with E(k)</code> . same for <code>d[k]</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 14:58</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: unless i am misinterpreting the formula (which is a strong possibility here)</div>
<div class='msg'><time>2024-07-18 15:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No dictionary with differing key/value types use this encode function.</div>
<div class='msg'><time>2024-07-18 15:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (In fact, AFAIR I don&#x27;t think it&#x27;s used at all, currently)</div>
<div class='msg'><time>2024-07-18 15:03</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@gav:polkadot.io&gt; No dictionary with differing key/value types use this encode function.

thanks. maybe it&#x27;s worth mentioning in the graypaper?</div>
<div class='msg'><time>2024-07-18 15:05</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: also for future reference <code>i think</code> it might be a good idea. In case jam ends up needing to use it. we might want to be sure that we only use it when that condition is satisfied</div>
<div class='msg'><time>2024-07-18 15:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;ll just remove the definitions for now. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 16:28</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Oliver Tale-Yazdi: Which package did you use to decode the <a href="https://gist.github.com/gavofyork/4cde92327cd91eff3e2ab91d316cb83a" target="_blank" rel="noopener">https://gist.github.com/gavofyork/4cde92327cd91eff3e2ab91d316cb83a</a> &quot;normal systematic RS EC in GF(2^16)&quot;?  Can you post your (I presume Rust) decoder in a similar gist?  A encode-decode combo?

Happy to submit a PR with the same shape of test vectors as cheme&#x27;s PR after we succeed, have you review it, based on the above. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-18 16:36</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Oliver Tale-Yazdi: Which package did you use to decode the <a href="https://gist.github.com/gavofyork/4cde92327cd91eff3e2ab91d316cb83a" target="_blank" rel="noopener">https://gist.github.com/gavofyork/4cde92327cd91eff3e2ab91d316cb83a</a> &quot;normal systematic RS EC in GF(2^16)&quot;?  Can you post your (I presume Rust) decoder in a similar gist?  A encode-decode combo?
&gt; 
&gt; Happy to submit a PR with the same shape of test vectors as cheme&#x27;s PR after we succeed, have you review it, based on the above.

I just used the decoder from here <a href="https://github.com/paritytech/erasure-coding/blob/main/src/subshard.rs" target="_blank" rel="noopener">https://github.com/paritytech/erasure-coding/blob/main/src/subshard.rs</a></div>
<div class='msg'><time>2024-07-18 17:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: this might be useful for anyone wanting to get their head around what keysets are used when: <a href="https://hackmd.io/@polkadot/jamkeysets" target="_blank" rel="noopener">https://hackmd.io/@polkadot/jamkeysets</a></div>
<div class='msg'><time>2024-07-18 19:42</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Updated 
<a href="https://github.com/w3f/jamtestvectors/pull/4#issuecomment-2237386980" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/4#issuecomment-2237386980</a>
with a snippet of Rust code
<a href="https://gist.github.com/sourabhniyogi/f448e213134c814d652d2eccf086bf53" target="_blank" rel="noopener">https://gist.github.com/sourabhniyogi/f448e213134c814d652d2eccf086bf53</a> 
covering the first test vector for JAM&#x27;s erasure decoding.  If this somehow breaks hygiene, please explain? </div>
<div class='msg'><time>2024-07-19 17:14</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: gav: Do you have wire format preferences for JAMSNP
<a href="https://hackmd.io/@polkadot/jamsnp" target="_blank" rel="noopener">https://hackmd.io/@polkadot/jamsnp</a>
For speed, I&#x27;d like to suggest we start with JSON and end with scale or protobuf.  Not arguing for protobuf over scale here ... but even though  JSON is something engineers tend to snicker at,  it usually makes debugging life easier, between individuals and especially between teams, at the expense of a bunch of (I suggest, temporary) serialization/deserialization.  Or perhaps JAMSNP can support more than 1 wire format.

Are the details of JAMSNP appropriate to develop by implementers and then turned into a GP Appendix after we get a couple &quot;serious&quot; implementations in to code complete form, or do you (+JAM protocol engineers) own this problem?

If you don&#x27;t own this, should implementers put something together into a polkadot-fellows RFC and then GP compatible notation?

 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-19 20:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: SCALE, to the degree it matters. Most items will have a standard binary representation anyway. </div>
<div class='msg'><time>2024-07-21 20:07</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Ok -- maybe C.2 should be expanded to cover all the SCALE encodings, not just for blocks but for JAMSNP stream objects?  Here are my notes:

- CE: Ticket submission - <code>Ticket</code> is an _element_ of ${\\bf E}\_T$ (Section 6.7 Equation 73) -- serialization of elements of  $\\mathbb{C}$ in C.2 (Equation 288)
- CE: Work Report publication - <code>Guaranteed Work Report</code> is an _element_ of ${\\bf E}\_G$ (Section 11.4 Equation 136) -- Serialization of $\\mathbb{W}$ is C.2 (Equation 286)
- CE: Assurance publication - <code>Assurance</code> is an _element_ of ${\\bf E}\_A$ (Section 11.2 Equation 123) -- need serialization in C.2 and a set definition in I.1.1.
- CE: Judgement publication - <code>Dispute</code> contains _components_ of ${\\bf E}\_D$ (Section 10.2 Equation 97) -- need serialization in C.2, though ${\\bf B}$ covers ${\\bf c}, {\\bf v}, {\\bf f}$ components.
- CE: Preimage publication - <code>Preimage</code> is an _element_ of ${\\bf E}\_P$ (Section 11.2 Equation 153) -- need serialization in C.2 and set definition in I.1.1.
- CE: Block publication - <code>Block</code> is  Section 4.1 Equation 13, serialization of ${\\bf B}$ is thorough in C.2 (Equations 280-282).
- CE: Work Package Submission and Sharing - <code>Work Package</code> is Section 14.3 Equation (174), serialization of elements of $\\mathbb{P}$ in C.2 (Equation 287).
- CE: Audit-announcement - <code>Announcement</code> - see Section 17.3 Equation 196.  Need serialization in C.2 and set definition in I.1.1.
- CE: AuditDA query <code>AuditDAQuery</code> &amp; response <code>AuditDAResponse</code> - need serialization in C.2 and  maybe set definitions in I.1.1.
- CE: ImportDA query <code>ImportDAQuery</code> &amp; response <code>ImportDAResponse</code> - need serialization in C.2 and maybe set definitions in I.1.1
- CE: Public ImportDA reconstruction <code>ImportDAReconstructionQuery</code> &amp; response <code>ImportDAReconstructionResponse</code> - need serialization in C.2 and maybe set definitions in I.1.1

Beyond the above encoding nitty gritty, it would be powerful to have JAMSNP, for each stream, have a short description of when the sender is typically expected to send and the expected behavior of the receiver when receiving each of the above.  You could leave it as an exercise for JAM implementers, but why?

Pedantic question: Why is V=1023, C=341 and not V=1026, C=342 where the latter  matches Appendix H&#x27;s 1026?

Do you have a recommendation on how implementers get started with a &quot;tiny&quot; C, V, W\_C, W\_S?

Above is relative to 0.3.1 (7/17/24) -- In addition, the start of section 14 is messed up. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-22 12:36</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I have a question regarding the safrole algorithm. Since the author of the block &quot;gives away who he is,&quot; shouldn&#x27;t the header also include proof that they are entitled to the ticket? From my understanding, $$H\_s$$ is a Bandersnatch signature of $$E\_U(H)$$ with same context as ticket, but I don&#x27;t see how it is sufficient to prove ownership of the ticket.

Shouldn&#x27;t we also include opring, using the notation from the 2023 paper by Jeffrey Burdges, where opring contains a NARK.Proof(comring, pk, ring)
?

I also reviewed the code in the Bandersnatch VRFs spec example. I noticed that the code assumes the prover\_key\_index is the correct one by using the same variable <code>prover_key_index</code> for both signing and verification.

I feel there is something obvious that I am not seeing :) <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-22 12:58</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: &gt;gives away who he is,&quot; shouldn&#x27;t the header also include proof that they are entitled to the ticket

IIUC: the header seal signature is the proof. It is a bandersnatch sig (not a bandersnatch ring sig).  
This sig can only be created by the holder of the key for the slot of that block - which was determined in advance by the ticket contest.  

So by issuing a standard bandersnatch signature, they give away that they control the respective authoring key.</div>
<div class='msg reply'><time>2024-07-22 13:12</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I agree that it is a bandersnatch signature but the ticket itself is generated using a bandersnatch ring signature.

How do you &quot;relate&quot; the holder of the key with the ticket seal in $$\\gamma\_s$$ ?

$$i$$ is known ($$\\gamma\_s\[H\_t\]$$) - and so is the expected Y(H\_s) - so what prevents me from signing with my own key E\_U(H), sign [] with context $$X_E + Y(H_v)$$ as well (since I know expected Y(H\_s)) then pretend I am the owner of the ticket ? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-22 13:19</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Not sure if i understand what you are asking, but if you just sign <code>Y(H_v)</code> with a different key, then it wont verify.  
<code>Y(H_v)</code> is passed into the signature verification function <code>vrf_verify</code> alongside with the public key. Only the author key can verify for that <code>Y(H_v)</code>.  
so you cannot just &quot;steal&quot; the ticket by copying the <code>Y(H_v)</code>.</div>
<div class='msg reply'><time>2024-07-22 13:29</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: What do you mean by &quot;sign Y(H_v)&quot; ? H_v and H_s are both headers provided by the one submitting the block.

The vrf value/ticket is known (looking at <code>$$\gamma_s$$</code>) that is we know what $$Y(H_s)$$ is supposed to be. So we know the context of $$H_v$$ signature. So I can sign [] with context X_E+Y(H_s) using my own key and sign E_U(H) with context X_T+eta_3+i_r (I can try i_r equals 0 or 1), I don&#x27;t see what is gonna fail here</div>
<div class='msg'><time>2024-07-22 19:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; Pedantic question: Why is V=1023, C=341 and not V=1026, C=342 where the latter matches Appendix H&#x27;s 1026?

Keeping the number no greater than 1024 is (or at least was) helpful for ensuring the speed of a few algorithms, including EC and SNARKs. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-22 19:30</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Looks like Safrole wants V=1023
<a href="https://github.com/w3f/jamtestvectors/blob/master/safrole/README.md" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/master/safrole/README.md</a>
and EC wants V=1026.  This needs to be resolved for GP self-consistency, right? 
Alistair said something about &quot;This could be 1024*2.&quot; a couple of days back and he has the path to reconcile this?
 <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-22 20:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The numbers are correct. There is nothing to resolve. There are 1023 validators and 342 are required for EC reconstruction.  <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-22 23:18</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Got it.  Clarifying that chunks for &quot;1023..1024..1025&quot; in Appendix H 342:1026 don&#x27;t actually get distributed to anyone might be useful, in a footnote in H.1 or 14.2.  This suppresses others like me who perceive a discrepancy.   <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-23 09:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In fact the latest GP (<code>main</code> branch) revises this to a rate of 342:1023, thereby removing this weirdness. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-22 19:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; Do you have a recommendation on how implementers get started with a &quot;tiny&quot; C, V, W_C, W_S?

Don&#x27;t know what you mean.</div>
<div class='msg reply'><time>2024-07-22 19:36</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: I mean that for those of us who want to just start doing producing blocks with a single machine simulating V nodes will choose a tiny V, like 6 (C=2).  But the EC parameters have to match.  Ideally we&#x27;d have &quot;tiny&quot; test vectors with very low V to match the &quot;full&quot; test vectors.  Safrole test vectors have tiny V=6 already and V=1024.  So the recommendation request is how to adjust other parameters W\_C, W\_S, ... and the EC procedure such that all teams can do basically the same thing.  

For me this low V situation (V=6 or 9 or 12) enables a quick way for 2-4 teams to test against each other, in a ZombieNet like way, instead of the impractically large V=1023 or V=1026 situation (not for mainnet, just for a single team to get all components working together).  The EC component is most glaring so we&#x27;ll just use some other Reed-Solomon parameters in the low V case but I&#x27;m sure you will have better parameter selection?  <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-22 20:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; I mean that for those of us who want to just start doing producing blocks with a single machine simulating V nodes will choose a tiny V, like 6 (C=2).  But the EC parameters have to match.  Ideally we&#x27;d have &quot;tiny&quot; test vectors with very low V to match the &quot;full&quot; test vectors.  Safrole test vectors have tiny V=6 already and V=1024.  So the recommendation request is how to adjust other parameters W\_C, W\_S, ... and the EC procedure such that all teams can do basically the same thing.  
&gt; 
&gt; For me this low V situation (V=6 or 9 or 12) enables a quick way for 2-4 teams to test against each other, in a ZombieNet like way, instead of the impractically large V=1023 or V=1026 situation (not for mainnet, just for a single team to get all components working together).  The EC component is most glaring so we&#x27;ll just use some other Reed-Solomon parameters in the low V case but I&#x27;m sure you will have better parameter selection? 

Safrole should have test vectors for V=1023. <a href="https://matrix.to/#/@davxy:matrix.org" target="_blank" rel="noopener">@davxy:matrix.org</a>please confirm. </div>
<div class='msg reply'><time>2024-07-22 23:10</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Yes the Safrole test vectors are V=1023.  </div>
<div class='msg'><time>2024-07-22 19:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; In addition, the start of section 14 is messed up.

Don&#x27;t know what you mean.</div>
<div class='msg reply'><time>2024-07-22 19:25</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg reply'><time>2024-07-22 19:29</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: see final pdf.  Not a big deal, but maybe you had some content there. </div>
<div class='msg reply'><time>2024-07-22 20:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; sent an image.

No idea how you generated that. My pdf (and that uploaded to github) is fine. </div>
<div class='msg reply'><time>2024-07-22 23:15</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: The present
<a href="https://graypaper.com/graypaper\_inverted.pdf" target="_blank" rel="noopener">https://graypaper.com/graypaper\_inverted.pdf</a>
<a href="https://graypaper.com/graypaper\_no\_background.pdf" target="_blank" rel="noopener">https://graypaper.com/graypaper\_no\_background.pdf</a>
have the above problem 
<a href="https://graypaper.com/graypaper.pdf" target="_blank" rel="noopener">https://graypaper.com/graypaper.pdf</a> 
does not.   <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-22 19:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; but I don&#x27;t see how it is sufficient to prove ownership of the ticket.

See the top line of (60)</div>
<div class='msg'><time>2024-07-22 19:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg'><time>2024-07-22 19:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The ticket ID (VRF output) is required to be the same. This guarantees the sealer is the ticket owner.</div>
<div class='msg'><time>2024-07-22 19:28</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: image.png</div>
<div class='msg'><time>2024-07-22 19:28</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: But how do we go from bandersnatch signature (H\_s) to bandersnatch ringVRF ? :)
(The only obvious way I see is to have <code>opring</code>)

When I look at the ringVRF construction from 2023 Jeffrey Burdges I don&#x27;t see how we can do this (aside from using <code>opring</code>) ?

And the ticket is signed with message/additional data equal to empty \[\] and H\_s is supposed to be on E\_U : I think the signature changes if additional data/message changes <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-22 19:31</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Maybe we can go to bed for now 😅</div>
<div class='msg'><time>2024-07-22 20:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@celadari:matrix.org&gt; But how do we go from bandersnatch signature (H\_s) to bandersnatch ringVRF ? :)
&gt; (The only obvious way I see is to have <code>opring</code>)
&gt; 
&gt; When I look at the ringVRF construction from 2023 Jeffrey Burdges I don&#x27;t see how we can do this (aside from using <code>opring</code>) ?
&gt; 
&gt; And the ticket is signed with message/additional data equal to empty \[\] and H\_s is supposed to be on E\_U : I think the signature changes if additional data/message changes

Will need to defer to <a href="https://matrix.to/#/@davxy:matrix.org" target="_blank" rel="noopener">@davxy:matrix.org</a>for the RingVRF/Bandersnatch specifics. </div>
<div class='msg'><time>2024-07-22 20:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I have no plans to alter the EC; the tiny Safrole test vectors were given only as a convenience since proof generation can be quite slow. The same is not true for EC. </div>
<div class='msg'><time>2024-07-22 20:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: V=6 seems fair for a testnet but it’s totally up to you. Experiment.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-23 06:14</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@gav:polkadot.io&gt; Safrole should have test vectors for V=1023. <a href="https://matrix.to/#/@davxy:matrix.org" target="_blank" rel="noopener">@davxy:matrix.org</a>please confirm. 

I confirm that &quot;full&quot; vectors are generated with V=1023</div>
<div class='msg'><time>2024-07-23 06:24</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@gav:polkadot.io&gt; Will need to defer to <a href="https://matrix.to/#/@davxy:matrix.org" target="_blank" rel="noopener">@davxy:matrix.org</a>for the RingVRF/Bandersnatch specifics. 

@sourabhniyogi reply is quite insightful :-) @celadari I&#x27;ll add something later (currently afk)</div>
<div class='msg'><time>2024-07-23 10:33</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: On another topic, I think some <code>max</code>s on appendix A should be <code>min</code>s, since they are used to disallow &quot;out of bounds&quot; access</div>
<div class='msg'><time>2024-07-23 10:34</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: Screenshot 2024-07-22 at 21.28.05.png</div>
<div class='msg'><time>2024-07-23 10:34</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: In all of these sections that calculate <code>l_x</code> or <code>l_y</code></div>
<div class='msg'><time>2024-07-23 10:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah, there’s a fix incoming for that. </div>
<div class='msg'><time>2024-07-23 11:24</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@davxy:matrix.org&gt; @sourabhniyogi reply is quite insightful :-) @celadari I&#x27;ll add something later (currently afk)

This gist may be helpful: <a href="https://gist.github.com/davxy/c3327f799cb70a7c55087c97741fa8d9" target="_blank" rel="noopener">https://gist.github.com/davxy/c3327f799cb70a7c55087c97741fa8d9</a>
(for struct defs, etc. refer to the example in bandersnatch specs repo)</div>
<div class='msg reply'><time>2024-07-23 14:10</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Thank you Davide 🙌, After checking the gist I realized that the ietfVRF output and ringVRF output are the same: obvious when looking at the 2024 paper but not obvious when looking at the 2023 paper

SO a ietfVRF Proof on an output made by ringVRF is still valid
SO even if the ticket in gamma_s was made using ringVRF, using the ietfVRF.Verify with H_s as signature, H_a as public key and E_U(H) as aux_data should produce the same output (since output is independant from aux_data)</div>
<div class='msg'><time>2024-07-23 14:05</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: </div>
<div class='msg'><time>2024-07-24 22:45</time>&ensp;<span class='u' style='color:#d25e85'>shawntabrizi</span>: gav - off grid, slow to respond: perhaps add a link to this channel to the header: <a href="https://www.youtube.com/@JamPrizeTour/videos" target="_blank" rel="noopener">https://www.youtube.com/@JamPrizeTour/videos</a>

It has all videos of the JAM lectures, including Buenos Aries, Singapore, and Brussels</div>
<div class='msg'><time>2024-07-29 13:16</time>&ensp;<span class='u' style='color:#65c4c9'>jay-chrawnna</span>: Hi folks. We&#x27;re pleased to introduce the new lecture section of the graypaper website:
<a href="https://graypaper.com/lectures/" target="_blank" rel="noopener">https://graypaper.com/lectures/</a></div>
<div class='msg'><time>2024-07-29 13:17</time>&ensp;<span class='u' style='color:#65c4c9'>jay-chrawnna</span>: Gray Paper Website.png</div>
<div class='msg'><time>2024-07-29 13:19</time>&ensp;<span class='u' style='color:#65c4c9'>jay-chrawnna</span>: This was filmed and created as a joint project by <a href="https://x.com/KeyPictures" target="_blank" rel="noopener">Key Pictures</a> &amp; <a href="https://x.com/TheKusamarian" target="_blank" rel="noopener">The Kus</a> under OpenGov Ref. 763 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-29 13:20</time>&ensp;<span class='u' style='color:#65c4c9'>jay-chrawnna</span>: More lectures and resources will be added over time. Please DM me directly if you have a request to make it more useful!</div>
<div class='msg'><time>2024-07-29 13:23</time>&ensp;<span class='u' style='color:#65c4c9'>jay-chrawnna</span>: thanks Philip for all the help getting it live!</div>
<div class='msg reply'><time>2024-07-29 13:26</time>&ensp;<span class='u' style='color:#58d23c'>philip.poloczek</span>: Glad I could help. 👍️:)</div>
<div class='msg'><time>2024-07-29 14:20</time>&ensp;<span class='u' style='color:#65c4c9'>jay-chrawnna</span>: if using YouTube, checkout the Playlist to see them in order!
<a href="https://www.youtube.com/watch?v=wbnTnBQNDr4&amp;list=PLwcnAOKMj-Ab7sDej2P4peqGxu2mTGYNy&amp;index=1" target="_blank" rel="noopener">https://www.youtube.com/watch?v=wbnTnBQNDr4&amp;list=PLwcnAOKMj-Ab7sDej2P4peqGxu2mTGYNy&amp;index=1</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-29 14:36</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: &gt; &lt;@davxy:matrix.org&gt; sourabhniyogi:
&gt; 
&gt; 1. For Safrole test vectors the only thing we use is $jam\_ticket\_seal.
&gt; In particular this is used for the ring-vrf input construction (context in the GP) to obtain the ticket score (aka ticket-id)  during the candidate ticket verification procedure.
&gt; The value of $jam\_ticket\_seal&quot; is constant and defined as &quot;jam\_ticket\_seal&quot; ASCII string.
&gt; This is a thing that applies in general for values starting with <code>$</code> (e.g. <code>$foo</code> in the GP =&gt; <code>&amp;quot;foo&amp;quot;</code> ascii string).
&gt; (Thank you BTW as I&#x27;ve just spotted that I was using &quot;jam\_seal&quot; instead of &quot;jam\_ticket\_seal&quot;, I&#x27;ll add the fix to the upcoming vectors PR)
&gt; The other constant strings ($jam\_fallback\_seal and $jam\_entropy) are used for block verification and per-block entropy production (which is passed as input to Safrole).
&gt; NOTE: The actual value of per-block entropy used by the Safrole test vectors is not relevant to have been really produced using the signature in the header. Here we abstract away from the value&#x27;s origin, we don&#x27;t really care for the sake of the Safrole test vectors and Safrole STF. In the specific case I&#x27;ve used:
&gt; 
&gt;     - entropy\_0 = blake2b(\[42\_u8; 32\])\[..32\]
&gt;     - entropy\_i+1 = blake2b(entropy\_i)\[..32\]
&gt; 2. If you take as a reference the Sassafras RFC then there some differences.
&gt; One of these is the attempts number and redundancy factor, which in the GP are in practice simplified to one single thing (attempts number).
&gt; Threshold is gone.
&gt; Even though reading Sassafras RFC can help (as it is a quite similar protocol), always take the GP as the source of truth for JAM.
&gt; 3. Sure thing. I&#x27;ll post here as soon as it is ready.
&gt; 4. This is a very interesting observation. Current implementation serializes 3 extra fields (part of the SNARK SRS).
&gt; Serialization of these fields may be important **in a general application**, but here these values are constant.
&gt; I will definitely get rid of these from serialized data (I&#x27;m on it). The final size will be 144 (i.e. the last 144 bytes of what you see right now)

Hi Davide,

I&#x27;m quoting this old message as it is related to my doubt. I have checked messages on the chat here and there and I just wanted to confirm my understanding of the test vectors regarding safrole.

- Just to confirm, in the test vectors &quot;input.entropy&quot; refers here to Y(H_v) of the GP, right?
- Thus, in the test vectors we don&#x27;t verify equations (59) and (60) (parts related to ark-ec-vrfs that I asked you about last week), right?</div>
<div class='msg'><time>2024-07-29 17:42</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: - As that old message reports, the <code>input.entropy</code> **for the vest vectors** is generated in some &quot;arbitrary&quot; manner (the quoted message reports how I generated it). In a real scenario YES, it is generated as per equation (66) of the last GP release (DRAFT 0.3.1 Jul 17). In the context of the safrole test vectors,  is not really important how we generate it as <code>H_v</code> is not present at all.
- In safrole test vectors **we don&#x27;t verify** the validity of the signatures contained within the header (i.e. H\_v and H\_s) simply because are not part of the safrole&#x27;s specific STF. These will be probably verified in some upcoming test vectors to asses block&#x27;s header validity <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-07-29 17:52</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Thank you</div>
<div class='msg'><time>2024-07-29 18:36</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Regarding &quot;recent history&quot;, why do we assign H\_r to beta\[0\] instead of assigning it to beta\[|beta| - 1\] ?

Since we produce beta&#x27; by appending the new elements to the end and taking the last H elements of the array (equation 81) I would have thought the last element of beta should be used for equation (80) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-30 04:32</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-07-30 at 4.31.47 PM.png</div>
<div class='msg'><time>2024-07-30 04:33</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: not 100% sure what is the modulo subscription operator is doing here. does it mean the memory access is never out of bonds but wrapped?</div>
<div class='msg'><time>2024-07-30 10:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-07-30 10:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; not 100% sure what is the modulo subscription operator is doing here. does it mean the memory access is never out of bonds but wrapped?

Yes.</div>
<div class='msg'><time>2024-07-31 09:01</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: am I wrong or there is no definition of what <code>Xv</code> is? being used in <code>98</code> first and <code>101</code>. I have the feeling <code>99</code> might miss something?</div>
<div class='msg'><time>2024-07-31 09:02</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-07-31 09:15</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I think there is a bug in the version without background:
<a href="https://graypaper.com/graypaper_no_background.pdf" target="_blank" rel="noopener">https://graypaper.com/graypaper_no_background.pdf</a>

</div>
<div class='msg'><time>2024-07-31 09:15</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-07-31 at 10.13.30.png</div>
<div class='msg'><time>2024-07-31 09:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; am I wrong or there is no definition of what <code>Xv</code> is? being used in <code>98</code> first and <code>101</code>. I have the feeling <code>99</code> might miss something?

v is either true or false. Both possibilities are defined in (99)</div>
<div class='msg'><time>2024-07-31 09:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; I think there is a bug in the version without background:
&gt; <a href="https://graypaper.com/graypaper_no_background.pdf" target="_blank" rel="noopener">https://graypaper.com/graypaper_no_background.pdf</a>
&gt; 
&gt; 

I don’t know who produced these. <a href="https://matrix.to/#/@philip.poloczek:parity.io" target="_blank" rel="noopener">@philip.poloczek:parity.io</a> please remove them if they’re broken, thanks. </div>
<div class='msg'><time>2024-07-31 09:19</time>&ensp;<span class='u' style='color:#8e60c3'>obi</span>: </div>
<div class='msg'><time>2024-07-31 09:20</time>&ensp;<span class='u' style='color:#8e60c3'>obi</span>: </div>
<div class='msg'><time>2024-07-31 09:20</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: thanks for the answer. I might miss the link between <code>v</code>and <code>(99)</code> then. but thanks for confirming <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-31 10:04</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: that <code>T</code> is true and the upside down <code>⟂</code> is false.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-31 10:05</time>&ensp;<span class='u' style='color:#58d23c'>philip.poloczek</span>: &gt; &lt;@danicuki:matrix.org&gt; I think there is a bug in the version without background:
&gt; <a href="https://graypaper.com/graypaper_no_background.pdf" target="_blank" rel="noopener">https://graypaper.com/graypaper_no_background.pdf</a>

Thanks for reporting this. It&#x27;s fixed now. Sorry for the inconvenience. 

I&#x27;ve added a disclaimer to the site that the white version is just for convenience and the gray version/github release being the decisive one</div>
<div class='msg'><time>2024-07-31 10:11</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: &gt; &lt;@danicuki:matrix.org&gt; I think there is a bug in the version without background:
&gt; <a href="https://graypaper.com/graypaper_no_background.pdf" target="_blank" rel="noopener">https://graypaper.com/graypaper_no_background.pdf</a>

there are some unofficial alternative renders in three color schemata here as well: <a href="https://jamcha.in/spec." target="_blank" rel="noopener">https://jamcha.in/spec.</a> They are automatically re-rendered from the main branch with at most 2hr delay. just in case you want the latest unreleased changes </div>
<div class='msg'><time>2024-07-31 12:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room v0.3.2 is tagged and PDF available <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.2" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.3.2</a></div>
<div class='msg'><time>2024-07-31 14:55</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I think i migght have found a typo in <code>129</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-31 14:56</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-07-31 14:56</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: let me know if that&#x27;s correct i will gladly open a PR with the fix</div>
<div class='msg'><time>2024-07-31 14:57</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: sorry for insisting but shouldn&#x27;t we use ? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-31 14:57</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: image.png</div>
<div class='msg'><time>2024-07-31 14:57</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: instead of</div>
<div class='msg'><time>2024-07-31 14:57</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: image.png</div>
<div class='msg'><time>2024-07-31 14:57</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: since we append new elements at the end and only take the H last elements: <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-07-31 14:58</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: image.png</div>
<div class='msg'><time>2024-07-31 15:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@celadari:matrix.org&gt; sorry for insisting but shouldn&#x27;t we use ?

yes that looks to be a typo...</div>
<div class='msg'><time>2024-07-31 17:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; I think i migght have found a typo in <code>129</code>

<a href="https://github.com/gavofyork/graypaper/pull/54/commits/c6d3af2abac9ab170e04ac820a40a6525c782b49" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/54/commits/c6d3af2abac9ab170e04ac820a40a6525c782b49</a> - thanks!</div>
<div class='msg'><time>2024-08-01 11:34</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: image.png</div>
<div class='msg'><time>2024-08-01 11:35</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: this should be <code>m</code> instead of <code>m&amp;#x27;</code>?</div>
<div class='msg'><time>2024-08-01 12:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@qiwei:matrix.org&gt; this should be <code>m</code> instead of <code>m&amp;#x27;</code>?

Yes :) <a href="https://github.com/gavofyork/graypaper/pull/54/commits/4a98e1f7180ed6d01d62ab5109092e2cb806d984" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/54/commits/4a98e1f7180ed6d01d62ab5109092e2cb806d984</a></div>
<div class='msg'><time>2024-08-02 11:19</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-08-02 11:19</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: what is this sentence referring to? I tried to find the <code>above condition</code> that its being referred there but I am unsure</div>
<div class='msg'><time>2024-08-02 11:26</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: &gt; &lt;@prematurata:matrix.org&gt; what is this sentence referring to? I tried to find the <code>above condition</code> that its being referred there but I am unsure

maybe it should say <code>above conditions are not met</code>? This is how I understood it a least.</div>
<div class='msg'><time>2024-08-02 11:27</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: oh that might also make more sense. but i dont see any conditions (there) the 3 above elements are just definitions, that&#x27;s part of the reason why i&#x27;m confused <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 11:32</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: &gt; &lt;@prematurata:matrix.org&gt; oh that might also make more sense. but i dont see any conditions (there) the 3 above elements are just definitions, that&#x27;s part of the reason why i&#x27;m confused

hmm, good point.</div>
<div class='msg'><time>2024-08-02 12:32</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: I interpreted it as <code>if the definitions can&amp;#x27;t be computed</code></div>
<div class='msg'><time>2024-08-02 12:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@cisco:parity.io&gt; I interpreted it as <code>if the definitions can&amp;#x27;t be computed</code>

Yes</div>
<div class='msg'><time>2024-08-02 12:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The condition it is refering to is the equality of v_x.</div>
<div class='msg'><time>2024-08-02 12:36</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@cisco:parity.io&gt; I interpreted it as <code>if the definitions can&amp;#x27;t be computed</code>

I thought about that as well ... as far as I can think of there is only one case when that cannot be computed. and if the next istruction is just right after the one we&#x27;re evaluating</div>
<div class='msg'><time>2024-08-02 12:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Because of its inverse encoding (E^-1), there&#x27;s a possibility it can fail (i.e. that there is no v_x which can satisfy the condition) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 12:36</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: ha!</div>
<div class='msg'><time>2024-08-02 12:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The other conditions (equalities) can always be met. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 12:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For a simple example, suppose I had defined v_x as i: 1&lt;i&lt;0.</div>
<div class='msg'><time>2024-08-02 12:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: then that condition would obviously not be possible to be met. No value exists which is both greater than 1 and less than 0.</div>
<div class='msg'><time>2024-08-02 12:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;s not (always) about being evaluatable or computable. Of course practical implementations must evaluate/compute, but formal specs only need specify relations and conditions. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 12:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Therefore we say &quot;if the condition cannot be met&quot; rather than &quot;if you can&#x27;t compute the value&quot;.</div>
<div class='msg'><time>2024-08-02 12:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There are various reasons why a value &quot;may not be computable&quot; - perhaps you don&#x27;t have the operands, perhaps you don&#x27;t know an algorithm to do it, perhaps the CPU is broken... there are practical concerns since computable is practical endeavour. We wouldn&#x27;t want to define the protocol in terms of practical concerns. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 12:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Meeting a condition is not a practical endeavour. It&#x27;s purely theoretical.</div>
<div class='msg'><time>2024-08-02 12:56</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: i am still trying to wrap my head around that. so i can&#x27;t really find a practical  <code>l_x</code> for which <code>E_lx</code> is not computable. (not considering the case where the arguments input size is zero or formally <code>ζı+1 ∈ ϖ</code>).

I understand the reasoning about <code>condition</code> vs <code>computable</code> but, feel free to correct me. Since the <code>E^-1</code> is the inverse of <code>E</code> for which  there is no input for which <code>E</code> fails to produce output... then I&#x27;d expect (always mathematically speaking) that if the inverse function is &quot;called&quot; with a member of the output set of <code>E</code>which is **Y**l (aka a sequence of <code>l</code>octects) then, unless otherwise specified, there would be no reason to believe the inverse fails for some inputs.


</div>
<div class='msg'><time>2024-08-02 12:58</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: So if my reasoning is correct, then I&#x27;d propose that either the <code>disclaymer</code> is <code>global</code>. If, for some reason, the defined values cannot be computed then a panic should occur <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 15:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Well, there are sequences of octets which when passed into E^-1 do not provide a value in N_(2^32), right? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 15:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As such the decoding may fail. </div>
<div class='msg'><time>2024-08-02 15:18</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: yes you&#x27;re right. but if you mean when the input sequence is longer than 4 octects... well that should be enforced by the <code>min</code> in <code>l_x</code> definition .  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 15:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I don’t mean that. </div>
<div class='msg'><time>2024-08-02 15:37</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I don&#x27;t see how little endian encoding which is defined in 273 has a way for its inverse to produce a value **not** in <code>N_(2^32)</code>. when subscripted with <code>x</code> being <code>0&amp;lt;=x&amp;lt;=4</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 17:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes indeed: <a href="https://github.com/gavofyork/graypaper/pull/54/commits/d474ed4da1032cfa1398c11afc0b3edf37f3934b" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/54/commits/d474ed4da1032cfa1398c11afc0b3edf37f3934b</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-02 17:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (Until 0.3 series with the PVM changes that equation was originally the decode function without the subscript, implying that it could fail to decode. That&#x27;s no longer the case so I&#x27;ll remove the now-superfluous disclaimer.)</div>
<div class='msg'><time>2024-08-04 10:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 0.3.3 released with all the recent corrections: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.3" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.3.3</a></div>
<div class='msg'><time>2024-08-04 10:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Heads-up: 0.4 will likely include a formalisation of #57 (dependent on final review).</div>
<div class='msg'><time>2024-08-05 03:23</time>&ensp;<span class='u' style='color:#65c4c9'>jay-chrawnna</span>: we&#x27;ve released the clips of the Belgium lecture for those using the YouTube <a href="https://www.youtube.com/watch?v=wbnTnBQNDr4&amp;list=PLwcnAOKMj-Ab7sDej2P4peqGxu2mTGYNy" target="_blank" rel="noopener">playlist</a>. Because the Gray Paper is a living project, we opt to title &amp; number the clips based on the version of the graypaper at time of lecture.

You&#x27;ll find them on graypaper.com soon™️</div>
<div class='msg'><time>2024-08-05 04:35</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: A minor inconsistency, <code>e</code> is used as epoch index for Safrole, but<code>m</code> is used as epoch index for validator activity statistics</div>
<div class='msg'><time>2024-08-05 04:35</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-05 at 4.35.22 PM.png</div>
<div class='msg'><time>2024-08-05 04:35</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-05 at 4.35.34 PM.png</div>
<div class='msg'><time>2024-08-05 04:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: the state deps graph for <code>π</code> seems to be incomplete?</div>
<div class='msg'><time>2024-08-05 04:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-05 at 4.43.18 PM.png</div>
<div class='msg'><time>2024-08-05 04:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-05 at 4.43.35 PM.png</div>
<div class='msg'><time>2024-08-05 04:43</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: it doesn&#x27;t have <code>Hi</code></div>
<div class='msg'><time>2024-08-05 06:06</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: is this a typo? (this part is super confusing because judgements now renamed to verdicts but there is still a variable j used in verdicts)</div>
<div class='msg'><time>2024-08-05 06:07</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-05 at 6.06.57 PM.png</div>
<div class='msg'><time>2024-08-05 06:07</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-05 at 6.07.17 PM.png</div>
<div class='msg'><time>2024-08-05 06:12</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-05 at 6.12.08 PM.png</div>
<div class='msg'><time>2024-08-05 06:13</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I am also unsure what exactly is the squared part mean here. It reads like epoch index minus 2? But it doesn&#x27;t make much sense to me here</div>
<div class='msg'><time>2024-08-05 06:15</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I guess it means that value <code>a</code> must be either the current epoch index or the previous one?</div>
<div class='msg reply'><time>2024-08-05 09:06</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: yes 11:28 <a href="https://www.youtube.com/watch?v=iMAqVPGppbs&amp;t=688s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=iMAqVPGppbs&amp;t=688s</a></div>
<div class='msg reply'><time>2024-08-05 09:09</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: thanks. this reminds me I should finish watching the jam lectures </div>
<div class='msg'><time>2024-08-05 06:23</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: In 226, shouldn&#x27;t the iota in the first case be <code>i + 1 + skip(i)</code>? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-05 07:52</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: &gt; Specifically, the machine does not halt, the instruction counter increments by one</div>
<div class='msg reply'><time>2024-08-05 07:52</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: so during normal execution, the counter will be updated</div>
<div class='msg reply'><time>2024-08-05 07:52</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: we don&#x27;t want to update it twice, or make an exception case here</div>
<div class='msg reply'><time>2024-08-05 08:05</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: so this means that the first case is covered through (220). Got it. Thanks!</div>
<div class='msg reply'><time>2024-08-05 09:49</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: &gt; &lt;@xlchen:matrix.org&gt; we don&#x27;t want to update it twice, or make an exception case here

Yes but following the formalism if we go to <code>b</code> we execute it first. We don&#x27;t do <code>b + 1 + skip(b)</code>, we first go to <code>b</code>and execute it. So I think what Ivan said makes sense 🤔</div>
<div class='msg reply'><time>2024-08-05 23:13</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: the instruction updates the counter and that&#x27;s it. </div>
<div class='msg reply'><time>2024-08-05 23:13</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: and the usual steps continues. i.e. increment the counter and execute the next instruction</div>
<div class='msg reply'><time>2024-08-08 10:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This is correct.</div>
<div class='msg'><time>2024-08-05 06:24</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: image.png</div>
<div class='msg'><time>2024-08-05 10:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; is this a typo? (this part is super confusing because judgements now renamed to verdicts but there is still a variable j used in verdicts)

Yes. I’ve cleared up the naming. </div>
<div class='msg'><time>2024-08-05 10:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Disputes includes verdicts (a final aggregated decision on whether a WR was bad) and offenders (proofs of those validators who issued judgements against such a verdict). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-05 10:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Verdicts are made up of individual judgements (which is a vote and a validator&#x27;s signature). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-05 10:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (In previous versions, we did not have offenders, and both judgements and verdicts were called judgements, confusingly) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-06 09:21</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Hey there! The last couple of days I&#x27;ve been working on a tool that would help to read and annotate the Gray Paper. Looking for some feedback:
<a href="https://graypaper.fluffylabs.dev/" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/</a>

On the top of the priority list to implement is to display the notes within the document and migrate them between versions. I found myself having a lot of notes on a printed version, but they are hard to maintain when the document keeps changing, hence the website.

Another important feature for me is the ability to share a link to a selection - I&#x27;ve noticed here that many people share screenshots (which I believe is still good), but if the screenshots were augmented with such a link it&#x27;s easier for others to find the context of the  discussion (and the graypaper version the quote is coming from).

Curious to hear what would be important for you or what you&#x27;d like to see improved. The (pretty hacky) code is on github, so feel free to file an issue or a PR there.</div>
<div class='msg reply'><time>2024-08-06 09:44</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: The linking feature is awesome! I tried a few things to have links to a specific formular but this is top. Does it search for the text or how does it resolve a link to a spot in the paper?</div>
<div class='msg reply'><time>2024-08-06 09:56</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: &gt; &lt;@oliver.tale-yazdi:parity.io&gt; The linking feature is awesome! I tried a few things to have links to a specific formular but this is top. Does it search for the text or how does it resolve a link to a spot in the paper?

As mentioned earlier it&#x27;s pretty hacky :D The PDF is converted to HTML and it has a very specific structure. The link saves the HTML nodes that are selected and then searches for these exact nodes  when loaded. I&#x27;m still trying to figure out how to best &quot;migrate&quot; the selection from one version to another, but I&#x27;m positive I&#x27;ll figure something out, given I have full information about the selection (including page, section, subsection, gp version and the text content)</div>
<div class='msg reply'><time>2024-08-06 09:57</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: The migration to newer version will most likely need some fuzzy searching if the exact text is not found, but at least we can limit that to some particular section.</div>
<div class='msg reply'><time>2024-08-06 09:58</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: We are also working on using synctex to map PDF/HTML selection to raw latex sources as another option.</div>
<div class='msg reply'><time>2024-08-06 10:07</time>&ensp;<span class='u' style='color:#ad33c0'>kianenigma</span>: This is super useful, thanks for sharing! will start using it and share feedback :) </div>
<div class='msg reply'><time>2024-08-06 10:28</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: Awesome tool! I also took a lot of notes on a printed version but all the changes make my notes harder to find.

You could maybe show the visual diffs between the different versions and associate notes to a particular version if stuff changed</div>
<div class='msg'><time>2024-08-06 12:09</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-08-06 12:10</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-08-06 12:10</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-08-06 12:11</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-08-06 12:11</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-08-06 12:14</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &lt;del&gt;~~Hello, i believe there is no formalism on how to properly encode/decode workresults. The <code>o</code> term is either <code>byte array</code> or <code>enum</code>. (123 and 124) .&lt;/del&gt;

&lt;del&gt;considering the <code>Eg</code> exstrinsic is a tuple containing workreport <code>138</code> and <code>119</code>. And that there is no specific formalism for term <code>o</code> in 123 on appendix <code>C</code>, i believe that note <code>20</code> at page <code>49</code> might also apply here?~~&lt;/del&gt; <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-06 12:25</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-08-06 13:14</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-08-06 13:15</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: is (284) correct? it misses the <code>segment-root</code> from the <code>S</code> set</div>
<div class='msg'><time>2024-08-06 17:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Incorrect. Will be fixed!</div>
<div class='msg'><time>2024-08-06 17:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Should appear after the regular erasure root. </div>
<div class='msg'><time>2024-08-07 13:01</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: AFAICT the PVM program should run up until it reaches an invalid instruction. What&#x27;s the reason for that? Couldn&#x27;t programs with invalid instructions be cheaply rejected during some initial (linear) validation based on the instruction mask? We also have well-defined trap instruction to terminate the program, so no need for that to panic (like there was in EVM afair).

The only reasons I could think of is:
1. Avoid the need of pre-validation completely (i.e. don&#x27;t assume there is anything like that in GP)
2. Support some future extensions?

Is there anything I&#x27;m missing here? Perhaps the compilers generate a code with invalid instructions in case of panic?</div>
<div class='msg'><time>2024-08-07 14:18</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: image.png</div>
<div class='msg'><time>2024-08-07 14:22</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: hello.
i think there is a mistake in recent history -  equation 83
**the subscript s is supposed to be subscript x**

since _s_ is an availability specification, that does no have a _p_ sub-component (eq 122)
_x_, however is refinement context , that does have _p_ component that is a hash (eq 121)


or maybe it refers to <em>S</em> subscript *h*? the work package hash? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-07 17:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It refers to the work package hash in the specification component. </div>
<div class='msg'><time>2024-08-08 01:58</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: &gt; &lt;@gav:polkadot.io&gt; It refers to the work package hash in the specification component.

thank you</div>
<div class='msg'><time>2024-08-08 07:26</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: gav:  any comments on this one? My current read of the GP is that it&#x27;s fine to have programs with invalid instructions, since they obviously might never be reached in code and we still need to panic only if that particular instruction is reached during execution. And obviously that&#x27;s payed for.
However I&#x27;m thinking if it would be &quot;less wasteful&quot; to disallow programs with invalid instructions to be executed at all. But perhaps it&#x27;s over complication or not practical for some reasons yet unknown for me? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-08 07:27</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-08-08 07:27</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-08-08 07:34</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I think there&#x27;s a typo in 59. k_b should be <code>k_e</code></div>
<div class='msg'><time>2024-08-08 08:52</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-08-08 08:52</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: and maybe this is also a typo... <code>posterior m</code> can be &gt; than <code>Y</code> but then <code>|ya|</code> would not be = to <code>E</code>... what I think we want to make sure is that the <em>current</em> <code>m</code> is &gt; than <code>Y</code> so that we know the lottery &quot;time&quot; is over <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-08 10:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@tomusdrw:matrix.org&gt; AFAICT the PVM program should run up until it reaches an invalid instruction. What&#x27;s the reason for that? Couldn&#x27;t programs with invalid instructions be cheaply rejected during some initial (linear) validation based on the instruction mask? We also have well-defined trap instruction to terminate the program, so no need for that to panic (like there was in EVM afair).
&gt; 
&gt; The only reasons I could think of is:
&gt; 1. Avoid the need of pre-validation completely (i.e. don&#x27;t assume there is anything like that in GP)
&gt; 2. Support some future extensions?
&gt; 
&gt; Is there anything I&#x27;m missing here? Perhaps the compilers generate a code with invalid instructions in case of panic?

Point 1. </div>
<div class='msg'><time>2024-08-08 10:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The PVM is designed to be linear complexity in terms of execution steps, not program size.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-08 10:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Correct. Will be in next round of corrections thanks <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-08 10:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah that is already corrected to the prior m on the latest GP.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-08 12:23</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@gav:polkadot.io&gt; Yeah that is already corrected to the prior m on the latest GP.

oops sorry. i must have missed one release</div>
<div class='msg'><time>2024-08-08 12:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@tomusdrw:matrix.org&gt; AFAICT the PVM program should run up until it reaches an invalid instruction. What&#x27;s the reason for that? Couldn&#x27;t programs with invalid instructions be cheaply rejected during some initial (linear) validation based on the instruction mask? We also have well-defined trap instruction to terminate the program, so no need for that to panic (like there was in EVM afair).
&gt; 
&gt; The only reasons I could think of is:
&gt; 1. Avoid the need of pre-validation completely (i.e. don&#x27;t assume there is anything like that in GP)
&gt; 2. Support some future extensions?
&gt; 
&gt; Is there anything I&#x27;m missing here? Perhaps the compilers generate a code with invalid instructions in case of panic?

(There are actually a number of exit conditions, an illegal instruction is only one of them and I wouldn&#x27;t expect it to happen in production.)</div>
<div class='msg'><time>2024-08-09 12:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/releases/" target="_blank" rel="noopener">v0.3.4</a> is out with the latest corrections. Nothing particularly new in there. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-09 14:09</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: </div>
<div class='msg'><time>2024-08-09 14:11</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: In the serialization definitions, there is the variable-size prefix 29-bit natural serialization function E4∗ \se_{4*}


But I don&#x27;t see it being used anywhere. I see only mentions to E4 (without the *) \se_4  

Should we use \se_{4*} by default when we see \se_4 ?</div>
<div class='msg reply'><time>2024-08-09 14:12</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-08-09 at 15.11.50.png</div>
<div class='msg reply'><time>2024-08-09 14:12</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-08-09 at 15.12.02.png</div>
<div class='msg'><time>2024-08-09 15:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; In the serialization definitions, there is the variable-size prefix 29-bit natural serialization function E4∗ \se_{4*}
&gt; 
&gt; 
&gt; But I don&#x27;t see it being used anywhere. I see only mentions to E4 (without the *) \se_4  
&gt; 
&gt; Should we use \se_{4*} by default when we see \se_4 ?

No. When you see \se_4, use \se_4. The variable-length encoding functions are not presently used. They might be used in the future but for now you obviously don’t need to implement them to build a conformant implementation. </div>
<div class='msg'><time>2024-08-09 21:12</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: </div>
<div class='msg'><time>2024-08-11 17:19</time>&ensp;<span class='u' style='color:#d43250'>finsig</span>: For integer encoding, eq275, there are values of x that satisfy 2^7*l &lt;= x &lt; 2^7(l+1) but do not correctly encode with length (l). For example, 2^14-1 satisfies the criteria for length 1, 2^7 &lt;= 2^14-1 &lt; 2^14, and encodes to bytes [255]. However, it requires length 2 bytes [255,63] = 2^14-1. Should the criteria instead be: 2^7*(l -1) &lt;= x &lt; 2^(7 * l) </div>
<div class='msg'><time>2024-08-11 17:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I’m not sure what you mean. It satisfies the criteria for l=1, which implies it needs two bytes: the discriminator summed with the most-significant bits in the first byte (128 + 63 = 191), together with least significant byte in the second (255), giving [191,255] <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-12 01:59</time>&ensp;<span class='u' style='color:#d43250'>finsig</span>: &gt; &lt;@gav:polkadot.io&gt; I’m not sure what you mean. It satisfies the criteria for l=1, which implies it needs two bytes: the discriminator summed with the most-significant bits in the first byte (128 + 63 = 191), together with least significant byte in the second (255), giving [191,255]

sorry, my mistake. I understand now.</div>
<div class='msg'><time>2024-08-12 10:04</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Screenshot 2024-08-12 at 11.59.40.png</div>
<div class='msg'><time>2024-08-12 10:04</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Screenshot 2024-08-12 at 12.00.37.png</div>
<div class='msg'><time>2024-08-12 10:04</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: The text in the guarantees extrinsic and the Block Serialization mention a core-index, but it looks like i was moved into the work-report. So just the text and encoding logic needs fixing?</div>
<div class='msg'><time>2024-08-12 11:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes: <a href="https://github.com/gavofyork/graypaper/commit/27947d73ab593597dcf4f41c036bd1eb68fd6ffe" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/commit/27947d73ab593597dcf4f41c036bd1eb68fd6ffe</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-14 02:31</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2024-08-14 02:31</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: davxy: Do you have a snippet of code that represents the above computation?  Would like to check our assumptions.  This &quot;ring root&quot; is used in a new epoch as per: <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-14 03:10</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: I think it&#x27;s just <a href="https://github.com/davxy/bandersnatch-vrfs-spec/blob/57f89545b825b8f032180dff59cf9d360d43d0dd/example/src/main.rs#L116" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/blob/57f89545b825b8f032180dff59cf9d360d43d0dd/example/src/main.rs#L116</a> 

<pre><code class=''>let mut buf = Vec::new();

verifier.commitment.serialize_compressed(&amp;mut buf).unwrap();
</code></pre></div>
<div class='msg reply'><time>2024-08-14 08:08</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: ^ this</div>
<div class='msg reply'><time>2024-08-14 09:02</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Excellent, we guessed right =)</div>
<div class='msg'><time>2024-08-14 02:33</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2024-08-14 03:07</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Is it possible for you to provide a full run of blocks for 4 epochs of a &quot;tiny&quot; chain (eg V=6, E=12, Y=8) with a complete genesis config with predefined Alice/Bob/.. /Fergie keys like   <a href="https://substrate.stackexchange.com/questions/41/what-are-the-predefined-accounts-alice-bob-etc" target="_blank" rel="noopener">https://substrate.stackexchange.com/questions/41/what-are-the-predefined-accounts-alice-bob-etc</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-14 22:56</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: </div>
<div class='msg'><time>2024-08-14 22:57</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: gav: Doesn&#x27;t host function <code>write</code> need a &quot;s&quot; register input like <code>read</code> has in <code>\omega_0</code>?    <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-14 22:57</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: </div>
<div class='msg'><time>2024-08-14 23:12</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: For <code>import</code> GP says &quot;This process may in fact be lazy as the Refine function makes no usage of the data until the import hostcall is made.&quot; -- does this imply that  PVM interpreters should &quot;page fault&quot; when hitting an &quot;import&quot; instruction?  Is this the only host function having a lazy evaluation / page fault or would there be others (say, <code>export</code> \[though I imagine it would be the last thing being done\]), in interacting with the DA systems? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-14 23:17</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: For Epoch Markers, at the start of Section 5.1 you have &quot;If not ∅, then the epoch marker specifies key and entropy relevant to the following epoch in case the ticket contest does not complete adequately (a very much unexpected eventuality)&quot; but then in equation (72) you have something that appears contradictory:
</div>
<div class='msg'><time>2024-08-14 23:17</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2024-08-14 23:19</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Does the epoch marker appear on rare occasions (only when the ticket contest does not complete adequately) or on every new epoch (what (72) implies)</div>
<div class='msg'><time>2024-08-15 06:41</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: The epoch marker appears in the first block of every epoch</div>
<div class='msg'><time>2024-08-15 06:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is merely noting that not all import data may need to be fetched ahead of the start of execution.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-15 06:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s obvious, really, but I wanted to point it out as for M4 it will be necessary to parallelise execution with import segment fetching.</div>
<div class='msg'><time>2024-08-15 06:52</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; relevant to the following epoch in case the ticket contest does not complete adequately (a very much unexpected eventuality)&quot; 

It is rare that the ticket contest doesn&#x27;t complete successfully. If the contest is successful, then the previously announced epoch marker becomes irrelevant for the sake of slot assignments to validators.</div>
<div class='msg'><time>2024-08-15 11:35</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: To me it looks like the types of the sets in definition 101 are incompatible: <code>Lambda U Kappa</code> being a set of validator key tuples and <code>Psi-o</code> a set of Ed25519 keys:</div>
<div class='msg'><time>2024-08-15 11:36</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: gp.png</div>
<div class='msg'><time>2024-08-15 12:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@oliver.tale-yazdi:parity.io&gt; To me it looks like the types of the sets in definition 101 are incompatible: <code>Lambda U Kappa</code> being a set of validator key tuples and <code>Psi-o</code> a set of Ed25519 keys:

yeah - it should be the Ed25519 portions of lambda and kappa.</div>
<div class='msg'><time>2024-08-15 12:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be corrected in 0.3.5</div>
<div class='msg'><time>2024-08-15 12:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: i.e. <code>[k_e | k \in \lambda \cup \kappa]</code></div>
<div class='msg'><time>2024-08-16 08:03</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: Screenshot 2024-08-16 at 10.02.44.png</div>
<div class='msg'><time>2024-08-16 08:03</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: Looking at the PVM&#x27;s standard program initialization. What is that <code>z</code>? I&#x27;ve identified all others and even read compiled pvm files successfully without mentioning it</div>
<div class='msg'><time>2024-08-16 09:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s the number of zeroed pages. </div>
<div class='msg'><time>2024-08-16 09:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: See right section of 4th row in initial memory layout. </div>
<div class='msg'><time>2024-08-16 09:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (246)</div>
<div class='msg'><time>2024-08-16 09:32</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: Thanks!</div>
<div class='msg'><time>2024-08-17 00:52</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2024-08-17 00:53</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: For <code>historical_lookup</code> host function, the $H$ in $H({\\bf a},t,h)$ should be a $\\Lambda$ to match 92+94 of Section 9.

Any reason why you don&#x27;t just assign some opcodes to all the host functions?   Can just add 100 or 128 to the existing ones, 13 becomes 113 or 141? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-17 04:50</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: @davxy:matrix.org:  just to clarify, can we use the code in <a href="https://github.com/davxy/bandersnatch-vrfs-spec/tree/main/example" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/tree/main/example</a> ?</div>
<div class='msg'><time>2024-08-17 08:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; For <code>historical_lookup</code> host function, the $H$ in $H({\\bf a},t,h)$ should be a $\\Lambda$ to match 92+94 of Section 9.
&gt; 
&gt; Any reason why you don&#x27;t just assign some opcodes to all the host functions?   Can just add 100 or 128 to the existing ones, 13 becomes 113 or 141?

Then each of the contexts would need to be integrated and defined as part of the basic PVM, which is obviously a terrible idea. </div>
<div class='msg reply'><time>2024-08-17 12:21</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Understood.  We are using koute&#x27;s assembler to build  refine and accumulate toy cases (to do squaring [refine] and summing [accumulating]) to cover host function implementations by hand replacing &quot;17=0x11&quot; (fallthrough) with &quot;temporary opcodes&quot; in the 128 range since all host functions are instructions with no args (ie for historical_lookup, 141=0x8D).    

We can fork koute/polkavm and add our own little mapping for the 2 dozen host functions around here 
<a href="https://github.com/koute/polkavm/blob/41c74f966eea0b7670075082f1231c6eeef20fc2/crates/polkavm-common/src/program.rs#L1313" target="_blank" rel="noopener">https://github.com/koute/polkavm/blob/41c74f966eea0b7670075082f1231c6eeef20fc2/crates/polkavm-common/src/program.rs#L1313</a>
<a href="https://github.com/koute/polkavm/blob/41c74f966eea0b7670075082f1231c6eeef20fc2/crates/polkavm-common/src/assembler.rs#L308" target="_blank" rel="noopener">https://github.com/koute/polkavm/blob/41c74f966eea0b7670075082f1231c6eeef20fc2/crates/polkavm-common/src/assembler.rs#L308</a>
Adding 128 is sufficient to avoid collisions, but seems clear that koute could surely follow the GP spec on these details?  
</div>
<div class='msg'><time>2024-08-17 08:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; For <code>historical_lookup</code> host function, the $H$ in $H({\\bf a},t,h)$ should be a $\\Lambda$ to match 92+94 of Section 9.
&gt; 
&gt; Any reason why you don&#x27;t just assign some opcodes to all the host functions?   Can just add 100 or 128 to the existing ones, 13 becomes 113 or 141?

On the first point, yes indeed - refactoring error and will be corrected in 0.3.5. </div>
<div class='msg'><time>2024-08-17 11:33</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@luke_f:matrix.org&gt; @davxy:matrix.org:  just to clarify, can we use the code in <a href="https://github.com/davxy/bandersnatch-vrfs-spec/tree/main/example" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/tree/main/example</a> ?

Yes. That example is compliant with what you need for JAM</div>
<div class='msg'><time>2024-08-17 13:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: On what details?</div>
<div class='msg'><time>2024-08-17 14:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I’m not really sure what you’re proposing, but if you mean to use opcodes which are not yet in use in place of host functions I would caution against it. Opcodes which are not in use should panic as an illegal instruction. If they do anything else then it will fail test vectors. </div>
<div class='msg'><time>2024-08-18 02:12</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: <a href="https://github.com/koute/polkavm/pull/156" target="_blank" rel="noopener">https://github.com/koute/polkavm/pull/156</a>
has the idea.  Understand the caution, but not sure how else implementers can tackle implementing 23 host functions (8 or so critical to get the basics of DA+ a battery of refine-accumulate code for &quot;tiny&quot; JAM services: import, export, solicit, forget, historical\_lookup, read, write, lookup) without something along these lines.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-18 02:13</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: <a href="https://github.com/koute/polkavm/blob/32253a16f3f427fb829c2013615192e17324cbf3/tools/spectool/spec/src/hostfunctions/README.md" target="_blank" rel="noopener">https://github.com/koute/polkavm/blob/32253a16f3f427fb829c2013615192e17324cbf3/tools/spectool/spec/src/hostfunctions/README.md</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-18 07:13</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: In eq(93), the preimage appears to be of arbitrary size - which is then erasure encoded &amp; distributed in segments of size wc*ws to DA. But how does the E_p (lookup extrinsic) in section 12.1 (eq 155-158) able to know the length of the preimage? Without knowing the length, we probably cannot remove the padded zeros from the wc * ws segments. What am I missing?</div>
<div class='msg'><time>2024-08-18 10:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; <a href="https://github.com/koute/polkavm/pull/156" target="_blank" rel="noopener">https://github.com/koute/polkavm/pull/156</a>
&gt; has the idea.  Understand the caution, but not sure how else implementers can tackle implementing 23 host functions (8 or so critical to get the basics of DA+ a battery of refine-accumulate code for &quot;tiny&quot; JAM services: import, export, solicit, forget, historical\_lookup, read, write, lookup) without something along these lines.

you&#x27;ll need to implement the host functions regardless. you&#x27;ll need to implement PVM too regardless.</div>
<div class='msg'><time>2024-08-18 10:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: i don&#x27;t understand why you&#x27;re trying to use polkavm given that even for M1 you&#x27;ll need to write your own. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-18 10:59</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: We are implementing our own PVM interpreter of course!  We have already done so for the Appendix A instruction set and covered the tests of <a href="https://github.com/w3f/jamtestvectors/pull/3." target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/3.</a>   We just need to have some similar byte code for Appendix B.  To do that, we have to assemble some byte code that has host functions, and so we only  use koute&#x27;s assembler to map some assembly code (the PR has 23 of them) into PVM byte code to test that assembler.

We are <em>not</em> FFIing into koute/polkavm.  We are only using it as an <em>assembler</em> to generate byte code to implement 23 host functions of Appendix B, following koute&#x27;s assemble/disassemble tool.

<a href="https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2257688558" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2257688558</a>
</div>
<div class='msg reply'><time>2024-08-18 11:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: ok that&#x27;s something.</div>
<div class='msg reply'><time>2024-08-18 11:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: but why not just use <code>ecalli</code> along with the relevant host call index? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-18 11:03</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: FYI there are some hostcall examples here if you just need something to test: <a href="https://github.com/JamBrains/polkavm-examples/blob/master/lang-cpp/main.cpp#L13" target="_blank" rel="noopener">https://github.com/JamBrains/polkavm-examples/blob/master/lang-cpp/main.cpp#L13</a>  
the project also has an universal interpreter CLI to inject mocked host functions - all just for testing and using Jans code, but it  helped with debugging our interpreter</div>
<div class='msg reply'><time>2024-08-18 11:07</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: you can call this with the universal interpreter of that project with something like <code>pvme call test.pvm entry 42 69 --host-functions &amp;quot;get_third_number:100&amp;quot;</code> and then compare the result to your interpreter</div>
<div class='msg reply'><time>2024-08-18 11:11</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: &gt; &lt;@gav:polkadot.io&gt; but why not just use <code>ecalli</code> along with the relevant host call index?

AHA!  Is there some line in the GP that explains ecalli -- This is the missing bit of info.   </div>
<div class='msg reply'><time>2024-08-18 11:12</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Screenshot 2024-08-18 at 13.12.34.png</div>
<div class='msg reply'><time>2024-08-18 11:12</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: it is what triggers a hostall</div>
<div class='msg reply'><time>2024-08-18 11:16</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Well, I missed this &quot;link&quot; between Appendix A and Appendix B -- where is it documented?  </div>
<div class='msg reply'><time>2024-08-18 11:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg reply'><time>2024-08-18 11:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Together with each of the places where Ψ_H is used</div>
<div class='msg reply'><time>2024-08-18 11:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (248) and, by extension, (250) etc.</div>
<div class='msg reply'><time>2024-08-18 11:27</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Ok -- I got it, thank you! (Closed my PR for now, it no longer makes sense)  Any reason why <code>assign</code> and <code>new</code> don&#x27;t get a host index in GP?</div>
<div class='msg reply'><time>2024-08-18 11:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/62/commits/025e868628ef5fe9ae781546ebb3a89fe93c7b09" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/62/commits/025e868628ef5fe9ae781546ebb3a89fe93c7b09</a></div>
<div class='msg reply'><time>2024-08-18 11:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Was fixed a week ago.</div>
<div class='msg reply'><time>2024-08-18 11:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;ll release 0.3.5 soon</div>
<div class='msg'><time>2024-08-18 10:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: and in using it, rather than altering the code to introduce new non-standard instructions in order to empower <code>ArchVisitor</code>, you should obviously just invoke <code>ArchVisitor</code> using the <code>ecall</code>. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-18 10:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@mkchung:matrix.org&gt; In eq(93), the preimage appears to be of arbitrary size - which is then erasure encoded &amp; distributed in segments of size wc*ws to DA. But how does the E_p (lookup extrinsic) in section 12.1 (eq 155-158) able to know the length of the preimage? Without knowing the length, we probably cannot remove the padded zeros from the wc * ws segments. What am I missing?

93 describes account state storage.</div>
<div class='msg'><time>2024-08-18 10:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: this is not erasure-coded. it is stored in state as a byte-sequence (with an implied length) in state directly. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-18 10:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (157) shows exactly how the length can be verified: it is stored, along with the hash, as a key in δ[s]_l</div>
<div class='msg'><time>2024-08-18 11:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.5" target="_blank" rel="noopener">0.3.5</a> is released. Mostly trivial corrections, but there&#x27;s also some small alterations to the work bundle serialisation format.</div>
<div class='msg'><time>2024-08-19 09:14</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I have a doubt about state encoding, more specifically: 

C(12) ↦ E4(χ)
C(13) ↦ E4(π)

How can we E4 here if χ and π are not actual integers? Would it be just E(χ) and E(π)?</div>
<div class='msg'><time>2024-08-19 14:59</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: I also have a Q about what <code>r</code> is in definition 111. It must be a work-report hash since it comes from  <code>V</code>, but <code>rho</code> does not contain work-report hashes but full work reports?  
Do we have to compute the hashes and then remove them?</div>
<div class='msg reply'><time>2024-08-20 06:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/65/commits/24488eb2c899bc211852d70784e3289b347b8b22" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/65/commits/24488eb2c899bc211852d70784e3289b347b8b22</a></div>
<div class='msg'><time>2024-08-19 14:59</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: gp3.png</div>
<div class='msg'><time>2024-08-19 16:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; I have a doubt about state encoding, more specifically: 
&gt; 
&gt; C(12) ↦ E4(χ)
&gt; C(13) ↦ E4(π)
&gt; 
&gt; How can we E4 here if χ and π are not actual integers? Would it be just E(χ) and E(π)?

chi is just a tuple of numbers, so element should be encoded accordingly.  </div>
<div class='msg'><time>2024-08-19 16:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: pi is also just a sequence of sequences of numbers. </div>
<div class='msg'><time>2024-08-19 16:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Just encode each accordingly. </div>
<div class='msg'><time>2024-08-19 16:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For tuples and sequences, E_4 is the same as E: totally transparent. </div>
<div class='msg'><time>2024-08-19 16:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@oliver.tale-yazdi:parity.io&gt; I also have a Q about what <code>r</code> is in definition 111. It must be a work-report hash since it comes from  <code>V</code>, but <code>rho</code> does not contain work-report hashes but full work reports?  
&gt; Do we have to compute the hashes and then remove them?

Yes - indeed this should have been placed in a hash function H(…)</div>
<div class='msg'><time>2024-08-19 16:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be fixed. </div>
<div class='msg'><time>2024-08-19 21:23</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: &gt; &lt;@gav:polkadot.io&gt; (157) shows exactly how the length can be verified: it is stored, along with the hash, as a key in δ[s]_l

Is E_P the only way to get preimage into the on-chain state δ? In other words, is it solely triggered by the solicit host func(Ωs) at the accumalate? Presumably block author would need to retrieve these preimage off chain from DAs in order to include it in the block as E_P?</div>
<div class='msg'><time>2024-08-19 21:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Correct. </div>
<div class='msg'><time>2024-08-19 21:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Validators are expected to receive and share these. </div>
<div class='msg'><time>2024-08-19 22:37</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: How does code get deployed?

As per 14.3, a Work Package has codehash $c$ (but not a length) –_must_ code deployment go through (i) <code>export</code> (ii) <code>solicit</code> in <code>accumulate</code> resulting in (iii) E\_P-driven state trie updates, as stated by Eq (91) or is there some other route?

More precisely how does a service&#x27;s FIRST code hash get deployed?  Its not happening  in host function <code>new</code>... so is there some privileged service that service creators have to use to get started that does (i)-(iii)? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-19 23:05</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: In 14.3 right before Eq (177) you have &quot;a sequence of hashed of blob hashes and lengths&quot; which I think should be ungarbled as something like &quot;a sequence of extrinsic hashes and lengths&quot; -- but shortly thereafter you have &quot;We make an assumption that the preimage to each extrinsic hash in each work-item is known by the guarantor.  In general this data will be passed to the guarantor alongside the work-package.&quot;   _These_ preimages have nothing to do with the E\_P-driven state trie updates from <code>solicit</code>, correct?

By &quot;In general this data will be  passed to the guarantor&quot; by &quot;this data&quot; do you mean the <code>Extrinsic</code> preimage _via JAMNP_ like what you have as <code>--&amp;gt; Vec&amp;lt;Extrinsic&amp;gt; ++ Vec&amp;lt;JustifiedImport&amp;gt;</code> or something else?

What does <code>JustifiedImport</code> refer to in GP? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-20 00:45</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: In B.3 &quot;The Refine invocation also ... explicitly accepts the work payload, ${\\bf y}$, ..., the import and extrinsic data blobs (both just concatenated segments) as dictated by the work-item, ${\\bf i}$ and ${\\bf x}$&quot; -- which  refers to 14.3&#x27;s (177) (carried through to (184) and then (253) but then _nowhere_ in the refine-specific host functions of (254)), correct?

Assuming the above understanding is correct, I am expecting some refine-specific host functions <em>analogous</em> to <code>import</code> (which gets at ${\\bf i}$) that gets at the <em>payload</em> ${\\bf y}$ (which might be called <code>import_y</code> and the <em>extrinsic</em> &quot;raw&quot; preimage data ${\\bf x}$ (which might be called <code>import_x</code>).   But I don&#x27;t see anything -- so which host functions read ${\bf y}$ and ${\bf y}$?  Is there some setup of ${\\bf x}$ and ${\\bf y}$ in memory that we missed?   <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-20 05:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As you postulate. The first service (which will appear in the Genesis block) will include functionality for creating new services permissionlessly.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-20 05:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; In 14.3 right before Eq (177) you have &quot;a sequence of hashed of blob hashes and lengths&quot; which I think should be ungarbled as something like &quot;a sequence of extrinsic hashes and lengths&quot; -- but shortly thereafter you have &quot;We make an assumption that the preimage to each extrinsic hash in each work-item is known by the guarantor.  In general this data will be passed to the guarantor alongside the work-package.&quot;   _These_ preimages have nothing to do with the E\_P-driven state trie updates from <code>solicit</code>, correct?
&gt; 
&gt; By &quot;In general this data will be  passed to the guarantor&quot; by &quot;this data&quot; do you mean the <code>Extrinsic</code> preimage _via JAMNP_ like what you have as <code>--&amp;gt; Vec&amp;lt;Extrinsic&amp;gt; ++ Vec&amp;lt;JustifiedImport&amp;gt;</code> or something else?
&gt; 
&gt; What does <code>JustifiedImport</code> refer to in GP?

On the first two points, yes.</div>
<div class='msg'><time>2024-08-20 05:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; In B.3 &quot;The Refine invocation also ... explicitly accepts the work payload, ${\\bf y}$, ..., the import and extrinsic data blobs (both just concatenated segments) as dictated by the work-item, ${\\bf i}$ and ${\\bf x}$&quot; -- which  refers to 14.3&#x27;s (177) (carried through to (184) and then (253) but then _nowhere_ in the refine-specific host functions of (254)), correct?
&gt; 
&gt; Assuming the above understanding is correct, I am expecting some refine-specific host functions <em>analogous</em> to <code>import</code> (which gets at ${\\bf i}$) that gets at the <em>payload</em> ${\\bf y}$ (which might be called <code>import_y</code> and the <em>extrinsic</em> &quot;raw&quot; preimage data ${\\bf x}$ (which might be called <code>import_x</code>).   But I don&#x27;t see anything -- so which host functions read ${\bf y}$ and ${\bf y}$?  Is there some setup of ${\\bf x}$ and ${\\bf y}$ in memory that we missed?  

It should not read “both just contented segments”; only imports are segments. Extrinsic data are (arbitrary length) blobs. </div>
<div class='msg reply'><time>2024-08-20 06:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/65/commits/90868bc03582665ffb67aedc6afe19517d9e853d" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/65/commits/90868bc03582665ffb67aedc6afe19517d9e853d</a></div>
<div class='msg'><time>2024-08-20 05:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Extrinsic data are passed into the refine function directly. Imported segments are read through the import host call. </div>
<div class='msg'><time>2024-08-20 05:51</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Thank you for explaining -- still unclear though -- which refine instructions / host functions can read/copy extrinsic data ${\\bf x}$ (I understand, passed into refine function directly) into RAM?  What about the payload ${\bf y}$? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-20 06:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Thank you for explaining -- still unclear though -- which refine instructions / host functions can read/copy extrinsic data ${\\bf x}$ (I understand, passed into refine function directly) into RAM?  What about the payload ${\bf y}$?

&gt; Extrinsic data are passed into the refine function directly.

See (251)</div>
<div class='msg'><time>2024-08-20 06:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Arguments to Refine are encoded into a; this includes all extrinsic data.</div>
<div class='msg'><time>2024-08-20 06:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (NOTE: &quot;Extrinsic&quot; is used for two separate and very different concepts in the GP. That&#x27;s not ideal. I&#x27;ll likely change this use of &quot;extrinsic&quot; to &quot;argument&quot; in a later draft.) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-20 10:32</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Understood -- I am postulating that  PVM programs  must have host functions in B.8 that copy
(a) ${\\bf x}$ extrinsic data encoded into the $a$ argument of Refine, call it <code>import_x</code> to copy $a\_{\\bf x}$ into RAM
and
(b) ${\\bf y}$ payload data encoded into the $a$ argument of Refine, call it <code>import_y</code> to copy $a\_{\\bf y}$ into RAM

I don&#x27;t see any such way within { <code>historical_lookup</code>, <code>import</code>, <code>export</code>, <code>machine</code>, <code>peek</code>, <code>poke</code>, <code>invoke</code>, <code>expunge</code> } to access elements of $a$.  

It seems I am missing a concept or there needs to be 2 more host functions <code>import_x</code> and <code>import_y</code>. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-20 10:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2024-08-20 10:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: I think when you say 251 you mean the above 253</div>
<div class='msg'><time>2024-08-20 10:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: since 251 for me is</div>
<div class='msg'><time>2024-08-20 10:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2024-08-20 10:42</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: and we&#x27;re talking about this $a$ here: </div>
<div class='msg'><time>2024-08-20 10:42</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2024-08-20 10:50</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: The postulated <code>import_x</code> and <code>import_y</code> would be like <code>import</code> here:</div>
<div class='msg'><time>2024-08-20 10:50</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2024-08-20 10:53</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: except instead of copying ${\\bf i}_{\\omega\_0}$ it would copy $a_{{\\bf x}_{\\omega\_0}}$ or ${a_{\\bf y}}$ into RAM (and no need for the min(\\omega\_2, W\_C W\_S), no index $\\omega\_0$ for payload ${\\bf y}$)   Perhaps names like <code>extrinsic</code> (?) and <code>payload</code> would be more appropriate than <code>import_x</code> and <code>import_y</code> -- What do you think? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-21 16:48</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Time as defined in the GP seems to be TAI-based. That is, it is defined simply as &quot;seconds passed since the beginning of the JAM Common Era&quot;. Practically speaking most systems are UTC-based. The difference is that UTC is adjusted by leap seconds, whereas TAI is not. Sticking with the current definition seems good, as it&#x27;s conceptually simple. It&#x27;s probably worth explicitly talking about this in the GP though, as just doing the natural thing (current UNIX timestamp minus epoch timestamp) will on most systems not be correct. Well, it might be, if there are no more leap seconds. AIUI they will be abolished by 2035 but there may be some before then. I&#x27;m not sure if there&#x27;s a &quot;standard&quot; way of dealing with this. I believe it is possible in Linux to make the system clock follow TAI, however I don&#x27;t know if this is a good idea or not.</div>
<div class='msg'><time>2024-08-22 11:17</time>&ensp;<span class='u' style='color:#d66f7e'>lucasvo</span>: I&#x27;ve been working through the paper and one thing I&#x27;m unsure about is how ordering of work packages defined and in practice how is it determined?</div>
<div class='msg'><time>2024-08-22 12:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s not defined except through the prerequisite field. This currently doesn’t give a strong ordering for accumulation (as availability may complete out of order) but from 0.4 onwards it will.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-22 20:35</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: TAI makes sense in a final ratification.  Since most will create some abstractions to get the &quot;JCE&quot;, it seems hardly problematic to address the leapseconds within that abstraction.

Are you taking the lead on the next JAMNP writeup?

We are wondering if there really  is no gossiping of Tickets, Blocks, etc. within JAMNP as it seems pretty wild for each validator to broadcast to all V-1 fellow validators.  Not only that, if each ticket is sent to V-1 validators, all the cool anonymity will be canceled by QUIC.  Is there some detail of how QUIC will be used for gossiping objects quickly in JAMNP?  Or some expectation that JAMNP will support gossiping soon enough? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-22 20:39</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Tickets are to be sent via a proxy; the proxy will know the sender&#x27;s identity obviously but is trusted to not reveal it. If you assume 2/3 honest validators then most of the tickets will be anonymous</div>
<div class='msg'><time>2024-08-22 20:40</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The plan is for new block distribution to be done via the availability system</div>
<div class='msg'><time>2024-08-23 01:32</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-23 at 1.30.48 PM.png</div>
<div class='msg'><time>2024-08-23 01:32</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: is this missing a Hash?</div>
<div class='msg'><time>2024-08-23 01:58</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-23 at 1.58.30 PM.png</div>
<div class='msg'><time>2024-08-23 01:59</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: to my understanding, those are unordered set, in that case, what order should be used for serialization? or they are just FIFO array without duplications? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-23 02:14</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-23 at 2.14.26 PM.png</div>
<div class='msg'><time>2024-08-23 02:14</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: what is <code>al</code> and <code>ai</code>?</div>
<div class='msg'><time>2024-08-23 02:15</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-23 at 2.15.01 PM.png</div>
<div class='msg'><time>2024-08-23 08:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Actually not via the “availability system” but through a separate distribution (and redistribution) of erasure coded block pieces. It’ll be its own distribution system but will reuse the erasure coding logic.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-23 08:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; is this missing a Hash?

No: <a href="https://github.com/gavofyork/graypaper/pull/65/commits/92b824261feb67d12784a539232eb64da1b87b47" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/65/commits/92b824261feb67d12784a539232eb64da1b87b47</a></div>
<div class='msg'><time>2024-08-23 08:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The wavey vertical line implies ordering (see the two paragraphs below (11)): <a href="https://graypaper.fluffylabs.dev/#WyI0ODY2YjU5YmMwIiwiNSIsIlByZXZpb3VzIFdvcmsgYW5kIFByZXNlbnQgVHJlbmRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDEzIGgyIHkyMDUgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MTMgaDIgeTIwZiBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI0ODY2YjU5YmMwIiwiNSIsIlByZXZpb3VzIFdvcmsgYW5kIFByZXNlbnQgVHJlbmRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDEzIGgyIHkyMDUgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MTMgaDIgeTIwZiBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-23 08:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: See <a href="https://graypaper.fluffylabs.dev/#WyJjNTZkZmI4NzYzIiwiMTEiLCJTZXJ2aWNlIEFjY291bnRzIiwiQWNjb3VudCBGb290cHJpbnQgYW5kIFRocmVzaG9sZCBCYWxhbmNlIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMSBoZSB5N2JmIGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDQ4IGhiIHk3Y2IgZmYxMiBmczAgZmMwIHNjMCBsczAgd3MwXCI+Il1d" target="_blank" rel="noopener">(94)</a>: <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-23 08:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg'><time>2024-08-23 09:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: They&#x27;re values which can be derived from the maps (so not strictly needed in the DB) but determining the total size/number of items directly from the Merkle tree is non-trivial. So they&#x27;re in there to facilitate implementations&#x27; tracking of the changes rather than rebuilding each block (or having a separate database to track them) both of which add a lot of implementation bloat and/or complexity. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-23 09:03</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: &gt; &lt;@gav:polkadot.io&gt; Actually not via the “availability system” but through a separate distribution (and redistribution) of erasure coded block pieces. It’ll be its own distribution system but will reuse the erasure coding logic.

Makes sense for &quot;big&quot; <code>Block</code>, but wouldn&#x27;t tiny JAM objects (<code>Guarantee</code>, <code>Assurance</code>, <code>Dispute</code>, <code>PreimageLookup</code>) benefit from libp2p style gossiping in speed over erasure coding? </div>
<div class='msg'><time>2024-08-23 09:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;s only for the block.</div>
<div class='msg'><time>2024-08-23 09:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The rest is indeed distributed directly on p2p connections.</div>
<div class='msg'><time>2024-08-23 17:10</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: We require that the code hashes in the guarantees extrinsic match the current code hashes for the relevant services. This may not be the case by the time the WRs are accumulated though? Is the intention that accumulation code should protect itself against this if necessary, eg by including a version in the refine output?</div>
<div class='msg'><time>2024-08-23 21:00</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-08-23 at 22.00.47.png</div>
<div class='msg'><time>2024-08-23 21:02</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Why (h4:) is negated here? Is this correct? Why not simple h4: ?</div>
<div class='msg reply'><time>2024-08-23 21:46</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I don’t exactly know but I think it is to protect from hash collusion </div>
<div class='msg reply'><time>2024-08-24 16:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; I don’t exactly know but I think it is to protect from hash collusion 

Exactly. </div>
<div class='msg'><time>2024-08-23 22:56</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: gav: Some basic questions on Assurances.

1. From (185)+(186) _Availability Specifier_ $s$ (with h, l, u, e) ALONE (included in a Work Report), will an assurer/validator be able to reconstruct the _auditable_ work package (by querying fellow validators) after getting their chunk and a proof of inclusion using $s$ ALONE?  If not, what else does a \[non-guarantor\] assurer need other than $s$ from a <code>Guarantee</code> to reconstruct the _auditable_ work package (by querying fellow validators)?
2. If the answer to (1) is &quot;YES, s alone is sufficient for work package reconstruction (by querying fellow validators)&quot;, we need a _test case_ of a work package ${\\bf p}$ and some pretend exported items with this &quot;Availability Specifier&quot; $s$ computed (which is equivalent to a Auditable Work package and sufficient for assuring, if we understand correctly).  When can we get a ${\\bf p}, {\bf e}, s$ test case?  Having this will be essential for JAM implementers to have proper $E\_G$ verifiable work report generation and to get through a full $E\_A$ Assurance generation.
3. Given the proof referenced in Section 16 &quot;... Firstly, their erasure-coded chunk for this report. The validity of this chunk can be trivially proven through the work-report’s work-package erasure-root and a Merkle proof of inclusion in the correct location.  The proof should be included from the guarantor.&quot;  ... which QUIC message covers this proof _submission_ by guarantors to all other validators in JAMNP?
4. In section 16 &quot;Availability Assurance&quot;, you refer to &quot;provided&quot; and &quot;required&quot; manifests, seemingly for the first time, which appear to be &quot;inside&quot; the availability specifier $s$.  Are these ${\\bf b}^\\club$ (package, imported items, extrinsics related) and ${\\bf s}^\\club$  (exported items)-- which one is &quot;provided&quot; and which one is &quot;required&quot;?     (The 14.3 paragraph &quot;Guarantors are required to erasure-code and distribute two data sets:... &quot; which is similar enough to cause us to believe section 16 could be folded into 14.3?) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-23 23:09</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: 5. What is ${\bf s}$ vs $n$ within ${\bf s}[n]$ in 185?  The meaning of ${\bf s}$ flips between imported and exported items in this section so we&#x27;d like to confirm.   <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 16:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dave:parity.io&gt; We require that the code hashes in the guarantees extrinsic match the current code hashes for the relevant services. This may not be the case by the time the WRs are accumulated though? Is the intention that accumulation code should protect itself against this if necessary, eg by including a version in the refine output?

For the few blocks where a service is undergoing an upgrade then you’d probably want to avoid sending reports to it since it’s fundamentally impossible to predict which code is current come Accumulation. </div>
<div class='msg'><time>2024-08-24 16:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-08-24 16:59</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. They&#x27;ll be able to ensure that the chunks they get from each validator is correct and that the bundle/work-package itself is correct. The bundle is all that is needed for a validator to audit.
2. As I’ve said before, test cases will be provided once they are ready. I won’t repeat myself further. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 17:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 3. I don’t know what you mean by “proof of submission”. In any case JAMSNP doesn&#x27;t presently include any message/stream type for providing DA chunks. It will be included in due course. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 17:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 4. Provided and required are old terminology. They’ll be removed in the next GP release. Corrected here: <a href="https://github.com/gavofyork/graypaper/pull/65/commits/cc7e2bc87959bf851bcf34208312df9c28283cb2" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/65/commits/cc7e2bc87959bf851bcf34208312df9c28283cb2</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 17:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; 5. What is ${\bf s}$ vs $n$ within ${\bf s}[n]$ in 185?  The meaning of ${\bf s}$ flips between imported and exported items in this section so we&#x27;d like to confirm.

I presume you mean:</div>
<div class='msg'><time>2024-08-24 17:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg'><time>2024-08-24 17:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (Best to use the <a href="https://graypaper.fluffylabs.dev/#WyJjNTZkZmI4NzYzIiwiMTEiLCJTZXJ2aWNlIEFjY291bnRzIiwiQWNjb3VudCBGb290cHJpbnQgYW5kIFRocmVzaG9sZCBCYWxhbmNlIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMSBoZSB5N2JmIGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDQ4IGhiIHk3Y2IgZmYxMiBmczAgZmMwIHNjMCBsczAgd3MwXCI+Il1d" target="_blank" rel="noopener">Reader</a> for referencing bits of the GP)</div>
<div class='msg'><time>2024-08-24 17:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Here, M(s) is the segment root of the exporting work-package and n is the index of a segment exported by it. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 17:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: s is therefore the sequence of exported segments from said exporting work-package. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 18:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.6" target="_blank" rel="noopener">0.3.6</a> is tagged and released.</div>
<div class='msg'><time>2024-08-24 18:25</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: By proof submission, I mean the &quot;The proof should be included from the guarantor.&quot;  I believe you stubbed  <code>JustifiedImport</code> in as <code>--&amp;gt; Vec&amp;lt;Extrinsic&amp;gt; ++ Vec&amp;lt;JustifiedImport&amp;gt;</code> in <a href="https://hackmd.io/@polkadot/jamsnp" target="_blank" rel="noopener">https://hackmd.io/@polkadot/jamsnp</a> , so we&#x27;ll run with that for now. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 18:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; By proof submission, I mean the &quot;The proof should be included from the guarantor.&quot;  I believe you stubbed as <code>JustifiedImport</code> in as <code>--&amp;gt; Vec&amp;lt;Extrinsic&amp;gt; ++ Vec&amp;lt;JustifiedImport&amp;gt;</code> in <a href="https://hackmd.io/@polkadot/jamsnp" target="_blank" rel="noopener">https://hackmd.io/@polkadot/jamsnp</a> , so we&#x27;ll run with that for now.

That&#x27;s only for sharing of Work Packages between guarantors on the same core.</div>
<div class='msg'><time>2024-08-24 18:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There is not yet an instruction for sharing (justified) DA chunks. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 18:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;ll likely just be <code>Vec&amp;lt;Hash&amp;gt; ++ Blob ++ Vec&amp;lt;Hash&amp;gt; ++ Vec&amp;lt;SegmentChunk&amp;gt; ++ Vec&amp;lt;Hash&amp;gt;</code>. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-24 18:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The <code>Vec&amp;lt;Hash&amp;gt;</code> will just be complementary Merkle-node-hashes from leaf to root. The first will contain hashes for the blob-subtree, the second for the segments subtree and the third for the super-tree.</div>
<div class='msg'><time>2024-08-26 18:47</time>&ensp;<span class='u' style='color:#c65e4e'>noahjoeris</span>: image.png</div>
<div class='msg'><time>2024-08-26 18:47</time>&ensp;<span class='u' style='color:#c65e4e'>noahjoeris</span>: Heya. Isn&#x27;t the posterior authorizer pool also dependent on the header?</div>
<div class='msg reply'><time>2024-09-09 07:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be fixed in 0.3.7</div>
<div class='msg'><time>2024-08-26 18:48</time>&ensp;<span class='u' style='color:#c65e4e'>noahjoeris</span>: Because we use the header timeslot here: <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-26 18:48</time>&ensp;<span class='u' style='color:#c65e4e'>noahjoeris</span>: image.png</div>
<div class='msg'><time>2024-08-26 23:58</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-27 at 11.57.19 AM.png</div>
<div class='msg'><time>2024-08-26 23:58</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: The return type for the merkle justification generation function is wrong</div>
<div class='msg reply'><time>2024-09-09 07:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be fixed in 0.3.7</div>
<div class='msg'><time>2024-08-27 01:23</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-27 at 1.22.50 PM.png</div>
<div class='msg'><time>2024-08-27 01:23</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: this need a special case to handle the case |v| is zero</div>
<div class='msg reply'><time>2024-09-09 07:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be fixed in 0.3.7</div>
<div class='msg'><time>2024-08-27 01:25</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-08-27 at 1.25.42 PM.png</div>
<div class='msg'><time>2024-08-27 01:26</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: this also using log2(|v|) which will be undefined when v is empty</div>
<div class='msg'><time>2024-08-27 01:27</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: and I am really confused about the <code>...max</code> part</div>
<div class='msg'><time>2024-08-27 01:28</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: it requires the length of v to be no more than <code>2^x</code> so <code>log2(|v|) - x</code>  is always &lt;= 0?</div>
<div class='msg'><time>2024-08-27 13:45</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: </div>
<div class='msg'><time>2024-08-27 14:00</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: Hello everyone,

When storing storage or preimage, we will specify the service identifier and the storage or preimage key at the same time, but we do not additionally store the mapping between the service identifier and the storage or preimage key.</div>
<div class='msg reply'><time>2024-08-28 02:37</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: my understand is that this is used to construct state root but it doesn&#x27;t means you also have to store the state into db with exactly this format</div>
<div class='msg reply'><time>2024-08-28 02:38</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: so you can/should store the keys in whatever format you want</div>
<div class='msg'><time>2024-08-27 14:00</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: 1.png</div>
<div class='msg'><time>2024-08-27 14:00</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: So assuming we have a service account identifier (s), how do we retrieve all of (s)&#x27;s storage(bold s) keys or preimage(bold p) keys?</div>
<div class='msg'><time>2024-08-27 14:00</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: 2.png</div>
<div class='msg'><time>2024-08-28 01:39</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: Screenshot 2024-08-27 at 6.29.11 PM.png</div>
<div class='msg'><time>2024-08-28 01:40</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: In host function new=9, what is the x_i used for creating the service account?

Additionally, for l∶{(c, l)↦[]} portion, are we writing this a_l on-chain, similar to the (h,z)=[] in the solicit=13 case? This should also trigger E_P, correct?</div>
<div class='msg'><time>2024-08-28 06:28</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Basic questions on Is-Authorized.

1. Why is the authorizer not a 4th entry point alongside refine/accumulate/on\_transfer?
2. In (182) you use blob-hood of ${\\bf o}$ (being an element of Y) to determine if work is authorized, but how does the PVM code actually return and &quot;set&quot; ${\\bf o}$ -- not clear from (248) how Is-Authorized can return a blob, e.g. a public key or recovered address.  Is it through \omega_10 + \omega_11 pointing to where the blob is returned in memory?   If so what is the &quot;not authorized&quot; return mechanism?
3. In 8.2 GP lecture you mention validating signatures, e.g. validating ${\\bf j}$ right at the start of the work package.   Shall we add ECRECOVER/... signature verification host functions for this purpose?
4. Why did you not support access to <code>historical_lookup</code> in Is-Authorized, to get at service-specific state?
5. It seems clear we will want &quot;opinionated&quot; inclusion of cryptographic primitives in ecalli host functions (BLS, Keccak/Blake2b/xx hash functions, Bandersnatch, Edwards, etc) due to the usual &quot;interpreted code is Nx slower than compiled, we must have this primitive!&quot; concerns.  How is this problem NOT going to immediately reveal itself on the first big JAM service (parachain validation) which uses all these must have primitives? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-29 13:35</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Re (1) AIUI authorisation is for usage of a core, this usage is not tied to a particular service</div>
<div class='msg reply'><time>2024-09-09 08:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (2) Should be obvious from the PVM definition. If you panic then the result will not be in Y.</div>
<div class='msg reply'><time>2024-09-09 08:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (3) PVM should really be fast enough. This isn&#x27;t Ethereum. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-09 08:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (4). IsAuthorized is intended to be as lightweight as possible to minimize the possibility of validator-griefing. This could potentially change in the future once we start actually writing code on JAM prototypes and understand the kinds of use-cases better.</div>
<div class='msg reply'><time>2024-09-09 08:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (5) See the answer to (3).</div>
<div class='msg'><time>2024-08-28 07:40</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-08-28 07:40</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: it looks to me that appendix F (304) is wrong. <code>4</code> should be added and  i&#x27; mont sure about the underlined red text. look like it does not make muc sense</div>
<div class='msg reply'><time>2024-09-09 08:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be fixed in 0.3.7</div>
<div class='msg'><time>2024-08-28 08:53</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: 6230937201131240805.jpg</div>
<div class='msg'><time>2024-08-28 08:54</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: Hello
I&#x27;m having a hard time understanding Equation  141 

Specifically R is a constant as far as i can tell, but used as a function here?
 <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-28 09:01</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I also had the same question but I assumed in the end that it meant &quot;multiply&quot; R by (floor(tau/R) - 1)</div>
<div class='msg reply'><time>2024-08-28 09:07</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: oh i see that does make sense
Thank you</div>
<div class='msg'><time>2024-08-28 08:56</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: How is it that the PVM argument invocation can return a blob? I guess the memory contents on a success are the blob. <a href="https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMjgiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGMgaGIgeTE1YzEgZmZmIGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MWE1IGhiIHkxNWMxIGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+Il1d" target="_blank" rel="noopener">Here</a> the return type is <code>( (N_G, Y) U {panic, oom}, X )</code> but the inner function <code>R</code> seems to return <code>({panic, oom} U N_G, X U Y)</code> <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-28 14:51</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Ok, we&#x27;ll run with your interpretation for now 😃, returning a &quot;panic&quot; being &quot;authorization failed&quot; if a new host function that we added to verify a signature against a hardcoded public key (or read via <code>historical_lookup</code>) doesn&#x27;t pass verification.   <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-30 01:21</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: We realized (again) that passing in \omega_10 + \omega_11 is to be the way to send in &quot;a=arguments&quot; (refine: authorization hash, accumulate: wrangled results, transfer: transfer memos) and ALSO return a blob.</div>
<div class='msg'><time>2024-08-28 23:52</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: General JAM Service Invocation/Interaction-related questions:

1. How are the <code>refine</code>, <code>accumulate</code> and <code>on_transfer</code> entry points (described after (90)) specified in the jump table ${\\bf j}$ of Eq (213)?  We are currently just using <code>pub @refine:</code>, <code>pub @accumulate:</code> and <code>pub @on_transfer</code> in koute&#x27;s assembler, but this appears underspecified in GP except for some 0/1/2 entry points 
2. Given that <code>refine</code> can ONLY access on-chain state from <code>historical_lookup</code> host function calls (through <code>accumulate</code>&#x27;s <code>solicit</code> host function calls that result in $a\_p$ preimage writes through $E\_P$ extrinsics) ... I am struggling to see how <code>accumulate</code> can drive <code>refine</code> inputs -- _except_ via some observer who &quot;sees&quot; the finalized post-accumulate state and submits a new work package based on that state in the form of extrinsics and payloads.     Why can&#x27;t <code>accumulate</code> also have access to the <code>export</code> host function such that <code>refine</code> can <code>import</code> segments exported by <code>accumulate</code>?
3. Why can&#x27;t <code>refine</code> have access to <code>read</code> host function to get at state written to by <code>accumulate</code>&#x27;s <code>write</code> host function calls?  I imagine it would be <code>historical_read</code>, analogous to <code>historical_lookup</code>.
4. How can there be a <code>refine</code>-less Work Package / Service, _not_ needing Assurances to trigger an <code>accumulate</code>, that is purely <code>accumulate</code> based?
5. What is the _idiomatic_ way (via a specific instruction) to &quot;panic&quot; for authorization code to return &quot;Not Authorized&quot;?  We are doing <code>ecalli 42</code> as a hack right now on failed authorizations.
6. For multiple services going through <code>accumulate</code> what is the ordering of ${\\bf S}$ in 157?  Assuming serial execution (which is sort of implied by <code>new</code> \[building up ${\\bf x}_n$\] and <code>transfer</code> \[building up ${\\bf x}_{\\bf s}$\]), is the context ${\\bf x}$ (of Eq 253) carried over from one services <code>accumulate</code> to the next?
7. From <code>upgrade</code> It appears to us that the invocation context ${\\bf x}$ in ${\\bf X}$ needs its ${\\bf s}$ to be a dictionary like ${\\bf x}\_{\\bf n}$, but right now its just ${\\bf s}$ of ${\\cal A}?$.
8. Host function service account lookup ${\\bf d}$  needs an explanation before B.5 On-transfer.  It is used in <code>lookup</code>, <code>read</code>, <code>info</code> but we&#x27;re not sure whether its in ${\\bf x}$ and how its initialized.
9. Why did you keep machine/invoke/peek/poke/expunge solely for <code>refine</code> and not also <code>accumulate</code>?
10. $\\bar{x}$, the full extrinsic data (not hash-len combo) given to the guarantors alongside the work package, needs to be put into Audit DA, since re-execution of <code>refine</code> by auditors require it.  This step is not described, but is of course necessary, correct? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-08-29 13:48</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Re (4), AIUI the blessed services are always accumulated every block even if there are no work reports for them</div>
<div class='msg reply'><time>2024-08-29 15:38</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Yipes, I read (28) + Sect 11 &quot;After enough assurances the work-report is considered available, and the work outputs transform the state of their associated ser- vice by virtue of accumulation, covered in section 12. The report may also be timed-out, implying it may be replaced by another report without accumulation.&quot; + (162) input of refine results M(s) as all implying that accumulation REQUIRES refine.</div>
<div class='msg reply'><time>2024-08-29 15:50</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: For most services that is true -- accumulate will not be called unless some work reports have become available, the 3 blessed services are an exception to this. See (159)</div>
<div class='msg reply'><time>2024-08-29 15:58</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Ah blessed=privileged =)</div>
<div class='msg reply'><time>2024-08-29 15:59</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Ah yeah sorry, not sure where I got that term from</div>
<div class='msg reply'><time>2024-09-09 08:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. There is no explicit jump table - only an entry point. These are now set to 0 (isAuthorized), 5 (Refine), 10 (Accumulate) and 15 (OnTransfer). <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-09 08:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: PVM code blobs use these to disambiguate usage.</div>
<div class='msg reply'><time>2024-09-09 08:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 2. Regarding JAM, Refine -&gt; Accumulate is a one-way street and as such sensibly designed services must be able to perform Refine with some degree of asynchroneity to Accumulate. This is why I write that JAM is &quot;mostly coherent&quot;. Getting any state-changes resulting from Accumulation as inputs to a later Refine would imply making a state proof, which introduces synchroneity and as such a degree of latency.

Re: &quot;Why can&#x27;t...&quot;: Lazy and Dumb Question. If you think you can add such a feature without blowing up the protocol&#x27;s complexity, submit your PR to the GP repo. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-09 08:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 3. Lazy and Dumb Question. If you think you can add such a feature without blowing up the protocol&#x27;s complexity, submit your PR to the GP repo. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-09 08:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: sourabhniyogi: This is not a forum to request your (IMO totally unachievable) product dreams. If you have a serious suggestion to improve the JAM protocol, make a PR to the GP repo. Be ready to defend its implications against some of the best minds of the industry. Beware that designing and writing a high-performance secure decentralized protocol is nontrivial and you can&#x27;t just wish features to exist.</div>
<div class='msg reply'><time>2024-09-09 08:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 4. With the particular exception of the privileged services, a service cannot be accumulated without at least one refine result. So in short, there generally cannot.
I&#x27;ve covered this many, many times in basically every talk I&#x27;ve given. Please familiarise yourself with this content. I&#x27;m not here to be your personal oracle, spoon-feeding you with material at your own pace. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-09 08:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 5. Any kind of panic works, but if you want a convention, I&#x27;d use <code>trap</code>. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-09 08:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 6. Your assertion is incorrect: there is no ordering. This is precisely the reason for <a href="https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMTYiLCJBY2N1bXVsYXRpb24iLCJJbnZvY2F0aW9uIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMyBoNiB5YjkwIGZmNyBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDEwIGg2IHliOTYgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">this paragraph</a>.</div>
<div class='msg reply'><time>2024-09-09 08:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 7. Again your assertion is incorrect.</div>
<div class='msg reply'><time>2024-09-09 09:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 8. There is indeed a missing argument for Refine&#x27;s <code>lookup</code> case. This will be fixed in the next release. Refine&#x27;s <code>read</code> and <code>info</code> cases properly supply this parameter. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-09 09:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 9. They are quite heavy-weight facilities and it is far from clear that they can be used effectively in the &lt;10ms of gas which Accumulate is given. This is something which might change as we begin writing prototype services.</div>
<div class='msg reply'><time>2024-09-09 09:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 10. It is fully defined <a href="https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMTkiLCJXb3JrIFBhY2thZ2VzIGFuZCBXb3JrIFJlcG9ydHMiLCJDb21wdXRhdGlvbiBvZiBXb3JrIFJlc3VsdHMiLFsiPGRpdiBjbGFzcz1cInQgbTAgeGUgaGIgeWRhYyBmZmYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHgxNDUgaGIgeWRhYyBmZjFjIGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">already</a></div>
<div class='msg reply'><time>2024-09-10 09:07</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: You already have service users submitting a refinement context within the work package, which includes an anchor block&#x27;s state root but not an unfinalized accumulate state root.  With Safrole, assuming very high liveness, you also won mostly forkless state roots.

So my lazy dumb strawman is that you can win <code>historical_read</code> parallel to <code>historical_lookup</code> in <code>refine</code> by modifying the &quot;anchor block&quot; centric refinement context included in work packages to be have state roots not
(a) relative to an anchor block
but instead
(b) whatever the work package submitter has observed to be a recent \[potentially unfinalized\] state root
The user already have to submit their work packages relative to (a), so what is lost with (b)?

I am not making a request for product dreams here 😅, I am asking why an observed unfinalized state root from the user is an insufficient state proof.

If 2 or 3 Guarantors refine a work package according to some unfinalized state root but it doesn&#x27;t get finalized, then the work report doesn&#x27;t get assured, it doesn&#x27;t get audited, and so it just times out.

The claim is that if this timeout is quite rare in practice, the experience for users improves tremendously with <code>historical_read</code> and a streamlined &quot;accumulate=&gt;refine&quot; .

The lazy/dumb GP modification would be extend what what you have in 9.2 &quot;By retaining historical information on its availability,
we become confident that any validator with a recently finalized view of the chain is able to determine whether any
given preimage was available at any time within the period
where auditing may occur.&quot; from preimages alone to what is done with <code>write</code> operations.  Still asynchronous post-write here, but with less latency than (a).

The new requirement is that any services aggressive work results (with aggressive (b)) would only be able to affect <code>accumulate</code> if the refinement context&#x27;s state root in conception (b) was finalized.   

I understand this is in the &quot;better to implement JAM to safely crawl before JAM walks/runs&quot; region here.  But you claim running with (b)&#x27;s aggressive refinement context is unachievable because ... what? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-10 09:09</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Typo: (252) should have &quot;historical_lookup&quot; instead of &quot;lookup&quot;</div>
<div class='msg reply'><time>2024-09-10 20:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: JAM (and Polkadot before it) is secure only because of Elves. Elves requires that all validators are able to audit all Work Reports *regardless of whether they’re synced to the same fork or not*. All host functions available to Refine must return exactly the same result for any node on any fork beyond the lookup-anchor. Since we cannot assume any particular state is known (even the lookup anchor block’s state, which could be very old and is likely pruned) then our host functions must be pretty much stateless. Historical lookup works only because we know, at any block up to 24 hours later, whether a preimage was known at the time and if so what it was. We manage this only with specialised data structures (in accounts) and limiting the rate at which a preimage may be supplied, removed and supplied again to avoid state blowup. This can all be discovered by a thorough read of the GP. The design would not cleanly apply to more arbitrary and general state changes such as service storage.  <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-12 14:00</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Thank you very much for this explanation.  We will properly understand ELVES=&gt;JAM constraints to see if there is any way we could improve the JAM service developer/user experience.  </div>
<div class='msg'><time>2024-08-29 11:37</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: (160) should have $l: {\\bf r}\_l$ to match 11.1.4&#x27;s eq (121) for the hash of the payload.
(252) should use <code>historical_lookup</code> instead of <code>lookup</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-08-29 23:40</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: </div>
<div class='msg'><time>2024-08-29 23:40</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: </div>
<div class='msg'><time>2024-09-04 03:33</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: some questions about dispute and audit:

 Will disputes enter a special voting phase if someone casts a false judgement during each tranche settlement? I would like to know the details of how E\_D is formed. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-04 09:28</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: AIUI H_V, like the other markers, was (intentionally) redundant. It simply provided verdict information for those downloading only headers, not block extrinsics. All validators need to download full blocks, so its removal makes no difference to them (other than not having to generate it etc obviously)</div>
<div class='msg reply'><time>2024-09-04 09:32</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Sorry, I might not have been clear. H_V still exists in the generation of s, so is it simply being removed from the function?</div>
<div class='msg reply'><time>2024-09-04 09:34</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: <a href="https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMWIiLCJBdWRpdGluZyBhbmQgSnVkZ2luZyIsIlNlbGVjdGlvbiBvZiBSZXBvcnRzIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHhiZCBoMiB5ZTZjIGZmMWMgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMjQgaGQgeWU2YiBmZjE4IGZzNSBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMWIiLCJBdWRpdGluZyBhbmQgSnVkZ2luZyIsIlNlbGVjdGlvbiBvZiBSZXBvcnRzIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHhiZCBoMiB5ZTZjIGZmMWMgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMjQgaGQgeWU2YiBmZjE4IGZzNSBmYzAgc2MwIGxzMCB3czBcIj4iXV0=</a></div>
<div class='msg reply'><time>2024-09-04 09:35</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Ah sorry think there is some confusion. H_j is what was removed</div>
<div class='msg reply'><time>2024-09-04 09:36</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: H_v still exists</div>
<div class='msg reply'><time>2024-09-04 09:36</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The above applies to H_j</div>
<div class='msg reply'><time>2024-09-04 09:36</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: There may be changes I&#x27;m not aware of though</div>
<div class='msg reply'><time>2024-09-04 09:41</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: my bad, that H_j is header verdict XD

Regarding dispute voting, what are your thoughts?
</div>
<div class='msg reply'><time>2024-09-04 09:45</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Re (2) if a node sees a negative judgement for a report, then it should start auditing it if it hasn&#x27;t already. I&#x27;m not sure if it&#x27;s supposed to send out an announcement in this case; I would guess this is not necessary, but probably also harmless.</div>
<div class='msg reply'><time>2024-09-04 09:49</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: got it, so next is to convert the judgments into Verdict and move on to the logic in Chapter 10. Thank you!</div>
<div class='msg reply'><time>2024-09-04 09:52</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@dave:parity.io&gt; Re (2) if a node sees a negative judgement for a report, then it should start auditing it if it hasn&#x27;t already. I&#x27;m not sure if it&#x27;s supposed to send out an announcement in this case; I would guess this is not necessary, but probably also harmless.

In the case that there is a negative judgement, it is thus expected that all validators will produce a judgement. If a block author has seen enough judgements to build a verdict then they will do this.</div>
<div class='msg reply'><time>2024-09-04 10:06</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: I see. You’re so nice! Tks</div>
<div class='msg'><time>2024-09-04 20:07</time>&ensp;<span class='u' style='color:#cc572f'>mateuszsikora</span>: Hey, correct me if I am wrong but there is no specification in GP how to handle out of memory in PVM. We have 2 cases:
1. A generic program without memory segmentation. In this case we start from empty memory and we can call <code>sbrk</code> until the memory exceed 2 ** 32. what should happen then? 
2. A &quot;standard program initialization&quot; program. In this case we have heap between 2Z_Q + Q(|o|)  and 2**32 - 2Z_Q - Z_I - P(s) (beginning of stack segment). what should happen when the memory that we allocated exceeds the heap segment?

I guess in both cases it should be a page fault but what should be the address then? we don&#x27;t pass any address to <code>sbrk</code> so there is no any strict point where this fault could happen</div>
<div class='msg reply'><time>2024-09-05 17:38</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Memory allocation/deallocation handling is still a work-in-progress, and it&#x27;s possible the <code>sbrk</code> instruction will get modified and/or removed. I&#x27;d suggest you temporarily skip it and focus on other parts of JAM and/or PVM.

---

If you&#x27;re interested in some history as to why <code>sbrk</code> is there then let me give you some background.

Historically I designed PolkaVM (on which PVM in the GP is based on) to be a VM which is as &quot;powerful&quot; as WASM VMs (so it can completely replace our current WASM-based executor in Polkadot 1.0 and our WASM-based smart contracts VM) while being as simple as possible to implement, and without sacrificing any performance.
So this is where the idea for the <code>sbrk</code> came from (which is similar to what WASM has): the VM maintains a heap pointer, and the guest program can use <code>sbrk</code> to query that pointer and/or to bump it up. And every time it crosses a page boundary the VM allocates new memory for the program.

So this design has numerous benefits. First, it&#x27;s very simple to use as a guest program (pseudo code):

<pre><code class=''>    // Get a pointer to the new allocation.
    let pointer = sbrk(0);
    // Actually allocate it.
    if sbrk(size) != 0 {
        // Allocation succeeded.
        // Now `pointer` points to `size` bytes you can use.
    }
</code></pre>

This is also great for use cases like e.g. tiny smart contracts which can use this as directly as an allocator without having to bring a heavyweight allocator of their own (which would consume a lot of space).

Secondly, it&#x27;s simple to implement in the VM, something like that (pseudo code again):

<pre><code class=''>fn sbrk(size) -&gt; Pointer {
    if size == 0 {
        // The guest wants to know the current heap pointer.
        return current_heap_pointer;
    }

    // The guest wants to allocate.
    let new_heap_pointer = current_heap_pointer + size;
    if new_heap_pointer &gt; max_heap_pointer {
        // Allocation failed.
        return 0;
    }


    let next_page_boundary = align_to_page_size(current_heap_pointer);
    if new_heap_pointer &gt; next_page_boundary {
        allocate_new_pages(next_page_boundary..align_to_page_size(new_heap_pointer));
    }

    current_heap_pointer += size;
    return current_heap_pointer;
</code></pre>

And this (along with the memory map I came up with, which is what we now call &quot;standard program initialization&quot;) also makes in very easy to write an interpreter for this, because when handling loads/stores from memory you only have to do something like this:

<pre><code class=''>fn load_value32(address) -&gt; value {
    if address &gt;= stack_address &amp;&amp; address + 4 &lt;= stack_address_end {
        return stack[address - stack_address];
    } else if address &gt;= rw_data_address &amp;&amp; address + 4 &lt;= align_to_page_size(current_heap_pointer) {
        return rw_data[address - stack_address];
    } else if address &gt;= ro_data_address &amp;&amp; address + 4 &lt;= ro_data_address_end {
        return ro_data[address - stack_address];
    } else {
        // Address is inaccessible.
        return Err;
    }
}
</code></pre>

It&#x27;s cheap, fast, and doesn&#x27;t require any crazy data structures and doesn&#x27;t require any handling of corner cases (for example, accesses which could read both from the stack and from RW data don&#x27;t have to be handled, because they&#x27;re impossible by definition; the interpreter can just keep them in separate arrays, and call it a day).

So that&#x27;s how (any why) it __was__ originally designed, but then came JAM and changed things. (: (Again, remember, I started working on this **before** JAM, and some things were just grandfathered into JAM.)

What JAM introduces is a concept of inner VMs (see <code>machine</code>, <code>peek</code>, <code>poke</code>, <code>invoke</code> and <code>expunge</code> host functions in section B.8 of the GP) where one VM can spawn another VM, and as it is currently designed those inner VMs are extremely flexible and have completely free-form memories and are dynamically paged.
What this essentially means is that all of those nice properties of <code>sbrk</code> that I&#x27;ve listed - simple and easy to implement, fast, doesn&#x27;t require fancy data structures - they all now go out of the window!

So we will probably be replacing <code>sbrk</code> with something else that&#x27;s more appropriate for the more flexible inner VM model. And unfortunately also most likely orders of magnitude harder to implement (at least if you want to reach at least the half-speed milestone), but it is what it is. I&#x27;m still finishing some other stuff up, but I&#x27;ll most likely be working on this soon-ish. (If any of you have any good and/or crazy ideas feel free to message me!) <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-09 06:54</time>&ensp;<span class='u' style='color:#cc572f'>mateuszsikora</span>: Thank you Jan Bujak, that clarifies a lot. It would be nice to include a note in the GP that <code>sbrk</code> might be modified or removed, and it is advisable not to implement it yet</div>
<div class='msg'><time>2024-09-06 00:49</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-09-06 at 12.49.05 PM.png</div>
<div class='msg'><time>2024-09-06 00:49</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: This appears to be the original version described in wikipedia, not the modern version?</div>
<div class='msg reply'><time>2024-09-06 08:53</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Looks like it ! Modern version looks a bit simpler to implement as well</div>
<div class='msg reply'><time>2024-09-06 08:53</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Modern version requires random variables j in [0, i] in the loop, and function Q_l (equation 306) is said to be constrained to [0, l]. So it should be possible to use the modern version.

PS: I don&#x27;t see why Q_l result is contained in [0, l] but in the meantime I assume this hypothesis (I don&#x27;t understand the 4i modulo 32 to be honest).</div>
<div class='msg reply'><time>2024-09-09 09:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be fixed in 0.3.7.</div>
<div class='msg'><time>2024-09-06 00:49</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: thus much less efficient</div>
<div class='msg'><time>2024-09-06 03:22</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-09-06 at 3.22.21 PM.png</div>
<div class='msg'><time>2024-09-06 03:22</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I am trying to understand this, which doesn&#x27;t make much sense to me</div>
<div class='msg'><time>2024-09-06 03:23</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: the R is used as a function but isn&#x27;t it a constant? </div>
<div class='msg reply'><time>2024-09-06 08:34</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I think R here refers to the rotation period 10 (appendix I.4.4) and it means multiply \* R by (floor(tau&#x27;/R) -1) <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-06 08:35</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: oh that make sense. thanks </div>
<div class='msg'><time>2024-09-06 03:23</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-09-06 at 3.23.38 PM.png</div>
<div class='msg'><time>2024-09-06 03:24</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: if it is referring to this R (in that case the font isn&#x27;t right), it takes two arguments</div>
<div class='msg'><time>2024-09-06 03:26</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: and the last part just isn&#x27;t making sense to me. the only logical interoperation I can come up with is that it is a typo that suppose to limit some t passing to the function R as the second argument?</div>
<div class='msg'><time>2024-09-06 08:34</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: </div>
<div class='msg'><time>2024-09-06 20:16</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-09-06 at 21.16.52.png</div>
<div class='msg'><time>2024-09-06 20:17</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Hi. I have a doubt about the definition of erasure-coding function. Is it a recursive function? If so, what is the base case? 

</div>
<div class='msg'><time>2024-09-06 20:17</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: What is the difference between Ck and C?</div>
<div class='msg'><time>2024-09-06 20:26</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: The only place I see C defined is here:</div>
<div class='msg'><time>2024-09-06 20:26</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-09-06 at 21.26.30.png</div>
<div class='msg'><time>2024-09-09 06:59</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Hi, I would like to inquire about the explanation for this function. Last week, others were discussing it as well, but it seems that no one knows the reason for this subscript.

<a href="https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMzUiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE4OCBoYiB5MjBkMCBmZjE2IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MTM5IGhiIHkyMGQwIGZmMTYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMzUiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE4OCBoYiB5MjBkMCBmZjE2IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MTM5IGhiIHkyMGQwIGZmMTYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==</a></div>
<div class='msg'><time>2024-09-09 07:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; it requires the length of v to be no more than <code>2^x</code> so <code>log2(|v|) - x</code>  is always &lt;= 0?

The outcome is that it skips the final $x$ items of the proof.</div>
<div class='msg'><time>2024-09-09 07:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The <code>ceil(log_2(|v|))</code> just gives the (generally maximum, but here constant) number of nodes from root to leaf. Substracting x would result in a negative number in the case that there are fewer than 2^x leaves. So we clamp it to zero and take only the first such proof items.</div>
<div class='msg'><time>2024-09-09 07:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This is useful since we know we&#x27;ll get a well-aligned subtree of 2\*\*x data items (the &quot;page&quot;) and thus need only proof data to get it from the root to the sub-tree root. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-09 07:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Consequently, if there are no more items in total than the items on our page, our proof can be empty (i.e. the subtree root is equal to the root). This where the <code>max(0, ...)</code> comes from. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-09 07:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is never required to enumerate a service&#x27;s storage keys or preimages. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-09 08:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@mkchung:matrix.org&gt; In host function new=9, what is the x_i used for creating the service account?
&gt; 
&gt; Additionally, for l∶{(c, l)↦[]} portion, are we writing this a_l on-chain, similar to the (h,z)=[] in the solicit=13 case? This should also trigger E_P, correct?

x is the context, x_i is initially defined here <a href="https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMjkiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE2IGhiIHkxNzk5IGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeGQ2IGhiIHkxNzk5IGZmMTYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMjkiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE2IGhiIHkxNzk5IGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeGQ2IGhiIHkxNzk5IGZmMTYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==</a> though it is mutated with every <code>new</code>.</div>
<div class='msg'><time>2024-09-09 08:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-09-09 08:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@cisco:parity.io&gt; How is it that the PVM argument invocation can return a blob? I guess the memory contents on a success are the blob. <a href="https://graypaper.fluffylabs.dev/#WyJlMjA2ZTI2NjNjIiwiMjgiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGMgaGIgeTE1YzEgZmZmIGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MWE1IGhiIHkxNWMxIGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+Il1d" target="_blank" rel="noopener">Here</a> the return type is <code>( (N_G, Y) U {panic, oom}, X )</code> but the inner function <code>R</code> seems to return <code>({panic, oom} U N_G, X U Y)</code>

Fixed in <a href="https://github.com/gavofyork/graypaper/pull/72/commits/38de2e265096cb1cbcaa31e9ce445a4e7e771b91" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/72/commits/38de2e265096cb1cbcaa31e9ce445a4e7e771b91</a></div>
<div class='msg'><time>2024-09-09 08:25</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: &gt; &lt;@gav:polkadot.io&gt; Fixed in <a href="https://github.com/gavofyork/graypaper/pull/72/commits/38de2e265096cb1cbcaa31e9ce445a4e7e771b91" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/72/commits/38de2e265096cb1cbcaa31e9ce445a4e7e771b91</a>

Everything&#x27;s clear now, thanks!</div>
<div class='msg'><time>2024-09-09 09:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-09-09 09:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; Hi. I have a doubt about the definition of erasure-coding function. Is it a recursive function? If so, what is the base case?

It is not.</div>
<div class='msg'><time>2024-09-09 09:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; The only place I see C defined is here:

C_k is the &quot;true&quot; definition, and it assumes an input of data in multiples of 684 bytes, and this multiple is the number of &quot;chunks&quot;, k. The k subscript may generally be elided since the number of chunks is implied by the input, but sometimes I put it in regardless to make things clearer. </div>
<div class='msg'><time>2024-09-09 09:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We use a 256-bit hash-sequence to create a 32-bit integer sequence. It would be wasteful to full 256-bit hash for just 32 bits of entropy. So we do a hash only every 8th item and otherwise take the 256-bits of the hash and split it into 8 32-bit integers. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-09 19:36</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-09-09 at 20.36.35.png</div>
<div class='msg'><time>2024-09-09 19:37</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: this formula is a little bit confusing because pc has two meanings here and the letters &quot;c&quot; are almost identical.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-10 01:47</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-09-10 at 1.47.36 PM.png</div>
<div class='msg'><time>2024-09-10 01:47</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-09-10 at 1.47.53 PM.png</div>
<div class='msg'><time>2024-09-10 01:48</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: the arguments order appears to be swapped for g &amp; o</div>
<div class='msg reply'><time>2024-09-10 06:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be fixed in 0.3.7</div>
<div class='msg'><time>2024-09-10 05:13</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-09-10 at 5.13.41 PM.png</div>
<div class='msg'><time>2024-09-10 05:15</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I don&#x27;t fully get this part. Firstly I think the code hash of a service can never be null. And when o is empty, it returns what? The same service account? But what about other fields in the return context?</div>
<div class='msg'><time>2024-09-10 05:16</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: and it is not invoking PVM when o is empty array, which I am not sure is correct. the only case this can be triggered are for privilege services and it should still invoke PVM when there is no work result to accumulate?</div>
<div class='msg'><time>2024-09-10 05:34</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-09-10 at 5.34.29 PM.png</div>
<div class='msg'><time>2024-09-10 05:35</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I also need some clarification about this regards to privileged services without work report</div>
<div class='msg'><time>2024-09-10 05:36</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: when there are two work result for a service, does it receive 2 minimal accumulation gas + (gas ratio * remain gas)? or 1 minimal gas?</div>
<div class='msg'><time>2024-09-10 05:36</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: how about privileged services without work result? they should still receive the minimal accumulation gas right?</div>
<div class='msg'><time>2024-09-10 06:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; this formula is a little bit confusing because pc has two meanings here and the letters &quot;c&quot; are almost identical.

It only has one meaning; the two lines are complementary. One defines the set it belongs to (i.e. its &quot;type&quot;) and the other defines the value within this set.</div>
<div class='msg'><time>2024-09-10 06:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; sent an image.

The two uses of c are related, but I&#x27;ll change the codehash to u in <a href="https://github.com/gavofyork/graypaper/pull/72" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/72</a></div>
<div class='msg'><time>2024-09-10 07:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; and it is not invoking PVM when o is empty array, which I am not sure is correct. the only case this can be triggered are for privilege services and it should still invoke PVM when there is no work result to accumulate?

Yes on both counts. Should be addressed by <a href="https://github.com/gavofyork/graypaper/pull/72/commits/f8ba4adcbb5982403cf35061a149d38826a3379e." target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/72/commits/f8ba4adcbb5982403cf35061a149d38826a3379e.</a></div>
<div class='msg'><time>2024-09-10 07:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; I don&#x27;t fully get this part. Firstly I think the code hash of a service can never be null. And when o is empty, it returns what? The same service account? But what about other fields in the return context?

This is not comparing the hash but the code itself, which can be null in the case that the service doesn&#x27;t currently host the preimage of its code hash.</div>
<div class='msg'><time>2024-09-10 07:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, the function implies this, since it is taking the sum over all work results attributable to the given service, and each element of that sum includes the minimum accumulation gas together with its share of the remainder of the core. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-10 07:15</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: how about the minimum accumulation gas from privileged services if they don&#x27;t have any work results?</div>
<div class='msg'><time>2024-09-10 07:16</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: the remaining gas should also subtract those?</div>
<div class='msg'><time>2024-09-10 07:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: At present, that&#x27;s zero according to the formula. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-10 07:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; how about the minimum accumulation gas from privileged services if they don&#x27;t have any work results?

At present, that&#x27;s zero according to the formula.</div>
<div class='msg'><time>2024-09-10 07:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; the remaining gas should also subtract those?

?</div>
<div class='msg'><time>2024-09-10 07:20</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: so if the gas is zero for privileged services without work results, then why include them in S? invoke those with zero gas surely wouldn’t yield anything other than OOG?</div>
<div class='msg'><time>2024-09-10 07:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah, it&#x27;s not final, I&#x27;m just describing correct behaviour at present.</div>
<div class='msg'><time>2024-09-10 08:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; so if the gas is zero for privileged services without work results, then why include them in S? invoke those with zero gas surely wouldn’t yield anything other than OOG?

<a href="https://github.com/gavofyork/graypaper/pull/75" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/75</a></div>
<div class='msg'><time>2024-09-11 04:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 0.3.7 is released: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.7" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.3.7</a>

In addition to the usual corrections/clarifications, this contains a couple of modest but important changes:
- Erasure-coding is now validator-major not chunk-major: this optimizes the happy case (where you have the first 342 validator&#x27;s shares) and doesn&#x27;t really affect the general case.
- There&#x27;s a new item in chi (privileged services) for managing always-accumulate services and how much gas they get. The three privileged services *no longer always-accumulate implicitly*.</div>
<div class='msg'><time>2024-09-11 07:34</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: I&#x27;ve found a possible discrepancy in single-step state transition of PVM:

In 214 psi_1 receives (c,k,j) + pvm_state, while in 218 psi_1 receives (c,j) + pvm_state</div>
<div class='msg'><time>2024-09-11 07:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; I&#x27;ve found a possible discrepancy in single-step state transition of PVM:
&gt; 
&gt; In 214 psi_1 receives (c,k,j) + pvm_state, while in 218 psi_1 receives (c,j) + pvm_state

<a href="https://github.com/gavofyork/graypaper/pull/77" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/77</a> - will be fixed in next release.</div>
<div class='msg'><time>2024-09-11 15:14</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Question regarding BitSequence codec:
Am I getting this right, that in case of a variable-length bit sequence encoding, one should <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMzEiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGYgaDYgeTFlNjMgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4ZiBoNiB5MWU2MyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">prefix it with length</a> of the bit sequence itself, not with length of it&#x27;s packed representation?</div>
<div class='msg reply'><time>2024-09-11 20:20</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: it has to be the bit length otherwise how do you figure out that? but I don’t think variable length bit sequence is used atm so no need to implement it</div>
<div class='msg'><time>2024-09-11 15:17</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Also IMHO it would be good to only have one canonical representation of some encoding, so GP should strictly define that:
1. The remaining bits (i.e. the remaining <code>bitLength % 8</code>)  should be set to 0 (and decoding should fail in other case)
2. The boolean discriminator can be only <code>0</code> or <code>1</code>, so any other number should fail the decoding.</div>
<div class='msg'><time>2024-09-11 15:20</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: </div>
<div class='msg'><time>2024-09-11 15:22</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: </div>
<div class='msg'><time>2024-09-11 15:24</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: Bitsequence with length 3 for Octet: 253 and octet: 1 both decode as [True,False,False]. With encoding the bits outside of the sequence matter to get the right octet back.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-11 15:58</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: </div>
<div class='msg'><time>2024-09-11 16:09</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: </div>
<div class='msg'><time>2024-09-12 00:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. This is already the implication. (We define only the encoding function, which implies that the remaining bits are set to zero. Decoding is just the inverse of the encoding function and so would naturally be invalid in if these bits happened to be set, since there would be no valid operand to the encoder function which could produce that output.)
2. What do you mean by “Boolean discriminator”? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 06:27</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: 1. Okay fair point, I didn&#x27;t think about implication like that. What I had in mind about being more explicit with bits is to change the sum limits to be full <code>0..8</code> and then define <code>b_i * 2^i if i &amp;lt; |b|, 0 otherwise</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 06:30</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: &gt; &lt;@gav:polkadot.io&gt; 1. This is already the implication. (We define only the encoding function, which implies that the remaining bits are set to zero. Decoding is just the inverse of the encoding function and so would naturally be invalid in if these bits happened to be set, since there would be no valid operand to the encoder function which could produce that output.)
&gt; 2. What do you mean by “Boolean discriminator”?

2. Sorry, should have been more precise: I&#x27;ve meant the <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMzEiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDEyIGg2IHkxZTU2IGZmNyBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeGYgaGMgeTFlNTcgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">discriminator for set in union with empty set</a>. But given your other explanation about just providing the canonical encoding it&#x27;s pretty clear that any number other than <code>0</code> and <code>1</code> should be rejected.</div>
<div class='msg'><time>2024-09-12 06:41</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: When looking at PVM testvectors, I assume k is a fixed length bitsequence (length defined by |c|=|k|). I believe the the remaining bits are all filled with 1s rather than 0s. 

Example is the first ADD instruction. <a href="https://github.com/w3f/jamtestvectors/blob/a2b18702aac7d15b9f51cd1ffcf0be95f987b2f7/pvm/programs/inst_add.json#L29" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/a2b18702aac7d15b9f51cd1ffcf0be95f987b2f7/pvm/programs/inst_add.json#L29</a>

Value [T,F,F] is currently 249 or 0xF9 (1-filled) and should be 1 or 0x01 (0-filled). 

IMO if we are strict about decoding these vectors should be fixed.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 07:06</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: This also implies that the only PVM testvectors that are currently valid are the ones where |c| is accidentally a multiple of 8. </div>
<div class='msg'><time>2024-09-12 07:08</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: We can work around this for now by not having a ‘strict’ decoding of a bitsequence. I.e. simply ignoring the bits outside of the bitmask. </div>
<div class='msg'><time>2024-09-12 07:11</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: Correct me if I am wrong. 🙏🏻 </div>
<div class='msg'><time>2024-09-12 07:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@emielvanderhoek:matrix.org&gt; When looking at PVM testvectors, I assume k is a fixed length bitsequence (length defined by |c|=|k|). I believe the the remaining bits are all filled with 1s rather than 0s. 
&gt; 
&gt; Example is the first ADD instruction. <a href="https://github.com/w3f/jamtestvectors/blob/a2b18702aac7d15b9f51cd1ffcf0be95f987b2f7/pvm/programs/inst_add.json#L29" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/a2b18702aac7d15b9f51cd1ffcf0be95f987b2f7/pvm/programs/inst_add.json#L29</a>
&gt; 
&gt; Value [T,F,F] is currently 249 or 0xF9 (1-filled) and should be 1 or 0x01 (0-filled). 
&gt; 
&gt; IMO if we are strict about decoding these vectors should be fixed. 

We are strict and if this is the case then they should indeed be fixed (@jan care to comment?)</div>
<div class='msg'><time>2024-09-12 07:26</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: <a href="https://github.com/w3f/jamtestvectors/issues/13" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/issues/13</a></div>
<div class='msg'><time>2024-09-12 07:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I think this would only confuse matters. It’s pretty clear currently using a summation to define each octet and totally ignoring the fact that the octets in the resultant sequence could hypothetically be expressed in bits some some of which may have no correspondence with bits in the bit sequence.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 07:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is bits in, octets (values between 0 and 255 inclusive) out. There’s absolutely no need to bring “unused bits” into it. Concerns specific to particular low-level implementations are not generally going to be made explicit in the GP. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-12 09:14</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Omg, sorry I&#x27;m so dumb. Only now I&#x27;ve realized it&#x27;s an actual sum, so obviously the other bits don&#x27;t need any special treatment</div>
<div class='msg'><time>2024-09-12 07:47</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: I append instruction data with 25 zeros (24 is de max value returned by skip function, I add one more for security) <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMjEiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGYgaGIgeTExMGQgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4ZiBoNiB5MTEwZSBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMjEiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGYgaGIgeTExMGQgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4ZiBoNiB5MTEwZSBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==,</a> so in the case of the first ADD instruction data I have 3 + 25 octets. The Bitmask is 249 (11111001), |b| = 3 and I consider the remaining 5 ones as suffix. So then I have to suffix 20 more ones to the bitmask in order to have |instruction\_data| = |bitmask| <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 08:11</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: &gt; &lt;@emielvanderhoek:matrix.org&gt; This also implies that the only PVM testvectors that are currently valid are the ones where |c| is accidentally a multiple of 8.

I append instruction data with 25 zeros (24 is de max value returned by skip function, I add one more for security) <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMjEiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGYgaGIgeTExMGQgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4ZiBoNiB5MTEwZSBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMjEiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGYgaGIgeTExMGQgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4ZiBoNiB5MTEwZSBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==,</a> so in the case of the first ADD instruction data I have 3 + 25 octets. The Bitmask is 249 (11111001), |b| = 3 and I consider the remaining 5 ones as suffix. So then I have to suffix 20 more ones to the bitmask in order to have |instruction_data| = |bitmask|</div>
<div class='msg'><time>2024-09-12 08:24</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The remaining bits in the PVM code blob&#x27;s bitmask (in case the size of the instructions&#x27; slice is not divisible by 8) don&#x27;t really matter and will produce the same result (as all out of bounds instructions are assumed to be traps, and regardless of what skip they have they will decode all the same), <em>except</em> the very first &quot;extra&quot; out of bounds bit which nominally should be <code>1</code>, because that bit determines the skip of the last instruction. So just assuming they&#x27;re all zeros would screw up decoding of the last instruction in case the instructions&#x27; slice is divisible by 8.

But you&#x27;re right that there&#x27;s discrepancy here between the GP and the test vectors. It essentially boils down to this: what should we do if the number of instructions is not divisible by 8? Naively reading the GP the <code>|c| = |k|</code> would suggest to me that the number of bits in the bit mask should be always equal to the number of instruction bytes, but that indeed is not the case for our current test vectors.

So how do we fix this discrepancy? First, even if the number of instruction bytes is divisible by 8 we need to assume that out of bounds bits are <code>1</code> (only the very first one needs to be, but it&#x27;s simpler to assume all of them are), otherwise the decoding of the last instruction will be broken (alternatively skip can be defined to be &quot;the number of <code>0</code>s until the next <code>1</code>s, or until the end of the bitmask&quot;, then conceptually the out of bounds bits can be <code>0</code>).

Second, decide what to do when the number of instruction bytes is not divisible by 8:
a) change the <code>|c| = |k|</code> to say that the <code>|c|</code> should be rounded up to the nearest 8 (so, essentially, &quot;round_up_to_nearest(8, instruction_bytes) == bits_in_bitmask&quot;); essentially, allow the number of instructions and the number of bits in the bitmask not match, but enforce that the bitmask can have at most an &quot;extra&quot; 7 bits of padding (of which, as I&#x27;ve previously explained, only the first bit matters)
b) delete the <code>|c| = |k|</code> (since AFAIK we always know the length of the whole **p** anyway, so the only purpose this equation serves is to add an additional constraint); essentially, allow the number of instructions and the number of bits in the bitmask not match, and not enforce anything about the bitmask&#x27;s length
c) force the instruction bytes to be always divisible by 8, in which case we could change the encoding of the **p** code blob to something like <code>p = E(|j|) ⌢ E_1(z) ⌢ E_z (j) ⌢ E(c) ⌢ E(k)</code> (basically remove <code>E(|c|)</code>, since, again, the lengths here can be implicitly calculated from the length of **p**)

So I think (b) is probably not a great idea. (a) is what I currently have implemented in PolkaVM, and I don&#x27;t dislike the (c) option (It can waste up to 6 bytes, but it doesn&#x27;t need any extra validation of the sizes. so one less place for the implementations to diverge I guess). gav </div>
<div class='msg'><time>2024-09-12 08:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Firstly I don’t understand the problem of instructions not being divisible by 8. Bit strings need not be divisible by 8 either. </div>
<div class='msg'><time>2024-09-12 08:36</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: &gt; &lt;@gav:polkadot.io&gt; Firstly I don’t understand the problem of instructions not being divisible by 8. Bit strings need not be divisible by 8 either.

We have a bit in the bit mask for every instruction, right? But we can&#x27;t just encode singular bits; we need to <em>physically</em> encode them as bytes. So if we have, say, an instructions blob which only takes 2 bytes of space, then sure, theoretically we only need 2 bits in the bit mask, but practically we must encode full 8 bits because 8 bits is the lowest granularity we can store. So this is what I mean by &quot;instructions not being divisible by 8&quot;.</div>
<div class='msg'><time>2024-09-12 09:03</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The implicit &quot;remaining bits of the bitmask encoded as bytes must be zero&quot; of GP&#x27;s bit string encoding has two issues here as far as I can see:

1. this being an implicit requirement can be confusing for the implementers (as we&#x27;ve seen from the questions here; it might not be entirely obvious to everyone that those should be zeros, nor whether this should be validated), so it could be worthwhile to add a clarifying footnote or something explicitly saying this so that there&#x27;s no room for confusion,
2. for the PVM code blob specifically this breaks the decoding of the very last instruction&#x27;s skip value, _unless_ we say that the the skip calculation goes only as far as the end of the bitmask (so effectively implicitly the bitmask would have a <code>1</code> in there because it would behave as if there actually was a <code>1</code> encoded there, even though we&#x27;d physically require encoding <code>0</code>s there!) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 09:05</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Hmm, but okay, <em>another</em> way of dealing with this could maybe be inverting the mask so that operands get a <code>1</code> and instruction opcodes get a <code>0</code> in the bitmask - <em>then</em> the zero padding would work.</div>
<div class='msg'><time>2024-09-12 09:19</time>&ensp;<span class='u' style='color:#7664c9'>emielvanderhoek</span>: Rereading GP-0.3.6-eq:276 (encoding of bitsequence) to me seems to explicitly force leading zero’s when encoding to an octet.

Example: Value [T,F,F] leads to value 1 or 0x01 (0-filled). And no other value.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 09:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; We have a bit in the bit mask for every instruction, right? But we can&#x27;t just encode singular bits; we need to physically encode them as bytes

The encoding is irrelevant from the perspective of the PVM spec. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 09:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: They&#x27;re totally separate concerns.</div>
<div class='msg'><time>2024-09-12 09:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I say again: the length of any sequence (including a sequence of bits) do not need to be divisible by 8. From the perspective of the spec there is <em>absolutely nothing special</em> about bit-sequences compared to any other kind of sequence.</div>
<div class='msg'><time>2024-09-12 09:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There is a perfectly well-defined serialization codec. It is independent of the business logic and does not prejudice it at all. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 09:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Reading what you&#x27;re saying, the only thing I can think of which might need a tweak is the skip function.</div>
<div class='msg'><time>2024-09-12 09:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg'><time>2024-09-12 09:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Since the final instruction&#x27;s opcode bitmask could not be followed by a 1 as that would imply the opcode bitmask sequence as being longer than the instruction data sequence.</div>
<div class='msg'><time>2024-09-12 09:40</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Sure, but the bits <em>are</em> physically there, so everyone needs to agree to handle them in the same way. (:

So, again, if the implicit assumption is that those extra physical bits in a bitstream must be zero then that doesn&#x27;t work for PVM as currently defined, and we need to fix it somehow.

One simple way we could fix it is to invert the bitmask (so change the <code>1</code> to <code>0</code> in the skip equation) at a tiny cost to performance (~0.006% worse compilation speed as I just implemented it and measured); if that&#x27;s fine to you then we can go with that.</div>
<div class='msg'><time>2024-09-12 09:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: it should probably read k + 1 + j &gt;= |k| OR ...</div>
<div class='msg'><time>2024-09-12 09:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; Sure, but the bits are physically there, so everyone needs to agree to handle them in the same way. (:

Not necessarily.</div>
<div class='msg'><time>2024-09-12 09:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You&#x27;re thinking far too implementation specific.</div>
<div class='msg'><time>2024-09-12 09:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Please check the room title.</div>
<div class='msg'><time>2024-09-12 09:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Maybe someone implements the bit sequence as <code>Vec&amp;lt;bool&amp;gt;</code>. Maybe they&#x27;re in C++ and it&#x27;s <code>std::vector&amp;lt;bool&amp;gt;</code>. Maybe they&#x27;re in Scheme or Haskell and it&#x27;s linked list of bools.</div>
<div class='msg'><time>2024-09-12 09:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The serialization format and the internal business logic are NOT the same.</div>
<div class='msg'><time>2024-09-12 09:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: They&#x27;re not even close to being the same thing.</div>
<div class='msg'><time>2024-09-12 09:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: AFAICT nobody has brought up any valid concern related to bit-sequences. The spec is 100% clear. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 09:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Bit sequences are arbitrary in length and anywhere spec subscripts by an index &gt;= length is undefined regardless of what might happen to be in any particular place in a machine&#x27;s physical RAM. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 09:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You seem to be conflating some element of (perfectly well defined) business logic with the fact that the serialization of a bit sequence of type B\_8 and value \[1, 1, 1, 1, 1, 1, 1, 0\] happens to give the same octet sequence as a bit sequence of type B\_7 and value \[1, 1, 1, 1, 1, 1, 1\]. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 09:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As I say, at present the skip function appears to be in part undefined. This is the only alteration I see the need for. And it&#x27;s just a broken function - it has nothing to do with the serialization format of sequences, or subscripting into bit sequences. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:03</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Okay, sure, but the bits <em>are</em> physically there, so it needs to be defined somehow (implicitly or explicitly) how they are handled. Are they validated (enforced to be zero) or are they ignored? The protocol <em>will</em> physically transmit those bytes, so it needs to define how they&#x27;re handled (even if, again, this definition is only implicit and not explicitly written out). So I disagree that this is in any way an implementation-only concern. It&#x27;s just a matter of whether the spec defines what happens explicitly or implicitly.

Like, for example, let&#x27;s take this pseudo code as an example:

<pre><code class=''>a = spawn_pvm(instructions = [1,2,3,4,5,6,7], bitmask = [0b11111110])
b = spawn_pvm(instructions = [1,2,3,4,5,6,7], bitmask = [0b11111111])
</code></pre>

We need the behaviour of this snippet to be the same for every implementation, hence the spec must define what happens here. Sure, the spec doesn&#x27;t explicitly have to concern itself whether the last bit is there, but it needs to at least implicitly define (as a consequence of what it <em>does</em> explicitly define) exactly what happens, whether that be just ignoring the extra bits, or checking whether the extra bits are zero and if not then rejecting the program. If you want to say &quot;this concern is too low level for the the spec to explicitly define, and we will only define it implicitly&quot; then okay, fair enough.

Anyway, so, can we change the bitmask for the skip to be the other way around - <code>0</code>s for instructions and <code>1</code>s for the argumets? That should resolve the issue with only a minimal hit to the performance of any potential implementations and not require any extra modifications.</div>
<div class='msg'><time>2024-09-12 10:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; but the bits are physically there

Not in the spec they&#x27;re not. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And the spec is what is correct.</div>
<div class='msg'><time>2024-09-12 10:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So NO. They&#x27;re not.</div>
<div class='msg'><time>2024-09-12 10:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It sounds as though your implementation of the spec is probably based on non-conformant assumptions about memory layouts.</div>
<div class='msg'><time>2024-09-12 10:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And that you&#x27;re conflating these non-conformant assumptions with the spec&#x27;s serialization format for bit sequences.</div>
<div class='msg'><time>2024-09-12 10:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Now I don&#x27;t think there&#x27;s any issue with altering the skip function in the way I state above.</div>
<div class='msg'><time>2024-09-12 10:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Implementations are free to include a bounds-check, but they can also just place extra bits (of value <code>1</code>) on the end of their (bit sequence) <code>k</code>, and thus allow writing a conformant skip function which needs no explicit bounds check as long as its argument is properly constrained (and we know it should be by virtue of how it&#x27;s used in the spec). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Inverting the meaning of bits in k is not going to help unless you presume (generally incorrectly, but perhaps by design in your implementation) that there are accessible trailing zero bits in whatever your internal representation of sequence k is. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; It&#x27;s just a matter of whether the spec defines what happens explicitly or implicitly.

I&#x27;ve no idea what you&#x27;re talking about.</div>
<div class='msg'><time>2024-09-12 10:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There&#x27;s nothing implicit.</div>
<div class='msg'><time>2024-09-12 10:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Beyond any as-yet unknown errors, the spec defines correct behaviour perfectly.</div>
<div class='msg'><time>2024-09-12 10:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There is nothing implicit about the serialization format nor about k, nor about what happens when you subscript into k.</div>
<div class='msg'><time>2024-09-12 10:19</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Okay, can I ask an offtopic question?

Leaving the spec-land, can you clarify what exactly are implementations supposed to do with the extra bits in the real world to be conformant with the spec? Are they supposed to ignore it? Or validate that they are zeros? Since the spec doesn&#x27;t define what to do with them and doesn&#x27;t concern itself with them am I correct in assuming that they should be ignored?</div>
<div class='msg'><time>2024-09-12 10:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There are no extra bits.</div>
<div class='msg'><time>2024-09-12 10:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;ve been trying to point this out for nearly 10 hours now.</div>
<div class='msg'><time>2024-09-12 10:22</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Okay, so they should be ignored by the implementations. Got it.</div>
<div class='msg'><time>2024-09-12 10:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There is a definition of how to serialize a sequence of N_2 values (&quot;bits&quot;, booleans, whatever you like to call it).</div>
<div class='msg'><time>2024-09-12 10:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This implies a deserialization function definition which requires canonical serialization. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As for internal (in-RAM) representations: it&#x27;s purely an implementation concern.</div>
<div class='msg'><time>2024-09-12 10:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The GP specifies correctness through the serialization of blocks only. It does not EVER specify how a machine should represent any particular datum in physical memory. For all the GP knows, it could be a pen-and-paper block execution. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As such there is simply no concern of &quot;extra bits&quot; with regards to correctness.</div>
<div class='msg'><time>2024-09-12 10:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If I might rephrase your question (possibly incorrectly) to &quot;I plan to implement a bit sequence in Rust as a <code>Vec&amp;lt;u8&amp;gt;</code> and thus will naturally have access to a multiple of 8 bits at a time. If the bit sequence is a non-multiple of 8 in length and I attempt to dereference a bit whose index falls into those bits beyond the rightful length but still within the final byte which I am able to access, how should I proceed?&quot; <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:30</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: More or less, yes.</div>
<div class='msg'><time>2024-09-12 10:30</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: (Although the question would be the same regardless of the programming language, as long as we&#x27;re implementing JAM on a computer.)</div>
<div class='msg'><time>2024-09-12 10:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The answer would be: &quot;Either your implementation is incorrect (because the GP does not subscript at that index) or the GP is incorrect (because it does subscript at that index and thus includes an undefined term).&quot; <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Again not true. This question can only be framed with the presumption that there is accessible capacity beyond the rightful length, which seems pretty specific to the presumptions inherent in your implementation. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:33</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Okay, so the implementation should not access those bytes, and if it does this should not change any observable behavior, so any practical implementations of JAM on a computer will have to ignore those bits.</div>
<div class='msg'><time>2024-09-12 10:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@jan:parity.io&gt; Okay, so the implementation should not access those bytes, and if it does this should not change any observable behavior, so any practical implementations of JAM on a computer will have to ignore those bits.

It&#x27;s not as simple as that.</div>
<div class='msg'><time>2024-09-12 10:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Maybe it does access those bytes.</div>
<div class='msg'><time>2024-09-12 10:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The point is that the GP defines correct behaviour.</div>
<div class='msg'><time>2024-09-12 10:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Implementations are totally free to access whatever parts of RAM they want in whatever ways they want to.</div>
<div class='msg'><time>2024-09-12 10:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As long as their behaviour is in line with the GP it really doesn&#x27;t matter.</div>
<div class='msg'><time>2024-09-12 10:35</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Yes, that&#x27;s what I was trying to say. (:</div>
<div class='msg'><time>2024-09-12 10:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: From the GP&#x27;s perspective, there are no &quot;extra bits&quot;, or more generally stated, there is no capacity beyond the length. For the sequence s = \[0, 1\], s\[2\] is undefined. If the spec ever tries to evaluate it, there is a mistake in the spec. Maybe a corresponding operation in some implementions would define some result. That&#x27;s a potential avenue for an implementation-specific optimisation perhaps, but it&#x27;s irrelevant from the perspective of asking about correct behaviour. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: To help illustrate this a bit further you&#x27;d probably want to implement an efficient bit-sequence as a <code>Vec&amp;lt;usize&amp;gt;</code>, implying that you&#x27;d have up to 31 &quot;extra bits&quot; on 32-bit architectures and 63 &quot;extra bits&quot; on 64-bit architectures. Clearly the spec cannot care about what architecture any given impl instance is on. Therefore it must surely be that the GP cannot possibly consider the existence of any such &quot;extra bits&quot;. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:41</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Hm... but isn&#x27;t there at least one part of the spec that accesses those &quot;extra&quot; bits, namely, the <code>machine</code> hostcall defines the program as being p_z <em>bytes</em> long, so doesn&#x27;t this impliy that there <em>will</em> be extra bits in there?</div>
<div class='msg'><time>2024-09-12 10:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Where exactly? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:43</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmYiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDQzIGhlIHkxY2ZjIGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDE1MyBoNCB5MWNmZSBmZjIxIGZzMiBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmYiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDQzIGhlIHkxY2ZjIGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDE1MyBoNCB5MWNmZSBmZjIxIGZzMiBmYzAgc2MwIGxzMCB3czBcIj4iXV0=</a></div>
<div class='msg'><time>2024-09-12 10:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: ok you mean the program blob.</div>
<div class='msg'><time>2024-09-12 10:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, this draws upon the exact same (deterministic) codec as before.</div>
<div class='msg'><time>2024-09-12 10:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There&#x27;s still no extra bits.</div>
<div class='msg'><time>2024-09-12 10:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Again, you&#x27;re confusing the wire format with business logic.</div>
<div class='msg'><time>2024-09-12 10:44</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Okay, fair enough. So in <em>this</em> case the bits should be zero to correctly decode, otherwise an error is returned?</div>
<div class='msg'><time>2024-09-12 10:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The point where wire-format (the p which is passed in <code>machine</code> and passed into Phi) changes into business logic is the E function.</div>
<div class='msg'><time>2024-09-12 10:45</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: In appendix A, why the gas delta is always 0 for every instruction?</div>
<div class='msg'><time>2024-09-12 10:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Before, one can argue that there may be &quot;extra bits&quot; (though I&#x27;d say it&#x27;s unhelpful and unnecessary to frame it in that way). Afterwards there are most certainly not. As I say, some implementations will likely use optimized language primitives like C++&#x27;s <code>vector&amp;lt;bool&amp;gt;</code> in order to represent this data and there will be no such accessible-beyond-rightful-length data. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We have not yet defined sensible gas costs - it&#x27;ll be one of the last things we do. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-12 10:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@jan:parity.io&gt; Okay, fair enough. So in <em>this</em> case the bits should be zero to correctly decode, otherwise an error is returned?

That&#x27;s implication of the math, yeah.</div>
<div class='msg'><time>2024-09-12 10:48</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: &gt; &lt;@gav:polkadot.io&gt; We have not yet defined sensible gas costs - it&#x27;ll be one of the last things we do.

okiedokie; so I assume in koute pvm test vectors the default value is 1</div>
<div class='msg'><time>2024-09-12 10:59</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: image.png</div>
<div class='msg'><time>2024-09-12 11:01</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Should &#x27;v&#x27; here be replaced with &#x27;f&#x27;?</div>
<div class='msg'><time>2024-09-12 11:02</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: image.png</div>
<div class='msg'><time>2024-09-12 11:02</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: so as eq 129</div>
<div class='msg'><time>2024-09-12 13:26</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: &gt; &lt;@gav:polkadot.io&gt; That&#x27;s implication of the math, yeah.

Okay, thank you for clarifying everything. Now I&#x27;m clear on the intended behavior. Sorry for being so dense. (:

So the skip equation should be fixed, as it current does access out of bounds elements of <code>k</code> as far as I understand: <code>j∈N∶ k_{i+1+j} = 1</code> (since <code>j</code> is <code>∈N</code>, so it goes up to infinity, but even without this it would do an out-of-bounds access for the very last instruction due to the <code>+1</code>)

And we might consider deleting/changing this sentence which precedes the skip equation as it explicitly talks about the extra padding. I&#x27;m not saying it&#x27;s incorrect (logically it&#x27;s true), but in the context of our &quot;there are no extra bits&quot; conversation it may be confusing when (outside of the serialization codec section) you have a sentence which explicitly says that those bits do in fact exist:

&gt; We assert that the length of the bitmask is no smaller than the length of the instruction blob (and in fact is simply rounded to the nearest multiple of eight for ease of octet-encoding).

So, let me quickly summarize the main options that I can see:

a) change <code>skip</code> to not read out of bounds,
b) keep <code>skip</code> as-is, define out of bounds reads to be <code>1</code> (after all we already do something similar with the instructions blob),
c) keep <code>skip</code> as-is, define out of bounds reads to be <code>1</code>, use a dedicated serialization codec for this bit mask which requires that <code>|k| mod 8 = 0</code> and <code>ceil(|c| / 8) = |k| / 8</code> (so this would make the business logic explicitly use the &quot;extra&quot; bits, which now I know you don&#x27;t want)

I can make a PR to the GP. I&#x27;m guessing you&#x27;d like to go with (a), correct?

(For reference, I&#x27;ve initially implemented (c) in PolkaVM because that was marginally the fastest option which didn&#x27;t require adding any extra unnecessary padding.)</div>
<div class='msg'><time>2024-09-12 13:33</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: &gt; &lt;@dakkk:matrix.org&gt; okiedokie; so I assume in koute pvm test vectors the default value is 1

Correct. The test vectors currently assume that every instructions costs <code>1</code> gas, but this is just a strictly temporary measure so that people can implement their gas metering machinery without needing the final gas cost model to be defined (since gas is a core part of the JAM you must have at least <em>some</em> gas cost model, and assuming every instruction costs only <code>1</code> gas is the simplest one you can have). We will be defining a proper gas cost model in the future and updating the vectors.</div>
<div class='msg'><time>2024-09-12 15:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@jan:parity.io&gt; Okay, thank you for clarifying everything. Now I&#x27;m clear on the intended behavior. Sorry for being so dense. (:
&gt; 
&gt; So the skip equation should be fixed, as it current does access out of bounds elements of <code>k</code> as far as I understand: <code>j∈N∶ k_{i+1+j} = 1</code> (since <code>j</code> is <code>∈N</code>, so it goes up to infinity, but even without this it would do an out-of-bounds access for the very last instruction due to the <code>+1</code>)
&gt; 
&gt; And we might consider deleting/changing this sentence which precedes the skip equation as it explicitly talks about the extra padding. I&#x27;m not saying it&#x27;s incorrect (logically it&#x27;s true), but in the context of our &quot;there are no extra bits&quot; conversation it may be confusing when (outside of the serialization codec section) you have a sentence which explicitly says that those bits do in fact exist:
&gt; 
&gt; &gt; We assert that the length of the bitmask is no smaller than the length of the instruction blob (and in fact is simply rounded to the nearest multiple of eight for ease of octet-encoding).
&gt; 
&gt; So, let me quickly summarize the main options that I can see:
&gt; 
&gt; a) change <code>skip</code> to not read out of bounds,
&gt; b) keep <code>skip</code> as-is, define out of bounds reads to be <code>1</code> (after all we already do something similar with the instructions blob),
&gt; c) keep <code>skip</code> as-is, define out of bounds reads to be <code>1</code>, use a dedicated serialization codec for this bit mask which requires that <code>|k| mod 8 = 0</code> and <code>ceil(|c| / 8) = |k| / 8</code> (so this would make the business logic explicitly use the &quot;extra&quot; bits, which now I know you don&#x27;t want)
&gt; 
&gt; I can make a PR to the GP. I&#x27;m guessing you&#x27;d like to go with (a), correct?
&gt; 
&gt; (For reference, I&#x27;ve initially implemented (c) in PolkaVM because that was marginally the fastest option which didn&#x27;t require adding any extra unnecessary padding.)

(a) sure. </div>
<div class='msg'><time>2024-09-12 15:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And indeed that parenthesised text should be removed as it is neither useful nor commensurate with everything else. </div>
<div class='msg'><time>2024-09-12 15:57</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: &gt; &lt;@gav:polkadot.io&gt; (a) sure.

Got it. I&#x27;ll make a PR to the GP and update the test vectors with the fixed paddings then.</div>
<div class='msg'><time>2024-09-13 04:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: That is now in <a href="https://github.com/gavofyork/graypaper/pull/77" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/77</a> (<a href="https://github.com/gavofyork/graypaper/pull/77/commits/8aad71e12fcb829e70b8bf577de8d45d1b346d41" target="_blank" rel="noopener">Fix PVM</a>) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-13 04:48</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: jeff: Can you point us to any ELVES talks posted from you (or anyone else)?  I found one, perhaps there are more?
 Elves paper: <a href="https://eprint.iacr.org/2024/961" target="_blank" rel="noopener">https://eprint.iacr.org/2024/961</a>    
 SBC 2024 video: <a href="https://www.youtube.com/watch?v=C1teIFTSphE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=C1teIFTSphE</a> </div>
<div class='msg reply'><time>2024-09-23 10:42</time>&ensp;<span class='u' style='color:#c74b98'>alistair</span>: We&#x27;ve been talking about this protcol for years.  I like this talk I gave at a workshop: <a href="https://www.youtube.com/watch?v=F8q16k4U2fA" target="_blank" rel="noopener">https://www.youtube.com/watch?v=F8q16k4U2fA</a> . In 2019, Jeff and I gave one at the web3 summit, <a href="https://www.youtube.com/watch?v=JgaDYFCKSxM" target="_blank" rel="noopener">https://www.youtube.com/watch?v=JgaDYFCKSxM</a> and I gave one at Devcon Osaka, <a href="https://www.youtube.com/watch?v=Ex_1XXF29Yo" target="_blank" rel="noopener">https://www.youtube.com/watch?v=Ex_1XXF29Yo</a> . Maybe Rob Habermeier has some. Expect more now that the paper is out.</div>
<div class='msg'><time>2024-09-13 06:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: sourabhniyogi: Before you or your team invest too much effort into attempting to redevelop the JAM protocol please note that following the resolution of <a href="https://github.com/gavofyork/graypaper/issues/57" target="_blank" rel="noopener">Ordered Accumulations</a> I do not anticipate any significant changes beyond tweaks, corrections and high-value-low-impact optimizations. Following this issue I consider JAM essentially feature complete and it will be very difficult to convince me to merge significant, novel feature additions into the GP. As a rough timeline I would like to have PolkaJAM entering audit in Q2 next year, which pretty much implies a security audit of the GP starting in Q1 and thus a spec freeze by EOY. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-13 08:14</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: following up this <a href="https://github.com/gavofyork/graypaper/pull/77/commits/b1f172bdf98a52b12cebd9d5064b22230730b5d9" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/77/commits/b1f172bdf98a52b12cebd9d5064b22230730b5d9</a></div>
<div class='msg'><time>2024-09-13 08:14</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: image.png</div>
<div class='msg'><time>2024-09-13 08:14</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I guess omega X here means <code>A function</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-13 08:15</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: so to avoid confusion may I suggest to remove the <code>_X</code> from the omega?</div>
<div class='msg'><time>2024-09-13 08:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; following up this <a href="https://github.com/gavofyork/graypaper/pull/77/commits/b1f172bdf98a52b12cebd9d5064b22230730b5d9" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/77/commits/b1f172bdf98a52b12cebd9d5064b22230730b5d9</a>

I cannot see any images you post unfortunately. Please use <a href="https://graypaper.fluffylabs.dev/" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/</a> instead to point to the part of the GP you mean.</div>
<div class='msg'><time>2024-09-15 08:33</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Is <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMzEiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE0MyBoYiB5MWUzNiBmZjE2IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4NiBoYiB5MWUzNiBmZjE2IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">this</a> term always zero? </div>
<div class='msg reply'><time>2024-09-15 08:50</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: No, e.g., if <code>l</code> is 0, then this term is <code>x</code> <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-15 08:50</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: If it is the correct link.</div>
<div class='msg reply'><time>2024-09-15 08:59</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: image.png</div>
<div class='msg reply'><time>2024-09-15 08:59</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Yes, its the correct link. Should <code>l</code> be determined implicitly by the number of octets of x? Or is it explicitly passed as an argument to the encode function? </div>
<div class='msg reply'><time>2024-09-15 09:04</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: it is calculated from the encoding number</div>
<div class='msg reply'><time>2024-09-15 09:18</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Is there any case in which <code>l</code> calculated from the encoding number is 0? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-15 09:26</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: For x between 2^0 to 2^7 it seems <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-16 06:36</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: To make this equation a little more clear, here&#x27;s a visualization of what it does. It essentially encodes numbers as varints in the following way:

<pre><code class=''>At most  7bit - 0xxxxxxx
At most 14bit - 10xxxxxx xxxxxxxx
At most 21bit - 110xxxxx xxxxxxxx xxxxxxxx
...
At most 56bit - 11111110 xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx
At most 64bit - 11111111 xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx
</code></pre>

So the first encoded byte tells you how long the encoded number is by the amount of <code>1</code>s either until the first <code>0</code> (starting at the most significant bit) or until the end of the byte. If there&#x27;s &quot;free space&quot; left after the first <code>0</code> then part of the number is packed in there (the <code>x</code>s in the first byte). And then the rest of the bits of the encoded number are appended (the <code>x</code>s after the first byte). So as you can see the number of <code>x</code> bits is always divisible by <code>7</code> (hence why you can find the <code>7l</code> in the GP equation), except the very last case where we don&#x27;t have to encode the <code>0</code> in the first byte anymore because we&#x27;ll hit the end of the byte when counting the <code>1</code>s when decoding anyway (hence the &quot;otherwise if x &lt; 2^64&quot; part in the GP).

Here are some example numbers encoded using this:
<pre><code class=''>number -&gt; encoded as
01111111 -&gt; 01111111 (127 -&gt; [127])
10000000 -&gt; 10000000, 10000000 (128 -&gt; [128, 128])
00111111_11111111 -&gt; 10111111, 11111111 (16383 -&gt; [63, 255])
</code></pre>

So if you&#x27;re maybe familiar with the &quot;standard&quot; uleb128 varint serialization scheme - this is essentially similar, except instead of putting the continuation bits in every byte it packs all of the continuation bytes in the first byte and limits the number to at most 64-bit. (The rationale for this is that this is more efficient to decode on modern CPUs, because you only need to look at the first byte to know the length of the varint, instead of having to check the most significant bit for every byte.)

Hopefully this makes it a little more clear.</div>
<div class='msg reply'><time>2024-09-19 15:09</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: In the last example 
<code>00111111_11111111 -&amp;gt; 10111111, 11111111 (16383 -&amp;gt; [63, 255])</code>
Don&#x27;t should be <code>16383 -&amp;gt; [191, 255]</code> ?
In this case, <code>l = 1</code> 
Acording with (272): 16383 -&gt; 2⁸ - 2⁷ + (16383/2⁸) = 191
concatenate with (16383 mod 2⁸) = 255</div>
<div class='msg reply'><time>2024-09-19 15:12</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Yes, you&#x27;re correct. That was a copy-paste error on my part when I converted binary to decimal. 10111111 is, of course, 191 is decimal. Sorry for the confusion.</div>
<div class='msg'><time>2024-09-15 08:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: That link doesn’t seem to work especially well. </div>
<div class='msg'><time>2024-09-15 09:35</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: </div>
<div class='msg'><time>2024-09-15 09:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>:  If 1 &lt;= x &lt; 128 then l = 0. </div>
<div class='msg'><time>2024-09-15 09:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This is made explicit in the equation you referenced. </div>
<div class='msg'><time>2024-09-15 09:42</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: &gt; &lt;@gav:polkadot.io&gt; If 1 &lt;= x &lt; 128 then l = 0.

Ok, I thought <code>l = number of octets</code> of x. Thanks.</div>
<div class='msg'><time>2024-09-17 13:08</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hi,

I have a question regarding state Merkelization. We say we use a Patricia trie, but looking at equation 295, it seems there are no extension nodes for common prefixes, which looks more like a regular prefix trie with Merkle hashing.

Could you confirm if my understanding is correct? If so, (we want a Patricia trie), wouldn’t we need to define l and r using b_t1 and b_t0, where t1 and t0 are the largest common prefix among paths starting with 1 and 0, respectively?</div>
<div class='msg reply'><time>2024-09-17 15:17</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: It&#x27;s intentional that there are no extension nodes. The keys are all hashes and so it isn&#x27;t expected that there will be long common prefixes. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-17 15:29</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I see ! I&#x27;m definitely not a database expert but doesn&#x27;t it mean we&#x27;ll have at least 512 jumps in the db  </div>
<div class='msg reply'><time>2024-09-18 01:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@celadari:matrix.org&gt; I see ! I&#x27;m definitely not a database expert but doesn&#x27;t it mean we&#x27;ll have at least 512 jumps in the db  

Only if it is implemented in the least optimal way. </div>
<div class='msg'><time>2024-09-17 16:08</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: Hello, some question about 4 Invocation function entry points:

As GP mentioned, the four entry points (0 (isAuthorized), 5 (Refine), 10 (Accumulate) and 15 (OnTransfer)) will pass through Ψ M -&gt; Ψ H -&gt; Ψ -&gt; Ψ 1.

My question is: What is the relationship between these four entry points and the PVM&#x27;s instruction counter? Will these different entry points affect the PVM&#x27;s instruction counter? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-18 01:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The instruction counter is initialised with the entry point. </div>
<div class='msg'><time>2024-09-18 02:50</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: &gt; &lt;@gav:polkadot.io&gt; The instruction counter is initialised with the entry point.

Why initialize the instruction counter with the entry point? 
Does it mean that different invocation functions execute different parts of the instruction data (bold C in GP(218))?</div>
<div class='msg'><time>2024-09-18 02:50</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The entry point <em>is</em> the instruction counter.</div>
<div class='msg'><time>2024-09-18 02:51</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: e.g. for refine you set the instruction pointer to 5 and start execution from there</div>
<div class='msg'><time>2024-09-18 02:57</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: To give more backround on this: the way this will work <em>in practice</em> is that the program will have 4 unconditional jump instructions at the very start, and the first 3 of those instructions will be encoded in such a way as to be padded and always take up 5 bytes of space. Hence the entry points of 0, 5, 10 and 15. This design allows for hardcoded addresses for each of the entry points without having to specify them dynamically anywhere in the protocol.</div>
<div class='msg'><time>2024-09-18 03:03</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: (And just to be clear in case it isn&#x27;t obvious: as a PVM implementation you don&#x27;t and shouldn&#x27;t care about this, and this shouldn&#x27;t be handled in any special way on the VM level. You&#x27;re supposed to set your instruction counter to the hardcoded address of the entry point, and just start execution from there, regardless of what exactly happens to be there. The fact that there will be usually unconditional jump instructions there is just an implementation detail, and is not in any way required by the GP.)</div>
<div class='msg'><time>2024-09-18 12:49</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I believe i found some error in the pvm appendix. 

- <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmIiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFtdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmIiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFtdXQ==</a> it says <code>bold A</code>.
- i belive this is <code>A</code> set which is the ServiceAccount defined in (89) <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMTAiLCJTZXJ2aWNlIEFjY291bnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGYgaDYgeTZmNyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHhmIGg2IHk2ZjcgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMTAiLCJTZXJ2aWNlIEFjY291bnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGYgaDYgeTZmNyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHhmIGg2IHk2ZjcgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=</a>
- to confirm this i looked at <code>bold X</code> which is defined at 254 and <code>x_s</code> is being used in 257 for example for the <code>omega w</code>
- if ^ is correct then <code>omega_w</code> or the <code>write</code>function states that i should compare <code>a_t</code> and <code>a_b</code> but there is no <code>_t</code>in the ServiceAccount set.  </div>
<div class='msg'><time>2024-09-18 13:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes it should read blackboard A</div>
<div class='msg'><time>2024-09-18 13:28</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@gav:polkadot.io&gt; Yes it should read blackboard A

what about the subscribpted t ?</div>
<div class='msg'><time>2024-09-18 14:07</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmMiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE1YSBoYiB5MTlmNCBmZjE2IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4NWYgaGQgeTE5ZjYgZmYxOCBmczUgZmMwIHNjMCBsczAgd3MwXCI+Il1d" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmMiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE1YSBoYiB5MTlmNCBmZjE2IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4NWYgaGQgeTE5ZjYgZmYxOCBmczUgZmMwIHNjMCBsczAgd3MwXCI+Il1d</a></div>
<div class='msg'><time>2024-09-18 14:08</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: same goes for <code>t_t</code> in the fn below</div>
<div class='msg'><time>2024-09-18 14:32</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: it could be the threshold balance <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMTEiLCJTZXJ2aWNlIEFjY291bnRzIiwiQWNjb3VudCBGb290cHJpbnQgYW5kIFRocmVzaG9sZCBCYWxhbmNlIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMiBoNiB5NzlhIGZmNyBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeGYgaDYgeTc5YyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMTEiLCJTZXJ2aWNlIEFjY291bnRzIiwiQWNjb3VudCBGb290cHJpbnQgYW5kIFRocmVzaG9sZCBCYWxhbmNlIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMiBoNiB5NzlhIGZmNyBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeGYgaDYgeTc5YyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==</a></div>
<div class='msg'><time>2024-09-18 14:49</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: oooh</div>
<div class='msg'><time>2024-09-18 14:49</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@qiwei:matrix.org&gt; it could be the threshold balance <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMTEiLCJTZXJ2aWNlIEFjY291bnRzIiwiQWNjb3VudCBGb290cHJpbnQgYW5kIFRocmVzaG9sZCBCYWxhbmNlIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMiBoNiB5NzlhIGZmNyBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeGYgaDYgeTc5YyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMTEiLCJTZXJ2aWNlIEFjY291bnRzIiwiQWNjb3VudCBGb290cHJpbnQgYW5kIFRocmVzaG9sZCBCYWxhbmNlIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHgxMiBoNiB5NzlhIGZmNyBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeGYgaDYgeTc5YyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==</a>

that is definetely it thanks</div>
<div class='msg'><time>2024-09-19 07:44</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmQiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGE2IGhiIHkxYWEzIGZmMTYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHhmZCBoZCB5MWFhNCBmZjE4IGZzNSBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmQiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGE2IGhiIHkxYWEzIGZmMTYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHhmZCBoZCB5MWFhNCBmZjE4IGZzNSBmYzAgc2MwIGxzMCB3czBcIj4iXV0=</a> is this correct? i am referring to the 176 offset/length the validator data should be 336 bytes long. 

</div>
<div class='msg'><time>2024-09-19 09:45</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: is <code>m</code> of deferred transfer Y\_64 or Y\_128? i ask because in 12.4 the text reads <code>a memo component m of 64 octets</code> but then its defined as <code>m ∈ YM</code> (161) and <code>M</code> is equal to 128 in the appendix.

What is even more interesting is that the <code>ΩT</code> fn on p.45 says we should deserialize a <code>M</code> long octet sequence into a <code>T</code>value. So my guess is that the (161) is wrong.

Assuming <code>m</code> is Y64 then deserializing <code>T</code> means that 128-64 octets must be used to get the other elements in <code>T</code> (<code>s</code>, <code>d</code>, <code>a</code>, <code>g</code>). but even if all of them were 8 octets that would mean that we&#x27;re left with 32 extra octets. so I&#x27;m a bit lost <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-20 02:24</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: How does Coreplay, with its stop-freeze-registers-resume pattern fit into JAM?

This would be the major &quot;feature request&quot;,  in addition to:

- connecting JAM back into Polkadot&#x27;s { Staking, Coretime, and Asset Hub } system chains
- getting complete about the rewards/punishment for guaranteeing/auditing/...
- JAMNP
- getting clear about how the (refineless) privileged services work from a user point of view

I hope by Strongly Web3&#x27;s &quot;equidistant from all teams&quot; principle, we can have multiple teams (3+) undergoing audits and not just PolkaJAM in the Q2 timeframe =). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-20 07:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: sourabhniyogi: I am happy to field specific questions on interpretation of the Gray paper. I am not happy to be managed.</div>
<div class='msg'><time>2024-09-20 07:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If you persist with this attitude, I **will ban you**. </div>
<div class='msg'><time>2024-09-20 07:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; <a href="https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmQiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGE2IGhiIHkxYWEzIGZmMTYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHhmZCBoZCB5MWFhNCBmZjE4IGZzNSBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyI3YWU1MWY5MzI1IiwiMmQiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGE2IGhiIHkxYWEzIGZmMTYgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHhmZCBoZCB5MWFhNCBmZjE4IGZzNSBmYzAgc2MwIGxzMCB3czBcIj4iXV0=</a> is this correct? i am referring to the 176 offset/length the validator data should be 336 bytes long.

Correct - that should be 336. Will be corrected.</div>
<div class='msg'><time>2024-09-20 08:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; is <code>m</code> of deferred transfer Y\_64 or Y\_128? i ask because in 12.4 the text reads <code>a memo component m of 64 octets</code> but then its defined as <code>m ∈ YM</code> (161) and <code>M</code> is equal to 128 in the appendix.
&gt; 
&gt; What is even more interesting is that the <code>ΩT</code> fn on p.45 says we should deserialize a <code>M</code> long octet sequence into a <code>T</code>value. So my guess is that the (161) is wrong.
&gt; 
&gt; Assuming <code>m</code> is Y64 then deserializing <code>T</code> means that 128-64 octets must be used to get the other elements in <code>T</code> (<code>s</code>, <code>d</code>, <code>a</code>, <code>g</code>). but even if all of them were 8 octets that would mean that we&#x27;re left with 32 extra octets. so I&#x27;m a bit lost

That was a typo in the text: where it reads 64 should read 128 and is fixed in the next release. The other points are invalid. The dererialization you refer to is moot (I have since removed the function as it&#x27;s a no-op here), and &quot;deserializes&quot; only the memo data. The other fields of the record are provided elsewhere.</div>
<div class='msg'><time>2024-09-20 13:50</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@gav:polkadot.io&gt; That was a typo in the text: where it reads 64 should read 128 and is fixed in the next release. The other points are invalid. The dererialization you refer to is moot (I have since removed the function as it&#x27;s a no-op here), and &quot;deserializes&quot; only the memo data. The other fields of the record are provided elsewhere.

thanks</div>
<div class='msg'><time>2024-09-22 21:18</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2024-09-22 at 22.17.56.png</div>
<div class='msg'><time>2024-09-22 21:19</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: What is the meaning of av[c] here? As far as I understood, av is an integer. 

I interpret it as the core associated with validator in index av. But I am not sure the formula is accurate to the meaning.</div>
<div class='msg'><time>2024-09-22 21:32</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I think I found the answer: it should be af, not av, right? </div>
<div class='msg'><time>2024-09-23 06:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Cannot see the image - please provide a link using <a href="https://graypaper.fluffylabs.dev/" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/</a> or an equation number along with a GP version. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-23 06:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ahh - I think I see; yes, a\_v should be a\_f in two of the equations. This is fixed in <a href="https://github.com/gavofyork/graypaper/pull/77" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/77</a> and will be in the next release. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-23 06:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: On that note, 0.3.8 is tagged and released: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.8" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.3.8</a></div>
<div class='msg'><time>2024-09-23 08:49</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Should Formula  (128) 

af[c] ⇒ ρ†[c]≠∅

be 

af[c] ⇔ ρ†[c]≠∅

?</div>
<div class='msg'><time>2024-09-23 09:25</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Another doubt: What does H(Hp, af) means in formula 126? H function should take only one argument, no?</div>
<div class='msg'><time>2024-09-23 10:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; Should Formula  (128) 
&gt; 
&gt; af[c] ⇒ ρ†[c]≠∅
&gt; 
&gt; be 
&gt; 
&gt; af[c] ⇔ ρ†[c]≠∅
&gt; 
&gt; ?

No. </div>
<div class='msg'><time>2024-09-23 10:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: H is assumed to encode any arguments give prior to hashing. Multiple arguments are treated as tuples.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-23 14:17</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: &gt; &lt;@gav:polkadot.io&gt; H is assumed to encode any arguments give prior to hashing. Multiple arguments are treated as tuples.

Just to make sure I understood correctly:

af is a binary string of 341 elements (e.g. represented in programming languages as an array of integers). It is not clear to me how should we hash this tuple. There is no clear definition of how to Hash a tuple in the GP. H(m ∈ Y)
 
Should I assume: concat the Hp binary with the 0 and 1 af array and then Hash the result of this concatenation?</div>
<div class='msg'><time>2024-09-23 17:58</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: After implementing the codec functions, I noticed that there is already a crate <a href="https://github.com/paritytech/parity-scale-codec" target="_blank" rel="noopener">parity-scale-codec</a>. Does this crate have the same encode implementations as the GP codec functions? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-23 19:37</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: After implementing the codec functions, I noticed that there is already a crate <a href="https://github.com/paritytech/parity-scale-codec" target="_blank" rel="noopener">parity-scale-codec</a>. Does this crate have the same encode implementations as the GP codec functions?</div>
<div class='msg reply'><time>2024-09-23 19:59</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: There are some similarities, but nope. AFAIR SCALE was initially mentioned in the Gray Paper (and is mentioned on the JAM prize website), but it is no longer. Main difference is the variable-length encoding of numbers. </div>
<div class='msg reply'><time>2024-09-23 22:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (Updated my JAM prize page to remove reference to SCALE.)</div>
<div class='msg reply'><time>2024-09-23 22:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: FWIW the only difference between SCALE and JAM&#x27;s serialization codec is in treatment of compact integers.</div>
<div class='msg'><time>2024-09-23 22:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There&#x27;s a lot of programming languages in the world. I&#x27;d avoid trying to make blanket statements about them. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-23 22:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As I wrote:

&gt; H is assumed to encode any arguments give prior to hashing. Multiple arguments are treated as tuples. </div>
<div class='msg'><time>2024-09-23 22:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The GP defines how to encode tuples and how to hash octet-sequences. </div>
<div class='msg'><time>2024-09-23 22:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And please note that no &quot;assumptions&quot; are needed. This is all detailed in the GP: <a href="https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiNyIsIk5vdGF0aW9uYWwgQ29udmVudGlvbnMiLCJDcnlwdG9ncmFwaHkiLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE1IGhiIHkyMzcgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MTUgaDYgeTIzYSBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiNyIsIk5vdGF0aW9uYWwgQ29udmVudGlvbnMiLCJDcnlwdG9ncmFwaHkiLFsiPGRpdiBjbGFzcz1cInQgbTAgeDE1IGhiIHkyMzcgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MTUgaDYgeTIzYSBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==</a></div>
<div class='msg'><time>2024-09-24 02:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: To avoid further confusion I&#x27;ll make it even more explicit with the sentence:

&gt; The inputs of a hash function should be expected to be passed through our serialization codec $\mathcal{E}$ to yield an octet sequence to which the cryptography may be applied. </div>
<div class='msg'><time>2024-09-24 02:58</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: GP defines BLS pubkey to be 144 bytes but it seems like the BLS pubkey is usually 48 bytes?</div>
<div class='msg'><time>2024-09-24 03:00</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: which function should be used for the pubkey serialization? <a href="https://github.com/supranational/blst/blob/6f3136ffb636974166a93f2f25436854fe8d10ff/bindings/blst.h#L303" target="_blank" rel="noopener">https://github.com/supranational/blst/blob/6f3136ffb636974166a93f2f25436854fe8d10ff/bindings/blst.h#L303</a></div>
<div class='msg'><time>2024-09-24 03:04</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: seems like the raw type (<code>blst_p1</code>) is 144 bytes but that should be internal details</div>
<div class='msg'><time>2024-09-24 07:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@xlchen:matrix.org&gt; GP defines BLS pubkey to be 144 bytes but it seems like the BLS pubkey is usually 48 bytes?

<a href="https://matrix.to/#/@davxy:matrix.org" target="_blank" rel="noopener">@davxy:matrix.org</a>?</div>
<div class='msg'><time>2024-09-24 08:59</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: The public key for the scheme consists of two public elements, each corresponding to one of the two groups used by BLS for pairing: G1 and G2. Specifically, it is represented as (g1 <em> sk, g2 </em> sk), where g1 is the generator of G1 and g2 is the generator of G2. Each point in G1 is compressed into 48 bytes, while each point in G2 is compressed into 96 bytes. This scheme allows for fast verification of aggregate signatures (which are very useful for bridges). In particular the G1 component allows for aggregate signature correctness verification without the need for N expensive pairings, with N the number of aggregated signatures. The full scheme is detailed in this paper: <a href="https://eprint.iacr.org/2022/1611" target="_blank" rel="noopener">https://eprint.iacr.org/2022/1611</a> and is implemented by this library: <a href="https://github.com/w3f/bls." target="_blank" rel="noopener">https://github.com/w3f/bls.</a> The authors of the paper are jeff  Syed Alistair and Oana Ciobotaru <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-24 09:02</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I see. I guess I should switch from using blst to w3f/bls</div>
<div class='msg'><time>2024-09-24 15:07</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: I have a doubt; in A.1, we define the program blob <code>p</code> (octects containing instructions <code>c</code>, bitmask <code>k</code> and jump <code>j</code>).

Then in A.7 we say &quot;We thus define the standard program code format p, which includes not only the instructions and jump table (pre-
viously represented by the term c), but ...&quot;

This I think it is wrong since we already defined <code>p</code> as the combination of <code>c</code>, <code>k</code> and <code>j</code>; the term <code>c</code> previously indicates only the instruction data.</div>
<div class='msg'><time>2024-09-24 16:45</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Would it make sense to maintain an extended recent block history for checking prerequisite WP hashes? As it stands, a work package can have a recent enough anchor block to in theory be reportable, but not actually be reportable because the reporting of its prerequisite WP has been forgotten about. A WP with a prerequisite essentially has a shorter lifetime than other WPs because of this.</div>
<div class='msg'><time>2024-09-25 02:17</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: Screenshot 2024-09-25 at 2.17.13 PM.png</div>
<div class='msg'><time>2024-09-25 02:18</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: isn&#x27;t this a circular dependency? The sealing key depends on unsigned block, but it includes Hv, and Hv depends on the VRF output of Hs?</div>
<div class='msg reply'><time>2024-09-25 06:17</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I think you first generate the anonymous VRF (with ring root) as a ticket submitter - you don&#x27;t need aux for that: only context.

This anonymous VRF happens to be equal to Y(H_s). You compute a signature H_v and then you compute H_s.

Everything I said is you as a block author. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-25 08:26</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: thanks. that make sense</div>
<div class='msg reply'><time>2024-09-25 08:39</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: how about the fallback case?</div>
<div class='msg reply'><time>2024-09-25 09:04</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I think you generate Y(H\_s) as a normal VRF using the context X\_F ++ eta\_3: anonymous and non-anonymous method give same VRF so here you can use whichever you want. You don&#x27;t need aux for VRF output: just the context.

You then compute signature H\_v and then you compute signature H\_s.

Again, everything I said is you as a block author.

If someone can confirm what I said it would be nice <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-25 02:20</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: or does the message (encoded unsigned block) won&#x27;t impact the VRF output? so I can pass empty data when calculating the VRF output?</div>
<div class='msg'><time>2024-09-25 15:41</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: I confirm.
Y(H_s) can also be generated independently from the signature (you just need the context). That is what breaks the cyclic dep.
</div>
<div class='msg'><time>2024-09-25 15:44</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: <a href="https://github.com/davxy/bandersnatch-vrfs-spec/blob/8c82722a8e9a29df7f7aca7e3c25aa1bef0c2409/assets/example/src/main.rs#L71" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/blob/8c82722a8e9a29df7f7aca7e3c25aa1bef0c2409/assets/example/src/main.rs#L71</a></div>
<div class='msg'><time>2024-09-25 15:45</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Y is then the output point hash. See here:

<a href="https://github.com/davxy/bandersnatch-vrfs-spec/blob/8c82722a8e9a29df7f7aca7e3c25aa1bef0c2409/assets/example/src/main.rs#L198" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/blob/8c82722a8e9a29df7f7aca7e3c25aa1bef0c2409/assets/example/src/main.rs#L198</a></div>
<div class='msg'><time>2024-09-27 22:34</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: A few questions regarding audit announcement statements (<a href="https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMWIiLCJBdWRpdGluZyBhbmQgSnVkZ2luZyIsIlNlbGVjdGlvbiBvZiBSZXBvcnRzIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHhiYyBoMTAgeWVjYiBmZjEwIGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MTFmIGhiIHllY2IgZmYxNiBmczAgZmMwIHNjMCBsczAgd3MwXCI+Il1d):" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMWIiLCJBdWRpdGluZyBhbmQgSnVkZ2luZyIsIlNlbGVjdGlvbiBvZiBSZXBvcnRzIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHhiYyBoMTAgeWVjYiBmZjEwIGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4MTFmIGhiIHllY2IgZmYxNiBmczAgZmMwIHNjMCBsczAgd3MwXCI+Il1d):</a>

1. Is the H(w) intended to mean the hash of the work report? It looks like the wrong font has been used
2. Is a\_0 intended to read a\_n instead?
3. Is it intended that announcement statements do not include eg the hash of the block that is being audited? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-28 02:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. Yes. 
2. Yes. 
3. No - the GP describes the signed material, but other data may be passed in addition for context. The signed material itself doesn’t need the block hash.  <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-30 14:33</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Re (3), because the block&#x27;s hash is not included in the signed data, it doesn&#x27;t seem unlikely that an announcement intended for a block on one fork could be fiddled with and then used in the context of a block on a different fork? Maybe this is not a problem but that is not clear to me</div>
<div class='msg reply'><time>2024-09-30 16:40</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: One more question on this... AFAICT, as currently specified, auditing of a block is performed by the prior validator set rather than the posterior validator set. This seems a bit odd, given that eg the availability assurance stuff uses the posterior validator set. Wondering if this is intentional or if it was simply missed when lots of things were changed to use posterior state?</div>
<div class='msg reply'><time>2024-09-30 22:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: They’re two very different processes - auditing is entirely off-chain, recorded publicly only through grandpa; assurance is recorded on-chain - so I wouldn’t draw any conclusions about one from the other.  <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-09-30 22:47</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Well auditors may request shards from assurers. If they&#x27;re always the same set you might for example only service shard requests if you have seen an appropriate audit announcement first (not sure if this would be sensible)</div>
<div class='msg'><time>2024-09-30 02:49</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: <a href="https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMmUiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGMzIGhiIHkxYzMyIGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDE2OCBoYiB5MWMzMiBmZjE2IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMmUiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGMzIGhiIHkxYzMyIGZmZiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDE2OCBoYiB5MWMzMiBmZjE2IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=</a>
just want to confirm, should it be <code>w &amp;lt; t - D</code> for this case?</div>
<div class='msg'><time>2024-09-30 04:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No - it is correct as it is. </div>
<div class='msg'><time>2024-09-30 04:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Note that the syntax in the preceding portion is the little-used numeric tuple subscript (the subscript “2”). I intend to remove this syntax in an upcoming revision. Instead the entire term “(x_s)_l[h,z]_2” can simply be replaced with“w”. </div>
<div class='msg'><time>2024-09-30 07:36</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: Graypaper releases with black backgrounds remain a pain point for me personally. Does anyone have a convenience download of the 0.3.8 release without the background and with black text? For a while these were available for download on the Graypaper site in the resources section.</div>
<div class='msg reply'><time>2024-09-30 07:39</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: <a href="https://jamcha.in/spec" target="_blank" rel="noopener">https://jamcha.in/spec</a> you can download light version here</div>
<div class='msg reply'><time>2024-09-30 07:40</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: great thanks hadn&#x27;t noticed that yet :)</div>
<div class='msg reply'><time>2024-09-30 12:38</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Great thanks as well</div>
<div class='msg'><time>2024-09-30 17:03</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Question about <a href="https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMzEiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeGYgaDYgeTFlNTAgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iLCI8ZGl2IGNsYXNzPVwidCBtMCB4ZjEgaGIgeTFlNTAgZmY3IGZzMCBmYzAgc2MwIGxzMCB3czBcIj4iXV0=" target="_blank" rel="noopener">Discriminator Encoding (275)</a> Must it support encoding sequences of several types? e.g., [u32, u8, i64, u16...]</div>
<div class='msg'><time>2024-09-30 22:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Sequences are generally drawn from the same type. </div>
<div class='msg'><time>2024-09-30 22:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But regardless, even if they were not it would not alter anything in the spec. </div>
<div class='msg'><time>2024-09-30 22:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: David Emett: There is not really the prior/posterior difference for auditing as it&#x27;s a fully off-chain process. With assurance, you actually check signatures on-chain, so you need to select which of the two sets those sigs refer to. Auditing doesn&#x27;t happen inside a block. No audit signatures are routinely checked on-chain (judgements are the exception, and these are intentionally drawn from the prior set). Auditing happens _between_ blocks. So there really isn&#x27;t a prior or posterior. There&#x27;s just the &quot;current&quot; validator key set. I suppose that could be phrased as the posterior of the block associated with the timeslot at the point that the auditing process began. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 22:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The slight annoyance for clients is that there may be several forks. </div>
<div class='msg'><time>2024-09-30 22:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So clients need to track all forks and do all audits of those forks where they are in the resultant (i.e. posterior) set.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 23:14</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: AIUI auditing happens in the context of a block, and this block has a prior validator set and a posterior validator set. We presumably need to pick one of these to be the validator set that is expected to audit the block? I don&#x27;t understand how you could just use the &quot;current&quot; validator set as (a) there is no consensus over this and (b) auditing is stateful and thus we presumably need the same validator set throughout the whole auditing process for a block?</div>
<div class='msg'><time>2024-09-30 23:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So both auditing and block STF happen in the context of some pre-existing chain-head and its implied (posterior) state. In the context of the the block STF (which essentially validates a candidate child-block and determines the implied (posterior) state), then we now have two states - the old implied state and the new implied state. I call these two the prior and the posterior, since one is the state before the STF and the other is after the effects of the STF. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 23:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Auditing is not an STF.</div>
<div class='msg'><time>2024-09-30 23:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There is only one state to consider: the former. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 23:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Now, depending on how you argue, this could be named the prior or the posterior. But the reality is that neither name is sensible. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 23:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: AFAIK I never actually specify either term in the section on auditing (nor should I have). I guess the confusion comes from the fact that I didn&#x27;t suffix kappa with a prime. But this wouldn&#x27;t make sense since there is no concept of a non-prime kappa here.</div>
<div class='msg'><time>2024-09-30 23:25</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: <a href="https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMWIiLCJBdWRpdGluZyBhbmQgSnVkZ2luZyIsIlNlbGVjdGlvbiBvZiBSZXBvcnRzIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHhmIGg2IHk3YyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHhmIGg2IHk3ZiBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMWIiLCJBdWRpdGluZyBhbmQgSnVkZ2luZyIsIlNlbGVjdGlvbiBvZiBSZXBvcnRzIixbIjxkaXYgY2xhc3M9XCJ0IG0wIHhmIGg2IHk3YyBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiIsIjxkaXYgY2xhc3M9XCJ0IG0wIHhmIGg2IHk3ZiBmZjcgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==</a></div>
<div class='msg'><time>2024-09-30 23:26</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You state here that the terms are in the context of the block that is being audited, so sigma prime is the posterior state for example</div>
<div class='msg'><time>2024-09-30 23:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah fair enough - that part is wrong.</div>
<div class='msg'><time>2024-09-30 23:26</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: This seems sensible to me</div>
<div class='msg'><time>2024-09-30 23:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It should read as what I wrote above.</div>
<div class='msg'><time>2024-09-30 23:28</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Particularly given that you use for example bold W to refer to the accumulated reports, which is defined in terms of prior state and the extrinsic</div>
<div class='msg'><time>2024-09-30 23:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So basically replacing

&gt; assume ourselves focused on some block B with other terms corresponding, so σ′ is said block’s posterior state, H is its header &amp;c.

with

&gt; assume ourselves focused on the most recent implied state of the chain, σ. The header of the most recent block of the chain is assumed as H. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 23:29</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: It would seem odd to say that &quot;non-prime&quot; names actually refer to items in the posterior state of the block <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 23:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;ll make it explicit.</div>
<div class='msg'><time>2024-09-30 23:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But using prime doesn&#x27;t make sense here for the reasons I mention above.</div>
<div class='msg'><time>2024-09-30 23:42</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not sure I agree. But in any case, if we agree that the validator set which should audit a block is the validator set in the state after the block has been executed, then I&#x27;m happy <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 23:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ok - I notice that we need to draw upon the prior of rho in order to describe work-reports which became available during the block. So it&#x27;s going to be convenient (indeed, pretty much necessary) to have both prior and posterior even though auditing _per se_ doesn&#x27;t impact their relationship. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-09-30 23:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So we&#x27;ll keep it as-is and I&#x27;ll add some clarifying text and a prime to kappa.</div>
<div class='msg'><time>2024-09-30 23:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: David Emett  <a href="https://github.com/gavofyork/graypaper/pull/90" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/90</a></div>
<div class='msg reply'><time>2024-10-01 00:35</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: LGTM. Getting back to the original question, should the \kappa bits be \kappa&#x27;?</div>
<div class='msg reply'><time>2024-10-01 04:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I think kappa’ makes more sense yes. That&#x27;s now in the PR.</div>
<div class='msg'><time>2024-10-01 03:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I think kappa’ makes more sense yes. That&#x27;s now in the PR. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-01 12:26</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: What are the default values for GA, GI and GR? BTW, if I am not wrong, GR is not used anywhere in the GP
<a href="https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiM2IiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDExNSBoZSB5ZTUgZmYyMiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDFmIGg2IHliMiBmZjEgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiM2IiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFsiPGRpdiBjbGFzcz1cInQgbTAgeDExNSBoZSB5ZTUgZmYyMiBmczAgZmMwIHNjMCBsczAgd3MwXCI+IiwiPGRpdiBjbGFzcz1cInQgbTAgeDFmIGg2IHliMiBmZjEgZnMwIGZjMCBzYzAgbHMwIHdzMFwiPiJdXQ==</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-01 14:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 0, 0, 0</div>
<div class='msg'><time>2024-10-01 14:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This will be detailed more properly in 0.4 series <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-04 08:47</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-10-04 09:38</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: shouldnt this be <code>Y</code> ?

<a href="https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMTgiLCJXb3JrIFBhY2thZ2VzIGFuZCBXb3JrIFJlcG9ydHMiLCJQYWNrYWdlcyBhbmQgSXRlbXMiLFtdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMTgiLCJXb3JrIFBhY2thZ2VzIGFuZCBXb3JrIFJlcG9ydHMiLCJQYWNrYWdlcyBhbmQgSXRlbXMiLFtdXQ==</a></div>
<div class='msg'><time>2024-10-04 10:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Shouldn&#x27;t what be <code>Y</code>? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-04 11:06</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@gav:polkadot.io&gt; Shouldn&#x27;t what by <code>Y</code>?

sorry (181) the return should by a sequence of <code>Y</code> imho as the output of <code>zeroPad</code> (P) does not guarantuee size output</div>
<div class='msg'><time>2024-10-07 07:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Zeropad function guarantees that the output is an integer multiple of the subscript (l = W_S.W_E, the length of a single segment in bytes). In this case the zeropad function just has the effect of padding the segment to exactly this size (blackboard Y_l === blackboard G) since its input is always greater than zero and never bigger than a segment.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-07 07:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-10-07 11:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.3.9" target="_blank" rel="noopener">GP v0.3.9 is released</a></div>
<div class='msg'><time>2024-10-07 11:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Expect 0.4.0 to come soon with #78 merged.</div>
<div class='msg'><time>2024-10-08 13:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.4.0" target="_blank" rel="noopener">GP v0.4.0 is released</a>

This includes the rather large change, <a href="https://github.com/gavofyork/graypaper/issues/57" target="_blank" rel="noopener">Ordered Accumulation</a>. </div>
<div class='msg'><time>2024-10-08 13:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The <code>bits</code> function for building tree nodes is now MSB-first and the PVM spec has several fixes as well as a fair amount of restructuring needed for OrdAcc. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-08 13:04</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: </div>
<div class='msg'><time>2024-10-08 13:04</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: <a href="https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMzAiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFtdXQ==" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#WyIzODcxMDNkODIzIiwiMzAiLCJBY2tub3dsZWRnZW1lbnRzIixudWxsLFtdXQ==</a>

that &quot;i&quot; should be &quot;l&quot;? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-08 13:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; that &quot;i&quot; should be &quot;l&quot;?

Please link to GPreader - images don&#x27;t seem to work on this server</div>
<div class='msg'><time>2024-10-09 09:04</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: was looking at 0.4.0 i noticed that the isAuthorized invocation&#x27;s F function at 267 should &quot;return&quot; 2 registers .

it was like this even in 0.3.8 but i believe it is atypo. <code>F</code> should return **all** registers considering is being used by <code>ΨM</code> and <code>ΨH</code> which uses <code>F</code> to builld <code>ω&amp;#x27;&amp;#x27;</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-09 09:05</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: same goes for the number of input registers. shouldnt that be 13?</div>
<div class='msg'><time>2024-10-09 09:06</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: side note: if i am wrong then why/what is the expected output is <code>n != gas</code> ? i see <code>w_8</code> is now being used</div>
<div class='msg'><time>2024-10-09 09:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Planned changes for 0.5 will be comparatively minor and very much directed towards tweaking and optimization:
- Post-Accumulate Preimage Integration
- Extrinsic Commitment should be hash of hashes
- 64-bit PVM</div>
<div class='msg'><time>2024-10-09 09:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; same goes for the number of input registers. shouldnt that be 13?

Yes, this is an old typo and will be corrected in 0.4.1</div>
<div class='msg'><time>2024-10-09 09:44</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@gav:polkadot.io&gt; Yes, this is an old typo and will be corrected in 0.4.1

thanks for confirming, then... is w_8 value to be placed in w_1 and the rest set to zero?</div>
<div class='msg'><time>2024-10-09 09:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: w\_1 isn&#x27;t used any more. (it was also a typo from when the register sets were limited to the argument/return value registers) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-09 09:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 0.4.1 is on its way with these fixes.</div>
<div class='msg'><time>2024-10-09 09:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Released GP <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.4.1" target="_blank" rel="noopener">v0.4.1</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-09 13:04</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: on (275) am I wrong or all <code>bold o</code> should be <code>bold u</code>? </div>
<div class='msg'><time>2024-10-09 13:07</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: same goes with (280) </div>
<div class='msg'><time>2024-10-09 13:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg'><time>2024-10-09 13:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: ^ here?</div>
<div class='msg'><time>2024-10-09 13:08</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: the one below</div>
<div class='msg'><time>2024-10-09 13:08</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: <code>I</code></div>
<div class='msg'><time>2024-10-09 13:08</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: i&#x27;m looking at 0.4.1</div>
<div class='msg'><time>2024-10-09 13:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: ahh yes</div>
<div class='msg'><time>2024-10-09 13:09</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: since you might be there gav  you might also want to check the first case of <code>C</code> (279) and (280) &gt; <code>check fn</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-09 13:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: First case of C seems fine</div>
<div class='msg'><time>2024-10-09 13:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <code>check</code> is corrected in <a href="https://github.com/gavofyork/graypaper/pull/99" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/99</a></div>
<div class='msg'><time>2024-10-09 15:53</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: quick question, Initially i thought it was a typo but I am now sure i am missing something, what is <code>_t</code> in relation to a service account?

for example in the <code>new</code> accumulate function both <code>bold s</code> and <code>bold a</code> reference this <code>_t</code>  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-09 15:56</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: as well as <code>(X_{bold s})_t</code> in the first matching case of <code>new</code> </div>
<div class='msg'><time>2024-10-09 17:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Threshold balance.</div>
<div class='msg'><time>2024-10-09 19:18</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: hi there! we&#x27;ve just deployed a new version of the GP Reader. It has much shorter links and displays notes as annotations on the document itself. If you run into any issues please let us know on github. The GP is also updated to the latest 0.4.1 released earlier today.</div>
<div class='msg'><time>2024-10-10 06:50</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: gav: in your opinion what are the parts of the paper that you consider almost &quot;written on stone&quot; (or at least enough solid to be considered almost ready)?</div>
<div class='msg'><time>2024-10-10 06:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Nothing is likely to change very much now. Safrole might not change at all.</div>
<div class='msg'><time>2024-10-10 06:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s hard to see what will need to be tweaked until we begin actually testing and benchmarking. </div>
<div class='msg'><time>2024-10-10 06:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But beyond the issues already in the GP repo and its readme, there’s nothing on my mind which needs altering. </div>
<div class='msg'><time>2024-10-10 10:21</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: <a href="https://graypaper.fluffylabs.dev/#/c71229b/2e20012e2301" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/2e20012e2301</a> 
 gav we are replacing X.c here, but c is not present in the ResultContext definition 272 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-10 11:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; <a href="https://graypaper.fluffylabs.dev/#/c71229b/2e20012e2301" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/2e20012e2301</a> 
&gt;  gav we are replacing X.c here, but c is not present in the ResultContext definition 272

yeah that&#x27;s a rename issue.</div>
<div class='msg'><time>2024-10-10 11:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: fixed in <a href="https://github.com/gavofyork/graypaper/pull/99/commits/fd7aee1ab73dbc16271f8136fe671cf42cc61725" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/99/commits/fd7aee1ab73dbc16271f8136fe671cf42cc61725</a> (will be in 0.4.2) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-10 12:57</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: Hi everyone, we noticed that the polkavm rust implementation charges 1 extra gas when load/store fails with out of bounds error, however we couldn’t find this described in the graypaper, is this expected behaviour?</div>
<div class='msg reply'><time>2024-10-10 13:01</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Do you mean that there is extra gas charged on top of the 1 gas that the instruction costs normally?

If so then that&#x27;s a bug. Nevertheless, it doesn&#x27;t really matter what PolkaVM does here. PolkaVM is <em>not</em> a reference implementation of the GP; it&#x27;s just <em>an</em> implementation, so you need to remember that just because PolkaVM does something it doesn&#x27;t mean it&#x27;s correct. :P</div>
<div class='msg reply'><time>2024-10-10 13:18</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: I understand, I was asking this because there is a PR for the <a href="https://github.com/w3f/jamtestvectors/pull/3" target="_blank" rel="noopener">jamtestvectors</a> and as I can see these are based the PolkaVM implementation, so we are also trying to validate our implementation agains these tests</div>
<div class='msg reply'><time>2024-10-10 13:20</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Ah, okay.</div>
<div class='msg reply'><time>2024-10-10 13:20</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: in this case I assume a more appropriate place to ask this would be in the PR itself :) <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-10 13:20</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: In that case this is expected behavior.</div>
<div class='msg reply'><time>2024-10-10 13:21</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The gas cost model in general is still a work-in-progress, so this is not specced in the GP yet (nor it should be considered final behavior), however the reason you&#x27;re seeing 1 extra gas being charged there is because we charge gas on an entry to a basic block, and not per instruction.</div>
<div class='msg reply'><time>2024-10-10 13:22</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Basically, for efficiency&#x27;s sake what we do is we calculate the gas cost for the whole basic block, and charge the whole cost at the start.</div>
<div class='msg reply'><time>2024-10-10 13:22</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: And in that particular test case you have a load/store instruction in the middle of a basic block, so the execution gets interrupted.</div>
<div class='msg reply'><time>2024-10-10 13:23</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: But since we&#x27;ve already entered the basic block the gas was already charged, as if the _whole_ basic block was executed. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-10 13:25</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: So charging the gas at the start of basic blocks allows us to do two things: 1) be more efficient (charging gas on each executed instruction is expensive), and 2) it should allow us to have a better gas cost model which will also take the dependencies between the instructions into account instead of only assigning static costs to each instruction in isolation</div>
<div class='msg reply'><time>2024-10-10 13:34</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: oh I see, thanks for explaining, that&#x27;s what I needed to know. So charging for the whole block even though it is probably not going to be fully executed is what we actually want, is this behaviour going to be described in the gray paper eventually?</div>
<div class='msg reply'><time>2024-10-10 13:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The behaviour will be fully described, but for now we will be removing these non-concordant test instances.</div>
<div class='msg'><time>2024-10-10 13:35</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: I&#x27;m a bit confused about this list indexing notation, where a dot is used. I&#x27;ve found this notation only in zip/lace functions of appendix H. I&#x27;m not sure what it means, and I can&#x27;t find a reference in the Notation chapter

<a href="https://graypaper.fluffylabs.dev/#/c71229b/382700382700" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/382700382700</a></div>
<div class='msg'><time>2024-10-11 08:02</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: Hello
Could anyone please help me understand Eq. 159?
<a href="https://graypaper.fluffylabs.dev/#/c71229b/152702152702" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/152702152702</a>

Is the symbol ⋃  defined anywhere? I couldn&#x27;t find a  definition.

I’m interpreting it as the union of all dictionaries in Eq. 158, but I’m not sure what exactly the union of dictionaries means in this context. Could someone explain?

Thank you!
</div>
<div class='msg'><time>2024-10-11 08:17</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: &gt; &lt;@luke_f:matrix.org&gt; Hello
&gt; Could anyone please help me understand Eq. 159?
&gt; <a href="https://graypaper.fluffylabs.dev/#/c71229b/152702152702" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/152702152702</a>
&gt; 
&gt; Is the symbol ⋃  defined anywhere? I couldn&#x27;t find a  definition.
&gt; 
&gt; I’m interpreting it as the union of all dictionaries in Eq. 158, but I’m not sure what exactly the union of dictionaries means in this context. Could someone explain?
&gt; 
&gt; Thank you!

oh. i guess the definition is in eq 11
<a href="https://graypaper.fluffylabs.dev/#/c71229b/068301068401" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/068301068401</a></div>
<div class='msg'><time>2024-10-11 12:58</time>&ensp;<span class='u' style='color:#55d5d5'>rosarp</span>: In section I.4.1  Block-context Terms, reference to equation explaining C is missing. 
C: The service accumulation-commitment, used to form the Beefy root. See equation ??.
Which equation it points to? 

<a href="https://graypaper.fluffylabs.dev/#/c71229b/3c18003c1b00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/3c18003c1b00</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-11 13:01</time>&ensp;<span class='u' style='color:#55d5d5'>rosarp</span>: is it (176) in 12.4 ? 
(176) let (n, o, t, C) = ∆+ (GT , W∗ , (χ, δ † , ι, φ), χg )
<a href="https://graypaper.fluffylabs.dev/#/c71229b/17b10217b102" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/17b10217b102</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-11 15:01</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@dakkk:matrix.org&gt; I&#x27;m a bit confused about this list indexing notation, where a dot is used. I&#x27;ve found this notation only in zip/lace functions of appendix H. I&#x27;m not sure what it means, and I can&#x27;t find a reference in the Notation chapter
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/c71229b/382700382700" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/382700382700</a>

I &#x27;m interested as well. i assumed <code>times</code> but didnt explore any further</div>
<div class='msg'><time>2024-10-11 15:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@rosarp:matrix.org&gt; is it (176) in 12.4 ? 
&gt; (176) let (n, o, t, C) = ∆+ (GT , W∗ , (χ, δ † , ι, φ), χg )
&gt; <a href="https://graypaper.fluffylabs.dev/#/c71229b/17b10217b102" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/17b10217b102</a>

Yes</div>
<div class='msg'><time>2024-10-11 15:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; I&#x27;m a bit confused about this list indexing notation, where a dot is used. I&#x27;ve found this notation only in zip/lace functions of appendix H. I&#x27;m not sure what it means, and I can&#x27;t find a reference in the Notation chapter
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/c71229b/382700382700" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/382700382700</a>

Simple scalar multiply</div>
<div class='msg'><time>2024-10-11 15:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But it should be $\cdot$ - i&#x27;ll fix</div>
<div class='msg'><time>2024-10-13 17:39</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: What&#x27;s the purpose of <code>i</code> in the accumulation context? <a href="https://graypaper.fluffylabs.dev/#/c71229b/2b31002b3100" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/2b31002b3100</a>

Is it a created account? But it should be optional in that case?</div>
<div class='msg'><time>2024-10-14 08:34</time>&ensp;<span class='u' style='color:#c77c36'>luke_f</span>: Hello,
i have a doubt

160 shows \seq{\seq{(\mathbb{W}, \{\H\})}}_\mathsf{E}
but it should be \seq{(\mathbb{W}, \{\H\})}_\mathsf{E}

i.e list of  length E of tuples. not list of lists of tuples

shouldn&#x27;t it?

<a href="https://graypaper.fluffylabs.dev/#/c71229b/154402155002" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/154402155002</a>

</div>
<div class='msg'><time>2024-10-14 09:23</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I also have a question when calculating posteruor accumulation queue <a href="https://graypaper.fluffylabs.dev/#/c71229b/174803174803." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/174803174803.</a> what exactly is<code>n</code> ?

Also <code>W*</code> is of <code>type</code> sequence 168,165,161 but being used as second parameter of <code>E</code> which is a dictionary in 182, maybe it was meant to be <code>P(W*..n)</code> ? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-14 10:24</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-10-14 11:18</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: n is the number of work reports that were actually accumulated, as returned by \Delta_+, see <a href="https://graypaper.fluffylabs.dev/#/c71229b/179e0217b102" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/179e0217b102</a></div>
<div class='msg'><time>2024-10-14 11:41</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@dave:parity.io&gt; n is the number of work reports that were actually accumulated, as returned by \Delta_+, see <a href="https://graypaper.fluffylabs.dev/#/c71229b/179e0217b102" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/179e0217b102</a>

I must go to see a doctor I might be turning blind</div>
<div class='msg'><time>2024-10-14 12:32</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: A question concerning audit announcements. If we see a negative judgment for a work-report from some other auditor, we are required to audit the work-report ourselves. The GP states that we must announce our intention to audit this work-report (&quot;In all cases, we publish a signed statement of which of the cores we believe we are required to audit&quot;). Currently this isn&#x27;t really possible in JAM-SNP as the &quot;evidence&quot; for requirement to audit a work-report only covers the no-shows case. I can extend the announcement message format to support this but I&#x27;m not sure what the reason is for announcing in this case, is it actually necessary?</div>
<div class='msg'><time>2024-10-15 02:21</time>&ensp;<span class='u' style='color:#dbc767'>stanleyli</span>: Hi David Emett , I have read your wonderful JAMNP-S simple.md. I have a few questions and was wondering if you could answer them.

(1)Are the [Segment Shard] of CE139/140 the same as those of CE137?

(2) in CE 139, you mentioned that &quot;Guarantors should initially use protocol 139 to fetch segment shards. If a reconstructed import segment is inconsistent with its reconstructed proof&quot;. What exactly is this &quot;reconstructed proof&quot; when CE 139 only asked for [Segment Shard]? Perhaps you meant Guarantor will use [Segment Shard] retrieved from Assurer to verify against its own pageProof that it sent out during CE 137?

(3) You mentioned that guarantors will use CE139/CE140 to request import segment shards from assurers. However, Builder specify Imported segments using the combination of ({tree_root, index})[<a href="https://github.com/w3f/jamtestvectors/blob/master/codec/data/work_package.json#L22-L35]" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/master/codec/data/work_package.json#L22-L35]</a> in CE 133 and not [Erasure Root ++ Shard Index ++ len++[Segment Index]]. Should CE 139 have some alternative request format using only [segment_root ++ index]?

(4) I need clarification on how is pageProof being used in CE139/CE140? Our understanding is that page proof is quite large as it&#x27;s encoded with Justification &amp; ↕si⋅⋅⋅+64 in  <a href="https://graypaper.fluffylabs.dev/#/c71229b/1a15001a1500." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/1a15001a1500.</a> So it&#x27;s probably possible to recover exported segments from pageproof alone;

Do I understand this wrong?</div>
<div class='msg reply'><time>2024-10-15 11:09</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; Are the [Segment Shard] of CE139/140 the same as those of CE137?

Yes. In CE137 the assurer receives a Segment Shard sequence, the CE139/140 Segment Index is an index into this sequence.</div>
<div class='msg reply'><time>2024-10-15 11:19</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; What exactly is this &quot;reconstructed proof&quot; when CE 139 only asked for [Segment Shard]

The segments that are erasure coded consist of the segments exported by the work package _plus_ a sequence of &quot;proof&quot; pages, essentially containing Merkle proofs from the segment root to the exported segments. When you fetch an exported segment, you also need to fetch the corresponding proof to the segment root, so that you can convince yourself and auditors that the segment is correct.</div>
<div class='msg reply'><time>2024-10-15 11:23</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: In the full network protocol these proof pages might be implicitly returned, but with SNP you will need to explicitly ask for them.</div>
<div class='msg reply'><time>2024-10-15 11:24</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: These proof pages are generated by the function P in the GP, defined here <a href="https://graypaper.fluffylabs.dev/#/c71229b/1a1c001a6e00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/1a1c001a6e00</a></div>
<div class='msg reply'><time>2024-10-15 11:39</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; You mentioned that guarantors will use CE139/CE140 to request import segment shards from assurers. However, Builder specify Imported segments using the combination of ({tree\_root, index})\[<a href="https://github.com/w3f/jamtestvectors/blob/master/codec/data/work\_package.json#L22-L35\]" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/master/codec/data/work\_package.json#L22-L35\]</a> in CE 133 and not \[Erasure Root ++ Shard Index ++ len++\[Segment Index\]\]. Should CE 139 have some alternative request format using only \[segment\_root ++ index\]

Guarantors will need to maintain a map from Segment Root to Erasure Root. This can be built from the work-reports placed on-chain / distributed via CE135. Note that an individual assurer cannot in general prove the relationship between a segment shard and the segment root, only between the shard and the erasure root. This is why for CE139/140 an erasure root is sent rather than a segment root. Note also that any segment root --&gt; erasure root mapping constructed based on reports included on-chain may have incorrect entries, as reports included on-chain are not necessarily correct. Guarantors can conclude that an erasure root was incorrect if after fetching all shards with CE 140 and verifying all the justifications, the reconstructed segment and proof do not match up. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-15 11:51</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; I need clarification on how is pageProof being used in CE139/CE140? Our understanding is that page proof is quite large as it&#x27;s encoded with Justification &amp; ↕si⋅⋅⋅+64 in <a href="https://graypaper.fluffylabs.dev/#/c71229b/1a15001a1500." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/1a15001a1500.</a> So it&#x27;s probably possible to recover exported segments from pageproof alone;

The proof pages contain Merkle proofs from the segment root to the exported segments. Each proof page/segment contains proofs for 64 exported segments. You certainly can&#x27;t reconstruct the exported segments themselves from these proof pages. CE139/140 is intended to be used to fetch proof page shards as well as exported segment shards. You need to explicitly request proof page shards by passing the appropriate segment indices.</div>
<div class='msg reply'><time>2025-07-15 11:17</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: Hi David Emett !

Could you explain why do we explicitly need CE 139  / 40 for segment shard requests? Like what advantage does it has.

for importing segments for a particular shard index and segment index, we also need to create its justification at the time of creating bundle. <a href="https://graypaper.fluffylabs.dev/#/38c4e62/1cba001cd600?v=0.7.0" target="_blank" rel="noopener">HERE</a>

for that we would need to have all the segments with their proofs. To build all the segments, we would have to manually pass all the indices for each shard index and then call CE139/40 to separate assurers.

so wouldn&#x27;t it be better we fetch whole shard from them using CE137?

</div>
<div class='msg reply'><time>2025-07-15 11:21</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: Although eventually 137 would become push protocol later on I suppose. So that might be the reason?

even in that case if we would need whole shard itself, we could just leave segment indexes empty? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-07-15 11:24</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I think you are misunderstanding the purpose of the various proofs/justifications</div>
<div class='msg reply'><time>2025-07-15 11:27</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You should not use CE137 except to fetch your shards as an assurer. There is no reason to do so, and validators may refuse to service such requests</div>
<div class='msg reply'><time>2025-07-15 11:32</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: FWIW in the full network protocol it will be possible to directly fetch exported segments from guarantors. This will be the fast path and generally will be attempted first. Currently only the fallback path is specified, where you fetch shards from assurers and reconstruct via EC.</div>
<div class='msg reply'><time>2025-07-15 11:35</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: To reconstruct a 4kB segment you need 342 distinct 12-byte segment shards. You _also_ need to reconstruct the page containing the proof for the segment, which will require an additional 342 12-byte segments.</div>
<div class='msg reply'><time>2025-07-15 11:36</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You _do not_ need to fetch anything else</div>
<div class='msg reply'><time>2025-07-15 11:39</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: As covered in the SNP doc, you should use CE139 initially, ie do not request justifications. This is because the justifications are quite large compared to the shards themselves. You should only use CE140 if segment proof verification fails and you need to refetch the shards</div>
<div class='msg reply'><time>2025-07-15 11:41</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You do not need to fetch anything to check a justification returned by CE140; each justification is a Merkle proof to the erasure root that was passed in with the request</div>
<div class='msg reply'><time>2025-07-15 11:51</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: this is good. I got the actual use of 139 but i was sceptical about specifying segment indices. 

for building specific justification page (of size 1) for a particular segment, we would need to have all the segments for a particular segment root mapped to that erasure-root.

so thus we would then have to request all the shards (more than threshold), with all the segment indices.

it would be direct, if we could directly get that particular segment shard without the need for specifying indices? </div>
<div class='msg reply'><time>2025-07-15 11:56</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You reconstruct proof pages in the same way you reconstruct the segments they prove</div>
<div class='msg reply'><time>2025-07-15 11:56</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not sure what you mean by &quot;building specific justification page&quot;</div>
<div class='msg reply'><time>2025-07-15 11:58</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The proof pages are built when the segments are exported. This does not happen at import time when you are using CE139, that would not make sense</div>
<div class='msg reply'><time>2025-07-15 11:59</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: at the time of building bundle, the primary guarantor needs to fetch justifications for required import segment.

for that it needs to create a single paged proof. this can be done when we have all the segments exported, mapped to a particular segment root.  </div>
<div class='msg reply'><time>2025-07-15 12:07</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: It does not _create_ any proofs for imported segments. It _fetches_ these proofs in the same way it fetches the segments being proven</div>
<div class='msg reply'><time>2025-07-15 12:07</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: At the moment this requires fetching the shards for the proof page and doing an EC reconstruction</div>
<div class='msg reply'><time>2025-07-15 12:08</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: It _does not_ require fetching unrelated segment shards</div>
<div class='msg reply'><time>2025-07-15 12:13</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You are possibly hung up on the definition in the GP. The GP definition tells you exactly what the proofs must look like but you are not expected to construct them following the definition</div>
<div class='msg reply'><time>2025-07-15 12:14</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: For imports you are expected to construct them via fetched proof pages</div>
<div class='msg reply'><time>2025-07-15 12:23</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: Thanks a lot. I would need to revisit it for more clarity. </div>
<div class='msg'><time>2024-10-16 07:17</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: In the &#x27;new&#x27; hostcall (<a href="https://graypaper.fluffylabs.dev/#/c71229b/2e9a022ee302):" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/2e9a022ee302):</a>
- in case of OOB | CASH, we are assigning 2 elements to a tuple of 3 elements
- we are referencing X_T, which I&#x27;m unable to find defined in any other part of the paper </div>
<div class='msg'><time>2024-10-16 11:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; In the &#x27;new&#x27; hostcall (<a href="https://graypaper.fluffylabs.dev/#/c71229b/2e9a022ee302):" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/2e9a022ee302):</a>
&gt; - in case of OOB | CASH, we are assigning 2 elements to a tuple of 3 elements
&gt; - we are referencing X_T, which I&#x27;m unable to find defined in any other part of the paper

Will be fixed in 0.4.3</div>
<div class='msg'><time>2024-10-16 11:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.4.2" target="_blank" rel="noopener">0.4.2 is released</a> </div>
<div class='msg'><time>2024-10-17 23:22</time>&ensp;<span class='u' style='color:#dbc767'>stanleyli</span>: Hi gav: is there a typo in the Page proof function here? <a href="https://graypaper.fluffylabs.dev/#/293bf5a/1a4f001a5100" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/1a4f001a5100</a>

In eq 196, is the ↕s referring to the actual segment or the segment hash? If it’s the segment, then each element within the page proof (encoded as 6Hash + G) would make this page proof extremely large (up to 64 G) ? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-18 03:27</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: Hello everyone:

Based on the GP&#x27;s definition, I speculate the following, (not certain if it&#x27;s correct):
(1) The genesis state will have privileged service code to obtain preimages.
(2) Users will use (1) to get their code into on-chain preimages.

My question is: How will the privileged service get the code into the system?</div>
<div class='msg'><time>2024-10-18 03:28</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I guess just have it included in genesis state</div>
<div class='msg'><time>2024-10-18 07:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Indeed, on both points. </div>
<div class='msg'><time>2024-10-18 11:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@stanleyli:matrix.org&gt; Hi gav: is there a typo in the Page proof function here? <a href="https://graypaper.fluffylabs.dev/#/293bf5a/1a4f001a5100" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/1a4f001a5100</a>
&gt; 
&gt; In eq 196, is the ↕s referring to the actual segment or the segment hash? If it’s the segment, then each element within the page proof (encoded as 6Hash + G) would make this page proof extremely large (up to 64 G) ?

Yes, as David Emett suggested, there should be a <code>H^#(...)</code> around the <code>s_{i...+64}</code></div>
<div class='msg'><time>2024-10-18 11:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be in 0.4.3.</div>
<div class='msg'><time>2024-10-21 03:08</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: I am likely missing a crucial point or important detail concerning the idea that guarantors, in order to use CE139/CE140, every validator must maintain a map from every Segment Root to Erasure Root -- this now requires every validator to become a indexer of pretty much a month&#x27;s worth of work packages&#x27;s work reports to be able to be guarantors.   No problem in indexing a month&#x27;s worth of ImportDA actiity, but validator need to take every single work report across all of JAM, and index ALL the _potential_ segment roots to Erasure Roots just to be able to _maybe_ fetch some import segment in some future work package&#x27;s work items -- Could this be??   If so, what is the simplest process to map an on-chain work report to all its segment roots _without_  auditing the work report?

As of 0.4.x, imported segments can now also be specified in a SECOND way with $H^\\boxplus$ as (work package hash, segment index) combinations, and further requires that validators build a lookup dictionary mapping these into segment roots.  But given CE139 has <code>[Erasure-Root ++ Shard Index ++ len++[Segment Index]]</code> as the request key, it seems that this second way to specify imported segments is (a) sufficient for builders to specify import segments ... and (b) has far lower indexing requirements because validators just need to store a months worth of workpackagehash =&gt; erasure-Root mappings to use CE139 (which are just sitting in the work report!).  Would it be reasonable to drop the first &quot;older&quot; way with segmentroot and just keep this SECOND method as the sole method to specify imported segments in a work package?  If not, why not?

I must have missed something crucial here...  Thank you for your help! <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-21 09:10</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Each work report has only one segment root, this is in the availability specifier</div>
<div class='msg reply'><time>2024-10-21 09:15</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Re the WP hash to segment root mapping, this only needs to be tracked for ~1 epoch, as the chain can only check mappings going this far back</div>
<div class='msg reply'><time>2024-10-21 09:21</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: This is also a reason for still permitting the &quot;older&quot; way: the &quot;newer&quot; way using WP hashes will only work for referencing segments exported by WPs reported in the last ~hour, whereas the &quot;older&quot; way should work for any segments exported in the last ~28 days</div>
<div class='msg reply'><time>2024-10-21 09:21</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@dave:parity.io&gt; Each work report has only one segment root, this is in the availability specifier

Probably this is what you are missing?</div>
<div class='msg reply'><time>2024-10-21 09:23</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: It should be possible to build this index using only the last 28 days worth of blocks</div>
<div class='msg reply'><time>2024-10-21 12:01</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Will review+follow up, thank you!</div>
<div class='msg reply'><time>2024-10-21 20:29</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Alright, thank you very much for clarifying the &quot;one segment root&quot;, there are so many different things &quot;segments root&quot; and &quot;segment roots&quot; could mean I&#x27;ll make a point to use singular &quot;segment-root (e)&quot; based on your design and my now clear understanding of what is going on!</div>
<div class='msg reply'><time>2024-10-21 20:36</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: One remaining nitpick question is this: Are you saying that a work item of a work package is _invalid_ if it uses a (workpackagehash, index) combination to specify an import segment if the workpackagehash is more than an epoch old?  Is this implied/stated in the GP somewhere?  If not, it should be added or made more explicit? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-21 21:31</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Alright, thank you very much for clarifying the &quot;one segment root&quot;, there are so many different things &quot;segments root&quot; and &quot;segment roots&quot; could mean I&#x27;ll make a point to use singular &quot;segment-root (e)&quot; based on your design and my now clear understanding of what is going on!

FWIW I changed the SNP doc to use &quot;segments-root&quot; as opposed to &quot;segment root&quot;</div>
<div class='msg reply'><time>2024-10-21 23:02</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; One remaining nitpick question is this: Are you saying that a work item of a work package is _invalid_ if it uses a (workpackagehash, index) combination to specify an import segment if the workpackagehash is more than an epoch old?  Is this implied/stated in the GP somewhere?  If not, it should be added or made more explicit?

Well, &quot;more than an epoch old&quot; is not exact. The GP is quite explicit about what work reports are valid for inclusion in a block and what happens to them after this point. The WP hash -&gt; segment root mapping is checked at accumulation time, against the history of accumulated work packages, lower-case xi. This happens in the E function with the &quot;x u w_l = w_l u x&quot; check. The history is a circular buffer of length E (= timeslots per epoch), with one entry pushed every block. So it can store _at least_ one epoch&#x27;s worth of history but possibly more if there are &quot;missing&quot; blocks</div>
<div class='msg reply'><time>2024-10-21 23:44</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: No debate on that, thanks for explaining.  But  on this last nitpick I mean  the work items in the work package, as of 0.4.x have this $H^\boxplus$ source here: 
<a href="https://graypaper.fluffylabs.dev/#/293bf5a/199e0019a500" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/199e0019a500</a>
As far as I can tell, I could have an old work package hash from a long time ago -- &quot;whereas a value drawn from H⊞ implies the hash value is
the hash of the exporting work-package. In the latter case, it must be converted into a segment-root by the guarantor and this conversion reported in the work-report for on-chain validation.&quot;   If you believe this last statement is only applied for around an epoch (with the circular buffer mechanics, as you mention) then we should ensure this is clear in GP, don&#x27;t you think?</div>
<div class='msg reply'><time>2024-10-22 10:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; No debate on that, thanks for explaining.  But  on this last nitpick I mean  the work items in the work package, as of 0.4.x have this $H^\boxplus$ source here: 
&gt; <a href="https://graypaper.fluffylabs.dev/#/293bf5a/199e0019a500" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/199e0019a500</a>
&gt; As far as I can tell, I could have an old work package hash from a long time ago -- &quot;whereas a value drawn from H⊞ implies the hash value is
&gt; the hash of the exporting work-package. In the latter case, it must be converted into a segment-root by the guarantor and this conversion reported in the work-report for on-chain validation.&quot;   If you believe this last statement is only applied for around an epoch (with the circular buffer mechanics, as you mention) then we should ensure this is clear in GP, don&#x27;t you think?

The guarantor will not be punished for introducing a WR with an old/unvalidatable SR lookup entry. They might just not get rewarded.
And it beyond the scope of the GP (at least currently) to go deep into the optimum strategies across all off-chain behaviour. </div>
<div class='msg'><time>2024-10-21 04:12</time>&ensp;<span class='u' style='color:#de68ab'>ksc85pwpj5</span>: image.png</div>
<div class='msg'><time>2024-10-21 04:12</time>&ensp;<span class='u' style='color:#de68ab'>ksc85pwpj5</span>: Excuse me, I would like to ask what the difference is between x ∪ wl and wl ∪ x, and what is the meaning of x ∪ wl = wl ∪ x. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-21 06:11</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: If I remember properly left or right side take priority in case of keys existing in both elements. This means that a U b = b U a effectively means there are no conflicting keys or if there are their values are the same</div>
<div class='msg reply'><time>2024-10-21 09:07</time>&ensp;<span class='u' style='color:#de68ab'>ksc85pwpj5</span>: Understood, thank you for your help.</div>
<div class='msg reply'><time>2024-10-21 11:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Indeed. I was a bit torn over how to express this in the paper.</div>
<div class='msg'><time>2024-10-21 08:52</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: what is the <code>w</code> referenced in the forget host call? <a href="https://graypaper.fluffylabs.dev/#/293bf5a/30e60030e600" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/30e60030e600</a></div>
<div class='msg'><time>2024-10-21 08:55</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: in quit hostcall, <code>a</code> is never used: <a href="https://graypaper.fluffylabs.dev/#/293bf5a/2f55012f5e01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/2f55012f5e01</a></div>
<div class='msg'><time>2024-10-21 09:13</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: in historical_lookup hostcall, <code>k</code> is undefined: <a href="https://graypaper.fluffylabs.dev/#/293bf5a/307102307102" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/307102307102</a> </div>
<div class='msg'><time>2024-10-21 09:26</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: <code>i</code> is undefined in poke hostcall: <a href="https://graypaper.fluffylabs.dev/#/293bf5a/316d02317402" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/316d02317402</a></div>
<div class='msg reply'><time>2024-10-21 09:31</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Typo; that should be <code>l</code></div>
<div class='msg'><time>2024-10-21 12:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; in quit hostcall, <code>a</code> is never used: <a href="https://graypaper.fluffylabs.dev/#/293bf5a/2f55012f5e01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/2f55012f5e01</a>

a is used to construct t: <a href="https://graypaper.fluffylabs.dev/#/293bf5a/2f97012f9801" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/2f97012f9801</a></div>
<div class='msg'><time>2024-10-21 12:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is the third item of (x\_s)\_l\[h, z\] with the condition that it&#x27;s a three-item array (notice it&#x27;s behind the &quot;if&quot; condition) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-21 12:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It wasn&#x27;t especially clear that the value was used as it was only referenced with the &quot;_2&quot; subscript prior to the &quot;if&quot;. This will be improved in 0.4.3.</div>
<div class='msg'><time>2024-10-21 12:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.4.3" target="_blank" rel="noopener">0.4.3</a> is released with all the latest corrections/clarifications.</div>
<div class='msg'><time>2024-10-22 07:22</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: in export hostcall, constant W_X is not defined: <a href="https://graypaper.fluffylabs.dev/#/439ca37/31ab0031ae00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/31ab0031ae00</a></div>
<div class='msg'><time>2024-10-22 11:14</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: Hello, I am struggling to understand appendix A.7 more specifically I can&#x27;t find the explanation for a bunch of variables like <code>o</code>, <code>w</code>, <code>z</code>, <code>s</code> in formula <code>260</code> and later <code>a</code>, <code>W</code>, <code>R</code>, <code>V</code>, <code>A</code> in formula <code>264</code>. I have managed to decode RAM but mainly looking at the polkavm rust implementation however I don&#x27;t understand how to decode the registers from the program code <code>p</code></div>
<div class='msg reply'><time>2024-10-22 11:27</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The formula (264) defines the memory map of the standard program initialization (that is: what is put at a given memory address, whether it&#x27;s initialized, whether it&#x27;s read-only/read-write, etc.). The formula (260) is essentially the standard JAM &quot;program blob&quot;. You don&#x27;t decode the registers from **p** (260); the initial values of the registers are given in (265).</div>
<div class='msg reply'><time>2024-10-22 11:54</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: Yeah, that would make sense however I got confused by this sentance:
&quot;We thus define the standard program code format p, which includes not only the instructions and jump table (pre-
viously represented by the term c), but also information on the state of the ram and registers at program start&quot;</div>
<div class='msg reply'><time>2024-10-22 11:56</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: here it says that we get registers from program code p and later in the formula 259 we have this <code>Y(p) -&amp;gt; (c, ω, μ)?</code> <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-22 12:19</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The wording here might be a little confusing as-is. The initial registers are defined as part of the standard program initialization (eq. 265), but they&#x27;re <em>not</em> explicitly part of the program blob (eq. 260). The Y in eq. 259 is meant to represent the standard program initialization, but it doesn&#x27;t necessarily mean that the values of the registers are directly extracted from **p**.</div>
<div class='msg reply'><time>2024-10-22 12:46</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: Thank you, this explanation makes sense, also formula 266 shows <code>a</code> as separate from <code>p</code>. I guess formula 259 should be something like this then <code>Y(p, a) -&amp;gt; (c, ω, μ)?</code> <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-22 13:19</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: one more thing, formula 265 describes what are the initial registers, but I can&#x27;t find defined anywhere how to convert <code>a</code> which is a series of octets with at most Z_I elements to registers [N_R]_13</div>
<div class='msg reply'><time>2024-10-22 13:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is |a|, the number of items in a, which should easily fit in register index 8. </div>
<div class='msg reply'><time>2024-10-22 14:35</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: I think I understand now, so when we refer to data arguments here it means a slice of bytes that can later be decoded when executing the program. I thought there would be a way to pass arguments as register values directly when invoking the PVM</div>
<div class='msg'><time>2024-10-22 13:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Improved in <a href="https://github.com/gavofyork/graypaper/pull/114" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/114</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-22 14:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No, not in this “standard argument passing” invocation</div>
<div class='msg'><time>2024-10-22 14:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Obviously you can use the PVM directly. </div>
<div class='msg'><time>2024-10-22 15:13</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: In state merklization of validator statistic (pi) (<a href="https://graypaper.fluffylabs.dev/#/439ca37/345702345802)," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/345702345802),</a> I don&#x27;t understand why we are using E_4 for serialization</div>
<div class='msg'><time>2024-10-22 16:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is perhaps not super clear, but it&#x27;s intended to serialize all of the inner elements as E_4</div>
<div class='msg'><time>2024-10-22 19:35</time>&ensp;<span class='u' style='color:#3c8ec8'>bmaas</span>: Are we guaranteed to have deterministic ordering here: <a href="https://graypaper.fluffylabs.dev/#/293bf5a/346502346f02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/346502346f02</a> ? I could not find any mention of how to handle (small) sets when encoding—whether to sort them or not. When I read about Theta as defined here:  <a href="https://graypaper.fluffylabs.dev/#/c71229b/154402154e02," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/154402154e02,</a> where <code>{H}</code> is a set of work-package hashes, it raises a question. Should this set containing work-package hashes be ordered before encoding?</div>
<div class='msg'><time>2024-10-23 09:07</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: <a href="https://graypaper.fluffylabs.dev/#/439ca37/121503121503" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/121503121503</a>
Is this supposed to be <code>ρ[c]_w</code>?</div>
<div class='msg'><time>2024-10-23 09:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@bmaas:matrix.org&gt; Are we guaranteed to have deterministic ordering here: <a href="https://graypaper.fluffylabs.dev/#/293bf5a/346502346f02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/293bf5a/346502346f02</a> ? I could not find any mention of how to handle (small) sets when encoding—whether to sort them or not. When I read about Theta as defined here:  <a href="https://graypaper.fluffylabs.dev/#/c71229b/154402154e02," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/154402154e02,</a> where <code>{H}</code> is a set of work-package hashes, it raises a question. Should this set containing work-package hashes be ordered before encoding?

GP should state that sets of encodable items should be encoded in order. </div>
<div class='msg'><time>2024-10-23 09:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Similar to dictionary encoding, but without the value part. </div>
<div class='msg'><time>2024-10-23 09:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@0xjunha:matrix.org&gt; <a href="https://graypaper.fluffylabs.dev/#/439ca37/121503121503" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/121503121503</a>
&gt; Is this supposed to be <code>ρ[c]_w</code>?

Yes. Will be fixed in next release. </div>
<div class='msg'><time>2024-10-24 07:39</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: <a href="https://graypaper.fluffylabs.dev/#/439ca37/348a02349202" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/348a02349202</a> about here</div>
<div class='msg'><time>2024-10-24 07:40</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: i guess a_l is actually cardinality of a_l </div>
<div class='msg'><time>2024-10-24 07:40</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: and couldnt really find a_i</div>
<div class='msg reply'><time>2024-10-24 08:04</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: see Eq 95 for a\_i and a_l <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-24 08:05</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: thanks mate</div>
<div class='msg reply'><time>2024-10-24 08:06</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: it&#x27;s not the first time i ask about this derived terms. my memory is not working properly :)</div>
<div class='msg'><time>2024-10-24 13:02</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: Hello gav
I think there is a mistake in Equation 183
<code>E(WQ, W∗ ...n) if i = 0</code>

the second argument is of the type <code>⟦W⟧</code> (list of work reports)

but the second argument that function <code>E</code> expects is <code>D⟨H → H⟩</code> (Equation 164) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-24 13:03</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@luke_fishman:matrix.org&gt; Hello gav
&gt; I think there is a mistake in Equation 183
&gt; <code>E(WQ, W∗ ...n) if i = 0</code>
&gt; 
&gt; the second argument is of the type <code>⟦W⟧</code> (list of work reports)
&gt; 
&gt; but the second argument that function <code>E</code> expects is <code>D⟨H → H⟩</code> (Equation 164)

There is a PR open to fix this: <a href="https://github.com/gavofyork/graypaper/pull/112" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/112</a></div>
<div class='msg'><time>2024-10-24 13:04</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: i see. Thank you</div>
<div class='msg'><time>2024-10-24 21:13</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: In formula 268, psi\_i definition:

<a href="https://graypaper.fluffylabs.dev/#/439ca37/29f80229fc02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/29f80229fc02</a>

↦ r where (g, r, ∅) = ΨM (pc, 0, GI , E(p, c), F, ∅)

What is pc? I believe there is a typo in the argument, since work packages do not have a field &#x27;c&#x27; <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-24 21:25</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: I believe a correction is needed in GP in the State Transition Dependency Graph section for gamma and kappa.

Suggested change: Remove <code>ψ&amp;#x27;</code> from GP-0.4.3-eq:21 and add <code>ψ&amp;#x27;</code> to GP-0.4.3-eq:19.
Likely an unchanged bit from an earlier version of GP.

Details here: <a href="https://github.com/gavofyork/graypaper/pull/118" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/118</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-25 09:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; In formula 268, psi\_i definition:
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/439ca37/29f80229fc02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/29f80229fc02</a>
&gt; 
&gt; ↦ r where (g, r, ∅) = ΨM (pc, 0, GI , E(p, c), F, ∅)
&gt; 
&gt; What is pc? I believe there is a typo in the argument, since work packages do not have a field &#x27;c&#x27;

Bold c is defined as the preimage of regular c. </div>
<div class='msg'><time>2024-10-25 09:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s a derived term. </div>
<div class='msg'><time>2024-10-25 12:16</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The state keys as currently defined in the State Merklization section can collide for different bits of state. e.g. The keys for general service storage and for service preimages are calculated identically? It seems like a_l keys can be made to collide with almost anything as both h and l are completely controllable by the code calling solicit.</div>
<div class='msg'><time>2024-10-25 14:42</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Where do I get the value of GI from in psi_I? Is it a constant? Or how should I calculate it? 
<a href="https://graypaper.fluffylabs.dev/#/439ca37/29f80229fd02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/29f80229fd02</a></div>
<div class='msg'><time>2024-10-25 15:19</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: What does \[WHAT, ω8, . . . \] mean here? What do I put on ...? I assume to pass through ω2, ω3, ... ? 
<a href="https://graypaper.fluffylabs.dev/#/439ca37/2a60002a6000" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/2a60002a6000</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-25 16:10</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: &gt; &lt;@danicuki:matrix.org&gt; What does \[WHAT, ω8, . . . \] mean here? What do I put on ...? I assume to pass through ω2, ω3, ... ? 
&gt; <a href="https://graypaper.fluffylabs.dev/#/439ca37/2a60002a6000" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/2a60002a6000</a>

That&#x27;s how I understand it as well. You assign ω0=WHAT, ω1 = ω8, and the rest stays the same. The same notation is used later as parameters pass-through (e.g. Omega_G).</div>
<div class='msg'><time>2024-10-25 16:33</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: If you all have a precise idea of what a &quot;null authorizer&quot; should be in our JAM implementations [disconnected from the CoreTime system chain], like down to pvm assembly code included in genesis state, kindly share --I think we can converge on something very quickly?</div>
<div class='msg'><time>2024-10-26 11:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/119" target="_blank" rel="noopener">Should be fixed by this</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-26 11:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;ll put some values in: <a href="https://github.com/gavofyork/graypaper/pull/120/commits/edafbd0a6d618cd1949e665e6a7fbc6187201c4b" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/120/commits/edafbd0a6d618cd1949e665e6a7fbc6187201c4b</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-26 11:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (They&#x27;re not going to be especially meaningful yet as we don&#x27;t have a sensible gas model yet)</div>
<div class='msg'><time>2024-10-26 11:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/120/commits/a4d857586f3253712edc73a09827075e05604f69" target="_blank" rel="noopener">PVM Invocations: Correct fallback condition</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-26 11:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Note that it is omega_7 which gets set to the error code <code>WHAT</code>. omega otherwise remains the same.</div>
<div class='msg'><time>2024-10-26 18:26</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I did not understand yet how do we have access to d and s (bold) in these formulas:

X(w ∈ I) ≡ [d ∣ (H(d),∣d∣) −&lt; wx]
S(w ∈ I) ≡ [s[n] ∣ M(s) = L(r),(r,n) &lt;− wi]
J ( w ∈ I ) ≡ [ ↕ J ( s , n ) ∣ M ( s ) = L ( r ) , ( r , n ) &lt;− w i ]

<a href="https://graypaper.fluffylabs.dev/#/439ca37/1a98011ad401" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/1a98011ad401</a>

Anyone has a clue?</div>
<div class='msg'><time>2024-10-26 18:27</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: </div>
<div class='msg'><time>2024-10-26 20:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Extrinsic preimages are expected to be passed alongside the work package by the block builder. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-26 20:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Import segments are expected to be retrieved by the guarantor through erasure-code reconstruction from pieces from the validators collected via the network. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-27 08:31</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: <a href="https://graypaper.fluffylabs.dev/#/439ca37/2cf9012cfc01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/2cf9012cfc01</a> It seems to me that the extra hashing here is redundant, unless the keys in preimage dictionary are double-hashed (which I didn&#x27;t find info about in section 9)</div>
<div class='msg'><time>2024-10-27 12:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Certainly if <a href="https://github.com/gavofyork/graypaper/pull/119" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/119</a> goes in it would be</div>
<div class='msg'><time>2024-10-27 12:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But yeah, it&#x27;s a provision from an older revision where it was desirable to ensure that equivalent keys in different services wouldn&#x27;t result in similar trie paths.</div>
<div class='msg'><time>2024-10-27 12:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;s less important with the current trie as there&#x27;s already a provision to split it based on service ID. It&#x27;s still more optimal to hash in order to uniformally distribute tree paths, and generally more secure to &quot;salt&quot; the hash with the service ID. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-27 12:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/121" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/121</a> is probably the alteration which will make it through. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-28 16:43</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: Something i might be missing. <a href="https://graypaper.fluffylabs.dev/#/439ca37/2bb6002bb800" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/2bb6002bb800</a> here preimage code ( i guess) is provided to the argument invocation. (d\[s\]\_bold\_c)

but the preimage section does not seem to mention any mechanism of storing/fetching preimage for the service. I marked my code with a TODO and now i am fixing all the leftovers.

omega_n (new service host call) does not seem to have access of such preimage but rather codehash is being directly provided in memory.... so I&#x27;m a bit lost of where the preimage is being handled <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-29 06:55</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: again my memory failed me... for those landing here</div>
<div class='msg reply'><time>2024-10-29 06:56</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: section 9.1 basically is the answer to this above</div>
<div class='msg'><time>2024-10-28 17:09</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: <a href="https://graypaper.fluffylabs.dev/#/439ca37/2e70002e7100" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/2e70002e7100</a> Should this <code>d</code> that&#x27;s being subscripted here be just <code>\mi</code>? I&#x27;m having a hard time to figure out where is the data necessary to build that dictionary coming from. In other context <code>d</code> is just a dictionary indexed by service id afaict.</div>
<div class='msg reply'><time>2024-10-28 20:18</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: it&#x27;s basically delta</div>
<div class='msg'><time>2024-10-28 20:18</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: </div>
<div class='msg'><time>2024-10-28 23:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@tomusdrw:matrix.org&gt; <a href="https://graypaper.fluffylabs.dev/#/439ca37/2e70002e7100" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/2e70002e7100</a> Should this <code>d</code> that&#x27;s being subscripted here be just <code>\mi</code>? I&#x27;m having a hard time to figure out where is the data necessary to build that dictionary coming from. In other context <code>d</code> is just a dictionary indexed by service id afaict.

Yes. Will be corrected in next revision</div>
<div class='msg'><time>2024-10-29 19:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Is JAMNP intended to socialize individual vs aggregated BLS signatures ie
<a href="https://graypaper.fluffylabs.dev/#/439ca37/1e7a001e7a00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/1e7a001e7a00</a>
If not, what does a validator do with ${\bf F}_v$?  Should these be aggregated into EpochMarkers or into BridgeHub somehow?  </div>
<div class='msg'><time>2024-10-30 01:42</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Hello. I asked this in the Jam chat and didn&#x27;t get a response so trying here (if this is not allowed let me know ill delete this post). Question about erasure coding in JAM. I’ve broken the blob into pieces, and then those pieces into the octet pairs. The pairs were then converted to 16 bits. I’m now trying to figure out the field element formula. It looks to be the summation of each bit multiplied by “vj” and this is where I’m not sure what value to use. If j = 7, then vj = α14 +α4 +α. What is α here? </div>
<div class='msg'><time>2024-10-30 01:42</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Screen Shot 2024-10-28 at 1.20.33 PM.png</div>
<div class='msg'><time>2024-10-30 07:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://matrix.to/#/@davxy:matrix.org" target="_blank" rel="noopener">@davxy:matrix.org</a>^^^</div>
<div class='msg'><time>2024-10-30 07:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Version 0.4.4 is out. This includes several corrections but two important protocol alterations. One change to the state merklisation, and one to the way that segment root lookup dictionary validations are done.</div>
<div class='msg'><time>2024-10-30 07:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I’ll probably be pushing on with 0.5 mostly now with a number of smaller protocol tweaks. See the milestone in the GP report if you want to know what to expect. </div>
<div class='msg'><time>2024-10-30 10:42</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: &gt; &lt;@charliewinston14:matrix.org&gt; Hello. I asked this in the Jam chat and didn&#x27;t get a response so trying here (if this is not allowed let me know ill delete this post). Question about erasure coding in JAM. I’ve broken the blob into pieces, and then those pieces into the octet pairs. The pairs were then converted to 16 bits. I’m now trying to figure out the field element formula. It looks to be the summation of each bit multiplied by “vj” and this is where I’m not sure what value to use. If j = 7, then vj = α14 +α4 +α. What is α here?

 I have written a toy example here: <a href="https://github.com/w3f/jamtestvectors/blob/skalman--add-sage-toy-example/erasure_coding/sage/spec.sage#L35" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/skalman--add-sage-toy-example/erasure_coding/sage/spec.sage#L35</a> it erasure code m1 = 0x0001 and m2 = 0x0002 if it helps. I think  V_j&#x27;s are elements of the contor basis, you can find them here <a href="https://github.com/w3f/jamtestvectors/blob/skalman--add-sage-toy-example/erasure_coding/sage/spec.sage#L26." target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/blob/skalman--add-sage-toy-example/erasure_coding/sage/spec.sage#L26.</a> </div>
<div class='msg reply'><time>2024-10-30 12:40</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: This is really helpful. Thanks!</div>
<div class='msg'><time>2024-10-30 10:50</time>&ensp;<span class='u' style='color:#da6aa2'>syed</span>: From_V function is basically computing the sum you are pointing at but in real life you shouldn&#x27;t do that, you should directly compute the code polynomial from (m_0, m_1,..m_15) vectors without the need to convert to standard field element representation.</div>
<div class='msg'><time>2024-10-30 11:48</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Currently, JAMNP does not incorporate any Beefy-related messaging. This gadget will need to be implemented on top of GRANDPA, which itself is not described by JAMNP yet.
I would tentatively assume that the protocol won’t diverge _significantly_ from the one described for Polkadot. Of course, there are some differences, such as constructing the MMR with accumulation outputs, and using only BLS instead of BLS or ECDSA for signatures. However, for context, there are numerous introductory resources on these concepts available.
Regarding the state of the &quot;BEEFY Distribution&quot; section in GP, it currently suggests signing each finalized block B. I&#x27;m not sure if this will later shift to a &quot;sign every X blocks&quot; approach similar to Beefy on Polkadot.
The signatures are for sure BLS signatures, which can be later aggregated for efficient light client verification. Aggregated signatures will necessitate an aggregated key, and APK proofs might be introduced to verify the validity of these aggregated keys (there is at least a talk and one excellent tutorial from Syed  online).
Who is in charge of aggregation of BLS keys in JAM? Who is in charge of maintaining the keys commitment eventually required for APK proofs? Probably this aspect is outside of the core JAM protocol per se.
These aspects likely warrants further discussion, and it is probably not worth for you (or anyone else) to focus on it right now, given that GRANDPA is not on M1, and potentially not even on M2 either, meaning BEEFY is further down the line (it may be the last component indeed). I believe further details will be provided when the time is appropriate. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-10-30 18:26</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Ok thank you for making the known unknowns super clear!

For the Syed talk do you mean this:
 <a href="https://www.youtube.com/watch?v=xzC9KJXtidE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=xzC9KJXtidE</a>
For the tutorial can you share the link please?</div>
<div class='msg reply'><time>2024-10-30 18:40</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Yeah. I think <a href="https://medium.com/web3foundation/apk-proofs-by-hand-and-sage-3f5feb3fcca4" target="_blank" rel="noopener">this</a> walkthrough is very helpful for understanding some low level aspects underlying APK (aggregated public key) proofs. It may also serve as a beneficial read before diving into the ring-proof primitive we&#x27;re using for Safrole (technical spec draft available <a href="https://github.com/davxy/ring-proof-spec" target="_blank" rel="noopener">here</a>), as they share some similarities. However, unless you’re interested for your own learning, it may not be essential to review this material. Regarding your JAM impl, you might prefer to just use FFI <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 10:48</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Below are some basic questions on Ordered Accumulation and Prerequisites.  

*Background*. Lets say we wish to compute $C[n + 1] = A[n] + B[n] + C[n]$ (some kind of recurrence relationship, lets say Fibonacci, Tribonnaci, and Quadranocci in a toy example, all of $A$, $B$, $C$ trying to write their value into service storage of key 0) using the <code>refine</code> work results of services $A[n]$, $B[n]$, $C[n]$ coming into <code>accumulate</code>.  We would like service $C$ to be able to <code>read</code> the results of $A, B, C$ and <code>write</code> out $C[n+1]$ to the service storage of $C$ in $C$&#x27;s <code>accumulate</code> code.    

Questions:

1. If we have a _single_ work package $p$ with 3 work items from service $A$, $B$, $C$ (with no prerequisites), there is **NO** way to have $C$&#x27;s <code>write</code> _guaranteed_ to happen **AFTER** $A$ and $B$. This is because $\Delta_{+}$ will initialize _parallelized_ execution of $\Delta_1$ for all 3 services through $\Delta_*$.  Can you confirm this?

2. If we have _three_ work packages $p_A, p_B, p_C$ with 1 work item each ($p_A$ with <code>refine</code> work results from service A, $p_B$ from service $B$, $p_C$ from $C$), we **CAN** have C&#x27;s <code>write</code> happen after A and B, by specifying BOTH $p_A$ and $p_B$ as _prerequisite_ work packages of $p_C$.  This SET of TWO prereqs was not possible until GP 0.4.5 supporting a _set_ of prerequisites.  Can you confirm this?

3. If (2) is correct, for the $C[n + 1] = A[n] + B[n] + C[n]$ <code>write</code> to happen _at the same time slot_ for some <code>n</code>, then another to happen within 2 timeslots for the next <code>n</code>, we **REQUIRE** _three_ cores for _three_ work packages, one core for each work package.  In a tiny $V=6,C=2$ test configuration, we CANNOT achieve this, but in a small configuration with $V=9,C=3$, we CAN.  Can you confirm this?

4. Actually, the answer to (3) is more nuanced!   Because we could actually solve this ordered accumulation $C[n + 1] = A[n] + B[n] + C[n]$ with only TWO cores working on TWO packages -- one package $p_{A,B}$ with 2 work items using services $A$ and $B$ and then another package $p_C$ with ONE prerequisite: $p_{A,B}$.  Then with a tiny $V=6,C=2$ test configuration, we CAN achieve the <code>read</code> of $C$ based on the <code>write</code>s of $A$ and $B$ all in one <code>accumulate</code> at the same time slot.  Can you confirm this?

5. With a tiny testnet of $V=6,C=2$, it IS possible test (4) using $\Delta_+$ with $i$ splitting ${\bf w}$ into two pieces that test $\Delta_*$ and the tail recursion of $\Delta_+$.  To observe $N$ calls to $\Delta_+$, you need $N-1$ cores though and need to figure out how to manage $g$ in $N$ splits.  Can you confirm this? 

    [If this is wrong, please advise how we should test $\Delta_+$]

6. Setting aside gas limits for a while (because at present anyway every operation is gas 1 or so, and the accumulation limit is 5-6 orders of magnitude higher) we can have 25 cores working on 25 work packages like this all in one <code>accumulate</code> of <code>Z[n+1]</code>, with each work package having 2 prerequisites (except for $p_{A,B}$ which have none):

  * $C[n + 1] = A[n] + B[n] + C[n]$ ($p_C$ depending on $p_{A,B}$ using 2 cores)
  * $D[n + 1] = B[n] + C[n+1] + D[n]$       ($p_D$ depending on $p_{A,B}$ and $p_{C}$ using 1 more core for $D$)
  * $E[n + 1] = C[n+1] + D[n+1] + E[n]$     ($p_E$ depending on $p_{C}$ and $p_{D}$ using 1 more core for $E$)
  * $F[n + 1] = D[n+1] + E[n+1] + F[n]$     ($p_F$ depending on $p_{D}$ and $p_{E}$ using 1 more core for $F$)
  * ... and so on until ...
  * $Z[n + 1] = X[n+1] + Y[n+1] + Z[n]$     ($p_Z$ depending on $p_{X}$ and $p_{Y}$ using 1 more core for $Z$)

  Assuming all 25 cores can complete their 25 refines and get 25 work reports guaranteed and assured in a medium configuration ($V=120,C=40$), we can have the entire ordered accumulation done in ONE timeslot.  Can you confirm this?

Because there is a lot of formatting that github treats at least somewhat better also putting it here <a href="https://github.com/gavofyork/graypaper/issues/129" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/129</a> -- is that better?</div>
<div class='msg'><time>2024-10-31 13:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. Correct</div>
<div class='msg'><time>2024-10-31 13:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 2. The intention was only give the same guarantee as in (1). However the way the queuing works at present will, I think, allow this.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 13:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-10-31 13:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-10-31 13:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-10-31 13:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The invariant you can definitely rely on is that work packages will not be accumulated any later than their dependencies.   <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 13:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In reality the order of item accumulation of any single service may come down to that service’s Accumulate code.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 13:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For dependent WPs with items in different services, you’ll just be guaranteed that the dependency service doesn’t see the dependent service’s changes before it’s own happen.</div>
<div class='msg'><time>2024-10-31 13:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Below are some basic questions on Ordered Accumulation and Prerequisites.  
&gt; 
&gt; *Background*. Lets say we wish to compute $C[n + 1] = A[n] + B[n] + C[n]$ (some kind of recurrence relationship, lets say Fibonacci, Tribonnaci, and Quadranocci in a toy example, all of $A$, $B$, $C$ trying to write their value into service storage of key 0) using the <code>refine</code> work results of services $A[n]$, $B[n]$, $C[n]$ coming into <code>accumulate</code>.  We would like service $C$ to be able to <code>read</code> the results of $A, B, C$ and <code>write</code> out $C[n+1]$ to the service storage of $C$ in $C$&#x27;s <code>accumulate</code> code.    
&gt; 
&gt; Questions:
&gt; 
&gt; 1. If we have a _single_ work package $p$ with 3 work items from service $A$, $B$, $C$ (with no prerequisites), there is **NO** way to have $C$&#x27;s <code>write</code> _guaranteed_ to happen **AFTER** $A$ and $B$. This is because $\Delta_{+}$ will initialize _parallelized_ execution of $\Delta_1$ for all 3 services through $\Delta_*$.  Can you confirm this?
&gt; 
&gt; 2. If we have _three_ work packages $p_A, p_B, p_C$ with 1 work item each ($p_A$ with <code>refine</code> work results from service A, $p_B$ from service $B$, $p_C$ from $C$), we **CAN** have C&#x27;s <code>write</code> happen after A and B, by specifying BOTH $p_A$ and $p_B$ as _prerequisite_ work packages of $p_C$.  This SET of TWO prereqs was not possible until GP 0.4.5 supporting a _set_ of prerequisites.  Can you confirm this?
&gt; 
&gt; 3. If (2) is correct, for the $C[n + 1] = A[n] + B[n] + C[n]$ <code>write</code> to happen _at the same time slot_ for some <code>n</code>, then another to happen within 2 timeslots for the next <code>n</code>, we **REQUIRE** _three_ cores for _three_ work packages, one core for each work package.  In a tiny $V=6,C=2$ test configuration, we CANNOT achieve this, but in a small configuration with $V=9,C=3$, we CAN.  Can you confirm this?
&gt; 
&gt; 4. Actually, the answer to (3) is more nuanced!   Because we could actually solve this ordered accumulation $C[n + 1] = A[n] + B[n] + C[n]$ with only TWO cores working on TWO packages -- one package $p_{A,B}$ with 2 work items using services $A$ and $B$ and then another package $p_C$ with ONE prerequisite: $p_{A,B}$.  Then with a tiny $V=6,C=2$ test configuration, we CAN achieve the <code>read</code> of $C$ based on the <code>write</code>s of $A$ and $B$ all in one <code>accumulate</code> at the same time slot.  Can you confirm this?
&gt; 
&gt; 5. With a tiny testnet of $V=6,C=2$, it IS possible test (4) using $\Delta_+$ with $i$ splitting ${\bf w}$ into two pieces that test $\Delta_*$ and the tail recursion of $\Delta_+$.  To observe $N$ calls to $\Delta_+$, you need $N-1$ cores though and need to figure out how to manage $g$ in $N$ splits.  Can you confirm this? 
&gt; 
&gt;     [If this is wrong, please advise how we should test $\Delta_+$]
&gt; 
&gt; 6. Setting aside gas limits for a while (because at present anyway every operation is gas 1 or so, and the accumulation limit is 5-6 orders of magnitude higher) we can have 25 cores working on 25 work packages like this all in one <code>accumulate</code> of <code>Z[n+1]</code>, with each work package having 2 prerequisites (except for $p_{A,B}$ which have none):
&gt; 
&gt;   * $C[n + 1] = A[n] + B[n] + C[n]$ ($p_C$ depending on $p_{A,B}$ using 2 cores)
&gt;   * $D[n + 1] = B[n] + C[n+1] + D[n]$       ($p_D$ depending on $p_{A,B}$ and $p_{C}$ using 1 more core for $D$)
&gt;   * $E[n + 1] = C[n+1] + D[n+1] + E[n]$     ($p_E$ depending on $p_{C}$ and $p_{D}$ using 1 more core for $E$)
&gt;   * $F[n + 1] = D[n+1] + E[n+1] + F[n]$     ($p_F$ depending on $p_{D}$ and $p_{E}$ using 1 more core for $F$)
&gt;   * ... and so on until ...
&gt;   * $Z[n + 1] = X[n+1] + Y[n+1] + Z[n]$     ($p_Z$ depending on $p_{X}$ and $p_{Y}$ using 1 more core for $Z$)
&gt; 
&gt;   Assuming all 25 cores can complete their 25 refines and get 25 work reports guaranteed and assured in a medium configuration ($V=120,C=40$), we can have the entire ordered accumulation done in ONE timeslot.  Can you confirm this?
&gt; 
&gt; Because there is a lot of formatting that github treats at least somewhat better also putting it here <a href="https://github.com/gavofyork/graypaper/issues/129" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/129</a> -- is that better?

Sounds right, yes. </div>
<div class='msg'><time>2024-10-31 13:59</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: ima_b388934.jpeg</div>
<div class='msg'><time>2024-10-31 14:00</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Where can I find function C defined? I don’t see it in section 12 and in the appendix under C it says “see equation ??” <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 14:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@jaymansfield:matrix.org&gt; Where can I find function C defined? I don’t see it in section 12 and in the appendix under C it says “see equation ??”

Please provide link with GP reader. </div>
<div class='msg'><time>2024-10-31 14:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Images are a bit broken in matrix currently. </div>
<div class='msg'><time>2024-10-31 14:08</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: &gt; &lt;@gav:polkadot.io&gt; Images are a bit broken in matrix currently. 

<a href="https://graypaper.fluffylabs.dev/#/439ca37/0f8a010f9601" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/0f8a010f9601</a></div>
<div class='msg'><time>2024-10-31 14:11</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Looking for function C to be able to generate the accumulate root</div>
<div class='msg'><time>2024-10-31 14:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: it&#x27;s not a function</div>
<div class='msg'><time>2024-10-31 14:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: and as the GP says right above your selection, it&#x27;s defined in section 12. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 14:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (177) specifically.</div>
<div class='msg'><time>2024-10-31 14:15</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: &gt; &lt;@gav:polkadot.io&gt; and as the GP says right above your selection, it&#x27;s defined in section 12.

Thanks I’ll take a look. Confusing though as there is no mention of C in 177 either. </div>
<div class='msg'><time>2024-10-31 14:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@jaymansfield:matrix.org&gt; Thanks I’ll take a look. Confusing though as there is no mention of C in 177 either.

<a href="https://graypaper.fluffylabs.dev/#/439ca37/179e02179e02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/439ca37/179e02179e02</a></div>
<div class='msg'><time>2024-10-31 14:19</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Oh thanks got it now! I should have specified which GP version. In v0.4.5 I found it as 182.</div>
<div class='msg'><time>2024-10-31 14:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I was just referencing the GP you used in your link, but yeah using numbers are a bad idea :) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 14:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@gav:polkadot.io&gt; Sounds right, yes.

Answered in the issue.</div>
<div class='msg'><time>2024-10-31 18:04</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: Hello, I have a few questions about the <a href="https://graypaper.fluffylabs.dev/#/439ca37/2f20022f2002" target="_blank" rel="noopener">solicit</a> host call for the accumulation host functions

1: This condition: <code>if h ≠ ∇ ∧ (h, z) /∈ (x_s)l</code> I assume should be <code>if h ≠ ∇ ∧ (h, z) /∈ K((x_s)l)</code> since <code>l</code> is a dictionary so here we are trying to verify if the key is in the dictionary

2: one line bellow here: <code>if (x_s)l[(h, z)] = [x, y]</code> I can&#x27;t figure out where do the _x_ and _y_ (italic) come from? (edit and _t_ as well) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 18:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. When it’s unambiguous then I don’t bother writing the extra K() since it clutters and adds no clarity. This is often the case in dictionaries when we care about key inclusion. </div>
<div class='msg'><time>2024-10-31 18:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 2. They are free variables defined by the fact that the value in question has two items.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-10-31 18:14</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: nevermind about <code>t</code> I see in the latest version it&#x27;s changed :)</div>
<div class='msg'><time>2024-10-31 18:16</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: So basically <code>if l = [x, y]</code> just means we check that there are two items</div>
<div class='msg'><time>2024-10-31 18:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes</div>
<div class='msg'><time>2024-10-31 21:37</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: <a href="https://github.com/gavofyork/graypaper/pull/121#discussion_r1823768372" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/121#discussion_r1823768372</a> what&#x27;s the reason to hash the preimage hash when serialize it into the state trie?</div>
<div class='msg'><time>2024-10-31 22:29</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The preimage hash is passed in to eg solicit directly, it&#x27;s trivial to pass in almost-colliding hashes. As the trie key construction function doesn&#x27;t preserve all hash bits, these almost-colliding hashes could actually collide in the trie if they are not hashed beforehand</div>
<div class='msg'><time>2024-11-03 11:24</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: In 150 (<a href="https://graypaper.fluffylabs.dev/#/364735a/159a00159e00)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/159a00159e00)</a> for every element <code>q</code> of <code>theta</code>, we are getting keys of <code>q</code>, but <code>theta</code> has this type: List[List[Tuple[WorkReport, Set[Hash]]]
So elements of <code>theta</code> are Lists, and I don&#x27;t understand the use of <code>K</code> on lists (It&#x27;s possible that I&#x27;m misunderstanding the formula)</div>
<div class='msg'><time>2024-11-03 17:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah it should be (w, d) in q. Will be corrected. </div>
<div class='msg'><time>2024-11-04 10:47</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: Hello, I would like to confirm if the gas calculation <a href="https://graypaper.fluffylabs.dev/#/364735a/2f38012f3b01" target="_blank" rel="noopener">here</a> is correct, it seems to me that <code>ω8</code> contains the memory address for memo</div>
<div class='msg'><time>2024-11-04 10:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Copy-paste error. g should be 10 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-04 16:43</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: <a href="https://graypaper.fluffylabs.dev/#/364735a/0f59020f6e02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/0f59020f6e02</a>

In phi, is correct that the size of the inner list is exactly Q? Q is <code>the maximum number of items in the authorizations queue</code>, so I expect to be <code>:Q</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-04 16:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: What is authoriser_queue?</div>
<div class='msg'><time>2024-11-04 16:50</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: phi is called authorizer queue in the graypaper

EDIT: I edited my question to match the GP <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-04 16:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Where does the “maximum number of items” come from? (The formalism is correct, it is the exact number not the maximum)</div>
<div class='msg'><time>2024-11-04 16:53</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: here (appendix I):  <a href="https://graypaper.fluffylabs.dev/#/364735a/3d6c003d6e00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/3d6c003d6e00</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-04 16:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ok that should not have the word “maximum” in there.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-04 16:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be corrected in the next release. </div>
<div class='msg'><time>2024-11-06 13:16</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: gav: is it possible to modify the formula numbering system within the graypaper? Currently, when formulas are added or removed, subsequent formula numbers shift, which can be problematic when referencing formulas from code.

A potential solution to this issue is to implement section-based numbering. For instance, the third formula in Chapter 10 would be labeled as 10.3. This approach would also enhance readability when formula numbers are referenced within the paper itself, as it would immediately indicate the formula&#x27;s location.</div>
<div class='msg'><time>2024-11-06 13:36</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@dakkk:matrix.org&gt; gav: is it possible to modify the formula numbering system within the graypaper? Currently, when formulas are added or removed, subsequent formula numbers shift, which can be problematic when referencing formulas from code.
&gt; 
&gt; A potential solution to this issue is to implement section-based numbering. For instance, the third formula in Chapter 10 would be labeled as 10.3. This approach would also enhance readability when formula numbers are referenced within the paper itself, as it would immediately indicate the formula&#x27;s location.

I&#x27;d love this. I do reference formulas in my code as well for future reference. I just recently added graypaper v number next to the formula &quot;Id&quot; but this suggestion is much more robust</div>
<div class='msg'><time>2024-11-06 13:38</time>&ensp;<span class='u' style='color:#92c76e'>rick</span>: &gt; &lt;@prematurata:matrix.org&gt; I&#x27;d love this. I do reference formulas in my code as well for future reference. I just recently added graypaper v number next to the formula &quot;Id&quot; but this suggestion is much more robust

Permanent formula ids would be very helpful</div>
<div class='msg'><time>2024-11-06 14:52</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: in <code>quit</code> host-call, if halt with a transfer, the service account balance will be below threshold balance, just wondering is the account supposed to be removed from state afterwards? I did not find such logic (maybe i missed it..)</div>
<div class='msg'><time>2024-11-06 17:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@qiwei:matrix.org&gt; in <code>quit</code> host-call, if halt with a transfer, the service account balance will be below threshold balance, just wondering is the account supposed to be removed from state afterwards? I did not find such logic (maybe i missed it..)

I&#x27;m not sure what you mean. The <code>quit</code> hostcall would delete the account in question.</div>
<div class='msg'><time>2024-11-07 15:14</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: Hey, is <code>d</code> <a href="https://graypaper.fluffylabs.dev/#/364735a/2bb1002bb100" target="_blank" rel="noopener">here</a> taken from <code>u</code> ? I don&#x27;t see it being explicitly defined anywhere <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-07 16:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes should be u_d - will be fixed in the next revision</div>
<div class='msg'><time>2024-11-07 18:33</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Is it intended that reports can sit around in rho essentially forever? Seems like some shenanigans might be possible if someone in control of a core leaves a report sitting there long enough for auditors to no longer be able to audit it</div>
<div class='msg reply'><time>2024-11-07 18:35</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I think there is timeout: if new report comes in and timeout has passed the old report is flushed and the new report takes place im rho</div>
<div class='msg reply'><time>2024-11-07 18:45</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: There is a timeout but the report is only discarded if a new one comes along to replace it. Someone in control of the core could ensure no other report comes along. Might not be abusable but doesn&#x27;t seem impossible to me and would be easy to fix by forcibly clearing reports after a certain amount of time</div>
<div class='msg reply'><time>2024-11-07 18:52</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: What does it mean to be &quot;in control of the core&quot; if validators are rotated within an epoch at high frequency?</div>
<div class='msg reply'><time>2024-11-07 18:54</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: If you mean the coretime owner, and they aren&#x27;t using their core at a high frequency, that&#x27;s not really a concern, I believe.</div>
<div class='msg reply'><time>2024-11-07 20:10</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Yes I mean the coretime owner. I&#x27;m not concerned about the core not getting used, I&#x27;m concerned about an invalid report potentially getting accumulated because noone audits it. The core not getting used would be a cost to execute this attack 😅</div>
<div class='msg reply'><time>2024-11-08 11:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I don&#x27;t think it matters - the only reason it wouldn&#x27;t go into accumulation is because it&#x27;s not yet available and if it happens to stick around for ages before 2/3+1 of validators finally all decide it is available, then there&#x27;s no great harm in initiating the auditing from that point. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-11-08 11:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Also, it&#x27;s not the coretime owner who can prevent its becoming available: it&#x27;s only the guarantors, and they do a switcheroo every 10 blocks. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-11-08 11:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If two guarantors and the coretime owner coordinated, then they could keep an unavailable WP in rho indefinitely and only choose to make it available at some arbitrary late stage (assuming the coretime owner has indefinite funds). But again, auditing only begins once available is assured.</div>
<div class='msg reply'><time>2024-11-08 11:40</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@gav:polkadot.io&gt; If two guarantors and the coretime owner coordinated, then they could keep an unavailable WP in rho indefinitely and only choose to make it available at some arbitrary late stage (assuming the coretime owner has indefinite funds). But again, auditing only begins once available is assured.

Yes this is the case I was imagining. Of course this assumes it is _possible_ to make the WP available at an arbitrary later point. It&#x27;s not obvious to me that this wouldn&#x27;t be possible. If you wait long enough to do this then auditors will be able to assemble the bundle but may not be able to check the report because they have discarded necessary state. What then?</div>
<div class='msg reply'><time>2024-11-08 11:43</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@gav:polkadot.io&gt; I don&#x27;t think it matters - the only reason it wouldn&#x27;t go into accumulation is because it&#x27;s not yet available and if it happens to stick around for ages before 2/3+1 of validators finally all decide it is available, then there&#x27;s no great harm in initiating the auditing from that point.

My point is that I think it _is_ harmful to kick off auditing so late as we don&#x27;t keep eg preimages forever</div>
<div class='msg'><time>2024-11-08 10:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2024-11-08 11:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: What state might they have discarded?</div>
<div class='msg'><time>2024-11-08 11:44</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@gav:polkadot.io&gt; What state might they have discarded?

Forgotten preimages for example</div>
<div class='msg'><time>2024-11-08 11:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I think the tolerances are pretty high on that, but it’s a lot easier to reason about correctness if it’s prevented outright. We can disable availability for WRs which should have timed out. This should avert any possibility of misuse.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-08 11:50</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: &gt; &lt;@dakkk:matrix.org&gt; gav: is it possible to modify the formula numbering system within the graypaper? Currently, when formulas are added or removed, subsequent formula numbers shift, which can be problematic when referencing formulas from code.
&gt; 
&gt; A potential solution to this issue is to implement section-based numbering. For instance, the third formula in Chapter 10 would be labeled as 10.3. This approach would also enhance readability when formula numbers are referenced within the paper itself, as it would immediately indicate the formula&#x27;s location.

If anyone is interested in using this type of numbering in their project, it is sufficient to put this line at the beginning of graypaper.tex:

``<code>\numberwithin{equation}{section}</code>``</div>
<div class='msg'><time>2024-11-10 19:38</time>&ensp;<span class='u' style='color:#bc4a3e'>basedafdev</span>: Screenshot 2024-11-10 at 2.38.09 PM.png</div>
<div class='msg'><time>2024-11-10 19:38</time>&ensp;<span class='u' style='color:#bc4a3e'>basedafdev</span>: in the latest GP, the state-key constructor for (service, hash) in the second term exceeds 32 bytes. E_4(l) ~ H(h) = 36 bytes. Unless i&#x27;m missing something here</div>
<div class='msg'><time>2024-11-11 06:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You’re not: there’s already a correction for it in my open PR: <a href="https://github.com/gavofyork/graypaper/commit/896430a35c6247175d0fdf41d2e791bacd2686e7" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/commit/896430a35c6247175d0fdf41d2e791bacd2686e7</a></div>
<div class='msg'><time>2024-11-14 03:58</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: Shouldn&#x27;t this <code>G</code> function in the definition of the <code>Accumulate</code> invocation take the status from the host call as well in the first argument?

<a href="https://graypaper.fluffylabs.dev/#/c71229b/2b6f022b6f02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/2b6f022b6f02</a>

Definition of the host call: <a href="https://graypaper.fluffylabs.dev/#/364735a/28a80228a802" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/28a80228a802</a></div>
<div class='msg'><time>2024-11-14 10:03</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: davxy: in your safrole test vectors, is it possible to know the validators&#x27; secret keys? </div>
<div class='msg'><time>2024-11-14 10:35</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: dakkk | JamPy: <code>i</code>-th key is geneted as follows:
1. interpret <code>i</code> as a 32 bit unsigned integer. 
2. Encode it in LE. 
3. Repeat the encoded value 8 times (you get a 32 bytes <code>data</code>)

- Ed25519 secret: is <code>data</code> 
- Bandersnatch secret: use <code>data</code> to call <code>Secret::from_seed</code> in ark-ec-vrfs</div>
<div class='msg'><time>2024-11-14 10:35</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: This is a trivial key generation used by the tests</div>
<div class='msg'><time>2024-11-14 10:47</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: &gt; &lt;@davxy:matrix.org&gt; dakkk | JamPy: <code>i</code>-th key is geneted as follows:
&gt; 1. interpret <code>i</code> as a 32 bit unsigned integer. 
&gt; 2. Encode it in LE. 
&gt; 3. Repeat the encoded value 8 times (you get a 32 bytes <code>data</code>)
&gt; 
&gt; - Ed25519 secret: is <code>data</code> 
&gt; - Bandersnatch secret: use <code>data</code> to call <code>Secret::from_seed</code> in ark-ec-vrfs

thank you (y) </div>
<div class='msg'><time>2024-11-14 11:33</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@davxy:matrix.org&gt; dakkk | JamPy: <code>i</code>-th key is geneted as follows:
&gt; 1. interpret <code>i</code> as a 32 bit unsigned integer. 
&gt; 2. Encode it in LE. 
&gt; 3. Repeat the encoded value 8 times (you get a 32 bytes <code>data</code>)
&gt; 
&gt; - Ed25519 secret: is <code>data</code> 
&gt; - Bandersnatch secret: use <code>data</code> to call <code>Secret::from_seed</code> in ark-ec-vrfs

not sure who&#x27;s behind jamcha.in but I&#x27;d suggest we all use this to generate keys</div>
<div class='msg'><time>2024-11-14 12:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@cisco:parity.io&gt; Shouldn&#x27;t this <code>G</code> function in the definition of the <code>Accumulate</code> invocation take the status from the host call as well in the first argument?
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/c71229b/2b6f022b6f02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/2b6f022b6f02</a>
&gt; 
&gt; Definition of the host call: <a href="https://graypaper.fluffylabs.dev/#/364735a/28a80228a802" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/28a80228a802</a>

Yes the triangle sign is in fact missing from a few places. Will be corrected in next release.</div>
<div class='msg'><time>2024-11-14 12:17</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: &gt; &lt;@davxy:matrix.org&gt; dakkk | JamPy: <code>i</code>-th key is geneted as follows:
&gt; 1. interpret <code>i</code> as a 32 bit unsigned integer. 
&gt; 2. Encode it in LE. 
&gt; 3. Repeat the encoded value 8 times (you get a 32 bytes <code>data</code>)
&gt; 
&gt; - Ed25519 secret: is <code>data</code> 
&gt; - Bandersnatch secret: use <code>data</code> to call <code>Secret::from_seed</code> in ark-ec-vrfs

Thank you for this! Needed it as well.</div>
<div class='msg'><time>2024-11-14 13:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@gav:polkadot.io&gt; Yes the triangle sign is in fact missing from a few places. Will be corrected in next release.

<a href="https://github.com/gavofyork/graypaper/pull/141" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/141</a></div>
<div class='msg'><time>2024-11-14 14:29</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Here, R looks like a function but it is multiplying with the inner term (t&#x27;/R -1)

<a href="https://graypaper.fluffylabs.dev/#/364735a/14f40214ff02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/14f40214ff02</a></div>
<div class='msg'><time>2024-11-14 15:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This (san-serif) R is a constant; it&#x27;s a simple product. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-14 15:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://graypaper.fluffylabs.dev/#/c71229b/3d6b003d6d00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/c71229b/3d6b003d6d00</a></div>
<div class='msg'><time>2024-11-14 20:51</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: The prerequisites of a work report are already a set, so shouldn&#x27;t <a href="https://graypaper.fluffylabs.dev/#/364735a/16c70016c900" target="_blank" rel="noopener">the D function</a> just do w_x_p U ...?</div>
<div class='msg'><time>2024-11-14 21:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@cisco:parity.io&gt; The prerequisites of a work report are already a set, so shouldn&#x27;t <a href="https://graypaper.fluffylabs.dev/#/364735a/16c70016c900" target="_blank" rel="noopener">the D function</a> just do w_x_p U ...?

Yes. Will be fixed in next release</div>
<div class='msg'><time>2024-11-14 21:27</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I have a question about acc history. According to <a href="https://graypaper.fluffylabs.dev/#/364735a/162000162800" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/162000162800</a> , its a <code>E long sequence of Hash sets</code> 

When merkleizing <a href="https://graypaper.fluffylabs.dev/#/364735a/34fa0234fc02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/34fa0234fc02</a> we&#x27;re asked to serialize it but C.1.7 <a href="https://graypaper.fluffylabs.dev/#/364735a/33d70033d700" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/33d70033d700</a> defines set serialization which if intended to be used for ξ encoding, then it means we won&#x27;t be able to decode it (due to not containing length discriminator). Right now we don&#x27;t really need to decode it but not sure this is intended</div>
<div class='msg'><time>2024-11-15 08:44</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: Your assumptions seems correct, but the state serialization is not intendeed to be &quot;reversible&quot; <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-15 08:47</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@dakkk:matrix.org&gt; Your assumptions seems correct, but the state serialization is not intendeed to be &quot;reversible&quot;

I agree with you but, according to my (bad) memory this is the only case when we serialize something but we are unable to deserialize it... I wonder if we really want to introduce a first here</div>
<div class='msg'><time>2024-11-15 08:49</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: &gt; &lt;@prematurata:matrix.org&gt; I agree with you but, according to my (bad) memory this is the only case when we serialize something but we are unable to deserialize it... I wonder if we really want to introduce a first here

it&#x27;s not the first case; check preimage metadata serialization key: we are hashing an hash, that&#x27;s not reversible</div>
<div class='msg'><time>2024-11-15 08:51</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: &gt; &lt;@dakkk:matrix.org&gt; it&#x27;s not the first case; check preimage metadata serialization key: we are hashing an hash, that&#x27;s not reversible

I knew my bad memory failed me again =) tkz</div>
<div class='msg'><time>2024-11-15 08:54</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: &gt; &lt;@prematurata:matrix.org&gt; I knew my bad memory failed me again =) tkz

No problem; btw it would be an interesting feature to have a deserializable encoding of the state, so for instance we can use it for storing on disk. But as mentioned earlier it is not the main purpose of this</div>
<div class='msg'><time>2024-11-15 09:48</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: we don’t really need the ability to decide state key for node usage. so it  is mostly useful as a dev / debug / indexing needs. the simple solution is just save the preimage in a aux store next to the state store</div>
<div class='msg'><time>2024-11-15 09:59</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: We need to be able to decode state values for warp sync so this does seem like an oversight. In any case if there is an ambiguous encoding that results in two different states having the same state root this is at the least not ideal...</div>
<div class='msg'><time>2024-11-15 10:02</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: In general it should be possible to execute a block given just the initial state trie without needing a &quot;real&quot; state to deal with ambiguity</div>
<div class='msg'><time>2024-11-15 10:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; I have a question about acc history. According to <a href="https://graypaper.fluffylabs.dev/#/364735a/162000162800" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/162000162800</a> , its a <code>E long sequence of Hash sets</code> 
&gt; 
&gt; When merkleizing <a href="https://graypaper.fluffylabs.dev/#/364735a/34fa0234fc02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/34fa0234fc02</a> we&#x27;re asked to serialize it but C.1.7 <a href="https://graypaper.fluffylabs.dev/#/364735a/33d70033d700" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/33d70033d700</a> defines set serialization which if intended to be used for ξ encoding, then it means we won&#x27;t be able to decode it (due to not containing length discriminator). Right now we don&#x27;t really need to decode it but not sure this is intended

this is an oversight. It will be fixed in 0.5.0 (state encoding of curly E will have a length prefixes)</div>
<div class='msg'><time>2024-11-15 10:09</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: since 0.5.0 is merged do you think it would be better to have formula numbers follow the subchapters as well? ex...

when reading chapter 12.2, the current 0.5.0 first formula is 12.13. what about (not sure it&#x27;s possible in latex) renaming 12.13 to 12.2.1?</div>
<div class='msg'><time>2024-11-15 10:09</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: gav <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-15 10:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No 0.5.0 has been tagged or released.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-15 10:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I’d avoid paying too much attention to the versions of main branch. </div>
<div class='msg'><time>2024-11-15 10:11</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: yeah i should have better explained myself. nevertheless what do you htink about changing the formula numbering a bit further?</div>
<div class='msg'><time>2024-11-15 10:12</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: i think it would be beneficial to encode the subsection in the formula numbering as well</div>
<div class='msg'><time>2024-11-15 10:25</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Is there any particular reason why <code>lower</code> and <code>higher</code> bits of the two U64s are in a different order in registers than in case of <code>new</code> and <code>transfer</code>? My OCD is killing me:
<a href="https://graypaper.fluffylabs.dev/#/364735a/2e0d032e0d03" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/2e0d032e0d03</a></div>
<div class='msg'><time>2024-11-15 11:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; since 0.5.0 is merged do you think it would be better to have formula numbers follow the subchapters as well? ex...
&gt; 
&gt; when reading chapter 12.2, the current 0.5.0 first formula is 12.13. what about (not sure it&#x27;s possible in latex) renaming 12.13 to 12.2.1?

To be honest, the bigger size of formula numbers is already screwing up the layouts. </div>
<div class='msg'><time>2024-11-15 11:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I don&#x27;t want to make it any worse that it needs to be.</div>
<div class='msg'><time>2024-11-15 11:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@tomusdrw:matrix.org&gt; Is there any particular reason why <code>lower</code> and <code>higher</code> bits of the two U64s are in a different order in registers than in case of <code>new</code> and <code>transfer</code>? My OCD is killing me:
&gt; <a href="https://graypaper.fluffylabs.dev/#/364735a/2e0d032e0d03" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/2e0d032e0d03</a>

It&#x27;s not an issue in 0.5.0</div>
<div class='msg'><time>2024-11-15 19:56</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Might be a dumb question, but shouldn&#x27;t creating a service with code larger than <code>W_C</code> be disallowed? AFAIU it will not run yielding <code>BIG</code>, but why allow <code>new</code> host call to succeed at all? <a href="https://graypaper.fluffylabs.dev/#/364735a/2e80022e8002" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/2e80022e8002</a></div>
<div class='msg'><time>2024-11-15 19:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It avoids the need for the code to be fetched (and fetchable) at time of service creation. </div>
<div class='msg'><time>2024-11-15 20:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s not like you can’t put a huge preimage into a service’s storage if you’re willing to pay. </div>
<div class='msg'><time>2024-11-15 20:01</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: &gt; &lt;@gav:polkadot.io&gt; It avoids the need for the code to be fetched (and fetchable) at time of service creation.

not sure I get it. If I understand correctly <code>l</code> is the code length, and the <code>new</code> host call could just end with some error code if <code>l &amp;gt;= W_C</code>.</div>
<div class='msg'><time>2024-11-15 20:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: yes, there could be a check on <code>l</code></div>
<div class='msg'><time>2024-11-15 20:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But (assuming we keep the check where it’s actually used) then it’s one extra piece of math that’s not really needed</div>
<div class='msg'><time>2024-11-15 20:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I guess the check could be moved here though. </div>
<div class='msg'><time>2024-11-15 20:03</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: I see. Though, you could still have some genesis services with code larger than <code>W_C</code> if it&#x27;s checked only in <code>new</code>. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-15 20:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah. Though then it’d be the chain publishers fault if it screwed the PVM</div>
<div class='msg'><time>2024-11-15 20:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Realistically implementations will likely need to limit the PVM code size so if the protocol theoretically supports unlimited blob sizes if they’re added in genesis it’s a bit problematic</div>
<div class='msg'><time>2024-11-15 20:06</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Well, if it&#x27;s not explicit in GP it could lead to some cross-implementation issues. My curiosity is satisfied though. So up to you where the check should be :) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-17 11:16</time>&ensp;<span class='u' style='color:#dbc767'>stanleyli</span>: image.png</div>
<div class='msg'><time>2024-11-17 11:16</time>&ensp;<span class='u' style='color:#dbc767'>stanleyli</span>: Hello guys, I have a question about the pageproof, according to the definition in the GP, constructing a Merkle Tree appears to follow the diagram provided. In this context, B(1,2) represents the branch of leaf 1 and leaf 2, and its calculation method is described as H($node ⌢ N(v\_{...|v|/2}, H) ⌢ N(v\_{|v|/2...}, H)).<a href="https://graypaper.fluffylabs.dev/#/364735a/354e0135ac01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/354e0135ac01</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-17 11:18</time>&ensp;<span class='u' style='color:#dbc767'>stanleyli</span>: Meanwhile, when calculating the Trace path, the method outlined in the GP is N(P(v, i), H).<a href="https://graypaper.fluffylabs.dev/#/364735a/364500360301" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/364500360301</a></div>
<div class='msg'><time>2024-11-17 11:18</time>&ensp;<span class='u' style='color:#dbc767'>stanleyli</span>: The methos doesn&#x27;t have any problem, but it leads to a final result formatted as [hash, hash ... hash, blob], where the earlier elements are hashes, but the last becomes a blob (length = G = 4104). This results in a significantly longer output length overall.

Would it make sense to modify the N() function so that it returns H(v) when |v|=1? This way, every node would consistently be a hash, and each element in the trace path would have a uniform length of hash.

Or perhaps I’ve misunderstood something?
 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-18 08:57</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: <a href="https://graypaper.fluffylabs.dev/#/364735a/2cfc012cfc01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/2cfc012cfc01</a>

Here we are fetching 32 bytes preimage hash from memory and then hashing it again, is it right?</div>
<div class='msg'><time>2024-11-18 10:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@amritj:matrix.org&gt; <a href="https://graypaper.fluffylabs.dev/#/364735a/2cfc012cfc01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/364735a/2cfc012cfc01</a>
&gt; 
&gt; Here we are fetching 32 bytes preimage hash from memory and then hashing it again, is it right?

Correct.</div>
<div class='msg'><time>2024-11-18 11:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@stanleyli:matrix.org&gt; The methos doesn&#x27;t have any problem, but it leads to a final result formatted as [hash, hash ... hash, blob], where the earlier elements are hashes, but the last becomes a blob (length = G = 4104). This results in a significantly longer output length overall.
&gt; 
&gt; Would it make sense to modify the N() function so that it returns H(v) when |v|=1? This way, every node would consistently be a hash, and each element in the trace path would have a uniform length of hash.
&gt; 
&gt; Or perhaps I’ve misunderstood something?

The justification function curly-J uses the constancy function _C_, which basically hashes all data items before passing them in to the trace function _T_.</div>
<div class='msg'><time>2024-11-18 11:48</time>&ensp;<span class='u' style='color:#dbc767'>stanleyli</span>: Understand! Thanks a lot.</div>
<div class='msg'><time>2024-11-19 15:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Graypaper <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.5.0" target="_blank" rel="noopener">version 0.5.0</a> is out. No vectors yet but they should be coming soon. There are several important changes, chiefly to the PVM, which is now 64-bit.</div>
<div class='msg'><time>2024-11-20 11:48</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: In Appendix I, there is a <code>ZG = 2^14: The standard pvm program initialization page size. See section A.7.</code>, but A.7 is still using ZP, maybe need to update to use ZG?</div>
<div class='msg'><time>2024-11-20 14:38</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: </div>
<div class='msg'><time>2024-11-20 15:35</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: Is it correct to deduct that in order to complete Milestone 1 of JAM prize we need to wait version 1.0 of the graypaper? Or can we deliver an 0.5 implementation? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-21 07:19</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Some candidate 32=&gt;64:

- service id might be 64-bit? <a href="https://graypaper.fluffylabs.dev/#/911af30/10da0010da00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/10da0010da00</a>
thus new&#x27;s check/bump would need adjustment <a href="https://graypaper.fluffylabs.dev/#/911af30/30e00230e002" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/30e00230e002</a>
<a href="https://graypaper.fluffylabs.dev/#/911af30/2da2032da203" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/2da2032da203</a>
- invoke 60 byte is 8+13\*8=112 byte with 4 =&gt; 8
<a href="https://graypaper.fluffylabs.dev/#/911af30/342a01342a01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/342a01342a01</a>
<a href="https://graypaper.fluffylabs.dev/#/911af30/346101346101" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/346101346101</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-21 09:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Some candidate 32=&gt;64:
&gt; * service id might be 64-bit? <a href="https://graypaper.fluffylabs.dev/#/911af30/10da0010da00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/10da0010da00</a>
&gt; thus new&#x27;s check/bump would need adjustment <a href="https://graypaper.fluffylabs.dev/#/911af30/30e00230e002" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/30e00230e002</a>
&gt; <a href="https://graypaper.fluffylabs.dev/#/911af30/2da2032da203" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/2da2032da203</a>
&gt; * invoke 60 byte is 8+13*8=125 byte with 4 =&gt; 8
&gt; <a href="https://graypaper.fluffylabs.dev/#/911af30/342a01342a01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/342a01342a01</a>
&gt; <a href="https://graypaper.fluffylabs.dev/#/911af30/346101346101" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/346101346101</a>
&gt; 

Service ID remains 32-bit (for now)</div>
<div class='msg'><time>2024-11-21 09:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/150" target="_blank" rel="noopener">Invoke will be fixed in the next revision</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-21 17:43</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Good afternoon everyone. I was hoping someone could shed some light on how to generate the accumulate root thats in block history? Not sure how it differs from the mmr peaks I already generated in the history items. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-22 13:52</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: A total of 5 suggested changes to Graypaper Appendix A regarding the change to 64bit.
Allowing up to 8 octets of input for the signed extension function. 
PR: <a href="https://github.com/gavofyork/graypaper/pull/151" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/151</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-23 06:58</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Small suggestion: the epoch marker here <a href="https://graypaper.fluffylabs.dev/#/911af30/0e52030e5203" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/0e52030e5203</a> may use $\\eta\_0$ and $\\eta\_1$ instead of $\\eta\_1&#x27;$ and $\\eta\_2&#x27;$ to keep the dependency graph here <a href="https://graypaper.fluffylabs.dev/#/911af30/098001098001" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/098001098001</a> clean and easy to reason about -- its equivalent based on <a href="https://graypaper.fluffylabs.dev/#/911af30/0e57020e5702" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/0e57020e5702</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-24 14:44</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: <a href="https://graypaper.fluffylabs.dev/#/911af30/0d63000d7c00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/0d63000d7c00</a>
Hello, (6.2) this R as remainder will strongly misunderstand by the constant R in Appendix. While the equation itself appears valid, it could lead to misunderstanding when reading the entire GP. Is there a better way to express this equation to avoid ambiguity&quot; <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-24 15:41</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hey guys, in the <code>refinement context</code> what&#x27;s the difference between the anchor (<code>a</code>) and the lookup-anchor (<code>l</code>) ?</div>
<div class='msg'><time>2024-11-24 17:19</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Perhaps I&#x27;m missing something, but it&#x27;s not clear to me what should happen with memory cells between <code>l</code> and <code>|v|</code> in case <code>l &amp;lt; |v|</code> in <code>import</code>. Should these be zeroed or just left as is?
<a href="https://graypaper.fluffylabs.dev/#/911af30/32e20232e202" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/32e20232e202</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-24 17:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@yu2c:matrix.org&gt; <a href="https://graypaper.fluffylabs.dev/#/911af30/0d63000d7c00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/0d63000d7c00</a>
&gt; Hello, (6.2) this R as remainder will strongly misunderstand by the constant R in Appendix. Is there any better expression for this equation?

It is pretty standard (e.g. <a href="https://study.com/academy/lesson/remainder-in-math-definition-theorem-examples.html#:~:text=The%20expression%20for%20division%20is,long%20division%20method%20is%20used" target="_blank" rel="noopener">here</a> ) But I can probably circle it or something to make it more explicit.</div>
<div class='msg'><time>2024-11-24 17:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@tomusdrw:matrix.org&gt; Perhaps I&#x27;m missing something, but it&#x27;s not clear to me what should happen with memory cells between <code>l</code> and <code>|v|</code> in case <code>l &amp;lt; |v|</code> in <code>import</code>. Should these be zeroed or just left as is?
&gt; <a href="https://graypaper.fluffylabs.dev/#/911af30/32e20232e202" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/32e20232e202</a>

that should have bold <code>v</code> replaced with bold <code>v_...l</code></div>
<div class='msg'><time>2024-11-24 17:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So that memory would stay unchanged <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-24 17:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In summary, anchor is used to anchor the WP (and thus WR) to a particular block which must (still) be in recent history when reported and ensures that the WP is recent. Lookup-anchor need not be very recent at all (it can be quite old), but must be finalised; this is used to ensure that the point at which the <code>historical_lookup</code> (in <code>refine</code>) is both finalised and within the amount of lookup-history which we maintain on-chain. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-24 17:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You can find out more by reading the section on Reporting (for anchor) and the <code>historical_lookup</code> and its dependent function (for lookup-anchor)</div>
<div class='msg'><time>2024-11-24 17:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Small suggestion: the epoch marker here <a href="https://graypaper.fluffylabs.dev/#/911af30/0e52030e5203" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/0e52030e5203</a> may use $\\eta\_0$ and $\\eta\_1$ instead of $\\eta\_1&#x27;$ and $\\eta\_2&#x27;$ to keep the dependency graph here <a href="https://graypaper.fluffylabs.dev/#/911af30/098001098001" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/098001098001</a> clean and easy to reason about -- its equivalent based on <a href="https://graypaper.fluffylabs.dev/#/911af30/0e57020e5702" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/0e57020e5702</a>

Feel free to make a PR.</div>
<div class='msg reply'><time>2024-11-25 00:14</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Sure -- <a href="https://github.com/gavofyork/graypaper/pull/154" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/154</a></div>
<div class='msg'><time>2024-11-25 08:02</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: could someone clarify please

in chapter 4 we have PVM memory with page size of 2^12 <a href="https://graypaper.fluffylabs.dev/#/911af30/2b94002b9400" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/2b94002b9400</a>

in appendix A, in (A.31) (A.34) we have page size of 2^14 <a href="https://graypaper.fluffylabs.dev/#/911af30/2afe022afe02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/2afe022afe02</a>
which one is it?

thanks




</div>
<div class='msg'><time>2024-11-25 08:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@luke_fishman:matrix.org&gt; could someone clarify please
&gt; 
&gt; in chapter 4 we have PVM memory with page size of 2^12 <a href="https://graypaper.fluffylabs.dev/#/911af30/2b94002b9400" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/2b94002b9400</a>
&gt; 
&gt; in appendix A, in (A.31) (A.34) we have page size of 2^14 <a href="https://graypaper.fluffylabs.dev/#/911af30/2afe022afe02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/2afe022afe02</a>
&gt; which one is it?
&gt; 
&gt; thanks

Some of those instances of Z_P should have been renamed to Z_G. Will be <a href="https://github.com/gavofyork/graypaper/pull/150/commits/10e09e6d1bfb0e3ec37e8007ee9deef850059abd" target="_blank" rel="noopener">fixed</a> in 0.5.1</div>
<div class='msg'><time>2024-11-25 08:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There is only one PVM page size (2^12)</div>
<div class='msg'><time>2024-11-25 08:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: However specifically and only for standard memory initialization, we use an additional two initialization &quot;page&quot; sizes (2^14 and 2^16) in the math. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-25 08:15</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: ok. Thank you Gav. </div>
<div class='msg'><time>2024-11-25 08:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I cleaned up the wording further in an additional commit. </div>
<div class='msg'><time>2024-11-25 12:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Further simplifications are incoming here: <a href="https://github.com/gavofyork/graypaper/pull/150/commits/1648b20a3cf4b1c730083c8033f649306d4d17a5" target="_blank" rel="noopener">Simplify initialization memory layout.</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-25 16:24</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: davyx raised a dilemma over gas constants; if <code>G_T</code> is <code>the total gas allocated across all cores for accumulation</code>, and <code>G_A</code> is <code>the total gass allocated to a core for accumulation</code>, should <code>G_A</code> be <code>G_T / C</code>?

<a href="https://graypaper.fluffylabs.dev/#/911af30/3f43003f5200" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/3f43003f5200</a></div>
<div class='msg'><time>2024-11-25 16:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; davyx raised a dilemma over gas constants; if <code>G_T</code> is <code>the total gas allocated across all cores for accumulation</code>, and <code>G_A</code> is <code>the total gass allocated to a core for accumulation</code>, should <code>G_A</code> be <code>G_T / C</code>?
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/911af30/3f43003f5200" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/3f43003f5200</a>

No not any more</div>
<div class='msg'><time>2024-11-25 16:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Because there is queuing and always accumulate services</div>
<div class='msg'><time>2024-11-25 16:40</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: Got it; so the always accumulated services and queuing would have the majority of the available gas, 341000000 - (341\*100000) = 306900000 (~90%); is it the correct order of magnitude? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-25 17:54</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: The doubt is mostly about the big 🍰 reserved for queued and always accumulate services</div>
<div class='msg'><time>2024-11-25 18:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@dakkk:matrix.org&gt; Got it; so the always accumulated services and queuing would have the majority of the available gas, 341000000 - (341\*100000) = 306900000 (~90%); is it the correct order of magnitude?

Well no not necessarily but the fact that always-accumulate exists at all means they can’t necessarily be equivalent. </div>
<div class='msg'><time>2024-11-26 00:22</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: <a href="https://graypaper.fluffylabs.dev/#/911af30/36cb02362803" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/36cb02362803</a>

Can state-key constructor functions C be enhanced with a &quot;type&quot; identifier? something like:

<pre><code class=''>(i ∈ N28, t ∈ N2) ↦ [i, 0, 0, . . . ,t]
(i, s ∈ NS, t ∈ N2) ↦ [i, n0, 0, n1, 0, n2, 0, n3, 0, 0, . . . ,t] where n = E4(s) 
(s, h, t) ↦ [n0, h0, n1, h1, n2, h2, n3, h3, h4, h5, . . . , h26, t] where n = E4(s)
</code></pre>

so that we can determine the expected type (δ, a\_s, a\_p, a\_l) from the C key alone? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-26 05:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: t is Boolean? I’m not sure what’s going on here</div>
<div class='msg'><time>2024-11-26 06:49</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: &quot;T&quot; is intended to be a type identifier (octet) so that it can potentially support up to 255 different types in state merklelization.
C1-C15 and account related states (i.e., δ, a_s, a_p, a_l) are all different types. I think it&#x27;s probably beneficial to have one octet from C key as a way to &quot;validate&quot; what encoded struct we are expecting (if collision is not a concern)? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-26 06:55</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: Right now it&#x27;s quite difficult to differentiate account related states (i.e., δ, a_s, a_p, a_l) from C key alone without this &quot;type identifier&quot;.  </div>
<div class='msg'><time>2024-11-26 07:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The first two key compositions should be easy to spot given the zeroes. The last one is harder, sure because of the information density, but precisely because of this we can’t really afford to waste a byte as that would further reduce the cryptographic security. </div>
<div class='msg'><time>2024-11-26 17:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: For general fuzz testing of JAM implementers STF in a &quot;jamblocks&quot; tester, we would like to represent 4 components (i.e., δ, a_s, a_p, a_l) of service state, expanding from this starting point

<a href="https://github.com/davxy/jam-test-vectors/blob/d4a7c879f54166ba9e505e2440f0b9b99c1dd9b8/reports/tiny/bad_service_id-1.json#L256-L268" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/blob/d4a7c879f54166ba9e505e2440f0b9b99c1dd9b8/reports/tiny/bad_service_id-1.json#L256-L268</a>

</div>
<div class='msg'><time>2024-11-26 17:46</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: to include the original inputs to C
(a) s for <a href="https://graypaper.fluffylabs.dev/#/911af30/371402371402" target="_blank" rel="noopener">δ</a>
(b) k (original 32-bit) for [a\_s]( <a href="https://graypaper.fluffylabs.dev/#/911af30/372a02372a02)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/372a02372a02)</a>
(c) h (original 32-bit) for [a\_p]( <a href="https://graypaper.fluffylabs.dev/#/911af30/373d02373d02)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/373d02373d02)</a>
(d) (h, l) for <a href="https://graypaper.fluffylabs.dev/#/911af30/375002375002" target="_blank" rel="noopener">a\_l</a>

This would require that implementers keep all the metadata { s, k, h, l } for all of (a)-(d), and is useful for implementers to debug in M1-M4.  May I suggest that we have a nice human reasonable JSON format and a matching state trie dump codec  test vector that is not just raw key-vals but organized by serviceID complete with this additional metadata { k, h, l }. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-26 17:58</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: By making the state trie JSON+codec representation non-lossy in having the original inputs for C that decide the keys (at the cost of making JAM implementers have slightly more bookkeeping), we have something better than the raw key-vals 
<a href="https://github.com/jam-duna/jamtestnet/blob/main/traces/assurances/jam\_duna/traces/395473\_011.json" target="_blank" rel="noopener">https://github.com/jam-duna/jamtestnet/blob/main/traces/assurances/jam\_duna/traces/395473\_011.json</a>
requiring a bunch of guesswork.   I would further suggest that this motivates a meaningful improvement to CE129
 <a href="https://github.com/zdave-parity/jam-np/issues/1" target="_blank" rel="noopener">https://github.com/zdave-parity/jam-np/issues/1</a>
which I believe is only for debugging purposes (confirm?). 

I claim that the additional cost of bookkeeping by JAM implementers will be happily borne to save tons of debugging time later.  

Do you agree?  If not, why not? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-11-26 21:31</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I&#x27;ve replied to the issue in the <code>jam-np</code> repo</div>
<div class='msg reply'><time>2024-11-26 21:35</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: FWIW it is possible for a node to maintain the &quot;original&quot; state keys if it executes every block from genesis, but in the case of warp sync this is _not_ possible because not all bits of the original state keys influence the state root and so they cannot all be proven</div>
<div class='msg reply'><time>2024-11-26 21:37</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: One further issue is that in the case of the preimage lookup dictionary l, the key transformation involves a hash and so cannot be reversed</div>
<div class='msg reply'><time>2024-11-26 21:39</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: In that case you could track the original key and prove this, but if we really want to address this issue I think the simpler solution is to simply include the original key in the transformed value</div>
<div class='msg reply'><time>2024-11-26 21:43</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: We could possibly do a similar thing for the discarded key bits</div>
<div class='msg reply'><time>2024-11-26 21:43</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Of course this adds complexity, which I think is the reason Gav hasn&#x27;t done it (not that I can speak for him)</div>
<div class='msg reply'><time>2024-11-26 23:04</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: there is no reason why we can&#x27;t have an extra aux store to store the preimages / hash mappings to support reverse lookup. this is something like archive node feature that&#x27;s optional but nice to have thing. I don&#x27;t think it needs be spec&#x27;ed</div>
<div class='msg reply'><time>2024-11-27 01:36</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Since CE129 is not intended for debug purposes but for warp-sync, this issue is not relevant, thank you.  Closed the issue =). But the general need for a state representation for STF testing (and debugging state) is still there.

For the syncing problem, we do need a clear understanding of how implementations should do the warp sync with CE129 and how AuditDA (1 hour) and ImportDA (28 days) should work at similar timescales, right? We imagine syncing could be skipped for AuditDA but ImportDA cannot.  We doubt teams need to implement it until getting through M1+M2, right?

We should spec out the RPC endpoints (with JSON request/responses) to cover the debugging case of state sharing without regard to CE 129 warp syncing... and the top 10 others.   <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-11-27 01:46</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Don&#x27;t understand what you mean by skipping sync for DA? Could you elaborate?</div>
<div class='msg reply'><time>2024-11-27 03:35</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: A new validator who joins a JAM network has to get all chunks associated with its validator index -- for both AuditDA (1 hour) and ImportDA (28 days).  For Audit DA, if there is some upper bound on how many new validators can join (not sure about where this will happen) then within an hour of participating its up to date -- so a new validator could &quot;skip&quot; this Audit DA syncing operation since there is so much redundancy.    Or it could look through the last hours worth of work reports and ask the guarantors for its chunks.

But for Import DA, the new validator should have some fast way of getting all the chunks its responsible for holding.  It could look through the last 28 days of work reports and ask the guarantors for its chunks .. but I am not sure that it can.</div>
<div class='msg reply'><time>2024-11-27 09:16</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Where did you get that from? Once enough validators claim receipt of their shards I do not believe there is any requirement for the guarantors of a report to send out more shards. There is also no mechanism for validators to report that they have obtained the shards after this point, although you could argue that isn&#x27;t really necessary.</div>
<div class='msg reply'><time>2024-11-27 16:47</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Consider the situation where on Dec 1 there is a segment exported in a V=1024 network.  Under normal conditions, up to 2/3 of the network can be dead and the segment will be available in ImportDA.

BUT if every day from Dec 1 to 11, 100 validators leave and 100 new join to take their place, in such a way that the entire network has been completely replaced, but 
(a) no one has the data to reconstruct the segment
(b) no one in the new set has used any JAMNP method to fetch their chunk from the guarantor, 
what happens?  

I think the present answer is &quot;there is no plan&quot;.

If the plan is &quot;oh we have 28 day unbonding periods&quot;, what happens with unbonding queues that are way shorter than that?

This sets my expectation that we need a way to have ImportDA syncs for a changing of the guard, where one validator takes the place of another at a specific validator index.   <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-11-27 16:49</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: <a href="https://github.com/polkadot-fellows/RFCs/blob/main/text/0097-unbonding_queue.md" target="_blank" rel="noopener">https://github.com/polkadot-fellows/RFCs/blob/main/text/0097-unbonding_queue.md</a></div>
<div class='msg reply'><time>2024-11-27 16:54</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: There is a question of whether there are sufficient incentives for old validators to maintain import DA data and make it available to the current validator set for the full 28 days. I don&#x27;t know the answer to that.</div>
<div class='msg reply'><time>2024-11-27 16:56</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: AFAIK though there is no mechanism to &quot;hand over&quot; import DA data to new validators</div>
<div class='msg'><time>2024-11-27 16:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Indeed there is not. Thus far the assumption is that it doesn’t matter. </div>
<div class='msg'><time>2024-11-27 16:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (Ie churn will be sufficiently small)</div>
<div class='msg'><time>2024-11-27 17:06</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Concerning the accumulation queue, we are struggling to come up with a test case where we have 12.3 <a href="https://graypaper.fluffylabs.dev/#/911af30/167100167100" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/167100167100</a> filled with anything because 11.38 <a href="https://graypaper.fluffylabs.dev/#/911af30/156001156001" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/156001156001</a> makes it difficult to impossible to do so.   

Concretely, if package M has package F as a prerequisite, because of 11.38 requirement, M can&#x27;t even get a work report in for 12.3 to matter.   Put another way, 11.38 has prereqs constraining refine of M before 12.3 accumulation can matter.  
How can we get a good test case for accumulation queue then?  

We must be misunderstanding something here.</div>
<div class='msg'><time>2024-11-27 17:09</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: AIUI the dependencies stuff in the backend is to deal with availability of work reports happening out of order</div>
<div class='msg'><time>2024-11-27 17:09</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Or not happening at all</div>
<div class='msg'><time>2024-11-27 17:10</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: So say you have two WPs A and B, with B depending on A. A and B can be reported in the same block. If B becomes available before A then it will enter the &quot;ready&quot; queue but must wait for A to be made available and accumulated before it can be accumulated itself. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-27 17:14</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Here is the thing -- by 11.38 B cannot become available before A because of this requirement <a href="https://graypaper.fluffylabs.dev/#/911af30/156001156001" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/156001156001</a></div>
<div class='msg'><time>2024-11-27 17:15</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: That&#x27;s a requirement for reporting. Availability happens after this</div>
<div class='msg'><time>2024-11-27 17:17</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: If B doesn&#x27;t get reported until A is reported, there is no way for B to become available before A, right?  No &quot;If B becomes available before A&quot; possibility exists then, thus no way for the accumulation queue to be filled with B.   <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-27 17:19</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Why do you say that? The availability of the two packages is pretty independent</div>
<div class='msg'><time>2024-11-27 17:20</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: For one if the guarantors for A go offline then A just won&#x27;t become available at all</div>
<div class='msg'><time>2024-11-27 17:31</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: 1. For guarantors, they can assure the data as soon as they generated the work report.
2. For non-guarantors, they will only be able to assure the data based on observing a guarantee extrinsic that includes a work report.  
The majority of the network (all but 2 or 3 validators out of V) is in 2.  

So for the B-depends-on-A:
* By 11.38 requirement on reporting/guarantees, there is no way to generate a work report for B until A has a work report
* Because of 2, the majority of the network cannot provide an assurance
* Because the above &quot;the majority of the network cannot provide an assurance&quot;, we are having difficulty generating any situation where 12.3 accumulation queue is filled with anything.

What are we getting wrong in the above chain of logic?  Is there a test case where 12.3 accumulation queue is filled with anything?

Note that we ARE able to generate a test case like this:
(1) |E_G|=2, where refine of A+B are executed _in the same slot_ 
(2) |E_A|=V, where all V validators assure both A+B and then due to the &quot;B depending on A&quot; first A is accumulated (having no dependencies) then B (having a dependency on A)</div>
<div class='msg'><time>2024-11-27 17:35</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: and what we have to do to get a test case working is:
(1) |E_G|=2, where refine of A+B are executed in the same slot (that is, 11.38 is NOT a problem)
then simulate a forced delay of assurances in order to get our accumulation queue filled.  Is this the only way?</div>
<div class='msg'><time>2024-11-27 17:36</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: What do you mean by &quot;Because of 2, the majority of the network cannot provide an assurance&quot;</div>
<div class='msg'><time>2024-11-27 17:39</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: If in your test case all reports are assured immediately then no you probably won&#x27;t get anything in the queue. So yes your test needs to simulate assurances being delayed. Not sure why this is impossible?</div>
<div class='msg'><time>2024-11-27 17:40</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Not impossible -- but our belief is that this is the only way.  Can you think of another?</div>
<div class='msg'><time>2024-11-27 17:41</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@dave:parity.io&gt; AIUI the dependencies stuff in the backend is to deal with availability of work reports happening out of order

Not aware of one. As I said, I believe the entire point of the dependencies stuff is to deal with this happening.</div>
<div class='msg'><time>2024-11-27 17:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: ok, great, we don&#x27;t have a misconception, thank you!</div>
<div class='msg'><time>2024-11-29 05:31</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: <a href="https://graypaper.fluffylabs.dev/#/911af30/162e02162f02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/162e02162f02</a>
Potential typo: &quot;the queue of work-reports&quot; should be &quot;the queue of authorizers&quot;?</div>
<div class='msg'><time>2024-11-29 08:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Correct! Will be fixed in next revision. </div>
<div class='msg'><time>2024-11-29 13:05</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: <a href="https://graypaper.fluffylabs.dev/#/911af30/2af3002a0801" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/2af3002a0801</a>
<a href="https://graypaper.fluffylabs.dev/#/911af30/23b20123c401" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/23b20123c401</a>
^ It seems type for the instruction counter is missing in these definitions

<a href="https://graypaper.fluffylabs.dev/#/911af30/2bd8012bd801" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/2bd8012bd801</a>
^ And type for the instruction could be <code>N_R</code>, it is currently marked as <code>N</code>.</div>
<div class='msg'><time>2024-11-29 15:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Will be corrected in 0.5.1: PVM: <a href="https://github.com/gavofyork/graypaper/pull/150/commits/6ad68fe00c8800c750118574ea6e5bc901530bba" target="_blank" rel="noopener">Don&#x27;t forget the instruction counter in prototype</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-11-29 16:02</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Hi, this Disputes test <a href="https://github.com/davxy/jam-test-vectors/blob/disputes/disputes/tiny/progress_with_culprits-7.json" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/blob/disputes/disputes/tiny/progress_with_culprits-7.json</a> fails because there is an offender relative to a not present verdict. Where is especified in the GP that offenders must be relative a present verdict? An offender cannot be new to be subsequently added to the verdicts?</div>
<div class='msg'><time>2024-11-29 16:27</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: &gt; &lt;@vinsystems:matrix.org&gt; Hi, this Disputes test <a href="https://github.com/davxy/jam-test-vectors/blob/disputes/disputes/tiny/progress_with_culprits-7.json" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/blob/disputes/disputes/tiny/progress_with_culprits-7.json</a> fails because there is an offender relative to a not present verdict. Where is especified in the GP that offenders must be relative a present verdict? An offender cannot be new to be subsequently added to the verdicts?

the test fails because the culprit target is not in the bad set (equation 10.5)</div>
<div class='msg'><time>2024-11-30 13:28</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: Another small correction for consistency: wrapping the <code>(x_s)_l</code> with <code>\keys{}</code> here
<a href="https://graypaper.fluffylabs.dev/#/911af30/31b30231b302" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/31b30231b302</a>
</div>
<div class='msg'><time>2024-12-02 08:54</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Is it possible to have different epoch judgments in the same dispute extrinsic?  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-05 11:05</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: Hello, guess i am missing something.
in <a href="https://graypaper.fluffylabs.dev/#/911af30/2c5b012c5b01" target="_blank" rel="noopener">Refine Invocation</a> we only ever call the Argument Invocation with **x = (∅, \[\])**
this then passes on through ΨM and ΨH and eventually one of the Omegas in <a href="https://graypaper.fluffylabs.dev/#/911af30/322101322101" target="_blank" rel="noopener">B.8</a> is getting called with this pair as an argument

so if we only ever pass &quot;empty&quot; pair, how will the internal Omegas ever operate on non empty argument? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-05 11:17</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: ok i think i can answer myself (sorry for the spam)
by using a series of host calls i can progressively  &quot;fill up&quot; the context pair
for example i could use machine =&gt; poke =&gt; peek in order to
create a machine in the **m** dictionary, write some program into it then verify it is there using peek</div>
<div class='msg'><time>2024-12-05 13:05</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: We use the paged proof hashed segments for building segment justification.

The segment root is built with a constancy preprocessor that prepends &quot;$leaf&quot; to the data.

Shouldn&#x27;t we also prepend &quot;$leaf&quot; here?

<a href="https://graypaper.fluffylabs.dev/#/911af30/1a18011a1f01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/1a18011a1f01</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-06 08:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@amritj:matrix.org&gt; We use the paged proof hashed segments for building segment justification.
&gt; 
&gt; The segment root is built with a constancy preprocessor that prepends &quot;$leaf&quot; to the data.
&gt; 
&gt; Shouldn&#x27;t we also prepend &quot;$leaf&quot; here?
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/911af30/1a18011a1f01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/1a18011a1f01</a>

Yes in the present system it would be needed. I might alter things so that for the pages proofs tree we don’t bother with the leaf/node prefixes at all since they’re redundant here. </div>
<div class='msg'><time>2024-12-06 08:10</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Gotcha, thanks!</div>
<div class='msg'><time>2024-12-06 11:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@amritj:matrix.org&gt; Gotcha, thanks!

<a href="https://github.com/gavofyork/graypaper/pull/150/commits/9b6ca3aac5a90b40fefa6449c238b0ff9bd3b3cb" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/150/commits/9b6ca3aac5a90b40fefa6449c238b0ff9bd3b3cb</a></div>
<div class='msg'><time>2024-12-06 15:05</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: One more suggestion, I think we should also check the export count in the work package items to be equal to the length of the actually exported segments.

Otherwise, work item can export more segments than Wm (2\*\*11) and I think may even overwrite index of the export segment of next work item

<a href="https://graypaper.fluffylabs.dev/#/911af30/1a0c021a0c02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/1a0c021a0c02</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-06 15:06</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Also, I can find any such constant named Wx, I think it should be Wm

<a href="https://graypaper.fluffylabs.dev/#/911af30/33ae0033ae00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/33ae0033ae00</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-06 16:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@amritj:matrix.org&gt; One more suggestion, I think we should also check the export count in the work package items to be equal to the length of the actually exported segments.
&gt; 
&gt; Otherwise, work item can export more segments than Wm (2\*\*11) and I think may even overwrite index of the export segment of next work item
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/911af30/1a0c021a0c02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/1a0c021a0c02</a>

It&#x27;s technically impossible to validly export more items than W_M already due to the condition in the <code>export</code> host-call (the only way to validly append an export)</div>
<div class='msg'><time>2024-12-06 16:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But in any case, there&#x27;s a required limitation placed on work-packages here: <a href="https://graypaper.fluffylabs.dev/#/911af30/19f500190501" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/19f500190501</a></div>
<div class='msg'><time>2024-12-06 16:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.5.2" target="_blank" rel="noopener">0.5.2</a> is out, with all of the various corrections from the past two weeks including those in <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.5.1" target="_blank" rel="noopener">0.5.1</a>, as well as some quite important tweaks:

- Change blocks to be audited by their prior validator set
- PVM: Simplify initialization memory layout
- <a href="https://github.com/gavofyork/graypaper/pull/150/commits/e691d2cc8d8d3cba049e8f6c02a11aa6e884799f" target="_blank" rel="noopener">WP&amp;WRs: Introduce second gas limit for Accumulate</a>
- <a href="https://github.com/gavofyork/graypaper/pull/150/commits/1f4c31976eb9242b74d18c7b57c7cd075cd6f371" target="_blank" rel="noopener">WP&amp;WRs: More sensible Work Report size limit</a>
- BEEFY: Use a more optimal BEEFY MMR commitment format <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-06 17:06</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Yes, we are checking if the export segment list is full if the export segment offset + current work item export count is more than W\_M (2\*\*11) , but the export segment offset is calculated by summing up the export counts of work items mentioned in the work package built by the builder

But we are not validating if the export count is equal to no of segments actually exported by the work items after refine

Maybe I am missing something? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-06 17:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@amritj:matrix.org&gt; Yes, we are checking if the export segment list is full if the export segment offset + current work item export count is more than W\_M (2\*\*11) , but the export segment offset is calculated by summing up the export counts of work items mentioned in the work package built by the builder
&gt; 
&gt; But we are not validating if the export count is equal to no of segments actually exported by the work items after refine
&gt; 
&gt; Maybe I am missing something?

 <a href="https://github.com/gavofyork/graypaper/pull/160" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/160</a></div>
<div class='msg'><time>2024-12-06 17:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;m not (yet) totally convinced that the builder can really break anything for anyone other than themselves by misreporting these counts. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-06 17:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But it&#x27;s probably sensible anyway.</div>
<div class='msg'><time>2024-12-07 10:58</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Question:

In auditing, we consider the report audited if the report have no negative judgement and there exists some tranche where all validators required to audit have positive judgement about the report.

In case some validator announced a audit but failed to deliver the judgement, and new audits are announced to cover that.

So, the new tranche A_n will be = old tranche auditors + new auditors just announced - auditors failed to deliver judgement ?

<a href="https://graypaper.fluffylabs.dev/#/911af30/1eab001eae00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/1eab001eae00</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-07 11:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Once it has been determined by the auditor that they will audit the new tranche, the VRF is used to determine which cores (and thus which WRs) should be audited. These are announced and by doing so the node is obliged to publish a judgement. They receive corresponding announcements and, later, judgements, from other auditors and will audit a new tranche only if by the tranche&#x27;s time limit they have not received a judgement for each announcement. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-07 11:37</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: In new tranche, auditors will only audit reports that were announced to be audited in previous tranch but judgement no received, right? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-07 11:46</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Ahh, gotcha, the new audit tranche only contain reports that did not receive all judgement, other reports that did receive all judgements are excluded from the new tranche list because they are already validated, thanks I got bit confused! <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-07 11:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The new audit tranche is determined solely by the VRF.</div>
<div class='msg'><time>2024-12-07 11:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This is defined as (17.15) and (17.16)</div>
<div class='msg'><time>2024-12-07 11:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So we perceive m_n missing audits at tranche n: those two formulae determine which of the work-reports (w) we will be required to audit this tranche.</div>
<div class='msg'><time>2024-12-07 11:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For any tranche, as the number of perceived missing-judgements increases, we audit a greater selection of the overall work-reports. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-07 11:59</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We don&#x27;t (necessarily) audit the report(s) with the missing judgement(s). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-07 12:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And we _always_ pass a judgement on any audits we have announced ourselves. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-07 12:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This is described in the paragraph here: <a href="https://graypaper.fluffylabs.dev/#/911af30/1e18001e2000" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/1e18001e2000</a></div>
<div class='msg'><time>2024-12-07 12:03</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Thanks, I got confused about rechecking all previous tranche WR to be present in J\_T to consider this WR audited, but as per eq 17.16 we only include those Work reports in new tranche that did not have all announced judgement, so no need to check work reports that are not included in next tranche again! <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-07 19:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@amritj:matrix.org&gt; Yes, we are checking if the export segment list is full if the export segment offset + current work item export count is more than W\_M (2\*\*11) , but the export segment offset is calculated by summing up the export counts of work items mentioned in the work package built by the builder
&gt; 
&gt; But we are not validating if the export count is equal to no of segments actually exported by the work items after refine
&gt; 
&gt; Maybe I am missing something?

<a href="https://github.com/gavofyork/graypaper/pull/160/commits/184515d80354f96f0410b48cea950ed7c9e4f03f" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/160/commits/184515d80354f96f0410b48cea950ed7c9e4f03f</a></div>
<div class='msg'><time>2024-12-07 19:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This will be updated to a new system; WPs should not be invalidated by a bad export count.</div>
<div class='msg'><time>2024-12-08 03:47</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: I asked this question in Jam room, not solved there so asking here too:

Question:

The segments are erasure-coded and distributed to the validators. Each validator receives a single shard out of the 1,023 shards, determined by their validator index. Therefore, the shard index of the shard they receive equals to their validator index.

According to the JAMNP protocol, to fetch data from the assurers, we need to provide each assurer with the shard index we require from them.

The exported segments are expected to remain available for 28 days. During this period, it is assumed that more than 341 validators will remain consistent. However, there is still a significant likelihood that validator indexes may change during this time due to the addition or removal of validators.

I asked if we have to remember historical validator sets to know who to request shards from, which David Emett  confirmed

But we are not able to find any way to distribute this data to a new validator added to the network, and without this data he won&#x27;t be able to compute work reports.

I proposed to not require shard index in the request to fetch data from assurer but assurer himself give us the shard index which we can ofcourse verify is correct or not, so we only need the erasure root and segment index, but as some new validators added to the system if we randomly choose 342 assurers to request data from some of the responses will be empty so either we can request from ~400-500 validators (churn rate as confirmed by sourabhniyogi  is low, so we will most probably receive more than 342 shards) OR somehow store which validators were expected to be active in the requested WR segment epoch by storing status component like we do in preimages in the validator metadata which I am not much sure about

The above solution is only for new validators, old validators will use the normal method as they know which validators have which shard

Is this a good solution to the problem or is there a better answer we can&#x27;t see? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 04:54</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Btw, a highly unlikely attack vector, but I&#x27;m still curious if it&#x27;s possible:

For a report to be marked valid, it goes through two checks: first, guaranteeing, and second, auditing.

To pass the guaranteeing stage, we need two guarantors to sign. To pass the auditing stage, we need all 10 randomly selected auditors to give a positive judgment about the report.

Let&#x27;s say one of the guarantors is a malicious actor and tries to bribe their fellow guarantor to sign an invalid report. The bribe would need to be large enough to offset the guarantor&#x27;s potential loss if they are found guilty. Since only one more actor needs to accept the risk and the bribe, let&#x27;s assume the other guarantor accepts the bribe.

After guaranteeing, we have to somehow pass the auditing stage. To do this, the attacker sets up an off-chain bribe market offering auditors of this report a deal: if all them don&#x27;t announce anything, and prove they are auditors of the report after the invalid report is marked valid, they will receive a huge sum of money.

The auditors face no risk even if they are the only one remaining silent, as they aren&#x27;t passing a positive judgment. If all 10 auditors stay silent and no one announces anything, the report will automatically be marked valid.
 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 05:30</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: A couple of bugs i found in 0.5.2:
- WorkItem new <code>a</code> field (accumultionGasLimit) is not taken care in the codec defined in C.26
- A.34 has been changed and <code>Q</code> fn in A.32 renamed to <code>Z</code> ... yet some parts of graypaper stil report old nomenclature. (paragraph after <code>sbrk</code> &amp; A.33)</div>
<div class='msg'><time>2024-12-08 08:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; A couple of bugs i found in 0.5.2:
&gt; - WorkItem new <code>a</code> field (accumultionGasLimit) is not taken care in the codec defined in C.26
&gt; - A.34 has been changed and <code>Q</code> fn in A.32 renamed to <code>Z</code> ... yet some parts of graypaper stil report old nomenclature. (paragraph after <code>sbrk</code> &amp; A.33)

Thanks will be fixed in next revision</div>
<div class='msg'><time>2024-12-08 08:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@amritj:matrix.org&gt; I asked this question in Jam room, not solved there so asking here too:
&gt; 
&gt; Question:
&gt; 
&gt; The segments are erasure-coded and distributed to the validators. Each validator receives a single shard out of the 1,023 shards, determined by their validator index. Therefore, the shard index of the shard they receive equals to their validator index.
&gt; 
&gt; According to the JAMNP protocol, to fetch data from the assurers, we need to provide each assurer with the shard index we require from them.
&gt; 
&gt; The exported segments are expected to remain available for 28 days. During this period, it is assumed that more than 341 validators will remain consistent. However, there is still a significant likelihood that validator indexes may change during this time due to the addition or removal of validators.
&gt; 
&gt; I asked if we have to remember historical validator sets to know who to request shards from, which David Emett  confirmed
&gt; 
&gt; But we are not able to find any way to distribute this data to a new validator added to the network, and without this data he won&#x27;t be able to compute work reports.
&gt; 
&gt; I proposed to not require shard index in the request to fetch data from assurer but assurer himself give us the shard index which we can ofcourse verify is correct or not, so we only need the erasure root and segment index, but as some new validators added to the system if we randomly choose 342 assurers to request data from some of the responses will be empty so either we can request from ~400-500 validators (churn rate as confirmed by sourabhniyogi  is low, so we will most probably receive more than 342 shards) OR somehow store which validators were expected to be active in the requested WR segment epoch by storing status component like we do in preimages in the validator metadata which I am not much sure about
&gt; 
&gt; The above solution is only for new validators, old validators will use the normal method as they know which validators have which shard
&gt; 
&gt; Is this a good solution to the problem or is there a better answer we can&#x27;t see?

We may consider storing historical (28 days worth) of validator keys in state. </div>
<div class='msg'><time>2024-12-08 08:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Honest Non-auditors would see the bribe market and realise they can profit by speculatively evaluating the report, finding it is invalid and making the judgement (honest participants in a dispute get a small reward). Once there is a single negative judgement in the system, all validators must audit. Expected loss of the guarantors is therefore huge and it becomes (wildly) unprofitable to attempt the attack.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 09:48</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Yeah, that&#x27;s the way I thought it will fail, but what if only the auditors of that work report know about the bribe.

One way is after the auditor announce that they are going to audit that report, the attacker may reach all WR auditors to pass positive judgement.

But in this way, even if auditor is willing to accept the bribe he don&#x27;t know if other will do the same and have huge risk.

But if someone have built the logic to accept the bribe he is not a good auditor, and all these bad auditors can also before announcing everyone about which report they going to audit tell the bribe market about it and if bribe market found ~30 such auditors working on same report he may ask them to not send this announcment to everyone and let the report to pass, otherwise everything goes normally, this could go on for years waiting for perfect moment.

Kinda filmy, and highly unlikely <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 10:00</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Their can be some hacker group that in years injected this kind of virus in some of the validators machines that work in background without validators knowing about it, waiting for perfect chance <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 10:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s an independent VRF per validator, stemming from both an on-chain seed and their secret key. There’s no way of knowing which validator will self-select before they announce.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 10:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And once the announcement happens, then it’s over as the escalation will begin if there’s no judgement.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 10:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As the attacker, you would need to know that the auditors were all compromised before committing to guaranteeing the invalid report. And this is impossible as it comes from 1023 VRFs whose entropy is secret (because at lease some are not compromised).  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 10:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Of course if you knew enough (&gt; 98%) of the validator secret keys you might be able to pull this off with non-negative expected profit, but we already assume &lt;33% compromised nodes.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 10:52</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Yeah, I calculated the probability, and the chances of all 30 auditors being in the compromised set, even if 33% of the validators are compromised, is 2.01×10^-15. That&#x27;s extremely low 

To have ~50% chance ~98% validators should be compromised

I think I must work on my math skils before asking these questions 😅 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 11:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You don&#x27;t even know how many it is.</div>
<div class='msg'><time>2024-12-08 11:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: All you know is that every (honest) validator has a roughly 1/100 chance of self-selecting for any given core/WR. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 11:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: i.e. ~99% chance of not, so assume that you compromise the secret keys of &gt;90% of validators, that means there&#x27;s still ~100 validators who are honestly self-selecting.</div>
<div class='msg'><time>2024-12-08 11:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: the chance that none of them unexpectedly audits your bad WR is therefore 0.99^100 = 36%, so you&#x27;ve around 2/3 chance of being discovered. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 11:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Once discovered, we can expect even the self-interested nodes acting under bribes to act honestly unless they&#x27;re already bribed with the auditor slash amount (~10% of stake). <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 11:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So you have to totally cover the slash of 2 guarantors (2x 100% stake), probably some of the third guarantor (who would have elevated chances of self-selecting out of spite of being left out of the guaranteeing process), and still have such a great hack that you compromise 90% of the secret keys (which in due course we can assume will be technically impractical owing to multiple implementations and hardware key support) or somehow bribe 90% to voluntarily give up their secret keys knowing that they could get slashed if the secret is misused (e.g. as a guarantor).</div>
<div class='msg'><time>2024-12-08 11:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And even then your attack would need to give you _guaranteed_ 2x revenue on that total cost just for it to have expected break-even <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 11:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And break-even isn&#x27;t enough due to gambler&#x27;s ruin. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 11:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In any case I think all these arguments are made in a more rigourous format in the ELVES paper, in case you want to dive deeper into it</div>
<div class='msg'><time>2024-12-08 11:28</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: I understand it now, thanks man for answering my dumb questions with such great explanations, really appreciate it.

My mind was stuck that we only need to disrupt the network between validators somehow at that exact time of audit announcement making A_n empty, and pass the audit test

But the amount of validators required to pull this off is huge, and can only think of only one next to impossible case if more 95% of the validators use the same Internet Provider, and the provider performed a huge targeted attack on the jam protocol validators and stopped their communication at the exact time, not much sure about this too

(reading the ELVES paper now) <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 11:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Good that there&#x27;s some effort to comprehend the underlying game theory! Less trust:)</div>
<div class='msg'><time>2024-12-08 18:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@amritj:matrix.org&gt; I asked this question in Jam room, not solved there so asking here too:
&gt; 
&gt; Question:
&gt; 
&gt; The segments are erasure-coded and distributed to the validators. Each validator receives a single shard out of the 1,023 shards, determined by their validator index. Therefore, the shard index of the shard they receive equals to their validator index.
&gt; 
&gt; According to the JAMNP protocol, to fetch data from the assurers, we need to provide each assurer with the shard index we require from them.
&gt; 
&gt; The exported segments are expected to remain available for 28 days. During this period, it is assumed that more than 341 validators will remain consistent. However, there is still a significant likelihood that validator indexes may change during this time due to the addition or removal of validators.
&gt; 
&gt; I asked if we have to remember historical validator sets to know who to request shards from, which David Emett  confirmed
&gt; 
&gt; But we are not able to find any way to distribute this data to a new validator added to the network, and without this data he won&#x27;t be able to compute work reports.
&gt; 
&gt; I proposed to not require shard index in the request to fetch data from assurer but assurer himself give us the shard index which we can ofcourse verify is correct or not, so we only need the erasure root and segment index, but as some new validators added to the system if we randomly choose 342 assurers to request data from some of the responses will be empty so either we can request from ~400-500 validators (churn rate as confirmed by sourabhniyogi  is low, so we will most probably receive more than 342 shards) OR somehow store which validators were expected to be active in the requested WR segment epoch by storing status component like we do in preimages in the validator metadata which I am not much sure about
&gt; 
&gt; The above solution is only for new validators, old validators will use the normal method as they know which validators have which shard
&gt; 
&gt; Is this a good solution to the problem or is there a better answer we can&#x27;t see?

David Emett: might have an opinion on this; personally I&#x27;d be tempted to store 28 days worth of historical validator key sets on-chain (full key 336 bytes, 10 validators change per epoch and 4 bytes to redirect to last change = 9 MB), as well as the 28 days of worth of entropy (32 bytes per 6 seconds = 13 MB)</div>
<div class='msg reply'><time>2024-12-09 13:24</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Is historical entropy needed? Not clear to me what for. Re historical validator info, my preference was to just expand the epoch mark to include Ed25519 keys and metadata, as this seems simpler (from a spec perspective at least) and the chain history will be required anyway to construct the SR-&gt;ER map</div>
<div class='msg'><time>2024-12-08 18:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Then, you can select the shards as desired and find (or cross-reference) the validator&#x27;s info fairly easily.</div>
<div class='msg'><time>2024-12-08 18:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; validator indexes may change during this time due to the addition or removal of validators

Index churn is somewhat problematic when considering our current EC reconstruction algorithms. The staking chain would need to be aware of this and enforce index-validator affinity, so it wouldn&#x27;t assign a different index to the same validator from hour to hour without good cause. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-08 19:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; old validators will use the normal method as they know which validators have which shard

Only as long as they know which era/block the segments-root belongs to and they know the validator information for that time? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-09 04:48</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: &gt; &lt;@gav:polkadot.io&gt; &gt; old validators will use the normal method as they know which validators have which shard
&gt; 
&gt; Only as long as they know which era/block the segments-root belongs to and they know the validator information for that time?

Yeah, old validators need to maintain a mapping for historical validators.
And new validators can now easily too if they can fetch historical validator set data from other nodes and verify it with epoch mark
 <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-09 15:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yup sounds sensible. </div>
<div class='msg'><time>2024-12-10 16:37</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: </div>
<div class='msg'><time>2024-12-11 20:57</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I have a doubt about this formula:
(7.2) β† ≡ β except β†\[|β| − 1\]s = Hr

What is the correct interpretation:

1. β† is a copy of β except that in the last element of β† we replace s for the value of Hr
2. β† is a copy of β only if the value of s in the last element is equal to Hr, otherwise β† is nil

<a href="https://graypaper.fluffylabs.dev/#/5b732de/0fd5010fde01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5b732de/0fd5010fde01</a> <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-12-11 20:58</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Choice 1 :) </div>
<div class='msg reply'><time>2024-12-11 20:58</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: 1</div>
<div class='msg reply'><time>2024-12-11 20:59</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: It&#x27;s just putting the correct state root in for the last block, which will be 0 in beta (prior state)</div>
<div class='msg reply'><time>2024-12-11 21:00</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: So, in this case, wouldn&#x27;t be more precise to put β†\[|β| − 1\]s ≡ Hr <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-12-11 21:02</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: and then comes another question: in report vectors, the prior_state_root (Hr) is not informed in the header, which means they are null. Should I replace the existing vale with null? Because the vectors post_state don&#x27;t do this</div>
<div class='msg reply'><time>2024-12-11 21:06</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I don&#x27;t understand the second part of the question regarding reports. Can you tell which equations you&#x27;re refering to ?</div>
<div class='msg reply'><time>2024-12-11 21:11</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Eq. 7.2, 7.3 and 7.3
</div>
<div class='msg reply'><time>2024-12-11 21:11</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: more specifically 7.2</div>
<div class='msg reply'><time>2024-12-11 21:12</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: If I have to replace  β† last element, Hr should not be null in the vector. </div>
<div class='msg reply'><time>2024-12-11 21:14</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hr is not null,
But beta[|beta|-1] is null (more specifically 32 bytes of zeros)</div>
<div class='msg reply'><time>2024-12-11 21:16</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: where is Hr informed in vector? </div>
<div class='msg reply'><time>2024-12-11 21:18</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: In vector ? Hr is a header</div>
<div class='msg reply'><time>2024-12-11 21:19</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: No, H is header.</div>
<div class='msg reply'><time>2024-12-11 21:19</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Hr is the header prior state root </div>
<div class='msg reply'><time>2024-12-11 21:29</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Yeah, I wasn&#x27;t super precise but yeah Hr is part of the header</div>
<div class='msg reply'><time>2024-12-11 21:29</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: My interpretation is:

1. take the last element of history and put the Hr on s (which was zero in the last iteration) (7.2)
2. create a new element for history (7.3)
3. add this newly created element in the end of the list, removing the first element if the list is bigger then Constant H (7.3) <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-12-11 21:30</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Yes that&#x27;s how we interpret it as well</div>
<div class='msg reply'><time>2024-12-11 21:32</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: actually, my main doubt is: are these vectors affecting the recent history state component? I think they are not</div>
<div class='msg reply'><time>2024-12-11 21:33</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I have the same question for the authorizer pool (I think someone already asked this, I didn&#x27;t see the answer)</div>
<div class='msg reply'><time>2024-12-11 21:35</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: My local tests were not passing because I was trying to match my post state recent history with the ones in the vectors, which actually are not correct, they are supposed to be ignored in these tests</div>
<div class='msg reply'><time>2024-12-11 21:48</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: No. Recent block history last block state root is mutated by the recent block history STF. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-12-11 21:49</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@danicuki:matrix.org&gt; I have the same question for the authorizer pool (I think someone already asked this, I didn&#x27;t see the answer)

Authorizer pool is now mutated by the &quot;authorizers&quot; STF. Vectors not published yet. </div>
<div class='msg reply'><time>2024-12-11 21:50</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: But I see authorizers (alpha) being changed in reports vectors, no?</div>
<div class='msg'><time>2024-12-11 21:50</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: Not anymore</div>
<div class='msg'><time>2024-12-11 21:50</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: <a href="https://github.com/w3f/jamtestvectors/pull/28#issuecomment-2535451326" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/28#issuecomment-2535451326</a></div>
<div class='msg'><time>2024-12-11 22:11</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: The work report&#x27;s authorizer\_hash is removed from the authorizer pool when it is placed on the core. <a href="https://graypaper.fluffylabs.dev/#/911af30/10b50010ba00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/10b50010ba00</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-12 04:31</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: </div>
<div class='msg'><time>2024-12-15 18:20</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: We are removing the starting 1 bit from the left sub-trie identity

<a href="https://graypaper.fluffylabs.dev/#/5b732de/37ab0237af02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5b732de/37ab0237af02</a>

But as this is a hash, we don&#x27;t know exactly if the starting bit of the left sub-trie identity will be 0 or 1.

So, how do we decode this hash value? What am I missing here?

 <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-12-15 18:43</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not sure what you mean by decode? This stuff is for calculating the state root from the state, which is a one-way operation</div>
<div class='msg reply'><time>2024-12-15 19:32</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: Ohk, clear!</div>
<div class='msg'><time>2024-12-16 21:50</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Is there a target date for having version 1.0 of the GP ready?</div>
<div class='msg'><time>2024-12-16 22:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: April 14th <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2024-12-16 22:22</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Thank you. I’m assuming M1 submissions can’t be before this date then? Or will the conformance tool come before this?</div>
<div class='msg reply'><time>2024-12-16 22:40</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: We have moved onto M2 work for JavaJAM until then.</div>
<div class='msg reply'><time>2024-12-17 08:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@jaymansfield:matrix.org&gt; Thank you. I’m assuming M1 submissions can’t be before this date then? Or will the conformance tool come before this?

Correct. From the published rules:

&gt; Prizes are paid no earlier than the ratification by the Polkadot Fellowship of version 1.0 of the JAM protocol. Payment of the prize by the Web3.0 Foundation is conditional upon the successful completion of all KYC/AML processes</div>
<div class='msg'><time>2024-12-16 23:05</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: Suggestion for an inconsistency fix in the designate host function.
PR: <a href="https://github.com/gavofyork/graypaper/pull/166" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/166</a>
(GP: <a href="https://graypaper.fluffylabs.dev/#/5b732de/306401306401)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5b732de/306401306401)</a>
</div>
<div class='msg'><time>2024-12-17 20:27</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: Following my comment <a href="https://github.com/w3f/jamtestvectors/pull/14#issuecomment-2549423040" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/14#issuecomment-2549423040</a> and discussion started in jam chat i think it would be better if <code>D.4</code> is being changed to take into account the last 6 bits of |v| instead of the first 6. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-18 00:54</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I am a bit confused about what is a work package bundle. I can&#x27;t find a formal definition of it</div>
<div class='msg'><time>2024-12-18 00:54</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: </div>
<div class='msg'><time>2024-12-18 00:58</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: <a href="https://graypaper.fluffylabs.dev/#/5b732de/1b9d001b9f00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5b732de/1b9d001b9f00</a> this have a description of it, but it leaves some ambiguity of the encoding format. e.g. how exactly are the extrinsic data and the proofs are encoded?</div>
<div class='msg reply'><time>2024-12-18 01:03</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: <a href="https://graypaper.fluffylabs.dev/#/5b732de/1b5d001b5d00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5b732de/1b5d001b5d00</a></div>
<div class='msg reply'><time>2024-12-18 01:05</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The bundle is the second argument to A</div>
<div class='msg reply'><time>2024-12-18 01:06</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I see. Thanks. It will be better if it is bit more explicit </div>
<div class='msg reply'><time>2024-12-18 01:07</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Agree that would be nice</div>
<div class='msg'><time>2024-12-18 14:58</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: davxy afk: since youre the bandernatch god :) I have a question... <code>Hs</code> has a direct dependency on <code>Hv</code> which is included in the <code>context</code> to sign includes <code>Hv</code> as last element. (6.16 and 6.15)

<code>Hv</code> seems to also depend on <code>Hs</code>.... well.. it depends on <code>Y(Hs)</code> (see 6.17) . While i know it needs to match the ticket in case we&#x27;re not in fallback mode, i believe there is some cryptography magic i didnt fully understand to know what <code>Y(Hs)</code> would be without really having Hs.... otherwise we would have a circular dependency <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-18 15:01</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: If i understand properly this magic should be using <code>G.4</code> with same message, privkey and **empty context** to get a RingVRF proof on which i could then apply G.5 and get the same result <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-18 15:10</time>&ensp;<span class='u' style='color:#79ca84'>alxmirap</span>: I may be able to answer that, I believe. The encoding in equations 6.15/6.16 uses the function \Epsilon_U(H), defined in Appendix C as being the full \Epsilon(H) without the H_s term (equations C.19 and C.20).

I believe this encoding function was created precisely for the case of omitting this field to avoid the circular dependency.</div>
<div class='msg'><time>2024-12-18 15:13</time>&ensp;<span class='u' style='color:#79ca84'>alxmirap</span>: This function is introduced in section 5, just before Eq 5.1.</div>
<div class='msg'><time>2024-12-18 15:20</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The VRF output is independent of the additional context, so there isn&#x27;t really a circular dependency</div>
<div class='msg'><time>2024-12-18 15:21</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: i think i didnt explain myself

- \Epsilon_U(H) contains <code>Hv</code>
- <code>Hs</code> uses \Epsilon_U(H)
- <code>Hv</code> uses <code>Y(Hs)</code>

</div>
<div class='msg reply'><time>2024-12-18 17:37</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Not sure but this might help <a href="https://github.com/jam-duna/jamtestnet/issues/21" target="_blank" rel="noopener">https://github.com/jam-duna/jamtestnet/issues/21</a></div>
<div class='msg'><time>2024-12-18 15:21</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: perfect</div>
<div class='msg'><time>2024-12-18 15:26</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: FWIW I just added this
<a href="https://github.com/davxy/bandersnatch-vrfs-spec/blob/bdd1f4b7ccbad9227dc28c72660d438cf00b1b33/assets/example/src/main.rs#L298-L300" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/blob/bdd1f4b7ccbad9227dc28c72660d438cf00b1b33/assets/example/src/main.rs#L298-L300</a></div>
<div class='msg'><time>2024-12-18 15:27</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: But you&#x27;ve got already your answer ^</div>
<div class='msg'><time>2024-12-18 18:12</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: Hello, question here : 
<a href="https://graypaper.fluffylabs.dev/#/5b732de/377b02377c02" target="_blank" rel="noopener">\mathbb{H}^0</a>  = [0]_32 in Ch3.8.1 called &quot;zero-hash&quot;
However, <a href="https://graypaper.fluffylabs.dev/#/5b732de/391200391200" target="_blank" rel="noopener">\mathbb{H}_0</a> called &quot;zero hash&quot;
Is there any difference between these terms? 
Does &quot;zero hash&quot; also refer to [0]_32 or does it take 0 as input of hash func?</div>
<div class='msg'><time>2024-12-18 21:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: “Zero hash” just means [0,0,0,…]_{…32}</div>
<div class='msg'><time>2024-12-18 21:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Both terms are equivalent in meaning but one is a typo and will be corrected to the other. For now please treat them as equal.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-18 22:55</time>&ensp;<span class='u' style='color:#bc4a3e'>basedafdev</span>: In appendix D.2, the state serialization spec for $ \pi $ is a bit ambiguous to me. \pi is defined as a tuple of prior stats for all validators, and current stats for all validators, how is E_4(\pi) possible? </div>
<div class='msg'><time>2024-12-19 00:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It just means that they should each be encoded with 4 bytes. </div>
<div class='msg'><time>2024-12-19 00:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But yeah I can look into reformulating this as someone else had a similar query. </div>
<div class='msg'><time>2024-12-19 09:23</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: in accumulate host function (Appendix B), the transfer function:

<a href="https://graypaper.fluffylabs.dev/#/5b732de/311401311401" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5b732de/311401311401</a>


the &quot;otherwise if ϱ &lt; g &quot; branch
does the g here refer the g = value of register #9
or g = 10 + ω8 + 232 ⋅ ω9 the gas cost?
Thanks :)

</div>
<div class='msg'><time>2024-12-19 09:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is the g of the same column. </div>
<div class='msg reply'><time>2024-12-19 13:29</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: OK then i must be missing something
g (of the same column) is w9

g (gas cost) = 10 + ω8 + 2^32 ⋅ ω9 (clearly bigger then w9)

so :
if Q &lt; w9 (the case to return HIGH) =&gt; Q &lt; g(gas cost) =&gt; not enough gas =&gt; fallback to Eq. B.20 =&gt; registers unchanged
so we can never get w7&#x27; = HIGH <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-19 19:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The gas cost for transfer is only a placeholder. I’ll make it more sensible soon. </div>
<div class='msg'><time>2024-12-19 19:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But the g it is referring to is not the instruction gas cost on the left but the let expression above. </div>
<div class='msg'><time>2024-12-19 19:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I’ll also change the term used. </div>
<div class='msg'><time>2024-12-20 09:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room Version 0.5.3 is <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.5.3" target="_blank" rel="noopener">released</a>, containing quite a few corrections and clarifications. No really major changes this time, though we now have *active removal of reports on timeout*. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-21 18:53</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: Screenshot 2024-12-22 at 01.53.11.png</div>
<div class='msg'><time>2024-12-21 18:54</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: **9.3 Account Footprint and Threshold Balance - formula (9.8)**

What about changing the <code>a_l</code> here to <code>a_o</code>, it looks too similar to <code>a_\mathbf{l}</code> <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-21 19:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Feel free to make a PR :)</div>
<div class='msg'><time>2024-12-21 19:50</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: When we refer to JAM&#x27;s DA capabilities, does that refer to the preimages (supported by accumulate host functions solicit/forget) as well as the ImportDA + AuditDA (supported by refine host functions import/export), or only the latter?  

For rollups utilizing JAM to store blocks and headers, should they be using one or the other or both in designs intended for max scalability for a whole ecosystem (e.g. OP Stack)?   <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-21 20:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Only the latter. </div>
<div class='msg'><time>2024-12-22 08:57</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: <a href="https://github.com/gavofyork/graypaper/pull/174" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/174</a>

please review</div>
<div class='msg'><time>2024-12-22 09:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Reviewed</div>
<div class='msg'><time>2024-12-22 17:05</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Which system is the CoreChains service going to write blocks and headers to ?  For zk rollup ecosystems using JAM DA vs preimages, where should proofs be stored -- is there a design judgment on this that should emulate that of the CoreChains service? <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-22 20:05</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: If I am building it, blocks will just be the body of work item, headers stored in service storage, parachain code blob in preimage, chain state in DA <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-22 20:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; Which system is the CoreChains service going to write blocks and headers to ?  For zk rollup ecosystems using JAM DA vs preimages, where should proofs be stored -- is there a design judgment on this that should emulate that of the CoreChains service?

Feel free to design your services exactly as you want. </div>
<div class='msg'><time>2024-12-26 13:51</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: Hello, I have a question about the structure of recent history $beta$, in the GP <a href="https://graypaper.fluffylabs.dev/#/5b732de/0fb6010fca01" target="_blank" rel="noopener">(7.1)</a> is (header hash, accumulation-result MMR, state root, work-report dict.), however in <a href="https://graypaper.fluffylabs.dev/#/5b732de/0f41020f6c02" target="_blank" rel="noopener">(7.3)</a> the item $n$ is (work-report dict., header hash, accumulation-result MMR, state root).
The order seems inconsistent. Which one should I follow? I assume this is a tuple, so the order is important for implementation because they will concat. at the end</div>
<div class='msg'><time>2024-12-26 15:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Tuple item order is irrelevant. It only matters for serialisation and that is well-defined in the appendix.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-26 16:19</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: Oh, I see~ Thank for reply</div>
<div class='msg'><time>2024-12-28 18:56</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Was it intentional that CE-130 was skipped in the networking specs?</div>
<div class='msg'><time>2024-12-29 07:06</time>&ensp;<span class='u' style='color:#d27e2d'>sisco0</span>: In the graypaper, it is stated that &quot;Size-Synchrony Antagonism&quot; is not a known concept under literature. However, the following concepts might be related: CAP Theorem, Blockchain Trilemma (<a href="https://www.mdpi.com/2076-3417/15/1/19" target="_blank" rel="noopener">Link</a>). Would not the &quot;Size-Synchrony Antagonism&quot; term be part of any of the cited ones?

Citing the Blockchain Trilemma research paper:

1. Adding more nodes increases communication overhead
2. As 𝑁 increases, 𝐿 grows at least logarithmically, potentially linearly or quadratically, depending on protocol specifics. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-29 08:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: CAP theorem comes closer since what it calls “consistency”is similar in nature to what i termed “coherency”. However each of its three concepts are binary conditions and the proof simply states that no system can fulfill all three. Furthermore it doesn’t conceptualise the size of the system directly (how could it under a binary condition?), instead going for antagonist concepts “availability” and “partition-tolerance”. As such I’d argue CAP theorem is a more concrete trilemma on specifically replicated data systems. <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-29 08:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The blockchain trilemma does conceptualise the size of the system but does not involve the coherency at all. It simply states that as a (blockchain) system scales then it becomes either centralised or insecure. This trilemma implicitly assumes total coherence.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-30 04:01</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: Sorry, I&#x27;m a bit confused about the definition of serialization of guarantee extrinsic $Eg$.
In GP <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/0ce0000cf200" target="_blank" rel="noopener">5.6</a>, $\mathbf{g}$ is defined
However, in appendix <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/36870036ab00" target="_blank" rel="noopener">C.16</a>, there&#x27;s already a definition for the serialization of $Eg$.
Is $\mathbf{g}$ specifically defined for $H_x$? Or which definition should we follow? Thanks</div>
<div class='msg'><time>2024-12-30 07:51</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: As of now 2 different serializations are needed in 2 different contexts </div>
<div class='msg'><time>2024-12-30 20:53</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Question about CE-137. In the specs a bundle shard is defined as [u8]. Is there a fixed size for them? There is no reference to a &quot;bundle shard&quot; in the GP itself and not sure if it goes by a different name in it.</div>
<div class='msg reply'><time>2024-12-31 11:57</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: A bundle shard is one of the pieces you get back after erasure coding a WP bundle. Size is not fixed as it depends on the size of the original bundle</div>
<div class='msg'><time>2024-12-31 09:58</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: a doubt about the encoding of service storage and pre-image lookups in D.2:
<a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/373302377802" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/6e1c0cd/373302377802</a>


if i am reading this correctly, after encoding it would be impossible to reconstruct the original hash keys when decoding


    ∀(s ↦ a) ∈ δ, (k ↦ v) ∈ as ∶ C(s, E4(232 − 1) ⌢ k0...28) ↦ v 


am i missing something?


thank you and a happy new year 


</div>
<div class='msg'><time>2024-12-31 10:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@luke_fishman:matrix.org&gt; a doubt about the encoding of service storage and pre-image lookups in D.2:
&gt; <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/373302377802" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/6e1c0cd/373302377802</a>
&gt; 
&gt; 
&gt; if i am reading this correctly, after encoding it would be impossible to reconstruct the original hash keys when decoding
&gt; 
&gt; 
&gt;     ∀(s ↦ a) ∈ δ, (k ↦ v) ∈ as ∶ C(s, E4(232 − 1) ⌢ k0...28) ↦ v 
&gt; 
&gt; 
&gt; am i missing something?
&gt; 
&gt; 
&gt; thank you and a happy new year 
&gt; 
&gt; 
&gt; 

You’re not missing anything. HNY:)</div>
<div class='msg'><time>2024-12-31 10:03</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: and this is intended? decode(encode(service\_account) != service\_account <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-31 10:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Are you implying you believe that is true?</div>
<div class='msg'><time>2024-12-31 10:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Obviously, since decode is defined only as the inverse of encode, that is not true unless service account has more degrees of freedom than its encoding. This should not be the case. </div>
<div class='msg'><time>2024-12-31 10:10</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: right, obviously should not be the case.
but you have confirmed above the i am not missing anything -&gt; impossible to reconstruct the hash keys of storage dictionary s, preimage lookup dictionaries p and l.

so... here i get stuck? where is the missing information to allow to reconstruct those hashes?</div>
<div class='msg'><time>2024-12-31 10:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: the mappings are not serialised alongside the rest of the service account.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-31 10:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: They’d be too big for that. </div>
<div class='msg'><time>2024-12-31 10:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The trie root is a commitment to them. In the protocol there’s no facility or direct need to enumerate the mappings’ keys thus no need to actually store them, only to be able to query them. It’s basically up to the implementation exactly how they’re stored, but good ones will need to take into account the commitment scheme (ie trie) when designing for it.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2024-12-31 10:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://matrix.to/#/@arkadiy:parity.io" target="_blank" rel="noopener">@arkadiy:parity.io</a>might be able to offer more hints as to how implementers might approach the database/trie layer. </div>
<div class='msg'><time>2024-12-31 10:33</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: ok. Thank you Gavin. Happy New Year</div>
<div class='msg'><time>2025-01-02 05:31</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: some questions about the following opcodes:  
135:  
<a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/27d70327e303" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/6e1c0cd/27d70327e303</a>  
Since **vx** belongs to **N64**, should **vx** be mod 2^32 to ensure the input of **X4** won&#x27;t overflow?  

136:  
<a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/27f30327fc03" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/6e1c0cd/27f30327fc03</a>  
Since **vx** belongs to **N64**, should **Z4(vx)** be replaced by **Z8(vx)**?  </div>
<div class='msg'><time>2025-01-02 10:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: v_x belongs to N_32 - it’s constructed from at most 4 octets from the instruction data. (l_x is <code>min(…, 4)</code>) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-02 12:12</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: But the output of **X_lx**(**eq A.11**) belongs to **N_R** (**N_64**) 
<a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/249501249601" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/6e1c0cd/249501249601</a>

Did I misunderstand something?</div>
<div class='msg'><time>2025-01-02 12:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: true - this is probably the correction needed, but checking with Jan Bujak also: <a href="https://github.com/gavofyork/graypaper/pull/178" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/178</a></div>
<div class='msg'><time>2025-01-02 12:37</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: &gt; &lt;@gav:polkadot.io&gt; true - this is probably the correction needed, but checking with Jan Bujak also: <a href="https://github.com/gavofyork/graypaper/pull/178" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/178</a>

Alright, thanks for your clarification</div>
<div class='msg'><time>2025-01-02 19:56</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: I&#x27;m wondering about an edge case with arguments parsing in PVM. Some instructions simply use <code>ζı+1</code> (like <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/26a60326a603" target="_blank" rel="noopener">here</a>), but for immediates/offsets we use <code>ℓ</code> which is mask dependent (like <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/262001262001" target="_blank" rel="noopener">here</a>).

ζ is zero-padded so it&#x27;s fine if we go beyond the program length, but what if <code>ζı+1</code> is actually the next instruction?

AFAICT from GP we should treat the instruction byte as argument (and read registers from it) and in the next step just move according to the mask (i.e. execute that instruction).
Is that expected or should there be some special casing for that in the GP?</div>
<div class='msg'><time>2025-01-02 20:04</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: In an edge case to that edge case we may have a program that is just instructions (i.e. all bits in the mask are set), but we are still executing every instruction correctly, because we read the next instruction bytes as arguments to the current instruction (or 0s in case we go beyond the program length). I just want to confirm that I&#x27;m understanding it correctly. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-02 23:57</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: Not sure if I&#x27;m correct, but I understand the definitions in the GP as how the program <em>must</em> be encoded. So if there is no argument present where one should be as per GP, then the program is incorrect and we need to <code>panic</code>.</div>
<div class='msg'><time>2025-01-03 00:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@tomusdrw:matrix.org&gt; I&#x27;m wondering about an edge case with arguments parsing in PVM. Some instructions simply use <code>ζı+1</code> (like <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/26a60326a603" target="_blank" rel="noopener">here</a>), but for immediates/offsets we use <code>ℓ</code> which is mask dependent (like <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/262001262001" target="_blank" rel="noopener">here</a>).
&gt; 
&gt; ζ is zero-padded so it&#x27;s fine if we go beyond the program length, but what if <code>ζı+1</code> is actually the next instruction?
&gt; 
&gt; AFAICT from GP we should treat the instruction byte as argument (and read registers from it) and in the next step just move according to the mask (i.e. execute that instruction).
&gt; Is that expected or should there be some special casing for that in the GP?

It’s perfectly fine to concoct programs which reuse a previous instruction’s argument as the next instruction’s opcode.  </div>
<div class='msg'><time>2025-01-03 00:55</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Basically what Gav said. The program code blob is just that, a blob of bytes. You have the instruction pointer which tells you at which position to decode an instruction, and you have the skip value which tells you how to increment the instruction pointer after that instruction is executed. And the skip value doesn&#x27;t necessarily have to be the same as the &quot;length&quot; of the instruction.</div>
<div class='msg'><time>2025-01-03 07:11</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Perfect, thanks for the confirmation.</div>
<div class='msg'><time>2025-01-03 21:35</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Hi. Question about block sealing (by ticket). Maybe I am missing something but tickets are generated using a ring signature so there doesn&#x27;t seem to be a way to determine which ring member created it. But then how do we validate that when a block is received that it was created by the correct author that matches the ticket? couldn&#x27;t any other member of the ring just create the same block and set themselves as the author (pretending the ticket was theirs)? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-03 21:46</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: The block author signs the block header using a &quot;standard&quot; Bandersnatch VRF signature. The VRF output generated from this signature matches the Ring VRF output, which serves as the ticket ID. This proves the block author&#x27;s ownership of the ticket, as they are the only one capable of producing this specific output. For further details, please refer to the Bandersnatch VRF specification paper and example <a href="https://github.com/davxy/bandersnatch-vrfs-spec." target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec.</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-05 09:10</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: couple of question please regarding chapter 14.4 (computation of work results)
1. in Eq. 14.11 =&gt; definition of I(p,j) =&gt; invocation of refine =&gt; the function <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/1a87021a8702" target="_blank" rel="noopener">S</a>(import segment data) is being called with two arguments, but in <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/1b48001b4800" target="_blank" rel="noopener">14.14</a> is defined only with single (work item) argument.
which one is it?
2. maybe related, who/what is the bold face **s** used by the functions J and S in 14.14? where does it come from?


Thank you</div>
<div class='msg'><time>2025-01-05 11:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. You can disregard the bold-l parameter; it is assumed to be “part of the environment” in each of the functions which utilise L and is not passed explicitly into it.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-05 11:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 2. Bold-s is constrained as the correct operand to the merkle root equality. </div>
<div class='msg'><time>2025-01-05 11:29</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: understood, thank you.
follow up question, could you shed some light on how to tell the difference between H and H⊞?

i saw your answer in the other room about encoding in C.29 but that didn&#x27;t clear it up for me.
are they both Y\_32 or is there any &quot;mark&quot; to tell them apart? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-05 11:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There’s a mark: it’s the little window thing. </div>
<div class='msg'><time>2025-01-05 11:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: One is drawn from the set Y_32 and the other from a bijective mapping, denoted by square-plus (that little window symbol) </div>
<div class='msg'><time>2025-01-05 11:52</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: yes indeed there is the window thingy mark. that&#x27;s not what i meant.
maybe it&#x27;s a silly question.
the intention was in code how do i tell them apart
if they are both a 32 octets long binary, how could i tell if i&#x27;m looking at an H or an H⊞? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-05 11:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Well that all depends on what language you’re using. In general, you’ll need to use some extra memory to store whether it’s with or without the mark. </div>
<div class='msg'><time>2025-01-05 11:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In rust you’d probably use a tagged union <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-05 13:09</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: Thank you Gav. I think I&#x27;ve got it</div>
<div class='msg'><time>2025-01-06 06:44</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: gav:  follow up question please.
about the construction of the  segment-root dictionary l.
initially we have:
<a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/1af0011af601" target="_blank" rel="noopener">K(l) ≡ {h S w ∈ pw , (h⊞, n) ∈ wi} , SlS ≤ 8</a>

this is clear enough, from the work item in a work package we take up to 8 hashes, of the kind that is the work-package hash. okie dokie.

then we come to :
∃p, c ∈ P, NC ∶ H(p) = h in <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/1ac7021aca02" target="_blank" rel="noopener">14.13</a>

which means to me one of two things

1. we have here knowledge of &quot;all&quot; the work packages (all in what scope?) or some subset/list of work packages and we go through it to find the work-pacakges that the work-items refers to

2. we only keep in the segment-root dictionary the hashes that refer to the work-pacakge paseed into work result computation function Ξ. so all the keys will be identical, H(p), but since <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/1b6c001b6c00" target="_blank" rel="noopener">s</a> as far as i can see is not dependent on the core index c. we would end up with  a dictionary of all identical key -&gt; value pairs

option 2 doesn&#x27;t make much sense, which brings me back yo option 1, but i see no reference to any list or set of work-packages <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-06 06:50</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: is there a video lecture of chapter 14 as part of the JAM tour? i could not find any</div>
<div class='msg'><time>2025-01-06 10:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Not yet. Expect one in two months</div>
<div class='msg'><time>2025-01-06 10:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, as the guarantor you&#x27;ll need to have seen the WRs of any WP hashes mentioned in the SR Lookup, so you can be sure that it&#x27;s correct otherwise you might end up guaranteeing WP with a WR which won&#x27;t be accumulated. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-06 10:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There only a limited about of WR history you&#x27;ll need have knowledge of: <a href="https://graypaper.fluffylabs.dev/#/6e1c0cd/15de01152d02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/6e1c0cd/15de01152d02</a></div>
<div class='msg'><time>2025-01-06 10:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Basically just what will be in the recent blocks by the time of becoming available. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-06 10:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So that&#x27;s basically just H = 8 slots <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-06 10:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This mechanism is designed to allow pipelining when sequences of unidependent work packages are executed on the same core.</div>
<div class='msg'><time>2025-01-06 10:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Without it, it would be hard to reference data in the DA without figuring out the SR manually which may not necessarily be known at the time of authoring the importing package.</div>
<div class='msg'><time>2025-01-07 10:52</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: I have a question regarding the leaf node encoding function (<a href="https://graypaper.fluffylabs.dev/#/911af30/37f402371103)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/911af30/37f402371103)</a> for state merklization.

In a Merkle trie, a leaf node will be typically placed at a depth less than 256, implying that it should represent the remaining, unconsumed bits of the <code>state_key</code> after navigating to that point - so that we can guess which <code>state_key</code> that leaf node represents.

When considering what the leaf node holds as the encoded state key (<code>bits(k)...248</code>), should this refer to:

a) &quot;The first 248 bits of the full 256-bit state key&quot;? Or
b) &quot;The first 248 bits of the unconsumed path bits&quot;?

For example, let&#x27;s say we have a state key like <code>0b1101_1010_1001...</code> and a leaf node is at depth 10, meaning we&#x27;ve navigated the trie using the path <code>0b1101_1010_10</code> to reach this node, should the leaf node:

a) Store the first 248 bits of <code>0b1101_1010_1001...</code>? Or
b) Only store the first 248 bits of <code>0b01...</code>, skipping the first 10 bits, thus excluding the part already used for navigation (<code>0b1101_1010_10</code>)? Actually in this case the remaining part is only 246 bits, so we have 2 bits of free space.

From my interpretation of the formalism, it seems the encoding takes the &quot;first 248 bits of the full 256-bit state key&quot; regardless of the leaf node&#x27;s position (depth), so option a), but just wanted to confirm this understanding.</div>
<div class='msg reply'><time>2025-01-07 13:55</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Yes, (a) is correct</div>
<div class='msg reply'><time>2025-01-07 14:18</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: David Emett: awesome, thanks for clarifying!</div>
<div class='msg'><time>2025-01-08 15:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room Version 0.5.4 <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.5.4" target="_blank" rel="noopener">released</a> with some important protocol alterations.</div>
<div class='msg'><time>2025-01-08 15:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Significant alterations:
* PVM Host-calls: Host-call to inspect preimage request status by @gavofyork in <a href="https://github.com/gavofyork/graypaper/pull/177" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/177</a>
* PVM Invocations: Yielding accumulation hash possible on OOG by @gavofyork in <a href="https://github.com/gavofyork/graypaper/pull/179" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/179</a>
* PVM: Bit manipulation (Zbb-inspired) extensions by @gavofyork in <a href="https://github.com/gavofyork/graypaper/pull/176" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/176</a>
* Accumulation &amp; PVM Invocations: Buddy ejects service to allow perfect service deletion by @gavofyork in <a href="https://github.com/gavofyork/graypaper/pull/182" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/182</a>
</div>
<div class='msg'><time>2025-01-08 15:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I expect <a href="https://github.com/gavofyork/graypaper/issues/186" target="_blank" rel="noopener">one further substantial alteration</a> in the <a href="https://github.com/gavofyork/graypaper/milestone/1" target="_blank" rel="noopener">0.5 series</a> and after that I think we&#x27;ll be good until the 0.7/0.8 series.</div>
<div class='msg'><time>2025-01-08 19:54</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Getting back to an old question: I still didn&#x27;t figure out what C(p) means in this formula. Here:

d ↦ [join(c) ∣ c &lt;−T[C(p) ∣ p &lt;−unzip684(d)]]

d is a binary with size multiple of both k and 684
I unzip684 d, so I get k binaries p of size 684
then I take each one of this binaries p and apply C(p) - what is C(p) ?  </div>
<div class='msg'><time>2025-01-09 08:17</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: It is Reed-Solomon erasure coding Encoding function we are allowed to use external library for this, example - <a href="https://github.com/ordian/reed-solomon-simd/blob/7def877102661817b3c2d5bcfe85118ffb535245/README.md?plain=1#L94" target="_blank" rel="noopener">https://github.com/ordian/reed-solomon-simd/blob/7def877102661817b3c2d5bcfe85118ffb535245/README.md?plain=1#L94</a></div>
<div class='msg'><time>2025-01-10 18:08</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I got it. Thanks for sharing this. I tried to use this library, but it accepts only shards with size that are multiple of 64 bytes. In case of JAM, shards are 684 bytes. Do you know how we could deal with this? 

Another question is:  684 / 1023 configuration would be for production network. What would be the testnet / tiny / small network configuration? </div>
<div class='msg'><time>2025-01-10 20:56</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: About the Erasure Code definition, if C ∶ ⟦Y2⟧342 → ⟦Y2⟧1023, and p ∈ ⟦Y684⟧, is there a formal specification missing in formula H.6 to transform p ∈ ⟦Y684⟧ into ⟦Y2⟧342 ? </div>
<div class='msg'><time>2025-01-11 03:40</time>&ensp;<span class='u' style='color:#c86f85'>amritj</span>: I am also facing this problem right now. I have temporarily padded my data to support 64 bytes and will fix it later.

There is also a discussion about this issue on GitHub here: <a href="https://github.com/w3f/jamtestvectors/pull/4" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/4</a>

Maybe someone else has a concrete solution.


I believe the configuration for testnet, tiny, or small networks will remain the same because the data size will still be 684k. In all these networks, the same validator holds multiple pieces of the 1023 chunks. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-11 17:32</time>&ensp;<span class='u' style='color:#6de2b4'>weigen</span>: Hi, I have a question about disputes. Based on my understanding, the faults (f) in the extrinsic include validators who issued invalid judgments on a work report. Since the work report is actually valid, it should belong to the good set (Psi_g).
This logic aligns with the behavior seen in this test vector (<a href="https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/disputes/tiny/progress_with_verdicts-4.json#L82," target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/disputes/tiny/progress_with_verdicts-4.json#L82,</a> <a href="https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/disputes/tiny/progress_with_verdicts-4.json#L191)," target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/disputes/tiny/progress_with_verdicts-4.json#L191),</a> where work reports included in faults (f) are added to the good set of the posterior Psi. However, according to the Gray Paper (<a href="https://graypaper.fluffylabs.dev/#/579bd12/128a01128a01)," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/128a01128a01),</a> the reports in faults (f) should instead be placed in the bad set (Psi_b) and not in the good set.

This creates a conflict: if the work reports in faults (f) are valid and should be part of the good set, why are they assigned to the bad set instead? My understanding is that validators who issued invalid judgments on these valid reports are placed in faults (f), but the reports themselves remain valid.

Am I interpreting this correctly, or have I missed something?</div>
<div class='msg'><time>2025-01-12 10:42</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I think you are interpreting the GP incorrectly. The judgments included in faults can be either positive (ie claiming the WR is good) or negative (ie claiming it is bad). The requirement you linked (<a href="https://graypaper.fluffylabs.dev/#/579bd12/128a01128a01)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/128a01128a01)</a> just states that they must contradict a verdict</div>
<div class='msg reply'><time>2025-01-12 13:40</time>&ensp;<span class='u' style='color:#6de2b4'>weigen</span>: Thanks! I got it</div>
<div class='msg'><time>2025-01-12 10:44</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: So eg if a WR is found to be bad, then validators who supported the WR (ie produced a positive judgment) can be reported via faults</div>
<div class='msg'><time>2025-01-12 13:37</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: can&#x27;t we just use <a href="https://github.com/paritytech/erasure-coding/tree/main" target="_blank" rel="noopener">https://github.com/paritytech/erasure-coding/tree/main</a> directly? for the testvector, I think it is incomplete or we&#x27;d better do it after the accumulation part, if I&#x27;m not mistaken, the testvectors required a lot of external logic for assembling the chunks <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-13 07:43</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: &gt; &lt;@clearloop:matrix.org&gt; can&#x27;t we just use <a href="https://github.com/paritytech/erasure-coding/tree/main" target="_blank" rel="noopener">https://github.com/paritytech/erasure-coding/tree/main</a> directly? for the testvector, I think it is incomplete or we&#x27;d better do it after the accumulation part, if I&#x27;m not mistaken, the testvectors required a lot of external logic for assembling the chunks

This parity example just takes a generic byte string and splits it into chunks. It still uses the Reed Solomon library, that only accepts strings with 64 bytes multiple size</div>
<div class='msg reply'><time>2025-01-16 05:02</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: thanks! I have skipped the types specified in erasure_coding after seeing <code>parity/erasure_coding</code> , will get it back these days!</div>
<div class='msg'><time>2025-01-13 10:29</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: In the INVOKE host-call (<a href="https://graypaper.fluffylabs.dev/#/579bd12/362401366b01)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/362401366b01)</a> we are apparently setting to regs[7], both values of &quot;Host-call result constants&quot; (<a href="https://graypaper.fluffylabs.dev/#/579bd12/2c78022ca802)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/2c78022ca802)</a> and values from &quot;inner pvm invocations result codes&quot; (<a href="https://graypaper.fluffylabs.dev/#/579bd12/2caa022cbd02)." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/2caa022cbd02).</a> This would be incorrect in theory, and also in practice since the value &quot;0&quot; is associated to two different constants (Ok and Halt)</div>
<div class='msg'><time>2025-01-13 12:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No it wouldn’t. </div>
<div class='msg'><time>2025-01-13 12:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The two tokens <code>OK</code> and <code>Halt</code> are each representations of zero. </div>
<div class='msg'><time>2025-01-13 12:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If <code>invoke</code> returns zero in omega_7, then it unambiguously means <code>Halt</code>.</div>
<div class='msg'><time>2025-01-13 12:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You’re probably trying to associate a _type_ with omega_7. This would be an incorrect approach. </div>
<div class='msg'><time>2025-01-13 12:30</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: yep, I was trying that. Thank you for clarification</div>
<div class='msg'><time>2025-01-13 16:56</time>&ensp;<span class='u' style='color:#817ecb'>ycc3741</span>: gav: 
Does the official source provide any test data for verifying whether each class has been correctly serialized according to the specifications in Appendix <a href="https://graypaper.fluffylabs.dev/#/5b732de/361100361100" target="_blank" rel="noopener">C.2</a> before performing the hash operation?</div>
<div class='msg'><time>2025-01-13 16:57</time>&ensp;<span class='u' style='color:#817ecb'>ycc3741</span>: We are currently encountering some issues and would like to verify whether the serialization is correct. Having the serialized results available would greatly facilitate development. Thank you!</div>
<div class='msg'><time>2025-01-13 17:08</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: &gt; &lt;@ycc3741:matrix.org&gt; We are currently encountering some issues and would like to verify whether the serialization is correct. Having the serialized results available would greatly facilitate development. Thank you!

Just a tip in the meantime until there are official full block/state serialization vectors.. I found switching to parsing all of the *.bin vectors rather than the json equivalents helped me catch a few encoding issues.</div>
<div class='msg'><time>2025-01-13 17:10</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: There are some serialization test vectors here: <a href="https://github.com/w3f/jamtestvectors/tree/master/codec" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/tree/master/codec</a></div>
<div class='msg'><time>2025-01-13 17:30</time>&ensp;<span class='u' style='color:#817ecb'>ycc3741</span>: Oh I got it thanks a lot </div>
<div class='msg'><time>2025-01-15 14:52</time>&ensp;<span class='u' style='color:#cb735c'>prasad-kumkar</span>: For state merklization, is there a recommended approach for data ordering before constructing the Merkle tree? While I noticed the state key construction function C appears to provide some ordering through key generation, I&#x27;m unsure if:

1. This is indeed meant to determine the ordering before Merkleization
2. If so, would service indices (s) create well-distributed keys since they are sparsely distributed 32-bit integers?

I initially thought of splitting data in half recursively (like traditional Merkle trees), but noticed JAM&#x27;s approach might be different.</div>
<div class='msg'><time>2025-01-15 16:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This is a Merkle trie, so the keys (given by C) determine exactly the node structure of the tree. </div>
<div class='msg'><time>2025-01-15 16:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You don’t get to decide. “Ordering” is moot as we never iterate. But if you really want an order (eg for RPC) then you can apply dictionary ordering to the keys. </div>
<div class='msg'><time>2025-01-15 16:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Service indices are sparse, as are keys generally: the function C is designed to be sparse and mostly uniform. The tree’s implied node structure (by virtue of the commitment scheme) should be able to manage this perfectly well. </div>
<div class='msg'><time>2025-01-15 16:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: One reasonable question might be whether (or to what degree) keys/values should be kept in-memory, and whether (or to what degree) the nodes of the tree should be persisted and whether that persistence should be in-memory or on-disk.  </div>
<div class='msg'><time>2025-01-15 16:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For now I’d leave this for implementers to decide. I expect that getting to M4 or M5 will almost certainly need aggressive use of RAM to store/memoize one or both of these databases. </div>
<div class='msg'><time>2025-01-15 19:52</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: A suggestion for CE-132.. it might be a good idea to allow multiple tickets to be submitted by a proxy in a single stream. The current specification works good for the tiny chain spec but it may not be the best performance wise when using the full chain spec. The full chain spec will have 2046 tickets to be distributed to everyone within approx. 22 minutes (half of the lottery time and allowing 3 min for connectivity changes). This will result in 90+ incoming streams per minute for each validator just to consume tickets.</div>
<div class='msg'><time>2025-01-15 19:56</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Might happen for the full network protocol, don&#x27;t think it&#x27;s particularly important though</div>
<div class='msg'><time>2025-01-15 20:23</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: For CE-134 &quot;Work-package sharing&quot;, why is &quot;slot&quot; not included as part of the msg?
 

<pre><code class=''>Guarantor -&gt; Guarantor

--&gt; Core Index ++ Segments-Root Mappings
--&gt; Work-Package Bundle
--&gt; FIN
&lt;-- Work-Report Hash ++ Ed25519 Signature
&lt;-- FIN
</code></pre>

Perhaps this can be something like
<pre><code class=''>--&gt; Core Index ++ slot ++ Segments-Root Mappings
</code></pre>
? </div>
<div class='msg'><time>2025-01-15 21:27</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not really necessary as it stands, the recipient can just accept or reject based on whether there is an appropriate core assignment or not. What an appropriate assignment is probably needs to be specified in more detail to ensure different implementations work well together, but will likely just be based on the current time and state at the head of the chain</div>
<div class='msg'><time>2025-01-17 16:29</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: If <a href="https://graypaper.fluffylabs.dev/#/579bd12/241901241b01" target="_blank" rel="noopener">this function</a> returns B_{8n}, shouldn&#x27;t it say &quot;forall i in N_{8n}&quot; instead of &quot;...in N_{2^{8n}}&quot;?</div>
<div class='msg'><time>2025-01-17 18:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@cisco:parity.io&gt; If <a href="https://graypaper.fluffylabs.dev/#/579bd12/241901241b01" target="_blank" rel="noopener">this function</a> returns B_{8n}, shouldn&#x27;t it say &quot;forall i in N_{8n}&quot; instead of &quot;...in N_{2^{8n}}&quot;?

Yes. Will be fixed in next revision</div>
<div class='msg'><time>2025-01-17 18:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/194" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/194</a></div>
<div class='msg'><time>2025-01-19 10:18</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Question about the <a href="https://github.com/subotic/polkavm/blob/subotic_add_64_bit_test_programs/tools/spectool/spec/schema.asn#L52" target="_blank" rel="noopener">schema.asn</a> of PVM test programs: &quot;expected-status&quot; is described as &quot;the status code of the execution, i.e. the way the program is supposed to end&quot;.

1.- Is this the GP exit reason? (halt, panic, out of gas, page fault, hostcall fault)
2.- If (1) is yes, should &quot;trap&quot; be replaced by &quot;panic&quot; and the other exit reasons be added to &quot;expected-status&quot;? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-01-20 05:50</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: 1. Yes.
2. &quot;trap&quot; is the same as  &quot;panic&quot;</div>
<div class='msg reply'><time>2025-01-20 09:57</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: It&#x27;s a bit confusing because &quot;trap&quot; is an instruction and &quot;panic&quot; is an exit reason.

What do you do when a page fault ocurrs? Do you store the lowest address to access in a status register before executing the trap instruction to switch from PVM mode to JAM kernel mode?</div>
<div class='msg reply'><time>2025-01-20 12:51</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: I will align the naming in the next version of the test vectors to make it less confusing.</div>
<div class='msg reply'><time>2025-01-20 12:55</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: For toplevel PVMs a page fault is no different than executing a &quot;trap&quot; instruction or any other condition which would result in a &quot;panic&quot; exit reason, and for those you don&#x27;t even need to know the address of the page that faulted.

For inner PVMs (those are PVMs triggered with the <code>invoke</code> hostcall) a page fault will interrupt the execution of the inner PVM and should return the address of the page which triggered the fault.</div>
<div class='msg reply'><time>2025-01-20 13:00</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: And in case you&#x27;re wondering, the store instructions are atomic, so for example if the inner PVM tries to write 4 bytes into the memory, and the first two bytes end up at the 2 last bytes of page N (which was already faulted) and the last two bytes end up at the 2 first bytes of page N +1 (which was not faulted) then such a write will <em>only</em> trigger a page fault with the address of the N + 1 page and memory will not be modified.</div>
<div class='msg'><time>2025-01-20 18:01</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Small Clarification question about preimages included in the genesis state (<a href="https://github.com/jam-duna/jamtestnet/blob/main/fallback/state_transitions/455223_000.json#L9C24-L9C90" target="_blank" rel="noopener">example</a>):  To be conformant to GP, should it include a matching <a href="https://graypaper.fluffylabs.dev/#/579bd12/387003387003" target="_blank" rel="noopener">a\_l</a> in the state trie _even though no preimage was ever &quot;requested&quot;_?  If so, what would (9.7) (<a href="https://graypaper.fluffylabs.dev/#/579bd12/11aa0011aa00" target="_blank" rel="noopener">GP link</a>) prescribe as its $[x]$ value? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-20 22:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: [0] perhaps?</div>
<div class='msg'><time>2025-01-21 12:29</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Question on JAM DA throughput: How does the model referenced in <a href="https://graypaper.fluffylabs.dev/#/579bd12/1f90011f9001" target="_blank" rel="noopener">Sec 20</a> arrive at the distributed availability of 852MB/s?  Simplest model based on <a href="https://graypaper.fluffylabs.dev/#/579bd12/418d00418d00" target="_blank" rel="noopener">W_B=12MB</a> (max encoded work package size, derived from bandwidth considerations I think?) with 6s on guarantee and 6s on assurance yields 1MB/s per core x 341 cores = 341MB/s -- so what accounts for the difference?  </div>
<div class='msg'><time>2025-01-21 13:24</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: JAM is pipelined so peak throughput is 341 WPs per block, not per 2 blocks. Don&#x27;t know exactly where the 852MB/s number comes from, but the bundle size does not include exported segments so possibly that is the other missing bit <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-21 13:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: That’s an old figure even WPs could be 15 mb. </div>
<div class='msg'><time>2025-01-21 13:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Now that they’re 12, it’s 682MB/s</div>
<div class='msg'><time>2025-01-22 04:52</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Ok, got it -- this 2x pipelining &quot;easter egg&quot; is not obvious from GP or JAMNP.   We now see the conditions for it are carefully enabled through the ordering of assurances and guarantees on &quot;rho&quot;.   Is the idea that this performance optimization is optional for M3 &quot;Kusama performance&quot; but practically required  for M4 &quot;Polkadot performance&quot; -- yet not really part of the JAM protocol per se and thus outside of GP?  Does a hint in CE133/134 to achieve this factor of 2x make sense?</div>
<div class='msg'><time>2025-01-23 08:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Implementations are expected to author blocks in a reasonably efficient manner. Asynchrony which is possible should be exploited. This will likely be required as early as M2. </div>
<div class='msg'><time>2025-01-23 08:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We will work to provide some basic M2 test vectors demonstrating this expectation. </div>
<div class='msg'><time>2025-01-23 08:52</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: If there will be a more detailed spec for async computation provided in M2 test vectors, as we can see in the dependency graph here <a href="https://graypaper.fluffylabs.dev/#/579bd12/091b00091b00," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/091b00091b00,</a> some of the state transition are just **assign** operations, that they actually not need async <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-23 09:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For the inner aspects of state transition (block execution), asynchrony is perhaps not quite so relevant as with block authoring. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-23 09:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There will likely need to be some to hit M3 and M4 (e.g. signature checking, inter-block Merkle root calculation).</div>
<div class='msg'><time>2025-01-23 09:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But it&#x27;s up to teams how the optimise, given the correctness-constraints of the GP.</div>
<div class='msg'><time>2025-01-23 09:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We won&#x27;t be holding anyone&#x27;s hand here.</div>
<div class='msg'><time>2025-01-23 09:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For block authoring (M2), skipping a block for either guaranteeing or assuring will be considered incorrect behaviour.</div>
<div class='msg'><time>2025-01-23 09:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Nodes are expected to provide (and use) information in a timely fashion; this goes for all aspects of block authoring and production. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-23 09:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Updated my notes with an according FAQ entry. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-24 10:06</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: Hi, in the GP v0.5.4 the instructions <code>rot_l_32</code> and <code>rot_r_32</code> have 3 registers but <code>ω_B</code> is never used, is this a typo? and should we rotate by <code>ω_B</code> instead?</div>
<div class='msg reply'><time>2025-01-24 10:07</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Yes, it&#x27;s a typo.</div>
<div class='msg reply'><time>2025-01-24 10:08</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: the fix is merged: <a href="https://github.com/gavofyork/graypaper/pull/193" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/193</a></div>
<div class='msg'><time>2025-01-25 13:18</time>&ensp;<span class='u' style='color:#6de2b4'>weigen</span>: Hi, I have a question about GP (<a href="https://graypaper.fluffylabs.dev/#/579bd12/131301131901)." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/131301131901).</a> What is the expected range of n (segment-count)? When serializing a work report, should n be considered as 𝑛∈𝑁_32 or 𝑛∈𝑁_16? The choice would result in a difference in byte size.</div>
<div class='msg reply'><time>2025-01-25 14:48</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Serialisation is defined in appendix C. In particular, see C.22</div>
<div class='msg reply'><time>2025-01-26 12:07</time>&ensp;<span class='u' style='color:#6de2b4'>weigen</span>: Maybe the constraint of 𝑛∈𝑁_16 is needed, since in C.22 the input of ε_2 should be N_16</div>
<div class='msg'><time>2025-01-26 14:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s not strictly needed, though if N \ N_{2^16} were ever fed into E_2 the result would be undefined.    <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-26 14:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Since it is deserialised with E_2, any foreign-born availability specification will always be in range for correct reserialisation. And though your node could create an availablilty spec with an out of range value, it would only break your own node since it could not be encoded and this would be needed for it to be sent to another node.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-26 16:52</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: The formula to encode guarantees on for Hx extrinsic hash 
(<a href="https://graypaper.fluffylabs.dev/#/579bd12/0ce0000cf200)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/0ce0000cf200)</a> differs from the formula for encoding guarantees for block encoding (<a href="https://graypaper.fluffylabs.dev/#/579bd12/375b01377f01)." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/375b01377f01).</a> 

In the former, it calculates hash of work report. Is this correct? 

 <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-26 17:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes. </div>
<div class='msg'><time>2025-01-26 17:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s a bit fiddly but it’s so that they can be separately distributed and individual items concisely proven to be correct.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-26 17:25</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: With <code>tiny</code> having <a href="https://docs.jamcha.in/basics/chain-spec/tiny" target="_blank" rel="noopener"><code>rotation_period: 4</code></a> (which is not all that different from <code>full</code> having <a href="https://docs.jamcha.in/basics/chain-spec/full" target="_blank" rel="noopener"><code>rotation_period: 10</code></a>) we have found in our &quot;run ~12MB work packages back-to-back&quot; tests that work packages are reasonable for one validator to start towards the end of one rotation but by the time a guarantee is signable by one of the three, it is the case that one or two of them have rotated out of the core.  Ok, so ... what is a good mode of operation for
(a) don&#x27;t start the work if you&#x27;re towards the end according to rule R, because you won&#x27;t be rewarded for it!
(b) finish it because you&#x27;ll be rewarded for it!
We do believe its valuable to have this rule R or reward process specified in more detail to ensure different implementations work well together -- can we come up with a good Schelling point at this point?

Not getting the slot in the &quot;tiny&quot; network (where C is just 2, R is just 4) with &quot;big&quot; work packages (close to 12MB) makes this issue quite prominent in regression tests. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-01-26 18:40</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Agree this will probably need to be specified at some point for different impls to work well together. I think this rule will need to be informed by the performance characteristics of a full 1000-validator network though, with real builder nodes, and we aren&#x27;t in a position to run such a network yet. I can say that at the moment our node follows a pretty simple rule: as a validator, accept a package for core C if we will be &quot;assigned&quot; to that core in the next slot or the slot after that. Note that it is possible for block authors to include packages using assignments from the previous rotation, so there is quite a bit of leeway.</div>
<div class='msg reply'><time>2025-01-26 18:43</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Given this leeway perhaps a better rule would be to allow if we&#x27;re currently assigned or will be assigned in the next slot. In any case I would recommend making this sort of thing easy to tweak in your implementation!</div>
<div class='msg reply'><time>2025-01-26 18:46</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The rule should also probably be a bit more lenient for work packages received indirectly from another guarantor on the same assignment, to avoid a situation where the &quot;primary&quot; guarantor _just_ accepts a package but the guarantors it then shares it with do not.</div>
<div class='msg reply'><time>2025-01-26 18:51</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Of course at the end of the day none of this behaviour will be required; nodes will be free to accept or reject packages however they think will maximise their profit. A specified rule seems like a good starting point though</div>
<div class='msg reply'><time>2025-01-26 22:45</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Alright - we&#x27;ll do &quot;to allow if we&#x27;re currently assigned or will be assigned in the next slot.&quot; for now sure thing thank you</div>
<div class='msg'><time>2025-01-29 16:46</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: If a panic occurs when <code>80 -&amp;gt; load_imm_jump</code> executes the <a href="https://graypaper.fluffylabs.dev/#/579bd12/26ef0226ef02" target="_blank" rel="noopener">branch</a> function, the &quot;ωA&quot; don&#x27;t should be changed, right?</div>
<div class='msg reply'><time>2025-01-29 16:49</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: It&#x27;s always changed, regardless of whether the jump fails or not.</div>
<div class='msg reply'><time>2025-01-29 16:49</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: (This is the equivalent of RISC-V&#x27;s <code>call</code> instruction; the usual use of this instruction is to load the return address and jump to another function.) <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-01-29 16:52</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Thanks! 🙂</div>
<div class='msg'><time>2025-01-30 10:08</time>&ensp;<span class='u' style='color:#c669dd'>carlos-romano</span>: Screenshot 2025-01-30 at 11.07.59.png</div>
<div class='msg'><time>2025-01-30 10:09</time>&ensp;<span class='u' style='color:#c669dd'>carlos-romano</span>: Regarding <a href="https://github.com/davxy/jam-test-vectors/tree/polkajam-vectors/reports" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/tree/polkajam-vectors/reports</a> :

 I can see there are test vectors where auth_pools are the same in both prestate and poststate, but given that we should remove the used authorizer from the pool, and that pending core authorizers are not provided by test vectors and should be empty, I don&#x27;t get why this is the case. 

Specific commit where this change was introduced: <a href="https://github.com/davxy/jam-test-vectors/commit/729592cf87eb09bc34555f846c5b19f5b1453c52" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/commit/729592cf87eb09bc34555f846c5b19f5b1453c52</a> .

This is related to equation 8.2, GP 0.5.4

Thanks!

</div>
<div class='msg'><time>2025-01-30 13:18</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: Regarding <code>page-fault</code> and this paragraph <a href="https://graypaper.fluffylabs.dev/#/579bd12/243c00245500," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/243c00245500,</a> I understand that when trying to write to writable memory and I cannot, I emit a <code>page-fault</code>. What is not so clear to me based on this definition, that if I want to write to read-only memory, I should emit a <code>panic</code>. I only know that because of the test-vectors. Or did I miss a place in the GP where this is defined?</div>
<div class='msg'><time>2025-01-30 13:20</time>&ensp;<span class='u' style='color:#5e86de'>boymaas</span>: Maybe this helps: <a href="https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2614547819" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2614547819</a></div>
<div class='msg reply'><time>2025-01-30 13:25</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: Great, thanks for the link. As always, things are more complicated, then they seem.</div>
<div class='msg'><time>2025-01-30 14:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Version <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.0" target="_blank" rel="noopener">0.6.0</a> is released!</div>
<div class='msg'><time>2025-01-30 14:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There&#x27;s a few changes in this from 0.5.4 all centred around the PVM</div>
<div class='msg'><time>2025-01-30 14:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: - <code>import</code> host call has been removed in favour of a new <code>fetch</code> hostcall; this reduces the amount of data placed in PVM memory up-front and provides a means of extracting data beyond just that concerning the current work-item but for other work-items too.
- All data providing host-calls now accept an offset parameter to allow any contiguous subportion of the data to be read.
- OOB has been (almost) removed. When the outer PVM has a host-call in which it is passed a memory address it cannot access, then it panics irrecoverably.
</div>
<div class='msg'><time>2025-01-30 14:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The page faulting specification has also been updated and formalised.</div>
<div class='msg'><time>2025-01-30 14:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This release signals the end of the 0.5 series and, potentially (but probably not), the final protocol revision (not including the obvious stuff which we know will need doing before 1.0 such as gas pricing). <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-30 14:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 0.6 series should contain primarily cleanups, finesse, formatting, discussion and corrections.</div>
<div class='msg'><time>2025-01-30 14:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 0.7 and 0.8 will be any important tweaks or optimisations brought on through service-prototyping and Toaster-testing. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-01-30 14:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 0.9 will be auditing fixes only.</div>
<div class='msg'><time>2025-02-02 11:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Version <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.1" target="_blank" rel="noopener">0.6.1</a> is released.

This is just a few small corrections and a simplification of <code>fetch</code>. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-03 06:12</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: Should **ω_A** be taken modulo **2^32** before being fed into **Χ_4**, since the input of **Χ_4** belongs to **N_32**?

<a href="https://graypaper.fluffylabs.dev/#/4bb8fd2/299c0329a303" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/4bb8fd2/299c0329a303</a></div>
<div class='msg'><time>2025-02-03 08:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, I expect so - <a href="https://matrix.to/#/@jan:parity.io" target="_blank" rel="noopener">@jan:parity.io</a>?</div>
<div class='msg'><time>2025-02-03 09:49</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Yes, since X\_4 requires the input to be N\_32 there should be a modulo there, otherwise the result would be undefined.

Side note, since I already had questions regarding this: you can think of every 32-bit instruction variant as _always_ taking a modulo of its inputs, even though sometimes in the GP we omit this modulo to make the equations simpler if the result would be equivalent anyway, for example in case of <code>add_32</code> the result gets truncated anyway so truncating the inputs is unnecessary. The high-level intent is to allow every 32-bit instruction variant to be implemented as follows (to allow for an efficient recompiler implementation): 1) truncate all inputs to 32-bit, 2) do the operation, 3) sign-extend to 64-bit, so if you find any equation in the GP for 32-bit instruction variants would have given a result that doesn&#x27;t match this please ping me and we&#x27;ll correct it. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-03 11:11</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: Related to an issue we found in testvectors for PVM instruction 206.
Does GP allow for negative output of a modulo operation?
Since this is not explicitly mentioned in section 3, I assume the answer is no. 
If the answer is no, then PolkaVM probably has an incorrect implementation of GP.
<a href="https://github.com/gavofyork/graypaper/issues/222" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/222</a></div>
<div class='msg reply'><time>2025-02-03 12:04</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: I just replied in the issue: <a href="https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2630744952" target="_blank" rel="noopener">https://github.com/w3f/jamtestvectors/pull/3#issuecomment-2630744952</a>

TLDR: the test vector is correct and what we want; GP might have to be tweaked to account for this</div>
<div class='msg'><time>2025-02-03 12:05</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: Yes in that case GP should be adjusted to remove any ambiguity.
GP should to explicitly state that the modulo operator on a negative number yields a negative number, and not a positive number as expected by &#x27;Maths&#x27;.</div>
<div class='msg'><time>2025-02-04 09:06</time>&ensp;<span class='u' style='color:#c669dd'>carlos-romano</span>: anyone please? 🙏</div>
<div class='msg'><time>2025-02-04 11:31</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@carlos-romano:matrix.org&gt; anyone please? 🙏

I&#x27;ll take a look. Could you please specify one particular test vector so I can review it directly?</div>
<div class='msg reply'><time>2025-02-04 12:44</time>&ensp;<span class='u' style='color:#c669dd'>carlos-romano</span>: thanks a lot! All the test vectors modified here:

<a href="https://github.com/davxy/jam-test-vectors/commit/729592cf87eb09bc34555f846c5b19f5b1453c52" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/commit/729592cf87eb09bc34555f846c5b19f5b1453c52</a>

For example:

reports/tiny/high_work_report_gas-1.json

Probably I am missing something, but for me the right test vectors should be how they were before that commit.</div>
<div class='msg reply'><time>2025-02-04 19:28</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: The &quot;reports&quot; STF exercised by these vectors has been modified to not change the content of the auth queues. The content of the queues is changed by the &quot;authorizations&quot; test vectors. I&#x27;ll add a note to the readme to make this explicit <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-02-05 07:06</time>&ensp;<span class='u' style='color:#c669dd'>carlos-romano</span>: ahh ok thanks, so then we don&#x27;t need to check them against the STF test vectors post state right? Thanks a lot  🙏</div>
<div class='msg'><time>2025-02-04 12:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@emielsebastiaan:matrix.org&gt; Yes in that case GP should be adjusted to remove any ambiguity.
&gt; GP should to explicitly state that the modulo operator on a negative number yields a negative number, and not a positive number as expected by &#x27;Maths&#x27;.

This is corrected/clarified in main. </div>
<div class='msg'><time>2025-02-04 16:28</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I&#x27;ve a question about 14.13. <code>bold_l</code> is being constructed by essentially ensuring that all the workpackagehashes (special hash) in the workItems import data segments <code>i</code> have a key in the bold\_l (14.11) and that the &quot;pointing&quot; value in the <code>bold_l</code> dictionary is the **previously** computed &quot;segmentRoot&quot; of the AVailability specification (14.13).

- If this is correct then it means guarantors need to maintain a Datastore containing a dictionary of Previously computed WorkResults corect?
- I don&#x27;t see any limitation of imported segments referencing WorkPackage hashes which generated a report on the same core as the one we&#x27;re trying to compute. This means that a workpackage p could have work items <code>w</code> whose reference in its import-segments a workpackagehash w which was computed on another core <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-04 16:28</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: (0.6.1)</div>
<div class='msg'><time>2025-02-05 09:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. Correct

2. Nodes need only keep fairly recent WPH-&gt;SR history, since it is known that the resultant report  must pass the on-chain WPH-&gt;SR lookup whose history is limited. Ultimately guarantors are free to ignore work packages whose imports they deem unreasonable, unknowable or unlikely to result in a profitable endeavour. To pass the conformance tests nodes need only be able to make guarantees under reasonable conditions.   <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-05 09:23</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: Thanks for this. Will it ever be specified in graypaper? Especially the &quot;fairly recent&quot; or &quot;reasonable conditions&quot;?</div>
<div class='msg'><time>2025-02-05 09:24</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I think the same might be applied on 14.14 which basically is implying that there is a datastore from the MerkleTreeRoot and its &quot;preimage&quot;</div>
<div class='msg'><time>2025-02-05 09:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@prematurata:matrix.org&gt; Thanks for this. Will it ever be specified in graypaper? Especially the &quot;fairly recent&quot; or &quot;reasonable conditions&quot;?

Guaranteeing is a strategic endeavour, and the Gray Paper generally avoids dictating strategy. </div>
<div class='msg'><time>2025-02-05 09:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: However the aspect of “fairly recent” is well-specified in terms of on-chain behaviour. See equations 12.4-12.8</div>
<div class='msg'><time>2025-02-05 09:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Of course a guarantor would need to guess when their guaranteed work-report would likely make it to accumulation in order to apply this limit to the strategy of guaranteeing. </div>
<div class='msg'><time>2025-02-05 11:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But given that guarantors are responsible for the same core for 10 blocks at a time and receive all guarantees across (even across other cores), then it&#x27;s quite possible to make a pretty decent guess on the quality and size of the core&#x27;s backlog and how long it might be before the new report would make it on-chain. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-05 11:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: See also 11.40/41: <a href="https://graypaper.fluffylabs.dev/#/4bb8fd2/150302152d02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/4bb8fd2/150302152d02</a></div>
<div class='msg'><time>2025-02-05 14:17</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: Thanks gavin. I also have another question about the new fetch. 

- Is it intended for μ′\_{o⋅⋅⋅+l} to be updated even in case of a panic? Ex when w9 is 5 and memory between w10 and +32 is readable.

- also what is bold x?  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-05 14:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In the case of a panic, memory remains the same (though since panic at the top level is unrecoverable, it doesn’t really matter)</div>
<div class='msg'><time>2025-02-05 14:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There is a superfluous condition there - the additional omega_9 term for a panic. This will be removed in the next revision. This will then make it very clear that memory does not change in the case of a panic. </div>
<div class='msg'><time>2025-02-06 06:51</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: did you discovered what that bold x is? </div>
<div class='msg'><time>2025-02-06 08:42</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: no, I have no idea. my first guess would have been A.7 but according to that it seems bold x woudld then be a set containing numbers \in N_{2^32} and that would make no sense in the fetch definition</div>
<div class='msg'><time>2025-02-06 11:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room : <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.2" target="_blank" rel="noopener">v0.6.2</a> is out - contains all the latest corrections.</div>
<div class='msg'><time>2025-02-06 11:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Bold x is any value which satisfies the various conditions on it. You&#x27;ll find that practically speaking, there&#x27;s only one which anyone could reasonably know. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-06 11:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;s used specifically for extrinsics, where an extrinsic is specified in the WP as a hash/len. We assert that we know the preimage since we would not get to this part of the guarantee pipeline without knowing.</div>
<div class='msg'><time>2025-02-06 11:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Alternatively it could have been made explicit with an additional term being passed in to the Refine function and its context, but that would have just complicated the formulation.</div>
<div class='msg'><time>2025-02-06 11:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The GP isn&#x27;t about describing a node&#x27;s internal _data-logistics_; that&#x27;s an implementation-specific consideration. It only concerns outward *behaviour*.</div>
<div class='msg'><time>2025-02-06 16:02</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: &gt; &lt;@gav:polkadot.io&gt; @room : <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.2" target="_blank" rel="noopener">v0.6.2</a> is out - contains all the latest corrections.

3 PRs with pvm instruction modifications are pending review at your convenience. </div>
<div class='msg'><time>2025-02-06 16:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Merged one - will wait for Jan Bujak to take a look at the others.</div>
<div class='msg'><time>2025-02-06 16:09</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Yeah, since in the GP we &quot;store&quot; the values unsigned those were definitely missing the conversions back, LGTM.</div>
<div class='msg'><time>2025-02-06 16:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: All merged - will be in 0.6.3</div>
<div class='msg'><time>2025-02-06 16:41</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: I may have found one more for 0.6.3: <a href="https://github.com/gavofyork/graypaper/pull/231" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/231</a>
Header / Bandersnatch related (<code>H_a</code>)</div>
<div class='msg'><time>2025-02-07 14:00</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: Should the zero host function have the same error condition as the void host function? The one about pages being inaccessible

<a href="https://graypaper.fluffylabs.dev/#/5f542d7/35a90235a902" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/35a90235a902</a></div>
<div class='msg'><time>2025-02-07 14:30</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: The logic for getting the service in the read host function is very similar to the lookup host function: <a href="https://graypaper.fluffylabs.dev/#/5f542d7/305c00305c00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/305c00305c00</a>

They could be unified to make it easier to read.</div>
<div class='msg'><time>2025-02-07 15:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In the case of <code>void</code>, the pages must all be accessible because we&#x27;re making them inaccessible.</div>
<div class='msg'><time>2025-02-07 15:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We wouldn&#x27;t want exactly that condition for <code>zero</code> whose job is to initialize pages to being accessible and zero.</div>
<div class='msg'><time>2025-02-07 15:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We could introduce a condition to require them to be previously inaccessible, but currently we don&#x27;t. This was intented, but maybe it should be changed if requiring it bring us more performance impls ( Jan Bujak ?)</div>
<div class='msg'><time>2025-02-07 15:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: PRs are considered :P <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-07 15:13</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: Will make a PR for that unification  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-07 15:30</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The lack of requirement in <code>zero</code> that the pages are inaccessible is indeed intended so that e.g. this host call can be used to clear/reinitialize memory without first having to void it nor track what is already allocated. Requiring it wouldn&#x27;t really change anything performance-wise since you have to (or the OS has to) iterate over the page map to find the holes to fill anyway. (And in practice not requiring this check can make things simpler because you can just ask the OS to zero allocate an address range in bulk instead of having to do this yourself.)

Hm, but now that I think about it we probably should make <code>void</code> not require the pages to be accessible either, as that could simplify its usage in certain cases (and, same as with <code>zero</code>, the page map has to be iterated over anyway by the implementation, whether it returns an error or not). Basically have it take a range of pages we want it to free, and when it returns it&#x27;ll guarantee that the whole range is now free. So the <code>HUH</code> error branch could just be deleted altogether (since voiding the first 64k or out-of-bounds would be a no-op as there can&#x27;t never be anything allocated there anyway).</div>
<div class='msg'><time>2025-02-09 01:25</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: </div>
<div class='msg'><time>2025-02-09 02:00</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Is anyone aware of any non-rust libraries which implement bandersnatch vrf signatures? Seems the main implementations are in Rust for now <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-02-09 17:08</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Not aware of any other than davxys work on this. Have it on my list to investigate as a potential SPOF for the network.</div>
<div class='msg'><time>2025-02-09 18:55</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: AFAIK, <code>arc-ec-vrfs</code> is currently the only implementation available. This is likely because the scheme is not standardized, thus any existing implementation should be tied to JAM.

For those interested in implementing it, the details of Bandersnatch VRFs are soecified here: <a href="https://github.com/davxy/bandersnatch-vrfs-spec." target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec.</a> Implementing the &quot;plain&quot; VRF is **relatively** straightforward, especially with the support of a &quot;bigint&quot; library, making it a manageable task.

However, the complexity increases significantly when dealing with the ring-VRF variant. Even though it is thoroughly specified here: <a href="https://github.com/davxy/ring-proof-spec" target="_blank" rel="noopener">https://github.com/davxy/ring-proof-spec</a> , implementing it requires a library that supports the underlying SNARK framework it relies on. Since there are no official standards (only de facto ones, at best), you’ll likely need to build many things from scratch. 

We have been using <a href="https://arkworks.rs/" target="_blank" rel="noopener">arkworks</a> for this, as it provides **most** of the tools necessary. That said, some additional components were developed by the W3F team and ourselves to fill in the gaps anyway.

In summary, if someone is inclined to implement any of these components (also by building over arkworks, for example), I’m available to provide some support. Additionally, test vectors are available for validating conformance. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-09 19:20</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Since implementing it from scratch is so challenging, it seems essentially everyone will rely on the one implementation that is available (using something like go’s FFI if they’re not implementing jam in rust), which becomes a redundancy and a failure point. It’s probably well audited and as a single point of failure still probably ok though.</div>
<div class='msg'><time>2025-02-09 19:21</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I would love if people reimplement it of their own volition in their chosen language but I think we might need additional incentives if we do think relying on just this one implementation is in fact an issue </div>
<div class='msg'><time>2025-02-10 18:08</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: </div>
<div class='msg'><time>2025-02-10 18:35</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: 1.- In the preimages extrinsic, do the service-data pairs have to be <a href="https://graypaper.fluffylabs.dev/#/5f542d7/184800184800" target="_blank" rel="noopener">ordered</a> _only_ by service id? Or do we also have to consider the order of the data blob?
2.- Is the R function of eq <a href="https://graypaper.fluffylabs.dev/#/5f542d7/185e00185e00" target="_blank" rel="noopener">(12.30)</a> the one defined in eq <a href="https://graypaper.fluffylabs.dev/#/5f542d7/17ce0317ce03" target="_blank" rel="noopener">(12.23)</a>? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-10 19:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. Both, primarily service ID and then data blob. Same goes for any tuple. </div>
<div class='msg'><time>2025-02-10 19:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 2. No. R in 12.30 and 12.31 are the same. R in 12.23 and 2.24 are the same. I might rename one of them to avoid the confusion. </div>
<div class='msg'><time>2025-02-10 19:45</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: got it, thanks 👍️</div>
<div class='msg'><time>2025-02-10 19:58</time>&ensp;<span class='u' style='color:#de60df'>leonidas_m</span>: The GP assumes that we know the preimage data because there&#x27;s only one value that satisfies the necessary conditions. However, since the Refine function neither allows passing the preimage explicitly as a parameter nor permits querying the state, it&#x27;s unclear where this data should come from.

Should the preimage be retrieved from a node&#x27;s internal data store (local database), or is it expected to be fetched from an external source (e.g., network)?</div>
<div class='msg'><time>2025-02-10 21:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The latter. </div>
<div class='msg'><time>2025-02-10 21:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Validator nodes are expected to be sent solicited preimages directly from external sources.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-11 16:04</time>&ensp;<span class='u' style='color:#7178d3'>arjanz</span>: I believe to have corrected two small typos in appendix D, \H_0 should be \H^0: <a href="https://github.com/gavofyork/graypaper/pull/234" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/234</a></div>
<div class='msg'><time>2025-02-11 16:10</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: <a href="https://matrix.to/#/!ddsEwXlCWnreEGuqXZ:polkadot.io/$aFpJR-J3zqDbApsjZ3qMX-QjOVoZnYSYG2oTSPPCDB0?via=polkadot.io&amp;via=matrix.org&amp;via=parity.io" target="_blank" rel="noopener">https://matrix.to/#/!ddsEwXlCWnreEGuqXZ:polkadot.io/$aFpJR-J3zqDbApsjZ3qMX-QjOVoZnYSYG2oTSPPCDB0?via=polkadot.io&amp;via=matrix.org&amp;via=parity.io</a></div>
<div class='msg'><time>2025-02-12 00:39</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Hello I have a few questions I was hoping someone could help with.

1. Is there a formal definition of a work package bundle other than the textual description in 14.4.1? It mentions the attributes but not the data types of each attribute.
2. The extrinsic data in a work package bundle, is it a list of hashes and lengths? Or is this the full preimages themselves?
3. The exported segments in a work package bundle, or they the actual segments of length 4104? Or are they a list of root and indexes?
4. Is the extrinsic that’s passed in CE133 the same as what’s in a work package bundle? If so why is it included in CE133 if it can just be calculated based off the work package by the receiver using X(w) in 14.14
</div>
<div class='msg'><time>2025-02-12 13:38</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: Hello I thought about opening an issue on graypaper repo instead of reporting here as it was/is a bit complicated matter to write here
 <a href="https://github.com/gavofyork/graypaper/issues/239" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/239</a> </div>
<div class='msg'><time>2025-02-12 15:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@charliewinston14:matrix.org&gt; Hello I have a few questions I was hoping someone could help with.
&gt; 
&gt; 1. Is there a formal definition of a work package bundle other than the textual description in 14.4.1? It mentions the attributes but not the data types of each attribute.
&gt; 2. The extrinsic data in a work package bundle, is it a list of hashes and lengths? Or is this the full preimages themselves?
&gt; 3. The exported segments in a work package bundle, or they the actual segments of length 4104? Or are they a list of root and indexes?
&gt; 4. Is the extrinsic that’s passed in CE133 the same as what’s in a work package bundle? If so why is it included in CE133 if it can just be calculated based off the work package by the receiver using X(w) in 14.14
&gt; 

1. It is the second argument to A in 14.15</div>
<div class='msg'><time>2025-02-12 15:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 2. A bundle has the extrinsic data; see 14.14 X. </div>
<div class='msg'><time>2025-02-12 15:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 3. A bundle has the actual segments and justifications. See 14.14 S and J. </div>
<div class='msg'><time>2025-02-12 15:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 4. 14.14 X assumes knowledge of the relevant hash preimages. The receiver may not have such knowledge therefore it makes sense to provide it. Theoretically we could make it an on-demand thing later. </div>
<div class='msg'><time>2025-02-13 10:16</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: Adds tau &amp; tau\_prime as state transition input dependency.

<a href="https://github.com/gavofyork/graypaper/pull/241" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/241</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-14 11:49</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: How is the strangely odd number <a href="https://graypaper.fluffylabs.dev/#/5f542d7/114c01114c01" target="_blank" rel="noopener">81</a> from the <code>a_o</code> service storage size formula derived?   The 32 within the same formula is the storage for key, but 81 is 17 more bytes than 64... <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-07-17 10:13</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I believe it&#x27;s key+value size for the l and p dictionaries. p key size is 32, value size is z. l key size is 36, value size is max 13 (1 for len + 3*4 bytes). Total is 81+z.</div>
<div class='msg'><time>2025-02-14 19:27</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: For initializing the ring context for bandersnatch ring vrf stuff, there must be a common seed we’ll all be using? So that it remains deterministic </div>
<div class='msg'><time>2025-02-14 19:33</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I assume we use the parameters in 4.1 configuration in <a href="https://github.com/davxy/bandersnatch-vrfs-spec/blob/main/specification.pdf" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/blob/main/specification.pdf</a> but wanted to confirm </div>
<div class='msg'><time>2025-02-14 21:58</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@ascriv:matrix.org&gt; I assume we use the parameters in 4.1 configuration in <a href="https://github.com/davxy/bandersnatch-vrfs-spec/blob/main/specification.pdf" target="_blank" rel="noopener">https://github.com/davxy/bandersnatch-vrfs-spec/blob/main/specification.pdf</a> but wanted to confirm 

Correct. If and when anything changes, I&#x27;ll update the spec and notify all JAM channels.

</div>
<div class='msg'><time>2025-02-16 18:27</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I think I have a correction for the state transition dependency graph: lambda prime needs to be added to the inputs for the state transition for the validator statistics, since we need to compute the reporters set which requires G* which requires lambda prime</div>
<div class='msg'><time>2025-02-17 08:36</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hi everyone,

I have a question about accumulation regarding the call to the accumulate function.

We call Ψ_A in equation (12.19) [GP version 0.6.1] at the accumulation stage.
I&#x27;m following the formalism of the white paper.

Should this function call alter δ, or does it return a new account (like the Ω functions) that needs to be accumulated/saved later in equation (12.21)?

Am I clear? 😅</div>
<div class='msg'><time>2025-02-17 08:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The accumulate function is used in the final definition of posterior delta. It is up to implementations to determine at what point they alter any particular internal data structure(s) which may represent delta or some partial/intermediate value of it.  <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-02-17 08:49</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: thanks</div>
<div class='msg'><time>2025-02-17 08:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: One thing which will be very helpful to know is that no two accumulate functions which both contribute to the same “wave” of accumulations will have contradictory changes. </div>
<div class='msg'><time>2025-02-17 21:31</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: </div>
<div class='msg'><time>2025-02-17 22:08</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: ignore previous message.. mistake on our end</div>
<div class='msg'><time>2025-02-17 22:19</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: apologies for the inconvenience Jan Bujak </div>
<div class='msg'><time>2025-02-18 04:38</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: We believe the notation ${\\bf p}\_{\\bf c}$ used in Eq B.1 <a href="https://graypaper.fluffylabs.dev/#/5f542d7/2cf8022cf802" target="_blank" rel="noopener">here</a> needs to be adjusted to accommodate service $h$ and authorization code hash $u$ of 14.2 <a href="https://graypaper.fluffylabs.dev/#/5f542d7/197900197900" target="_blank" rel="noopener">here</a> -- that the preimage $u$ of service $h$ is the authorization code input to $\\Psi\_M$ of B.2.   Can someone confirm this interpretation is correct?

Specifically, the genesis state with bootstrap service 0 will have a null authorizer code hash (say, 0x12344321...) and the very first work package ${\\bf p}$ (to create a new service) will have $h=0$ and $u=0x12344321...$ to reference this null authorizer.

Does that make sense? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-18 04:51</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: Description of accumulate queue-editing function (*E*) seems outdated -  opened a PR to update it.
<a href="https://github.com/gavofyork/graypaper/pull/246" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/246</a></div>
<div class='msg'><time>2025-02-18 05:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No - having trouble interpreting this <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-18 05:07</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Sorry -- how does Eq B.1&#x27;s first input of $\\Psi\_M$ ( which is ${\\bf p}\_{\\bf c}$) get at a work package&#x27;s authorization code? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-18 05:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: See 14.9</div>
<div class='msg'><time>2025-02-18 13:26</time>&ensp;<span class='u' style='color:#de60df'>leonidas_m</span>: Hey, I&#x27;ve noticed that some PVM tests (eg <code>inst_load_u8_nok</code>, <code>inst_store_u8_trap_inaccessible</code>) charge more than 1 extra gas when a page fault occurs even though only a single instruction is executed. In previous commits, similar tests were removed because the cost model was based on polkaVM and wasn&#x27;t specified in the GP. Are these tests facing the same issue now or am I misunderstanding something?</div>
<div class='msg reply'><time>2025-02-18 20:27</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Yes.</div>
<div class='msg reply'><time>2025-02-19 07:58</time>&ensp;<span class='u' style='color:#de60df'>leonidas_m</span>: Looks like the same issue also affects the following test vectors:
<code>inst_store_imm_indirect_u16_with_offset_nok</code> 
<code>inst_store_imm_indirect_u32_with_offset_nok</code>
<code>inst_store_imm_indirect_u64_with_offset_nok</code>
<code>inst_store_imm_indirect_u8_with_offset_nok</code>
<code>inst_store_imm_u8_trap_inaccessible</code>
<code>inst_store_indirect_u16_with_offset_nok</code>
<code>inst_store_indirect_u32_with_offset_nok</code>
<code>inst_store_indirect_u64_with_offset_nok</code>
<code>inst_store_indirect_u8_with_offset_nok</code></div>
<div class='msg'><time>2025-02-19 12:37</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hi guys,

Just some question related to safrole:

Equations (6.15), (6.16), (6.17), (6.18), (6.19), (6.20) - GP version 6.2 - refer to gamma_s&#x27; and eta_3&#x27; =&gt; so we should update gamma_s and eta_3 before ? Therefore, we should compute equations (6.23), (6.24) before checking equations (6.15), (6.16), (6.17), (6.18), (6.19), (6.20) ?</div>
<div class='msg reply'><time>2025-02-19 13:28</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: I had a similar Q and that is was i ended up doing. It seems that the gamma states cannot be updated at once anymore but need to be done in two steps</div>
<div class='msg reply'><time>2025-02-19 13:33</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Can you elaborate please ? 🙃
Should we update gamma then before making the header check of equation (6.15)-(6.20) ?</div>
<div class='msg reply'><time>2025-02-19 14:57</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: We first do gamma_k &amp; gamma_z, then check entropy marker H_e and then gamma_s &amp; gamma_a.  
Not sure if that is optimal, it was just what i coded up first 🤷</div>
<div class='msg'><time>2025-02-19 14:21</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: That’s how I interpret the equations, since they involve posterior variables, the posterior variables must be computed already </div>
<div class='msg'><time>2025-02-20 12:10</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: I want a JAM codec expression after <a href="https://graypaper.fluffylabs.dev/#/5f542d7/381700381700" target="_blank" rel="noopener">here</a> to fully detail <a href="https://graypaper.fluffylabs.dev/#/5f542d7/17fa0117fa01" target="_blank" rel="noopener">wrangled operand tuples</a> to support <a href="https://graypaper.fluffylabs.dev/#/5f542d7/2e89002e8900" target="_blank" rel="noopener">this ${\bf o}$ input into single accumulate</a> -- is this reasonable? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-20 12:37</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Also, due to <a href="https://graypaper.fluffylabs.dev/#/5f542d7/095f00095f00" target="_blank" rel="noopener">GP Eq 4.7</a> it seems technically JAM departs from good old <a href="https://graypaper.fluffylabs.dev/#/5f542d7/087a00087a00" target="_blank" rel="noopener">GP Eq 4.1</a> in needing <a href="https://graypaper.fluffylabs.dev/#/5f542d7/0fe4010fe401" target="_blank" rel="noopener">accumulation result tree root $r$</a> summarizing ${\\bf C}$ from the state before $\\sigma$.  So, to verify a isolated JAM &quot;state\_transition&quot;, it has to not only include two states and block, but ALSO include this $r$  (or the _whole_ <a href="https://graypaper.fluffylabs.dev/#/5f542d7/172a03172a03" target="_blank" rel="noopener">Beefy commitment map ${\\bf C}$</a>) like <a href="https://github.com/jam-duna/jamtestnet/blob/0.6.2.3/data/assurances/state_transitions/1_005.json#L289" target="_blank" rel="noopener">this</a> -- can someone confirm this? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-20 12:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; I want a JAM codec expression after <a href="https://graypaper.fluffylabs.dev/#/5f542d7/381700381700" target="_blank" rel="noopener">here</a> to fully detail <a href="https://graypaper.fluffylabs.dev/#/5f542d7/17fa0117fa01" target="_blank" rel="noopener">wrangled operand tuples</a> to support <a href="https://graypaper.fluffylabs.dev/#/5f542d7/2e89002e8900" target="_blank" rel="noopener">this ${\bf o}$ input into single accumulate</a> -- is this reasonable?

Not sure what you’re talking about. </div>
<div class='msg reply'><time>2025-02-20 14:23</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Will refine our guess --  <a href="https://hackmd.io/@sourabhniyogi/wrangledoperandtuples" target="_blank" rel="noopener">https://hackmd.io/@sourabhniyogi/wrangledoperandtuples</a></div>
<div class='msg'><time>2025-02-20 12:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: O is defined properly. </div>
<div class='msg'><time>2025-02-20 12:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Its result can easily be fed into the serialization function.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-20 12:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As used in C.23</div>
<div class='msg'><time>2025-02-20 14:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2025-02-20 14:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Cool - looks like you’ve already done most of the work for a PR to sort this - want to submit one?</div>
<div class='msg reply'><time>2025-02-20 18:09</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: If someone else agrees with it, we will give it a shot!   <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 00:16</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Hello.

I’m having some difficulty understanding the erasure root formula in the GP, specifically calculating “s♣” in 14.16.

Hoping someone can point me in the right direction. 

I had no problem calculating “b♣” and have my erasure coding function C and paged proof generation function P already.

The s♣ formula has C#6 (s⌢ P(s))), where S is an array and P(S) is an array as well. Does that mean to concatenate them both together and then pass to chunking function?  I think it’s the # that is confusing me as that normally means apply to each of the sub items. There is also a # on the binary merkle call so I’m assuming that I need to call the merkle function multiple times and not just once with the results of the erasure encoding but not understanding the formula at all. Can someone give me a tip of how to proceed with it?

<a href="https://graypaper.fluffylabs.dev/#/5f542d7/1b4c011b5701" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/1b4c011b5701</a>
</div>
<div class='msg'><time>2025-02-22 01:57</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Is there a very rough estimate for v1.0.0? Trying to think if I can make milestone 1 by that time :v</div>
<div class='msg'><time>2025-02-22 02:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Latest estimate is by end of Q3. But will depend a lot on the outcome of Toaster and initial service development. </div>
<div class='msg'><time>2025-02-22 03:47</time>&ensp;<span class='u' style='color:#a977d7'>ymcsabo</span>: Hi, in the gray paper section 15.2, it mentions advanced nodes and naive nodes. What are some of the examples of those two types of nodes?</div>
<div class='msg'><time>2025-02-22 07:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There is no clear delineation. It’s about *strategy*. Some implementations (or node configurations) may use a more sophisticated strategy for predicting the best work package to execute and guarantee. This will allow their operators to take greater rewards under some circumstances. But again, this is strategy and therefore largely out of scope for the GP.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 07:25</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: I need some clarification regarding the advancement  of the instruction counter i in the PVM

Reading <a href="https://graypaper.fluffylabs.dev/#/5f542d7/23ec0023ec00" target="_blank" rel="noopener">A.1</a> and <a href="https://graypaper.fluffylabs.dev/#/5f542d7/246600246600" target="_blank" rel="noopener">A.7</a>

I understand the counter i` will always advance to the next instruction unless the exit reason is panic or halts

so if we have program like
ecalli ..
op1 ...
op2 ...

host call fail =&gt; continue from op1
host call succeed =&gt; continue from op2 (due to the extra skip in [A.33] (<a href="https://graypaper.fluffylabs.dev/#/5f542d7/2b70012b7001)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/2b70012b7001)</a>


However, reading the <a href="https://graypaper.fluffylabs.dev/#/5f542d7/2b16022b1602" target="_blank" rel="noopener">text</a> below A.34 i understand that

i&#x27; is:
exit reason == continue &gt; i + 1 +skip
out of gas =&gt; i
panic or halt =&gt; 0
page fault =&gt; i
host call =&gt; i


but this makes [A.33] (<a href="https://graypaper.fluffylabs.dev/#/5f542d7/2b70012b7001)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/2b70012b7001)</a> not make sense
as now we will have

host call fail =&gt; counter stays =&gt; reinvoke into the failing host call
 
</div>
<div class='msg'><time>2025-02-22 07:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You seem to be confusing two different conditions. </div>
<div class='msg'><time>2025-02-22 07:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If the hostcall succeeds (where you pointed) then i’’ is used as the new instruction counter for the invocation of Phi_H which effectively skips past the ecalli instruction. If the hostcall results in anything other than a continue (the last condition) then Phi_H is not invoked again anyway.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 07:43</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: right. my code does just that. no issue

so lets talk about the case where the host call succeeds

we start with phi\_1 which returned ecalli, and i&#x27; = i +1 +skip (i.e point to instruction after the the ecalli)

and so we don&#x27;t need to advance again after the host call has succeeded. since we already point to the next instruction

or, the Phi\_1 should not advance the counter on a ecalli exit reason, and after host call finishes with success then the counter advances

basically, why the text below A.34 says the i\` point the the host call, when seems to me from A.7 that it has already progressed beyond <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 08:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I see your point, yes. i’’ needs not be defined; i’ should be used instead. Feel free to make a PR if i don’t get to it first. </div>
<div class='msg'><time>2025-02-22 08:07</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: yep. that&#x27;s what i thought , i&#x27;&#x27; is not needed
Thank you for confirming</div>
<div class='msg'><time>2025-02-22 11:48</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: regarding <code>i</code> in <a href="https://graypaper.fluffylabs.dev/#/5f542d7/2e11012e1101" target="_blank" rel="noopener">B.9</a>

<pre><code class=''>i = check((E4−1 (H(E(s, η0′ , Ht ))) mod (2^32 − 2^9 )) + 2^8 )
</code></pre>

does the decode\_4 bytes imply that only the first(last?) bytes of the hash are to be taken? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 13:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes</div>
<div class='msg'><time>2025-02-22 15:19</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Question on what the first value of a_t is in <code>new</code> <a href="https://graypaper.fluffylabs.dev/#/293bf5a/2e81022e8102" target="_blank" rel="noopener">here</a> which is defined in <a href="https://graypaper.fluffylabs.dev/#/5f542d7/115f01115f01" target="_blank" rel="noopener">9.8</a>:

Assume the preimage of the code is 1149 bytes, and recall GP constants: B_S = 100, B_I = 10, B_L = 1

What is the value of a_i and a_o and thus a_t:

* (1): a_i = 0, a_o = 0 ==&gt; a_t = 100
<em> (2): a_i = 2, a_o = 81 + 1149 = 1230 ==&gt; a_t = 100 + 10 </em> 2 + 1 * 1230 = 1350

The order of operations in <code>new</code> is not clear, especially with the a_t and l &quot;happening in the same line&quot; here: <a href="https://graypaper.fluffylabs.dev/#/5f542d7/31b90231b902" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/31b90231b902</a></div>
<div class='msg'><time>2025-02-22 15:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: a_t is a dependent variable whose value is implied through the (non-negotiable) definition of bold-l, which is fully defined as c and l are both fixed values.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 15:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: balance is required to be equal to this (dependent) variable. There exists only one solution to this statement.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 15:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No specific order is *needed*. Ever.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 15:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ordering is a point of implementation strategy, for implementation languages which require the practitioner to specify it (ie imperative ones).  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-22 15:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Plenty of languages, like formal logic, don’t generally insist on specifying a solution in terms of ordered mutations. </div>
<div class='msg'><time>2025-02-22 15:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If this is a new concept, I’d suggest reading some undergrad computer science texts such as “structure and interpretation of computer programmes”.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-23 03:51</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: good morning everyone
very small specific question about encoding

looking at the encoding in the calculation of <code>i</code> in <a href="https://graypaper.fluffylabs.dev/#/5f542d7/2ef9002ef900" target="_blank" rel="noopener">B.9</a>

<code>E(s, η0′ , Ht )</code>

for me the symbol e means general encoding <a href="https://graypaper.fluffylabs.dev/#/5f542d7/365702365702" target="_blank" rel="noopener">C.6</a>

But the text under C.6 says
_&quot;Note that at present this is utilized only in encoding the length prefix of variable-length sequences.&quot;_

which would imply:

- service index is encoded as 4 bytes
(refs <a href="https://graypaper.fluffylabs.dev/#/5f542d7/10e40010e400" target="_blank" rel="noopener">9.1</a>, <a href="https://graypaper.fluffylabs.dev/#/5f542d7/377202377202" target="_blank" rel="noopener">C.23</a>)
- timeslot is encoded as 4 bytes as well (refs <a href="https://graypaper.fluffylabs.dev/#/5f542d7/3e36003e3600" target="_blank" rel="noopener">I.1.1</a>, <a href="https://graypaper.fluffylabs.dev/#/5f542d7/37e50037e500" target="_blank" rel="noopener">C.16, C.20, C.22</a>) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-23 11:26</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: In eq <a href="https://graypaper.fluffylabs.dev/#/5f542d7/16c90116d001" target="_blank" rel="noopener">12.10</a>, Does <code>m</code> should be <code>m&amp;#x27;</code> since <code>Ht = tau&amp;#x27;</code>?</div>
<div class='msg'><time>2025-02-23 12:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I generally prefer not using a prime unless the plain (non-prime) term is also used. </div>
<div class='msg'><time>2025-02-23 18:32</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I assume that when inspecting memory during the sbrk instruction, this should not case a memory-access exception, right? Also, is it right to interpret the math as saying “find the earliest inaccessible contiguous memory segment starting at or above h of length wa, and set it as mutable”?</div>
<div class='msg'><time>2025-02-23 19:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: For sbrk, I’ll leave it in the hands of <a href="https://matrix.to/#/@jan:parity.io" target="_blank" rel="noopener">@jan:parity.io</a> - I’d personally quite like to get rid of it:))</div>
<div class='msg'><time>2025-02-23 20:49</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: neg_add_imm_64 has a +2^64 but then mods by 2^64 so this addition is the same as +0, so it’s redundant. Unless there’s a typo </div>
<div class='msg'><time>2025-02-23 21:06</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: rot_r_64_imm performs a left shift as written (ith bit of w’a = i+vx bit of wb), but the name suggests a right shift. Is this correct?</div>
<div class='msg'><time>2025-02-23 21:07</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Similar for the next 3 instructions </div>
<div class='msg'><time>2025-02-23 23:09</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: ^similar for instructions 220-223</div>
<div class='msg'><time>2025-02-23 23:10</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Also, shouldn’t we be doing Z inverse on the result of the max (227) and min (229) instructions? To convert back to unsigned before storing in the register </div>
<div class='msg'><time>2025-02-24 02:58</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Morning all. Are the &quot;EC shards&quot; referenced in CE137 the same as the &quot;bundle shards&quot; referenced in CE138? What is the difference between these two APIs? Are they essentially the same except CE137 also returns segment shards?</div>
<div class='msg'><time>2025-02-24 11:57</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Hi Dr.Wood
<a href="https://github.com/gavofyork/graypaper/pull/248" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/248</a>
Can we use beta_dagga as the only reference(instead of beta+beta_dagga) for all processes in Section 11?
</div>
<div class='msg'><time>2025-02-24 12:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@shwchg:matrix.org&gt; Hi Dr.Wood
&gt; <a href="https://github.com/gavofyork/graypaper/pull/248" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/248</a>
&gt; Can we use beta_dagga as the only reference(instead of beta+beta_dagga) for all processes in Section 11?
&gt; 

The two should give equal effects in Section 11 as the only difference is the placement of the beefy root. </div>
<div class='msg'><time>2025-02-24 12:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; neg_add_imm_64 has a +2^64 but then mods by 2^64 so this addition is the same as +0, so it’s redundant. Unless there’s a typo 

I don’t define negative modulo; this ensures the modulo is positive. </div>
<div class='msg'><time>2025-02-24 12:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is correct. Check the definition of caligraphic B.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-24 12:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; Also, shouldn’t we be doing Z inverse on the result of the max (227) and min (229) instructions? To convert back to unsigned before storing in the register 

Yes. If you’re in the mood feel free to submit a PR. </div>
<div class='msg'><time>2025-02-24 13:23</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: &gt; &lt;@ascriv:matrix.org&gt; Also, shouldn’t we be doing Z inverse on the result of the max (227) and min (229) instructions? To convert back to unsigned before storing in the register 

Actually this change is merged into main - probably will be included in the next release? <a href="https://github.com/gavofyork/graypaper/pull/228" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/228</a></div>
<div class='msg'><time>2025-02-25 15:20</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Hi team 👋 Quick question about the Merkle function in D.6-&gt; the branch splitting conditional implies that the key should be left shifted one bit before each recursion. Am I interpreting this correctly? The tests &amp; gh consensus suggests that the keys shouldn&#x27;t be rotated at each recursion, but rather that the $d&#x27;th bit should be used in the splitting conditional at recursion depth $d. I&#x27;m happy to open a PR to the GP repo if appropriate.

<a href="https://graypaper.fluffylabs.dev/#/5f542d7/391b01391c01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/391b01391c01</a></div>
<div class='msg'><time>2025-02-25 15:58</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: <a href="https://graypaper.fluffylabs.dev/#/5f542d7/10b00010b000" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/10b00010b000</a>
If the authorization pool is all the same hash, and there is a guarantee that using that hash as authorization, will it consume the entire pool? and will the queue then refill with eight more?</div>
<div class='msg reply'><time>2025-02-25 16:01</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Only one of the hashes should be consumed, see <a href="https://graypaper.fluffylabs.dev/#/5f542d7/07f70007fa00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/07f70007fa00</a></div>
<div class='msg reply'><time>2025-02-25 16:10</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: ok I see!
thanks for reply</div>
<div class='msg'><time>2025-02-25 16:23</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: In order to compare large amounts of PVM traces between teams precisely, I would like a formula to hash the registers with the PVM paged memory for teams to know they ended up with same answer at the end, and if they did not, be able to quickly determine which line in some PVM trace of PC they differed in results.  

Its not hard to come up with a procedure, but does a ready made answer  exist within the PolkaVM repo or is there some public algorithm to do this kind of operation so we don&#x27;t reinvent the wheel needlessly?    <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-25 16:53</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Hey! Hoping to get a clarification on the justifications for CE-138 (audit shard request). It mentions &quot;The assurer should construct this by appending the corresponding segment shard root to the justification received via CE 137.&quot;. 

What is the segment shard root corresponding too exactly when it&#x27;s a request about a work package shard? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-25 21:26</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: The Parity Service trait definition for accumulate here returns an Option&lt;Hash&gt;
fn accumulate(_slot: Slot, _id: ServiceId, items: Vec&lt;AccumulateItem&gt;) -&gt; Option&lt;Hash&gt;
but it appears there are TWO ways to provide a Some for accumulate:
(1) if $\omega_8=32$, then the B.12 ${\bf o} \in \mathbb{H}$ condition applies
(2) the yield host function
As B.12 is written, (1) takes precedence over (2), but the new (2) yield is a cleaner solution otherwise why was it added? Now that its been added, I believe we don&#x27;t need (1). Having both is not needed since whatever 32-byte optional yield could go through output (1) OR (2), so perhaps we can eliminate (1).
Nitpick check: is $omega8 = 32$ a sufficient criteria for (1) to take precedence over (2) ? What if $omega8 &gt; 32$? What if $omega8 &lt; 32$?

Related nitpick check: is there a way to change the C notation in eq 4.7 vs 4.17 to eliminate the appearance of dependency loops.  We are pretty sure  the C in 4.7 is from the previous states  4.17 but seek confirmation?  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-26 01:53</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Should (A.43) have x’ instead of x? For clarity that it’s the x after the host call</div>
<div class='msg'><time>2025-02-26 01:55</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: And should the type of the gas in the return for (A.42) be signed (Zg) to handle e.g. when the host call returns out of gas?</div>
<div class='msg'><time>2025-02-26 13:44</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Hey! Question about the state transition dependency graph 4.2.1. Should the calculation of β′ be moved further down since it depends on the commitment map C which doesn&#x27;t exist yet, or does it use the commitment map from the previous block?</div>
<div class='msg'><time>2025-02-26 13:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; In order to compare large amounts of PVM traces between teams precisely, I would like a formula to hash the registers with the PVM paged memory for teams to know they ended up with same answer at the end, and if they did not, be able to quickly determine which line in some PVM trace of PC they differed in results.  
&gt; 
&gt; Its not hard to come up with a procedure, but does a ready made answer  exist within the PolkaVM repo or is there some public algorithm to do this kind of operation so we don&#x27;t reinvent the wheel needlessly?   

No, there’s no canonical PVM state serialization. Registers are trivial, but for memory we would need to have some definition on how to encode the pages and their accessibility. </div>
<div class='msg reply'><time>2025-02-26 19:16</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: <a href="https://hackmd.io/@sourabhniyogi/pvmhash" target="_blank" rel="noopener">https://hackmd.io/@sourabhniyogi/pvmhash</a> 
is a first try, hopefully a couple of us will try to converge on something as we get our host function implementations and PVM interpreter implementations correct.

I am wondering why R/W/0 page accessibility came to your mind right away (as opposed to X/Y contexts which has most of the immediate debugging problems) -- I must  be missing something since any discrepancy in internal representations of page accessibility would be visible by some load/store instructions effect (or lack thereof) on a particular page -- encoding this page accessibility would be for 2 teams to reason about the contents of the memory after they saw the memory affected/not affected based on R/W/0 page accessibility bits -- if you anticipate this to be quite important early, I would like to put it in early in a &quot;v1&quot; (like in a page) -- is it?

Related question maybe?:  Was the W\_G=4104 segment size chosen for segments to match a 4096-page size and a specific 8-byte encoding of the page, a page number and some specific metadata, specifically the accessibility bits.  If so, we might as well get the &quot;dump a page&quot; to map into the 4104 encoding imagined for CoreVM service with the desired 8-byte encoding for pages maybe?   <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-02-27 04:59</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The context is not PVM state - the whole point is that it&#x27;s external. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-02-27 05:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Of course you&#x27;ll likely still want to test it, but I don&#x27;t think there&#x27;s any reason to check it before the context is collapsed into the final result from Phi\_A <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-02-27 10:59</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Then the v2 &quot;hash&quot; intends to capture the PVM state AND both contexts so as to support debugging of incorrect host function implementations.  What should this be called?

Since a Phi\_A result may have many host function calls to get at its result (with many intermediate X + Y contexts), we do have a reason to check this v2 &quot;hash&quot;, to see if an intermediate value of the v2 &quot;hash&quot; from one implementation matches another after some of those host function calls \[which affect the X (or Y) context\] complete, one (or maybe both) of which is incorrect.  Does that make sense? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-26 14:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; The Parity Service trait definition for accumulate here returns an Option&lt;Hash&gt;
&gt; fn accumulate(_slot: Slot, _id: ServiceId, items: Vec&lt;AccumulateItem&gt;) -&gt; Option&lt;Hash&gt;
&gt; but it appears there are TWO ways to provide a Some for accumulate:
&gt; (1) if $\omega_8=32$, then the B.12 ${\bf o} \in \mathbb{H}$ condition applies
&gt; (2) the yield host function
&gt; As B.12 is written, (1) takes precedence over (2), but the new (2) yield is a cleaner solution otherwise why was it added? Now that its been added, I believe we don&#x27;t need (1). Having both is not needed since whatever 32-byte optional yield could go through output (1) OR (2), so perhaps we can eliminate (1).
&gt; Nitpick check: is $omega8 = 32$ a sufficient criteria for (1) to take precedence over (2) ? What if $omega8 &gt; 32$? What if $omega8 &lt; 32$?
&gt; 
&gt; Related nitpick check: is there a way to change the C notation in eq 4.7 vs 4.17 to eliminate the appearance of dependency loops.  We are pretty sure  the C in 4.7 is from the previous states  4.17 but seek confirmation? 

We can consider removing (1) at a later stage. Host calls are not especially cheap and returning data is a more natural pattern than relying on the side-effect of a host call. </div>
<div class='msg'><time>2025-02-27 04:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; Should (A.43) have x’ instead of x? For clarity that it’s the x after the host call

Sure <a href="https://github.com/gavofyork/graypaper/pull/254" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/254</a></div>
<div class='msg'><time>2025-02-27 04:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; And should the type of the gas in the return for (A.42) be signed (Zg) to handle e.g. when the host call returns out of gas?

Yes indeed: <a href="https://github.com/gavofyork/graypaper/pull/255" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/255</a></div>
<div class='msg'><time>2025-02-27 05:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@jaymansfield:matrix.org&gt; Hey! Question about the state transition dependency graph 4.2.1. Should the calculation of β′ be moved further down since it depends on the commitment map C which doesn&#x27;t exist yet, or does it use the commitment map from the previous block?

I&#x27;m kept the (different variations of) the state components together rather than try to keep any &quot;execution order&quot;. Indeed rather the point of this dependency graph is to demonstrate that there exists no specific order since it&#x27;s a partially parallel rather than a fully serial system.</div>
<div class='msg reply'><time>2025-02-27 08:20</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Here is the context of this &quot;C&quot; and &quot;Beta&quot; dependency question: 
<a href="https://github.com/jam-duna/jamtestnet/issues/101" target="_blank" rel="noopener">https://github.com/jam-duna/jamtestnet/issues/101</a>

</div>
<div class='msg reply'><time>2025-02-27 08:28</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: &gt; &lt;@gav:polkadot.io&gt; I&#x27;m kept the (different variations of) the state components together rather than try to keep any &quot;execution order&quot;. Indeed rather the point of this dependency graph is to demonstrate that there exists no specific order since it&#x27;s a partially parallel rather than a fully serial system.

sourabhniyogi: I think this answered your doubt. C used by beta&#x27; is the result from accumulation process </div>
<div class='msg reply'><time>2025-02-27 08:53</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: We&#x27;ll consider this case closed =) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-27 05:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; Nitpick check: is $omega8 = 32$ a sufficient criteria for (1) to take precedence over (2) ? What if $omega8 &gt; 32$? What if $omega8 \&lt; 32$?

Not sure what you mean by $omega8, but assuming you mean selecting between that latter 2 variants of B.12, then it&#x27;s pretty clear: you use the returned value IFF it is a 32-byte sequence (blackboard H). If it&#x27;s anything other than this (e.g. 31 byte sequence or 33 byte sequence), then you fallback to the _otherwise_ condition of using the (success) context&#x27;s yield. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-27 23:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Sure. Then indeed you’ll want to serialise the context also. </div>
<div class='msg'><time>2025-02-28 02:43</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I’m guessing in (B.1) p_c should be p_p?</div>
<div class='msg reply'><time>2025-02-28 03:03</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: see 14.9, there is a authorization code</div>
<div class='msg'><time>2025-02-28 03:17</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Thanks. Should the returned gas value in (A.34) be signed? </div>
<div class='msg'><time>2025-02-28 03:36</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Jan Bujak: are you able to confirm if the rv test vectors are compliant with A.17? Based on my testing, I suspect they may be branching to the middle of basic blocks on passing tests. One example I found is the branch\_eq instruction at pc 466 in rv64ui\_add <a href="https://graypaper.fluffylabs.dev/#/5f542d7/24e40224e502" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/24e40224e502</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-28 04:09</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: I&#x27;m confused. There&#x27;s nothing wrong with the branch_eq instruction at pc 466 in rv64ui_add test and it certainly doesn&#x27;t branch into the middle of a basic block?

<pre><code class=''>   448: 01                       fallthrough
      :                          @20
   449: 33 00 0d                 r0 = 0xd
   452: 33 01 0b                 r1 = 0xb
   455: c8 10 0b                 r11 = r0 + r1
   458: 64 b3                    r3 = r11
   460: 95 aa 01                 r10 = r10 + 0x1
   463: 33 02 02                 r2 = 0x2
   466: ab 2a ef                 jump 449 if r10 != r2
</code></pre></div>
<div class='msg'><time>2025-02-28 04:21</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: You&#x27;re right, this is my mistake... embarrassingly small bug on my end, should have reviewed the target more thoroughly before posting as well (different debugging scope &amp; missed fallthrough is bb terminator) 🤦‍♂️ Thanks for your response. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-02-28 10:30</time>&ensp;<span class='u' style='color:#4772c5'>faiz_871</span>: I am struggling to understand the meaning of t_t, t_l and t_i in info host call function that is defined here: <a href="https://graypaper.fluffylabs.dev/#/5f542d7/306802308802" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/306802308802</a></div>
<div class='msg'><time>2025-02-28 10:44</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: Faiz Ahmad: This should help: <a href="https://graypaper.fluffylabs.dev/#/5f542d7/115c01115c01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/115c01115c01</a> (<code>t_t &amp;amp; t_i</code>), <a href="https://graypaper.fluffylabs.dev/#/5f542d7/115400115700" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/115400115700</a> (<code>t_l</code>)</div>
<div class='msg'><time>2025-02-28 19:03</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Are alterations to the PC as a result of a host call required to be the start of a basic block? Not sure if I&#x27;m interpreting &quot;call&quot; appropriately in this sentence in the GP.
<a href="https://graypaper.fluffylabs.dev/#/5f542d7/24e40224e402" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/24e40224e402</a> 

If so, does reinvoking with the same pc of the host call (in the case of a host call page fault) imply a strict requirement that the instruction prior to the host call is a block terminator?
<a href="https://graypaper.fluffylabs.dev/#/5f542d7/2b23022b2302" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/2b23022b2302</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-01 13:47</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Can a parent VM determine which PVM memory pages have been modified by an &quot;invoked&quot; child VM?

CoreVM-type services aim to extend JAM computation across multiple work packages by exporting PVM memory pages as segments at the end of a task and retrieving them at the start of the next.

While the <a href="https://github.com/gavofyork/graypaper/issues/145" target="_blank" rel="noopener">memcpy/memset host call</a> can support data transfer between parent and child VMs (an imported segment copied into some child VM page index), the parent needs a way to identify all mutated memory pages—not just those explicitly copied via memcpy—to ensure they are correctly included in the exported segments.

One approach could be extending <a href="https://graypaper.fluffylabs.dev/#/5f542d7/2d22002d2200" target="_blank" rel="noopener">M</a> to track modified page indexes and providing an explicit mechanism for the parent VM to access this set, supporting efficient page/segment export.

Is this a good idea or is there a better approach?</div>
<div class='msg'><time>2025-03-02 04:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; Thanks. Should the returned gas value in (A.34) be signed?

Yes. Already merged.</div>
<div class='msg'><time>2025-03-02 04:49</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: A lot of the host functions (eg solicit, forget, yield, etc) use Z_o…+32 (for example). I think these can never be negative since they’re register values? So N is a bit more clear</div>
<div class='msg'><time>2025-03-02 05:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; A lot of the host functions (eg solicit, forget, yield, etc) use Z_o…+32 (for example). I think these can never be negative since they’re register values? So N is a bit more clear

Yes, feel free to make a PR.</div>
<div class='msg'><time>2025-03-02 14:06</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: <a href="https://github.com/gavofyork/graypaper/pull/262" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/262</a></div>
<div class='msg'><time>2025-03-02 14:23</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Is there always an implicit mod 2^32 when inspecting or mutating the ram given a register (64 bit unsigned)? we do this a lot and wondering how it should be handled </div>
<div class='msg'><time>2025-03-02 16:57</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I have a doubt about the work package execution formula: <a href="https://graypaper.fluffylabs.dev/#/5f542d7/1a48021a5d02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/1a48021a5d02</a>

it says that <code>I(p,j) = (r, e)</code> when <code>|e| = we</code>, but what if r is an error and the |e| = we? Shouldn&#x27;t be

- <code>(r, [G0, G0, ...) if r not binary</code> first 
- <code>(r, e) if |e| = we</code> second 

?</div>
<div class='msg'><time>2025-03-02 22:01</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: According to the gp, we only handle memory access/modification exceptions in the single step function, but presumably we’d want to catch such exceptions in , e.g host calls as well, no?</div>
<div class='msg'><time>2025-03-02 22:17</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: believe mem fault in nested pvm is returned to parent pvm instance for the pvm program to handle, someone correct me if I&#x27;m wrong here</div>
<div class='msg'><time>2025-03-02 22:21</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: <a href="https://graypaper.fluffylabs.dev/#/5f542d7/364401364d01" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/364401364d01</a></div>
<div class='msg'><time>2025-03-02 22:24</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Yes, but if for example the 8th register is not a valid memory location, then when deserializing to construct g, we should fault, right? Before the pvm function is called </div>
<div class='msg'><time>2025-03-02 22:25</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Similar for other host functions </div>
<div class='msg'><time>2025-03-02 22:29</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Good question. I would assume write to that location from an &#x27;outer-shell&#x27; implementation perspective, and if the pvm program attempts to access it, then it would trigger a page fault. Interested to hear other folks thoughts on this though. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-03 02:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; Is there always an implicit mod 2^32 when inspecting or mutating the ram given a register (64 bit unsigned)? we do this a lot and wondering how it should be handled 

No. Everything is explicit.</div>
<div class='msg'><time>2025-03-03 02:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: They are handled explicitly. If you believe there is an instance where unarmed memory may be addressed, please report.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-03 02:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; I have a doubt about the work package execution formula: <a href="https://graypaper.fluffylabs.dev/#/5f542d7/1a48021a5d02" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/1a48021a5d02</a>
&gt; 
&gt; it says that <code>I(p,j) = (r, e)</code> when <code>|e| = we</code>, but what if r is an error and the |e| = we? Shouldn&#x27;t be
&gt; 
&gt; - <code>(r, [G0, G0, ...) if r not binary</code> first 
&gt; - <code>(r, e) if |e| = we</code> second 
&gt; 
&gt; ?

No. GP is correct. </div>
<div class='msg'><time>2025-03-03 02:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; Yes, but if for example the 8th register is not a valid memory location, then when deserializing to construct g, we should fault, right? Before the pvm function is called 

See the second line there. The range beginning with o is ensured to be in the set of valid memory addresses. </div>
<div class='msg'><time>2025-03-03 04:53</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: In export, since we’re reading indices p…+z wrapped, should we also be checking if Np…+z (mod ram size) is in Vu ?</div>
<div class='msg'><time>2025-03-03 04:54</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Similar for poke </div>
<div class='msg'><time>2025-03-03 08:11</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: I have several questions/comments regarding the historical lookup and related constants:

1. The constant <code>D</code> has been updated from 28,800 slots (48 hrs) to 4,800 slots (8 hrs). I opened a PR to update it in appendix I too: <a href="https://github.com/gavofyork/graypaper/pull/260" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/260</a>

2. Probably the constant value <code>L</code> should be reduced too? <code>D</code> seems to be introduced to prevent a preimage data from being removed while it still could be referenced during auditing. So <code>D</code> should be larger than <code>L</code>. However, current value of <code>L</code> is 14,400 (24 hrs): (<a href="https://graypaper.fluffylabs.dev/#/5f542d7/417000417000" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/417000417000</a> and <a href="https://graypaper.fluffylabs.dev/#/5f542d7/0c9f000c9f00)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/0c9f000c9f00)</a> which hasn&#x27;t been updated since the initial commit, while <code>D</code> was updated as mentioned above.

3. <a href="https://graypaper.fluffylabs.dev/#/5f542d7/113b00113b00" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/113b00113b00</a> Regarding the brief definition of the historical lookup function, should the constant <code>C_D</code> be <code>D</code> instead? I wonder if this is a typo or I&#x27;m missing something. Also, while the function is designed to be called off-chain, should we interpret the <code>H_t</code> here as &quot;The timeslot index of the last finalized block header that an auditor sees at the point of auditing&quot;?</div>
<div class='msg'><time>2025-03-03 09:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1./2. Yes there&#x27;s an issue for this now; the provided PR may not be quite right. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-03 09:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 3. Yes indeed <code>C_D</code> should be <code>D</code>; will be fixed in 0.6.4. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-03 09:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: One may consider 9.5 as the &quot;on-chain&quot; function-contract.</div>
<div class='msg'><time>2025-03-03 09:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Big-Lambda is defined fully at 9.7 and this proper definition does not use <code>H_t</code>.</div>
<div class='msg'><time>2025-03-03 09:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 9.5 is only provided to help the reader understand what problem the function is attempting to solve. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-03 09:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room Gray Paper version 0.6.3 is released: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.3" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.6.3</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-03 09:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In addition to many corrections and clarifications, there are several small but important functional alterations; pay attention to the first 6 items in the changelog. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-03 11:17</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: Does anyone know why the PDF file for release v0.6.3 is 111 MB, while the previous version v0.6.2 was only 4.22 MB? 🧐</div>
<div class='msg'><time>2025-03-03 11:43</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: The alternative renders are small though <a href="https://github.com/JamBrains/graypaper/actions/runs/13629940636" target="_blank" rel="noopener">https://github.com/JamBrains/graypaper/actions/runs/13629940636</a> (and if you are not logged into GH, <a href="https://jamcha.in/spec" target="_blank" rel="noopener">here</a>) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-03 13:08</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: Is the missing update of $l$ to $y$ in the serialization of $\mathbb{L}$?<a href="https://github.com/gavofyork/graypaper/blob/85129dacf739e76ead2065bb5b84a999e8ac71e7/text/serialization.tex#L143" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/blob/85129dacf739e76ead2065bb5b84a999e8ac71e7/text/serialization.tex#L143</a></div>
<div class='msg'><time>2025-03-03 14:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@yu2c:matrix.org&gt; Does anyone know why the PDF file for release v0.6.3 is 111 MB, while the previous version v0.6.2 was only 4.22 MB? 🧐

Good point!:) I’ll look into getting a smaller rendering. </div>
<div class='msg'><time>2025-03-03 14:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@yu2c:matrix.org&gt; Is the missing update of $l$ to $y$ in the serialization of $\mathbb{L}$?<a href="https://github.com/gavofyork/graypaper/blob/85129dacf739e76ead2065bb5b84a999e8ac71e7/text/serialization.tex#L143" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/blob/85129dacf739e76ead2065bb5b84a999e8ac71e7/text/serialization.tex#L143</a>

PR accepted!:)</div>
<div class='msg'><time>2025-03-03 16:58</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: And small suggestion: Add $\mathbb{N}_{R}$ defined in <a href="https://graypaper.fluffylabs.dev/#/85129da/0a13010a2001?v=0.6.3" target="_blank" rel="noopener">(4.23)</a> in the Appendix I / Sets / Regular Notions</div>
<div class='msg'><time>2025-03-03 17:35</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I believe we are not checking the right indices for memory validity in host functions that have wrapping in their memory inspecting/mutation:
<a href="http://github.com/gavofyork/graypaper/pull/272" target="_blank" rel="noopener">http://github.com/gavofyork/graypaper/pull/272</a></div>
<div class='msg'><time>2025-03-03 18:50</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I saw that formula 14.11 (<a href="https://graypaper.fluffylabs.dev/#/85129da/1a9b021aad02?v=0.6.3)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/1a9b021aad02?v=0.6.3)</a> on 0.6.3 now passes work item components to ΨR, but ΨR function signature didn&#x27;t change (B.4). It still receives package (p) and item position (i). Where do args S(w,l), X(w) go now? (replaced old î) </div>
<div class='msg'><time>2025-03-03 19:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@yu2c:matrix.org&gt; And small suggestion: Add $\mathbb{N}_{R}$ defined in <a href="https://graypaper.fluffylabs.dev/#/85129da/0a13010a2001?v=0.6.3" target="_blank" rel="noopener">(4.23)</a> in the Appendix I / Sets / Regular Notions

PR?:)</div>
<div class='msg'><time>2025-03-03 19:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; I believe we are not checking the right indices for memory validity in host functions that have wrapping in their memory inspecting/mutation:
&gt; <a href="http://github.com/gavofyork/graypaper/pull/272" target="_blank" rel="noopener">http://github.com/gavofyork/graypaper/pull/272</a>

Is there any particular reason you think we should be more lenient?</div>
<div class='msg'><time>2025-03-03 19:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; I saw that formula 14.11 (<a href="https://graypaper.fluffylabs.dev/#/85129da/1a9b021aad02?v=0.6.3)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/1a9b021aad02?v=0.6.3)</a> on 0.6.3 now passes work item components to ΨR, but ΨR function signature didn&#x27;t change (B.4). It still receives package (p) and item position (i). Where do args S(w,l), X(w) go now? (replaced old î) 

Please explain?</div>
<div class='msg'><time>2025-03-03 20:50</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: ΨR call here passes 11 parameters: (wc,wg ,ws,h,wy ,px, pa,o,S(w,l),X(w),ℓ) (<a href="https://graypaper.fluffylabs.dev/#/85129da/1a9b021aad02?v=0.6.3)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/1a9b021aad02?v=0.6.3)</a>

But ΨR defined still has only 5 (i,p,o,i,ς): <a href="https://graypaper.fluffylabs.dev/#/85129da/2d65002d9300?v=0.6.3" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/2d65002d9300?v=0.6.3</a> </div>
<div class='msg'><time>2025-03-03 21:12</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@gav:polkadot.io&gt; Is there any particular reason you think we should be more lenient?

In poke for example, we read from the ram with wrapping , which means we want to allow for the case where z &gt; ram size, in which case we wrap back to 0. But in that case, Ns…z will not be in Vu, so we will panic</div>
<div class='msg'><time>2025-03-03 21:12</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: If we don’t want to handle the case where z &gt; ram size, then we are wrapping unnecessarily</div>
<div class='msg'><time>2025-03-03 21:15</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: *s+z</div>
<div class='msg'><time>2025-03-04 02:13</time>&ensp;<span class='u' style='color:#823cac'>wabkebab</span>: Jam implementors, technologists and Web3 enthusiasts, here you can find one of the videos of the JAM Tour, filmed during the lecture at Taipei University. More content coming! <a href="https://www.youtube.com/watch?v=aTS4yjFsJd0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=aTS4yjFsJd0</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-04 03:44</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: In 0.5.4 there was extrinsic data blobs in $a$ of Refine invocation:
<a href="https://graypaper.fluffylabs.dev/#/579bd12/2d13012d1301?v=0.5.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/579bd12/2d13012d1301?v=0.5.4</a>
but in 0.6.x these extrinsic data blobs seem to have disappeared:
<a href="https://graypaper.fluffylabs.dev/#/78ca0a8/2df3002df300?v=0.6.0" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/78ca0a8/2df3002df300?v=0.6.0</a>
There are no release notes for this change
<a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.0" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/releases/tag/v0.6.0</a>
While <code>fetch</code> enables access to the extrinsic blob hashes and their lengths of a work item, the extrinsic blobs are not in the work item:
<a href="https://graypaper.fluffylabs.dev/#/85129da/199f00199f00?v=0.6.3" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/199f00199f00?v=0.6.3</a>
So how does Refine fetch the extrinsic data blobs as of 0.6.x?</div>
<div class='msg'><time>2025-03-04 05:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@danicuki:matrix.org&gt; ΨR call here passes 11 parameters: (wc,wg ,ws,h,wy ,px, pa,o,S(w,l),X(w),ℓ) (<a href="https://graypaper.fluffylabs.dev/#/85129da/1a9b021aad02?v=0.6.3)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/1a9b021aad02?v=0.6.3)</a>
&gt; 
&gt; But ΨR defined still has only 5 (i,p,o,i,ς): <a href="https://graypaper.fluffylabs.dev/#/85129da/2d65002d9300?v=0.6.3" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/2d65002d9300?v=0.6.3</a>

Yes indeed: <a href="https://github.com/gavofyork/graypaper/pull/273" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/273</a></div>
<div class='msg'><time>2025-03-04 05:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As I&#x27;ve said countless times now, the GP does not dictate the specifics of data logistics, only observable behaviour. <code>fetch</code> requires implementations to return the correct extrinsic data by virtue of the constraints placed on the return value from <code>fetch</code>. How it gets the extrinsic data is entirely implementation-specific and left as an exercise for the reader. Probably it will be supplied along with the rest of the WP by the builder, but the GP does not define this since it is not *observable behaviour*. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-04 05:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Your question betrays a presupposition that the formalisms in the GP are 1:1 mappable to some implementation code. That may sometimes be the case but certainly not always. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-04 05:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: e.g. We are able to use formalisms in mathematics such as <code>let H(return_value) = input_value</code>. This does not map 1:1 with (procedural) code, because it would imply the ability to make a reverse hash, for which no general solution is known. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-04 05:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It works in the GP because it is describing <em>what</em> we wish to see, not <em>how</em> it must be delivered.</div>
<div class='msg'><time>2025-03-04 05:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In the case of implementing the &quot;impossible&quot; reverse hash function, it is fine because implementations are allowed to &quot;cheat&quot; and use external knowledge (such as DA contents or data arriving over the network) in order to arrive at the answer.</div>
<div class='msg'><time>2025-03-04 05:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Implementing the GP is a puzzle and intentionally so. There may be different ways of solving the puzzle. This diversity can help deliver a resilient, even anti-fragile, network. Don&#x27;t expect a perfectly described path to implementation. You&#x27;ll need to use your brain.</div>
<div class='msg'><time>2025-03-04 05:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ahh, in fact the wrapping is superfluous there; I&#x27;ll accept a PR which removes it from the host functions. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-04 05:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@yu2c:matrix.org&gt; And small suggestion: Add $\mathbb{N}_{R}$ defined in <a href="https://graypaper.fluffylabs.dev/#/85129da/0a13010a2001?v=0.6.3" target="_blank" rel="noopener">(4.23)</a> in the Appendix I / Sets / Regular Notions

PR welcome:)</div>
<div class='msg'><time>2025-03-04 06:06</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: <a href="https://github.com/gavofyork/graypaper/pull/274" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/274</a> This PR adds the definition of $\N_R$ in Appendix I / Sets / Regular Notion.</div>
<div class='msg'><time>2025-03-04 09:19</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: hi there, I&#x27;m currently confused about the fallback keys (sealing) in grandpa:

while blocks sealed with fallback keys are for the placeholder of contingency, <a href="https://graypaper.fluffylabs.dev/#/85129da/1fc0001fc400?v=0.6.3" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/1fc0001fc400?v=0.6.3</a> seems mean that headers with fallback keys are not eligible to be selected as best headers which will make the blocks with fallback keys meaningless, if I&#x27;m not mistaken, the blocks with fallback keys should be selected as the best headers if there are no ticket sealed blocks at the end of slots, plz correct me if I&#x27;m wrong 🙏 <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-04 13:20</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Such blocks may be the only way of extending the chain and getting to the point of having regular ticketed blocks which increase the best chain score.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-04 21:43</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@gav:polkadot.io&gt; Ahh, in fact the wrapping is superfluous.

<a href="http://github.com/gavofyork/graypaper/pull/272" target="_blank" rel="noopener">http://github.com/gavofyork/graypaper/pull/272</a></div>
<div class='msg'><time>2025-03-05 01:34</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: In New, should we panic if the 8th register is not in N-2^32? Because then (c,l) will not be a valid key for the l component of the new service account </div>
<div class='msg'><time>2025-03-05 02:40</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: ~~so the case of finalizing headers with fallback keys is: we just confirmed a ticketed block is on the best chain, and we are requesting the ancestors of the best head ( blocks with the fallback keys in the headers could be here ) ?~~

clear about it now, best chain voted by blocks with most ancestor blocks, headers with fallback keys could be part of them <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-05 02:44</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@ascriv:matrix.org&gt; In New, should we panic if the 8th register is not in N-2^32? Because then (c,l) will not be a valid key for the l component of the new service account 

Also in new, a is missing the p component which should presumably be {}</div>
<div class='msg'><time>2025-03-05 02:58</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: <a href="http://github.com/gavofyork/graypaper/pull/275" target="_blank" rel="noopener">http://github.com/gavofyork/graypaper/pull/275</a></div>
<div class='msg'><time>2025-03-06 05:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Well, it’s not that it’s not “valid” (don’t forget we’re not using typed logic here, just basic set formalisms). Rather that there can be early certainty that if l is not in N_2^32, then there can be no item (c, l) in the set (H, N_2^32). This implies no key can exist.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-06 15:24</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: gav: in your latest lecture in Taipei about JAM, you said that your implementation achieved ~**% speed of native code; would it possible to have the program you used for this benchmark? I&#x27;d love to test jampy PVM around different improvements I have in my sleeve</div>
<div class='msg reply'><time>2025-03-06 15:25</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: <a href="https://github.com/paritytech/polkavm/blob/master/BENCHMARKS.md" target="_blank" rel="noopener">https://github.com/paritytech/polkavm/blob/master/BENCHMARKS.md</a></div>
<div class='msg reply'><time>2025-03-06 15:25</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: <a href="https://github.com/paritytech/polkavm/tree/master/guest-programs" target="_blank" rel="noopener">https://github.com/paritytech/polkavm/tree/master/guest-programs</a></div>
<div class='msg reply'><time>2025-03-06 15:27</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: thx Jan</div>
<div class='msg reply'><time>2025-03-06 16:00</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: Jan Bujak: I&#x27;m calling <code>bash guest-programs/build-benchmarks.sh</code> in order to create pvm and native binaries: it correctly creates PVM binaries, but the x86_64 contains only shared objects. Am I missing a step? </div>
<div class='msg reply'><time>2025-03-06 16:01</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: tools/benchtool is used to run those</div>
<div class='msg reply'><time>2025-03-06 17:28</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: I&#x27;m giving up since generated files are elf or .polkavm format, and I do not want to read other implementation&#x27;s code. I&#x27;ll write my own benchmark program</div>
<div class='msg'><time>2025-03-06 17:45</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: for the &#x27;info&#x27; host call-&gt; where is the serialization of the service accounts preimage availability dictionary (l) defined? 

<a href="https://graypaper.fluffylabs.dev/#/5f542d7/307f02307f02?v=0.6.2" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/307f02307f02?v=0.6.2</a></div>
<div class='msg'><time>2025-03-06 22:13</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Pretty sure this is the case, but want to verify here-&gt; this branch conditional in the read host call is TYPE equivalence rather than literal equivalence? So this branch wouldn&#x27;t be taken if w7 == s, only in the case where w7 == 2^64-1

<a href="https://graypaper.fluffylabs.dev/#/5f542d7/308500308500?v=0.6.2" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/308500308500?v=0.6.2</a></div>
<div class='msg'><time>2025-03-07 00:28</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: </div>
<div class='msg'><time>2025-03-07 20:23</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: For some cases when lhs and rhs types are different, it’s clear what to do, for example in set inclusion we can safely interpret as evaluating to false. But in other cases where lhs and rhs are different types, like the building of the set that is the new service account, it becomes too ambiguous. One interpretation is that the l component in the new service account should be empty. Another is that a should be \error . I’ve made a PR with the second interpretation 
<a href="http://github.com/gavofyork/graypaper/pull/279" target="_blank" rel="noopener">http://github.com/gavofyork/graypaper/pull/279</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-08 08:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, that&#x27;s fair. Merged.</div>
<div class='msg'><time>2025-03-08 08:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: you&#x27;ve highlighted regular l, when the preimage dictionary is bold-l.</div>
<div class='msg'><time>2025-03-08 08:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: regular l is an dependent field.</div>
<div class='msg'><time>2025-03-08 08:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No idea what you&#x27;re talking about. s\* and s are both in <code>\N_S</code>. the comparison is just a simple numeric one. If you work the logic through, it would be taken if <code>omega_7 in { s,  2^64-1 }</code>. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-08 14:45</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Thanks for the response! I&#x27;m not sure I&#x27;m following though? &#x27;t&#x27; is referencing an account, and I only see &#x27;l&#x27; used in the accounts context when referring to the lookup dict? It would make sense if the metadata returned by the info host call contains some metadata about preimages, maybe just the keys even -&gt; but I&#x27;m assuming that would be represented as K{t}_l in the spec if that were the case...</div>
<div class='msg'><time>2025-03-08 15:02</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Thanks for clarifying! Wasn&#x27;t sure if an account being able to selectively target its <em>s</em> vs. <em>d</em> context was a valid use case. Also was getting hung up on this being a more verbose way to get to &#x27;a&#x27; than in the previous host call (lookup) -&gt; but I see the intermediate value used when querying the storage, so the verbosity makes sense there.</div>
<div class='msg'><time>2025-03-08 20:35</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Hello. For the bless and assign host calls, what should happen if a non-privileged service tries to execute it? Panic or HUH? The GP doesn’t really specify. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-10 13:25</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Happy Monday folks. In the &#x27;new&#x27; host function-&gt; the GP doesn&#x27;t specify what should happen if the preimage blob length is above the valid range required by the account spec (N_l = 2^32). There is a related case where this type of behavior is specified-&gt; In the bless host call the GP specifies a &#x27;WHO&#x27; exit when the values aren&#x27;t within the valid N_s range. Curious to hear what the guidance is here, happy to open a PR if needed.

<a href="https://graypaper.fluffylabs.dev/#/5f542d7/31db0031e600?v=0.6.2" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/31db0031e600?v=0.6.2</a></div>
<div class='msg'><time>2025-03-11 17:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Exactly what the GP specifies. It returns OK but has no effect on the system&#x27;s state. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-11 17:59</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ahh yes, <code>t_l</code> should actually be <code>t_o</code>. Feel free to post an issue or make a PR:) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-11 18:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This was previously reported and is addressed in <code>main</code> branch.</div>
<div class='msg'><time>2025-03-11 18:11</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: &gt; &lt;@gav:polkadot.io&gt; Exactly what the GP specifies. It returns OK but has no effect on the system&#x27;s state.

Thanks!</div>
<div class='msg'><time>2025-03-11 18:12</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: <a href="https://github.com/gavofyork/graypaper/pull/284" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/284</a></div>
<div class='msg'><time>2025-03-11 18:13</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@jay_ztc:matrix.org&gt; Happy Monday folks. In the &#x27;new&#x27; host function-&gt; the GP doesn&#x27;t specify what should happen if the preimage blob length is above the valid range required by the account spec (N_l = 2^32). There is a related case where this type of behavior is specified-&gt; In the bless host call the GP specifies a &#x27;WHO&#x27; exit when the values aren&#x27;t within the valid N_s range. Curious to hear what the guidance is here, happy to open a PR if needed.
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/5f542d7/31db0031e600?v=0.6.2" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/31db0031e600?v=0.6.2</a>

I made a change which results in a panic if that happens</div>
<div class='msg'><time>2025-03-11 18:15</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: I see it now, thanks!</div>
<div class='msg'><time>2025-03-11 22:05</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I see in the on transfer and accumulate invocations we check if a service account’s code hash is “without value” but according to the service account type the code hash must have a value. Is the service account type wrong or are these checks wrong? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-12 09:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: what makes you think that the code hash must have a value?</div>
<div class='msg'><time>2025-03-12 09:50</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: The accumulate invocation returns unsigned gas (N_G): <a href="https://graypaper.fluffylabs.dev/#/85129da/2e3e002e5a00?v=0.6.3" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/2e3e002e5a00?v=0.6.3</a>

Shouldn&#x27;t the return value be signed gas (Z_G), as Psi_M is returning signed gas? The same also for C, where now the input and output should then probably be both Z_G? Or should C instead return 0 for the out-of-gas case?</div>
<div class='msg'><time>2025-03-12 12:19</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@gav:polkadot.io&gt; what makes you think that the code hash must have a value?

In 9.3 the code hash is of type H, I think if we want it to be able to be valueless it should be of type “H?” ?</div>
<div class='msg'><time>2025-03-12 15:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: ahh right, sure the hash is non-empty. but there may not be a preimage. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-12 15:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: regular c and bold c are not the same.</div>
<div class='msg'><time>2025-03-12 15:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes indeed. I suspect this may have been incorrectly corrected recently.</div>
<div class='msg'><time>2025-03-12 15:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Feel free to make a PR/issue.</div>
<div class='msg'><time>2025-03-12 15:50</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@gav:polkadot.io&gt; regular c and bold c are not the same.

Yep, misread as regular c. Thanks </div>
<div class='msg'><time>2025-03-12 16:49</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: Sure, for C to return 0 in case of negative gas or for change to Z_G? If change to Z_G, then this will also spill over into Psi_A and the accumulation chapter, where N_G is expected.</div>
<div class='msg'><time>2025-03-13 12:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, in fact it was confusing the gas remaining (which is the PVM gas counter and can be negative in the case of an underrun) with gas used (which is the value used by the higher level accumulation functions and cannot be negative). Should make more sense with <a href="https://github.com/gavofyork/graypaper/pull/288." target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/288.</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-15 19:11</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: In the outer accumulation function, is it intended that the free accumulation services dict be zeroed out after the first iteration? Couldn’t there be work reports in the remaining ones which was made by a free accumulation service?</div>
<div class='msg reply'><time>2025-03-17 05:22</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: My understanding is that the always-accumulate services should be processed first, followed by other services. And there is enough gas to run all the always-accumulate services in the initial round, so those getting accumulated later than the initial round would never happen. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-17 04:40</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: hey teams, curious about in your implementations, after genesis, can you ensure there will be no empty slots in the local testnet? e.g. there are valid blocks on each of the time slots and all of them get full finalized with all of the nodes within 6 seconds <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-17 10:04</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I think I&#x27;ve found something interesting when handling the <code>ecalli</code> pvm fn. According to the gp <code>ΨH|A.34</code> calls <code>Ψ()|A.1</code> and handles the  <code>ε′ = hxh</code>.

The <code>ecalli</code> fn ( <a href="https://graypaper.fluffylabs.dev/#/85129da/25ff0025ff00?v=0.6.3" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/25ff0025ff00?v=0.6.3</a> )  is set to modify just <code>ε</code> leaving the default <code>ı′ = ı + 1 + skip(ı)</code> defined in A.7 in place.

Then the host call gets executed inside <code>ΨH|A.34</code>. If all goes ok and <code>f</code> returns (▸, ....) then we should recursively call <code>ΨH</code> but with <code>ı′′</code> which is defined as <code>ı′′ = ı′ + 1 + skip(ı′)</code>. Now since <code>i&amp;#x27;</code> is what is being returned by <code>Ψ</code> and is already skipping an instruction, then <code>ΨH</code> gets called by skipping another instruction (due to the 2x skips being applied).

Now i think this is either a misinterpretation of mine or an error in the graypaper as in my point of view it makes no sense to skip 1 instruction after a successful hostcall execution via ecalli. Multiple implementations seems to agree with this considering there are multiple implementors passing the duna testnet. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-17 14:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You mean this, right? <a href="https://github.com/gavofyork/graypaper/issues/247" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/247</a></div>
<div class='msg'><time>2025-03-17 14:51</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: yes. i didnt see this issue daaamn. but essentially yeah its the same as i am reporting <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-17 14:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/292" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/292</a></div>
<div class='msg'><time>2025-03-17 15:01</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: perfect thanks</div>
<div class='msg'><time>2025-03-17 19:54</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Hey, I have a question relating to guaranteeing/auditing timing. After a work package is guaranteed and included on-chain, assurers will normally start assuring its availability in the next slot. Is there any reason to wait for these assurances to be posted, or can the auditors (if they are assigned to that specific core) just immediately request shards from the original guarantors? My implementation currently doesn&#x27;t wait for the assurances and just wanted to see if thats okay, or if i should change the timing around. What are the best practices here? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-18 02:30</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: <a href="https://graypaper.fluffylabs.dev/#/85129da/1b6d001b8800?v=0.6.3" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/1b6d001b8800?v=0.6.3</a>
Is equation (14.14) using J_x as defined in (E.5) or the PagedProof P described in (14.10)?

From the preceding equations, it appears to use J_x, but the paragraph stating that “such a vast amount of data is not generally needed as the justification can be derived through a single PagedProof” suggests that using P could also be reasonable. Could we get a clarification on this?</div>
<div class='msg'><time>2025-03-18 17:33</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: What does <a href="https://graypaper.fluffylabs.dev/#/85129da/307f02307f02?v=0.6.3" target="_blank" rel="noopener"><code>t_o</code></a> mean in the info host\_call function?

In the graypaper reader version 3 March 2025 this term is <code>t_l</code>, but in the latest version of the GP 0.6.3 March 13 2025 this term is <code>t_o</code>. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-18 18:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Not sure what you mean: see section 17.3; audit selection happens on all work-reports &quot;pending which have just become available&quot;.

</div>
<div class='msg'><time>2025-03-18 18:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So you&#x27;ll never be self-selecting to audit a work-report until you, at least, believe it is available.</div>
<div class='msg reply'><time>2025-03-18 18:27</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Thanks this answers the question. </div>
<div class='msg'><time>2025-03-18 18:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 14.14 defines regular-J, using caligraphic-J (subscripted with 0), itself defined in E.5. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-18 18:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The formulation of 14.14 does not use the paged-proof(regular-P, 14.10) formulation at all. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-18 18:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Now, please remember as I&#x27;ve now said countless times, the Gray Paper defines _observable behaviour_. It doesn&#x27;t necessarily tell you how to create that behaviour. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-18 18:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In this case, as the text states, you&#x27;ll need to combine this formulation with the page-proof formulation and see that you can create the correct behaviour without requiring all of the data in the segment tree. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-18 18:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: That&#x27;s indeed the whole point of the paged-proofs. They&#x27;re a very efficient means of storing proofs across nodes for showing the correctness of exported data segments when the time comes to import them. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-18 18:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So you&#x27;ll need to study (14.10) and understand that for any export, a relevant proof-page can be fetched from the Segments DA and information from within the two parts of it can be (quite easily) selected and combined in order to produce a full import-justification of the form needed by (14.14 J). <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-03-19 00:36</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: ok! Thanks for replying me!</div>
<div class='msg'><time>2025-03-18 19:24</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.4" target="_blank" rel="noopener">v0.6.4 is released</a>. Many minor fixes and clarifications in here; the only real changes are:
- <a href="https://github.com/gavofyork/graypaper/pull/285" target="_blank" rel="noopener">Activity statistics</a>
- <a href="https://github.com/gavofyork/graypaper/pull/281" target="_blank" rel="noopener">Assurances are checked with the prior validator set (rather than posterior)</a>
- <a href="https://github.com/gavofyork/graypaper/pull/282" target="_blank" rel="noopener">Include ed25519 keys in the epoch marker</a></div>
<div class='msg'><time>2025-03-18 19:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Activity statistics should help us understand what our JAM instances are actually doing and would be a nice thing to monitor and visualise on a web/cli tool if anyone&#x27;s making any.</div>
<div class='msg'><time>2025-03-18 21:11</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Is it reasonable to use <a href="https://github.com/zdave-parity/jam-np/blob/main/simple.md#ce-139140-segment-shard-request" target="_blank" rel="noopener">CE139</a> to fetch the relevant-proof page (or rather shards of the proof page, so as to reconstruct the proof page) from &quot;Segments DA&quot;, where the <code>Segment Index</code> of CE139 is _greater_ than the export count? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-18 21:16</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Yes, that&#x27;s intended even</div>
<div class='msg'><time>2025-03-18 21:26</time>&ensp;<span class='u' style='color:#449ad3'>eclesiomelo</span>: hey guys! I have a question regards the test service in the Accumulation test vector, we have tried to parse it using the definition A.37. I would like to confirm that this PVM blob is formatted according to this definition and not simply A.2 (deblob), is this correct?</div>
<div class='msg reply'><time>2025-03-19 04:15</time>&ensp;<span class='u' style='color:#6ecf94'>qiwei</span>: yes, it&#x27;s a standard program blob</div>
<div class='msg reply'><time>2025-03-19 14:44</time>&ensp;<span class='u' style='color:#449ad3'>eclesiomelo</span>: okay, so given the definition A.37 the first 3 bytes encodes the |o|, however the first 3 bytes in the test service is 0x47000c which decodes to 786503 in decimal which is greater than the test service total bytes

 <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-03-19 14:44</time>&ensp;<span class='u' style='color:#449ad3'>eclesiomelo</span>: image.png</div>
<div class='msg reply'><time>2025-03-19 15:00</time>&ensp;<span class='u' style='color:#449ad3'>eclesiomelo</span>: I am using the inverse of integer encoding, definition C.5, and where I pass [47, 00, 0c] and as output I got 786503, which I think I am missing something.</div>
<div class='msg'><time>2025-03-19 07:19</time>&ensp;<span class='u' style='color:#5e86de'>boymaas</span>: I am double-checking my implementation against the GP, and a question arose. I conclude that if we have a configuration with a W* such that the sum of gas consumption for W* is greater than G_a * C, then we would be overspending the provided gas limit (<a href="https://graypaper.fluffylabs.dev/#/85129da/176503176f03?v=0.6.3)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/176503176f03?v=0.6.3)</a> with our always accumulate services (<a href="https://graypaper.fluffylabs.dev/#/85129da/175901175901?v=0.6.3)." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/175901175901?v=0.6.3).</a> I searched for a condition that would prevent this but could not find one. Furthermore, this line from the Gray Paper suggests that such a scenario is possible:

	“We work with a limited amount of gas per block and therefore may not be able to process all items in W∗ in a single block.”
(<a href="https://graypaper.fluffylabs.dev/#/85129da/160e02161102?v=0.6.3)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/85129da/160e02161102?v=0.6.3)</a>

If my conclusion is correct, is this overspending allowed by design?</div>
<div class='msg'><time>2025-03-19 10:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; then we would be overspending the provided gas limit

No.</div>
<div class='msg'><time>2025-03-19 10:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: W* is the <em>accumulatable</em> WRs; we don&#x27;t accumulate all of them if the gas limit doesn&#x27;t allow.</div>
<div class='msg'><time>2025-03-19 10:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As for always-accumulate services, see (12.20) - there&#x27;s always enough gas to accumulate those in addition to the usual amount for each core. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 10:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There&#x27;s an additional note placed on G_T in definitions advising to account for the always-accumulate services, but because of (12.20) G_T formally only places a lower-limit on the amount of gas used; if there&#x27;s more always-accumulate gas than would fit into G_T, we run &quot;over&quot; G_T and honour the always-accumulate gas.</div>
<div class='msg'><time>2025-03-19 11:29</time>&ensp;<span class='u' style='color:#5e86de'>boymaas</span>: Thank you, gav . I am going to take another look later today. I was aware of 12.20 with the addition of the always accumulate services. I was imagining a scenario where we could get a set of accumulatable WRs whose total gas consumption would be more than Gₐ * C. Where fe an immediate WR, would resolve a bunch of queued WRs. In a tiny network setup with 2 cores for example. Since g is used to select a subset of the accumulable WRs I though it could eat into the reserve for the always accumulate services.</div>
<div class='msg'><time>2025-03-19 12:17</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Should <a href="https://graypaper.fluffylabs.dev/#/85129da/2dff012dff01?v=0.6.3" target="_blank" rel="noopener">this</a> be <code>H?</code> ? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 14:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Always-accumulate services should be in the first &quot;batch&quot; of WRs accumulated (i.e. among the first items of W*) so they will, indeed, always accumulate.</div>
<div class='msg'><time>2025-03-19 14:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Should <em>what</em> be <code>H</code>?</div>
<div class='msg'><time>2025-03-19 14:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Not at all clear what you&#x27;re pointing at or the reasoning behind your suggestion. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 14:57</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: <a href="https://graypaper.fluffylabs.dev/#/85129da/2def012d0102?v=0.6.3" target="_blank" rel="noopener">Eq B.6</a> defines the result context <code>X</code> of the accumulate invocation. The last term of this equation is <code>y ∈ ¿H</code>. Should this term be <code>y ∈ H?</code> instead of <code>y ∈ ¿H</code> since the operator <code>¿</code> is used for serializable terms? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 15:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ahh I see; yes.</div>
<div class='msg'><time>2025-03-19 15:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/299" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/299</a></div>
<div class='msg'><time>2025-03-19 17:12</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: C(13) in Eq D.2 needs to get the current / last validator stats (pi\_V, pi\_L) back in (from 13.1/13.2) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 17:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Please explain <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 17:38</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: The subscripts in C(13) in D.2 only have { C, S, L } but should have { C, S, V, L } to cover both core/service activity (the new elements of C(13)) and validator statistics activity (the old elements of C(13)), that&#x27;s all. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 17:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Not sure what you&#x27;re looking at</div>
<div class='msg'><time>2025-03-19 17:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <code>main</code> branch currently reads:</div>
<div class='msg'><time>2025-03-19 17:39</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2025-03-19 17:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg'><time>2025-03-19 17:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I suspect the problem you&#x27;re describing was fixed by <a href="https://github.com/gavofyork/graypaper/pull/298" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/298</a></div>
<div class='msg'><time>2025-03-19 17:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; The subscripts in C(13) in D.2 only have { C, S }

(They actually had C, L and S, but were indeed missing V as the typo had C twice.) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 17:47</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Would it be ok to seed a JAM implementer DAO on this repo
 <a href="https://github.com/w3f-webops/graypaper-website/pull/96" target="_blank" rel="noopener">https://github.com/w3f-webops/graypaper-website/pull/96</a></div>
<div class='msg'><time>2025-03-19 18:59</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: How did you end up with W\_M = 2048 (The maximum number of imports and exports in a work-package.) \[or 3072 in recent versions\] which implies at most 32 proof pages and 8.4MB of CoreVM memory -- is this due to bandwidth or networking considerations?    With 4104 bytes usable per proof page, you can fit many many more import/export segments than 2048.   If we solved the 14.10/14.14 &quot;puzzle&quot;, we have only 64\*32+5\*32 byte = 2208 bytes out the 4104 bytes being used [or 2240 in recent versions].  You can definitely fit many many more segments with the unused proof page space of 4104-2208=1896 bytes <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 19:02</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I didn&#x27;t come up with these numbers; Gav did. I think they&#x27;re based primarily on bandwidth usage, as discussed in the discussion section at the end of the GP</div>
<div class='msg'><time>2025-03-19 19:08</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Re proof segment usage, think one reason for the choice of 64 is that it&#x27;s a power-of-2 which makes things simple -- you fit a complete subtree in a segment. Could probably fit more proofs in but it would get more complicated as you would have a partial subtree (or multiple subtrees depending on how you look at it). Not sure if there are other reasons. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 19:21</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Did you get &quot;full&quot; erasure coding decoding in the JAM Toaster yet (or some serious fraction of it) --  I&#x27;ve been bothered by doing all this networking just to get a measly 12 bytes  and was wondering if instead of W\_G=4104 pages we&#x27;d like something slightly bigger than 64K or 128K instead (thus getting 16x-32x as much).   Then the 2048 could gets 16 or 32x times as much memory but of course 16x - 32x as much bandwidth usage.  The idea would be that you can get your CoreVM loaded with fewer segments and network calls, but maybe someone will want a CoreVM to have not 8.4MB of memory but 134MB or 268MB instead.  Not sure if W\_G = 4104 is chosen to be compatible with some RISC-V related considerations? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-19 19:25</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: W_G=4104 for 4k pages for eg CoreVM. Bigger page sizes are not great, as it means way more read/write amplification in the worst case. 4k is already really too big for a number of use cases, we just can&#x27;t really go smaller as 4k is the min page size on modern HW</div>
<div class='msg'><time>2025-03-19 19:28</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Please note that the 12 bytes is _per segment shard requested_. You should absolutely be batching these requests so that in the ideal case you make ~340 network requests for all of the segment shards you need for a WP. This is still a lot of requests of course. In the full network protocol we may add a fast path for requesting the original data directly from guarantors.</div>
<div class='msg'><time>2025-03-19 19:32</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: 12MB is a limit on the number of pages read/written _per WP_. It is _not_ the limit on the CoreVM memory. This can&#x27;t really be made larger as it is constrained by bandwidth. Remember that all this data needs to be read/written from/to the DA system for every core every slot</div>
<div class='msg'><time>2025-03-19 19:53</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Understood about the batching of <code>segmentIndex</code> in JAMNP taking us from 12 bytes to some multiple of that.   My mental model is that the majority of segments will come from one primary work package and occasionally a few segments come in from another few &quot;foreign&quot; wps but I understand that&#x27;s just one use case, where my mental model is formed by what I imagine a lazy CoreVM programmer would do (if you tell him its like normal programs).   

By &quot;read/write amplification&quot; I believe you mean the idea that we load up all these pages (yes, in a single WP) from Segments DA and only a tiny % of the pages are updated and only a tiny fraction of each page at that, right?  So it looks like a tradeoff between that and the number of networking calls, even with batched <code>segmentIndex</code>.   Thanks for explaining!</div>
<div class='msg reply'><time>2025-03-20 10:10</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: By read/write amplification I mean even if you want to read or write just 1 byte you still have to import/export an entire page/segment; you end up reading/writing 4000 times as much. Of course that is the worst case, usually it will not be quite as bad</div>
<div class='msg'><time>2025-03-20 03:43</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: What is the expected strategy to have the CoreVM service identify which pages in the child VM have been written to (say, marked with a &quot;dirty&quot; bit) so that those pages (and only those pages) are exported to Segment DA by the parent VM?    </div>
<div class='msg'><time>2025-03-20 08:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, CoreVM will support this via the inner PVM host API. We don&#x27;t yet have that host call API in place but I believe it&#x27;s on Jan Bujak &#x27;s TODO list. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 08:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: One additional thing to note for segment reconstruction is that actually fetching each 12 byte piece from a unique set of 342 nodes and reconstructing is the very worst case. There are four better cases: that some or all of the segments are provided to the guarantors by the builder (because it could be the same builder or builder-network whose package created them in the first place). In this case they could have the proof-pages or just be content indexed and passed as extrinsics. Or the guarantor could already have the pages in their own cache because it was they who guaranteed the exporting package. Or the guarantor could fetch them from the exporting guarantor as whole segments. Or that the guarantor batches them because they were exported by the same package as other segments which are also needed for import. And in the worst case, the system wouldn&#x27;t _break_; it would just mean that packages which exposed this worst-case behaviour would take potentially a little longer to make their way through the pipeline. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 10:26</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: The encoding for newly created Work Result fields (C.23) do not specify integer sizes for xu, xi, xx, xz, xe. Are they all 1 byte values? </div>
<div class='msg'><time>2025-03-20 16:32</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I have a couple of questions/remarks about accumulation. Specifically how jam should handle dependencies when accumulating a service. Let&#x27;s consider the following scenario:

- WorkReport A contains 2 results: service 1 and service 2
- WorkReport B has a dependency on A <code>((WB)_x)_p = ((WA)_s)_h</code> and contains one result of service 3.

So <code>W!</code> contains \[1, 2\], lets assume <code>WQ</code> is empty... But <code>W*</code> contains also 3 so <code> W* = [1, 2, 3]</code>.

Now <code>∆∗</code> which is called &quot;parallelized accumulation&quot;, is being called with W\* on 12.21 (after ∆+) <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/17b50317c103?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/17b50317c103?v=0.6.4</a> .

question 1: But since there is no ordering enforced (that i can see) when executing <code>∆∗</code>, then 3 might be executed before it&#x27;s dependencies.

question 2: lets say i am wrong in the previous question. Lets say Service 1 writes in it&#x27;s storage a key that Service 3 needs to read from (via hostcall read). service 3 does not seem to receive the updated storage when <code>∆1</code> gets called with s=3

I guess both questions/remarks are wrong and that Service3 needs to be indeed gets executed after 1,2 (which can be parallelized) and that it should be accumulated using the updated service accounts from the 1,2 accumulation. but i can&#x27;t see where this is enforced in the GP. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 17:08</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Indeed, as Gav said, we will most likely add a way for the parent VM to fetch this information in an efficient manner. It&#x27;s on my TODO list; we just don&#x27;t want to spec it before implementing it to make sure the performance is good.</div>
<div class='msg'><time>2025-03-20 18:34</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: That&#x27;s totally great.  A <code>page-manifest</code>  host function call of both (A) what pages MUST be exported because it was written to (a &quot;dirty bit&quot; per page) and (B) what page MUST be imported because it was read from (a &quot;accessed&quot; bit per page) appears necessary for programmers to not have to think much about how their child &quot;guest program&quot; uses memory and the parent CoreVM service will need this manifest to poke and peek pages so the programmer doesn&#x27;t have to.

But since guest programs will vary widely in terms of how many &quot;accessed&quot; and &quot;dirty&quot; bits they get before they hit some refine gas limit OR the W\_M=3072 (12MB) limit on imported+exported segments which applies across ALL the VMs, parent and child, it seems the builder should be able to run with the whole 2^32 VMs always fully loaded ... and <em>then</em> use this bookkeeper to dump work packages out right before it runs out of gas or hit the W_M, to effectively break up long running computations into work packages that the guarantors can legit handle in accordance with JAM spec.   We would thus want &quot;builder&quot; mode refining (having tens of thousands maybe the 1MM page) and &quot;guarantor&quot; model refining (W\_M) working on just the subset the builder wants.  Is that the way to think about designing this host function?  How do performance considerations figure in? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 18:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: They&#x27;re all variable. See C.6 <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 18:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. WIs for services 1, 2 and 3 would be executed in the same batch. From the perspective of each they would be executed under the same prior state. If #3 inspected the state of #2 it would see its prior state; if #2 inspected #3, it would also see #3&#x27;s prior state.
2. No. #3 would not (necessarily) see the storage change. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 18:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The thing to understand is that JAM services are very much designed to be only asynchronously interactive, at least at the accumulation stage.</div>
<div class='msg'><time>2025-03-20 18:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The prerequisite functionality is there to ensure that a package doesn&#x27;t get accumulated before another package is known to be accumulatable.</div>
<div class='msg'><time>2025-03-20 18:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is not there to force a total ordering over its constituent work items; and certainly not over multiple services. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 18:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This would create a potentially troublesome pattern and may over-extend the queue system and reduce potential parallelisability for accumulate. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 18:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: A total ordering is possible within a single service; by creating dependent packages, you can be certain that certain WIs will not be accumulated in batches before others. You may end up with a dependency in the same batch, but then that&#x27;s up to the service code to apply the appropriate ordering. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 18:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If you&#x27;re looking to synchronise between services, then you&#x27;ll need to use <code>transfer</code>s. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 18:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Transfers can be combined with co-scheduling at the Refine stage (e.g. sharing the same WP) and it becomes possible to create causal entanglement between the WIs of multiple services which can be enforced at the accumulation stage, so the entangled effects only get integrated into state when both sides are known to be completable. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 18:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Accumulation is designed with a view to becoming parallelisable. At some later revision of JAM we may e.g. increase the number of cores to 682 with a requirement that a single service cannot regularly have more accumulation gas than is possible with 341 of them. We can&#x27;t squeeze more gas into the synchronous pipeline, so this would be made viable through CPU parallelism executing multiple service&#x27;s simultaneously.</div>
<div class='msg'><time>2025-03-20 18:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This model breaks more as work-items between services become orderable and synchronous dependencies - chains of execution - start to become the norm.</div>
<div class='msg'><time>2025-03-20 18:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So it&#x27;s something I&#x27;m really trying to avoid with this design.</div>
<div class='msg'><time>2025-03-20 18:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In short, cross-service execution dependencies force synchroneity and are evil and the death of scalability. We want to keep them off-chain. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-20 19:03</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: perfect gavin. Thanks for this indepth explanation. it was very much needed for me... I was trying to make both the &quot;dependency system&quot;/prerequisite and parallelism work together. 

</div>
<div class='msg'><time>2025-03-21 14:34</time>&ensp;<span class='u' style='color:#994dd2'>tvvkk7</span>: Hello, I&#x27;m implementing PVM invocations, but I&#x27;m curious about how we get the actual service code, or in other words the standard program codes. 
Take <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/2fc8002fca00?v=0.6.4" target="_blank" rel="noopener">on-transfer invocation</a> for example, we input service codeHash into argument invocations. But, service codeHash is a 32-octet value. How do we get the program codes through service codeHash ? </div>
<div class='msg'><time>2025-03-21 14:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There’s a function, big Lambda. This should define how to derive the hash preimage. </div>
<div class='msg'><time>2025-03-21 14:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It’s all well defined. </div>
<div class='msg'><time>2025-03-21 14:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You’ll need to utilise the preimage lookup map. </div>
<div class='msg'><time>2025-03-21 14:57</time>&ensp;<span class='u' style='color:#994dd2'>tvvkk7</span>: Much appreciated </div>
<div class='msg'><time>2025-03-21 22:19</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hi guys, small questions:  
- Is ε(tₐ, tᵦ, tₜ, tᵧ, tₘ, tₒ, tᵢ) used in the definition of the host call function info Ωᵢ the same encoding as **𝐚 ∼ 𝓔₈(𝐚ᵦ, 𝐚ᵧ, 𝐚ₘ, 𝐚ₒ) ∼ 𝓔₄(𝐚ᵢ)**?
- Perhaps there&#x27;s something I don&#x27;t see, but in equation A.43 we define **u = ρ − max(ρ′, 0)**.  
  If ρ′ is negative, then **u = ρ**, which means the gas doesn&#x27;t change.  
  So the service would have run code, but the gas stays the same — is that correct?  
  If so, is that the intended behavior?</div>
<div class='msg reply'><time>2025-03-22 04:56</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: may I ask if this is part of the new PVM tests or the stf of accumulation? I see everybody is talking about this however we haven&#x27;t met this yet 😅 <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-03-22 09:01</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Capture d’écran du 2025-03-22 10-28-25.png</div>
<div class='msg reply'><time>2025-03-22 09:01</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Capture d’écran du 2025-03-22 10-29-08.png</div>
<div class='msg reply'><time>2025-03-22 09:02</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Sorry actually you were asking about the first question or the second question ?</div>
<div class='msg reply'><time>2025-03-22 09:06</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: sry I&#x27;m just curious about the host call part, I&#x27;m now updating our PVM tests while I don&#x27;t see tests with host calls, so I assume it belongs to the accumulation stf?</div>
<div class='msg'><time>2025-03-22 05:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@celadari:matrix.org&gt; Hi guys, small questions:  
&gt; - Is ε(tₐ, tᵦ, tₜ, tᵧ, tₘ, tₒ, tᵢ) used in the definition of the host call function info Ωᵢ the same encoding as **𝐚 ∼ 𝓔₈(𝐚ᵦ, 𝐚ᵧ, 𝐚ₘ, 𝐚ₒ) ∼ 𝓔₄(𝐚ᵢ)**?
&gt; - Perhaps there&#x27;s something I don&#x27;t see, but in equation A.43 we define **u = ρ − max(ρ′, 0)**.  
&gt;   If ρ′ is negative, then **u = ρ**, which means the gas doesn&#x27;t change.  
&gt;   So the service would have run code, but the gas stays the same — is that correct?  
&gt;   If so, is that the intended behavior?

On the second point, no. u is gas used. By ensuring the second term (gas counter) is never negative we just ensure that the gas used is never greater than the gas limit. </div>
<div class='msg reply'><time>2025-03-22 07:40</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Oh thank you, I hadn&#x27;t inderstood that u was used gas, makes sense</div>
<div class='msg'><time>2025-03-22 05:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: On the first point, no. The former encoding uses the variable size numeric encodings. </div>
<div class='msg reply'><time>2025-03-22 08:31</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I see =&gt; thanks : )</div>
<div class='msg'><time>2025-03-22 11:21</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Is the explicit encoding of the <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/0ce0000cf200?v=0.6.4" target="_blank" rel="noopener">tuple in 5.6</a> redundant since that&#x27;s going to just remain an octet sequence after the outer encoding?  Or is there something special I&#x27;m missing? (i.e is it pretty much the same as the regular serialization in the appendix only the work report replaced with the hashed work report instead) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-22 11:36</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Question regarding this:

i&#x27;&#x27; was removed in the definition of Psi_H in version 6.4 of the GP so my question   =&gt;  ¿ do we advance the counter after ecalli instruction or not when we exit ecalli for the host call ?

Looking at this line looks like we don&#x27;t advance it <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/246700247200?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/246700247200?v=0.6.4</a>

but then it conflicts with idea of using i&#x27; (not using i&#x27;&#x27;) during Psi_H call (<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/2b9d012b9d01?v=0.6.4)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/2b9d012b9d01?v=0.6.4)</a> where it would mean that i&#x27; is advanced after ecalli instruction for the host call ?

Thanks in advance for the clarification 🙏</div>
<div class='msg reply'><time>2025-03-22 11:38</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: PS: I tag Ivan Subotic  so he gets notified as well</div>
<div class='msg'><time>2025-03-22 11:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@greywolve:matrix.org&gt; Is the explicit encoding of the <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/0ce0000cf200?v=0.6.4" target="_blank" rel="noopener">tuple in 5.6</a> redundant since that&#x27;s going to just remain an octet sequence after the outer encoding?  Or is there something special I&#x27;m missing? (i.e is it pretty much the same as the regular serialization in the appendix only the work report replaced with the hashed work report instead)

It is done this way to avoid having to send all guarantees with the header. Merkle proofs can be provided for those which are sent on other channels. </div>
<div class='msg'><time>2025-03-22 11:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@celadari:matrix.org&gt; Question regarding this:
&gt; 
&gt; i&#x27;&#x27; was removed in the definition of Psi_H in version 6.4 of the GP so my question   =&gt;  ¿ do we advance the counter after ecalli instruction or not when we exit ecalli for the host call ?
&gt; 
&gt; Looking at this line looks like we don&#x27;t advance it <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/246700247200?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/246700247200?v=0.6.4</a>
&gt; 
&gt; but then it conflicts with idea of using i&#x27; (not using i&#x27;&#x27;) during Psi_H call (<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/2b9d012b9d01?v=0.6.4)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/2b9d012b9d01?v=0.6.4)</a> where it would mean that i&#x27; is advanced after ecalli instruction for the host call ?
&gt; 
&gt; Thanks in advance for the clarification 🙏

ecalli is no different to other instructions regarding i’: i’ still represents the instruction immediately following and as per the definition of PsiH, we advance to it once the host call is resolved. </div>
<div class='msg'><time>2025-03-22 13:10</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: Ahh, now I understand it. The program counter always advances as per (A.7) and additionally in the case of <code>ecalli</code>,  <code>epsilon is h x v_x</code> instead of <code>play</code>. Thanks!</div>
<div class='msg'><time>2025-03-24 09:56</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: gav: ﻿what is the rationale of having core and service statistics into the protocol? While validators&#x27; statistics are useful as explained in the GP, there are no information of the usefulness of core and service statistics, and I&#x27;m unable to figure it out by myself</div>
<div class='msg'><time>2025-03-24 10:10</time>&ensp;<span class='u' style='color:#bf4233'>emilkietzman</span>: Secondary markets of Agile Coretime like RegionX or Lastic - You could check Core utilizations in different projects and sell unused Coretime</div>
<div class='msg'><time>2025-03-24 11:16</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: It was mentioned in the OpenDev call <a href="https://www.youtube.com/live/5kpgs7eb95M?si=AQu819sfQUwxgCRP&amp;t=395" target="_blank" rel="noopener">https://www.youtube.com/live/5kpgs7eb95M?si=AQu819sfQUwxgCRP&amp;t=395</a></div>
<div class='msg'><time>2025-03-24 11:21</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: I missed that, I&#x27;ll watch it. Thank you</div>
<div class='msg'><time>2025-03-24 23:32</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Question regarding host call functions Omeja_J(n=reject)

- if we apply it to an account <code>a</code> of index <code>s</code> =&gt; it is supposed to eliminate from the database only the components <code>a_c</code>, <code>a_b</code>,<code> a_g</code>, <code>a_m</code>, <code>a_o</code>, <code>a_i</code> (represented by C(255, s) in the trie) or <code>a_l</code>, <code>a_p</code>, <code>a_s</code> as well ? </div>
<div class='msg'><time>2025-03-25 14:55</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Is the ordering of the preimages extrinsic fully defined in the GP? 12.35 specifies that the preimages extrinsic should be ordered by the (account, preimage) tuples, but doesn&#x27;t go into further detail. Looking at the tuple &amp; sequence notation sections in section 3, there&#x27;s not a default tuple ordering defined there either. 

 <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/181001181001?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/181001181001?v=0.6.4</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-25 15:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Tuples are ordered in the usual, obvious way.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-25 15:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Eg (1,1), (1,2), (2,1), (2,2)</div>
<div class='msg'><time>2025-03-25 15:09</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: got it, thx for clarifying</div>
<div class='msg'><time>2025-03-25 16:31</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: With v0.5&#x27;s PVM 64-bit change (and a irreversible commitment to not supporting 32-bit PVM), it is reasonable to adjust <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/2c15002c1500?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/2c15002c1500?v=0.6.4</a> to have a memory address space beyond 4GB?   If not, what are the technical reasons for continuing with this 32-bit layout?  

I believe we should extend the &quot;A&quot; <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/0a7e010a7e01?v=0.6.4" target="_blank" rel="noopener">here</a> to include &quot;accessed&quot; (i) and &quot;dirty&quot; (e) bits so as to map into what pages must be imported and what pages must be exported, thus treating coreVM OSes specially.  Or get at least a convention on how corevm services use the 4104-4096=8 bytes to keep the page number and these additional metadata bits.  I understand JAM protocol may not wish to impose constraints on what these additional 8 bytes contain (though I believe it makes sense to have these i+e bits to support OSes to run on JAM), but a nevertheless pregnant question regardless is: are there additional metadata bits candidates per segment we should consider when designing CoreVM + Coreplay services?   <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-25 20:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No idea what you&#x27;re talking about. Please reframe it in specific terms of Omega_J.</div>
<div class='msg'><time>2025-03-25 20:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We can&#x27;t actually handle 4 GB of allocations in terms of gas. Realistically most programs will mostly execute with only 1MB actually accessible (maybe sometimes with 16MB, but only very rarely with more). <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-25 20:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Gas will be scaled depending on how much memory you&#x27;re accessing. It&#x27;ll become impractical many orders of magnitude below 32-bit.</div>
<div class='msg'><time>2025-03-25 20:36</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: &gt; If not, what are the technical reasons for continuing with this 32-bit layout?

Speed, as it makes sandboxing cheaper, and as Gav said you won&#x27;t be able to use this much memory in practice anyway, so it&#x27;s pointless to have a 64-bit address space.</div>
<div class='msg'><time>2025-03-25 20:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And, for security (auditing) validators will need to be able to execute several refinements concurrently, probably around 10; we&#x27;ll also need 2 guarantor refinements. If they all used, say, 4 GB of RAM, then validators would need to have 48GB of RAM free before we even start thinking about the state DB and various caches. </div>
<div class='msg'><time>2025-03-25 20:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: That would probably push minimum requirements to beyond 64 GB per node, which is too much.</div>
<div class='msg'><time>2025-03-25 20:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Any, in any case, there&#x27;s no sensible on-chain use-case which would need 64-bit addressability.</div>
<div class='msg'><time>2025-03-25 21:03</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: I read David Emett &#x27;s comment of &quot;12MB is a limit on the number of pages read/written per WP. It is not the limit on the CoreVM memory.&quot; in the following way:

- A CoreVM service user actually really does have a 4GB virtual computer.  However, in any given work package, spanning say a few seconds of computation only	a small number of pages are accessed (imported) or written to (exported).
- Only W\_M (3072 as of 0.6.4) pages = 12MB of this 4GB virtual computer is realistic to set up with JAM&#x27;s PVM but it is only  _tiny fraction_ of the larger addressable subset of the CoreVM service users&#x27;s 4GB virtual computer.
- So one work package might access ABC (12MB) the next might access DEF (a different 12MB), the next EFG etc, none of which exceed W\_M _individually_ but in totality across multiple work packages exceed 12MB.  In this way, you could totally want much more than 4GB.
- When a builder submits a work package to a guarantor, JAM being basically an audit protocol of what happens in up to a W\_M (12MB sized) sliver of memory of what the larger 4GB computer did.  JAM is optimized for trustless OS services.

In previous decades there was a story of &quot;640K ought to be enough for anybody&quot; and maybe &quot;I think there is a world market for about five computers&quot; -- these days 4-8B people all have 4-8GB phones in their pocket and so perhaps the trustless supercomputing equivalent is &quot;12MB/4GB ought to be enough for everyone&quot; and &quot;there is a world market for about 5 trustless supercomputers&quot; =).  Could we imagine that all 4-8B people collectively get their Shared World Computer in a 64-bit way so they may all coreplay together, even though any individual work package only references a tiny sliver? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-25 21:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I appreciate the ambition, but the limits are there for a reason.</div>
<div class='msg'><time>2025-03-25 21:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: We&#x27;ve explained the reasoning. Live with it or come up with a better protocol yourself.</div>
<div class='msg'><time>2025-03-25 21:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There&#x27;s the business of dreaming and the business of building. This channel is for the latter.</div>
<div class='msg'><time>2025-03-25 21:33</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Thanks for pointing out my message wasn’t clear and asking for clarification — I appreciate it 🙂

Speaking in terms of **<code>Omega_J</code>**:
– we&#x27;re removing an account <code>d</code> (<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/32a50332a803?v=0.6.4)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/32a50332a803?v=0.6.4)</a>

Speaking in terms of the **trie root (Appendix D)**:
By removing this account <code>d</code>, the state root trie will need to be updated at some point.

My question is:
– Do we remove only the first component of the account in the trie? (<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/382b03383b03?v=0.6.4)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/382b03383b03?v=0.6.4)</a>
– Or do we remove other components of the account (storage, pre_image lookup, ...) as well?
(<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/385403386103?v=0.6.4," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/385403386103?v=0.6.4,</a> <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/384103384e03?v=0.6.4," target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/384103384e03?v=0.6.4,</a> <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/387603387f03?v=0.6.4)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/387603387f03?v=0.6.4)</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-25 21:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: You can answer your own question if you simply phrase it in terms of Omega_J.</div>
<div class='msg'><time>2025-03-25 21:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Omega_J has the effect of removing a particular item (d) from the accounts dictionary (delta).</div>
<div class='msg reply'><time>2025-03-26 15:25</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Thanks again for your time and answer.

Just to give a bit more context on why I was confused:

I hadn’t realized that the condition on
<code>𝑑𝑖=2</code> was actually implying that the **storage**, **preimages**, etc. for that account had to be _already empty_ — meaning the account must have gone through a <code>forget(Omega_F)</code> and <code>write(Omega_W)</code> before being eligible for deletion.

Initially, I thought we were supposed to manually remove these fields by directly deleting down from the partial trie key like
<code>𝐶(𝑠,𝐸4(2^32−1))</code>
which would have worked fine for **preImageLookupP** and **storage**, but not for **preImageLookupL** (because of <code>E(l)</code>) — and that one had me pulling my hair out 😅

All good now and thanks again :) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-25 21:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And if you see the various data concerning accounts which makes up the state trie (from which the trie root may be derived), they&#x27;re all defined through the contents of the accounts dictionary delta.</div>
<div class='msg'><time>2025-03-25 21:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Therefore if the dictionary no longer contains a particular account, then state trie items such as the the stored data, preimages, &amp;c which were concerning said account will no longer be in place.</div>
<div class='msg'><time>2025-03-26 07:36</time>&ensp;<span class='u' style='color:#994dd2'>tvvkk7</span>: Hello gav , I&#x27;m implementing accumulation invocation. The <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/2e36012e4001?v=0.6.4" target="_blank" rel="noopener">initializer function</a> I requires eta&#x27;_0. Does eta&#x27;_0 be input through <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/163702163702?v=0.6.4" target="_blank" rel="noopener">U</a> ? Although, it is only needed in Psi_A.</div>
<div class='msg'><time>2025-03-26 09:21</time>&ensp;<span class='u' style='color:#d25e85'>shawntabrizi</span>: As I recall, compact numbers in JAM are different than they are in SCALE and Polkadot today. Can someone write a small description of the new compact number format? ❤️</div>
<div class='msg reply'><time>2025-03-26 09:31</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I give my code to chatgpt and this is the description from it
<pre><code class=''>This encoding converts an unsigned integer into a sequence of bytes using just as many bytes as needed. Here’s how it works in simple terms:
	1.	Zero Handling:
If the integer is 0, it simply outputs one byte with the value 0.
	2.	Determining Byte Count:
For nonzero numbers, the encoder figures out how many extra bytes are needed by finding the smallest number l (from 0 to 7) such that the value fits within 7 \times (l+1) bits. If none of these work, it defaults to using 8 bytes in total.
	3.	Control Byte Creation:
The first byte (control byte) combines a prefix that indicates how many extra bytes follow and part of the number itself. The prefix is calculated as:
\text{prefix} = 256 - (1 \ll (8 - l))
The control byte is then formed by adding this prefix to the most significant bits of the number.
	4.	Appending Remaining Bytes:
After the control byte, the remaining bytes (if any) represent the lower parts of the number, each taking an 8-bit chunk.

In summary, the format starts with a control byte that tells you how many additional bytes there are and includes part of the data, followed by the extra bytes that complete the full representation of the integer.
</code></pre></div>
<div class='msg'><time>2025-03-26 09:22</time>&ensp;<span class='u' style='color:#d25e85'>shawntabrizi</span>: image.png</div>
<div class='msg'><time>2025-03-26 09:22</time>&ensp;<span class='u' style='color:#d25e85'>shawntabrizi</span>: is that this?

</div>
<div class='msg'><time>2025-03-26 09:22</time>&ensp;<span class='u' style='color:#d25e85'>shawntabrizi</span>: need an ELI5 :)</div>
<div class='msg'><time>2025-03-26 09:24</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: One prefix byte plus payload. The prefix byte determines the length through the number of <code>1</code>s before the first <code>0</code>. The unused bits in the first byte are used for the payload. The first byte always contains the most significant bits. The rest of the bytes are always written in a little endian order. Can encode at most 64-bit numbers.

At most  7bit - 0xxxxxxx
At most 14bit - 10xxxxxx xxxxxxxx
At most 21bit - 110xxxxx xxxxxxxx xxxxxxxx
At most 28bit - 1110xxxx xxxxxxxx xxxxxxxx xxxxxxxx
At most 35bit - 11110xxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx
At most 42bit - 111110xx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx
At most 49bit - 1111110x xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx
At most 56bit - 11111110 xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx
At most 64bit - 11111111 xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx
</div>
<div class='msg'><time>2025-03-26 09:24</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: is there any specification for work package builders, yet? </div>
<div class='msg'><time>2025-03-26 09:30</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: hi there, as for the riscv test <a href="https://github.com/koute/jamtestvectors/blob/master_pvm_initial/pvm/programs/riscv_rv64ua_amoadd_d.json," target="_blank" rel="noopener">https://github.com/koute/jamtestvectors/blob/master_pvm_initial/pvm/programs/riscv_rv64ua_amoadd_d.json,</a> it doesn&#x27;t have jump table defined, (the program starts with \[0, 0\]), however seems jumps are required for executing the complete logic, but how do we perform jumps in the bytecode since we don&#x27;t have the jump table? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-26 09:33</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Not sure I understand your question. That program contains only static jumps and it doesn&#x27;t require a jump table.</div>
<div class='msg reply'><time>2025-03-26 09:48</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: wait, I can reproduce my case in pvm debugger 

<a href="https://pvm.fluffylabs.dev/?program=0x0000808833000000018300ff9700103200330502330700000080330800f83a0a0000017ba782ab3e02000003c88b027ba23a02000003330400000080ab4b4c33050382ac3304ff97441f954400f8ab4c3a33050482ab3e02000003c88b027ba23a020000033304ff97441f954400f8ab4b1933050582ac33040000f88344ff97440cab4c0652050400287bff212941840a2904494924851492480a4932#/" target="_blank" rel="noopener">https://pvm.fluffylabs.dev/?program=0x0000808833000000018300ff9700103200330502330700000080330800f83a0a0000017ba782ab3e02000003c88b027ba23a02000003330400000080ab4b4c33050382ac3304ff97441f954400f8ab4c3a33050482ab3e02000003c88b027ba23a020000033304ff97441f954400f8ab4b1933050582ac33040000f88344ff97440cab4c0652050400287bff212941840a2904494924851492480a4932#/</a>

at JUMP\_IND, we trigger halt, if so, how do we run the rest of the logic to reach the expected test result?  <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-03-26 09:49</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: You don&#x27;t start execution at 0.</div>
<div class='msg reply'><time>2025-03-26 09:50</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: oh I got it, missed the <code>initial_pc</code>, thanks!</div>
<div class='msg'><time>2025-03-26 09:35</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: oh I got you, so there could be problems in my <code>djump</code> implementation, I&#x27;m referencing the jump table in all jump instructions</div>
<div class='msg'><time>2025-03-26 09:36</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The only dynamic jump in that program is the jump that goes to the hardcoded special address which halts the program; no other jumps there use the jump table.</div>
<div class='msg'><time>2025-03-26 09:37</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Non-dynamic jumps definitely shouldn&#x27;t do anything with the jump table.</div>
<div class='msg'><time>2025-03-26 09:37</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: I may need to fix more problems in my code, since I can pass all <code>test_instr_*</code> with my current implementation 😂</div>
<div class='msg'><time>2025-03-26 09:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Specification, no, and there won&#x27;t be.</div>
<div class='msg'><time>2025-03-26 09:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There may be conventions, published APIs and/or SDKs to help create package builders.</div>
<div class='msg'><time>2025-03-26 09:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But the JAM protocol doesn&#x27;t prescribe any means of building packages any more than it prescribes how you should create your service logic. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-26 09:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It terms of data logistics, ideally builders will connect to the JAM network via inbuilt nodes (light or full, depending on the use-case and circumstances) and use internal node APIs to inject new packages. Nodes would then identify the right guarantors and send the package to them.</div>
<div class='msg'><time>2025-03-26 09:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: However, in the early days, we&#x27;ll probably see RPCs being used by builder executables to deliver packages to nodes on testnets. It&#x27;s definitely not something I&#x27;d want to see in production, but running &amp; synching a full-node to insert a single work-package is plainly suboptimal and we don&#x27;t have any light-clients yet.</div>
<div class='msg'><time>2025-03-26 09:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: That&#x27;s not a question the GP (or I) can answer. How you get eta&#x27; into the appropriate place in your code for it to be able to calculate the initial machine state is entirely an implementation detail. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-03-26 11:51</time>&ensp;<span class='u' style='color:#994dd2'>tvvkk7</span>: Many thanks ! I got it!</div>
<div class='msg'><time>2025-03-26 09:50</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: are validators expected to open connections with any builder nodes? obviously limits needs to be enforced on validators side but that can still be a DoS vector?</div>
<div class='msg'><time>2025-03-26 09:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No.</div>
<div class='msg'><time>2025-03-26 09:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The builder node set is unconstrained.</div>
<div class='msg'><time>2025-03-26 09:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And even if it were somehow constrained, validators have no idea who they are.</div>
<div class='msg'><time>2025-03-26 09:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Whereas validators IDs are well-known to anyone with an up to date JAM state.</div>
<div class='msg'><time>2025-03-26 09:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Strategically, validators need to find work-packages they can guarantee in order to make rewards. But they must balance this with the possibility of being DoSed/attacked. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-26 09:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So there will be some need for implementors to create guarantor strategies which balance these two opposing forces. There&#x27;s not really a right answer here and it&#x27;s the sort of thing which should be discussed at JAM0.</div>
<div class='msg'><time>2025-03-26 09:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Realistically I&#x27;d expect validators to have several dozen nodes connected, other than fellow validators.</div>
<div class='msg'><time>2025-03-26 09:55</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I see. something to be figured out. worst case we just have tx pool and some package gossip protocol + peer reputation. ie something like what we have today </div>
<div class='msg'><time>2025-03-26 09:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And to actively churn through nodes, keeping ones who tend to give them good packages.</div>
<div class='msg'><time>2025-03-26 09:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Connection could come with a promise to give packages adhering to a set of authorizers. Failure to provide a package on a core with one of those authorizers in the pool could result in booting.</div>
<div class='msg'><time>2025-03-26 09:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Obviously if bad packages are received, then this would also result in booting.</div>
<div class='msg'><time>2025-03-26 10:12</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: so for a builder to be able to consistently deliver work packages, it needs to work with all sorts of services. It certainly need a pool and some way to collect the packages. this is a big chunk of work</div>
<div class='msg'><time>2025-03-26 10:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Highly unlikely.</div>
<div class='msg'><time>2025-03-26 10:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Builders will almost certainly be private enterprises and specialised to a particular service or service-type.</div>
<div class='msg'><time>2025-03-26 10:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: E.g. for parachains, it could be that every parachain will have its own builder network (aka collator network). Though with the Omninode, we&#x27;ll probably see generic parachain builder networks. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-26 10:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But still, they&#x27;ll only build for the one Parachains service.</div>
<div class='msg'><time>2025-03-26 10:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It will be up to the builders to convince guarantors on cores which their packages are capable of running that they can furnish them with packages.</div>
<div class='msg'><time>2025-03-26 10:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Thankfully this need not be done blindly; IsAuthorized is designed to run independently and cheaply.</div>
<div class='msg'><time>2025-03-26 10:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And once IsAuthorized executes successfully, the guarantor knows that the builder can reasonably supply a package worth refining/guaranteeing.</div>
<div class='msg'><time>2025-03-26 10:35</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: so the strategy to build connection and accept work packages will be fixed for each implementation, for consistency, or will there be different strategies? If fixed, will that be provided in JAM-NP?</div>
<div class='msg'><time>2025-03-26 10:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: JAM-SNP already contains network messages for provision/sharing of work-packages (and preimages)</div>
<div class='msg'><time>2025-03-26 10:37</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: but that is just protocol for connection setup. will there be any strategy/requirements for acceptance or just we have to validate author hash or work package on our own and then perform computations?</div>
<div class='msg'><time>2025-03-26 10:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As I just wrote:</div>
<div class='msg'><time>2025-03-26 10:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; So there will be some need for implementors to create guarantor strategies which balance these two opposing forces. There&#x27;s not really a right answer here and it&#x27;s the sort of thing which should be discussed at JAM0</div>
<div class='msg'><time>2025-03-26 10:39</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (For the purposes of M2 conformance testing we&#x27;ll have idealised connections and implementations will not need to concern themselves with the possibility of DoS.)</div>
<div class='msg'><time>2025-03-26 10:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As per the security audit (M5), implementations will need to demonstrate a resilience against DoS, including attacks by peers. But of course, over-conservative nodes which sacrifice too many rewards may find that fewer validators are willing to run them. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-26 10:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Again, no right answers, and I do expect (and hope for!) some differences between node strategies, but our implementor conferences are meant for brainstorming and sharing insights into such things.</div>
<div class='msg'><time>2025-03-26 10:43</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: alright, got it. thank you very much</div>
<div class='msg'><time>2025-03-26 11:01</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: SNP currently allows builders to identify themselves at connection time by adding /builder to the protocol advertised during ALPN, see <a href="https://github.com/zdave-parity/jam-np/blob/main/simple.md#alpn." target="_blank" rel="noopener">https://github.com/zdave-parity/jam-np/blob/main/simple.md#alpn.</a> To some extent how validators treat these connections is a strategy thing and it isn&#x27;t necessary for all implementations to behave the same. A reasonable strategy might be to grant a peer connecting with the /builder suffix a special builder connection slot (subject to availability), but require the peer to submit a valid work-package within a few seconds after connecting in order to keep the slot and not lose reputation.</div>
<div class='msg'><time>2025-03-26 12:41</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: </div>
<div class='msg'><time>2025-03-27 16:51</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: should the pvm invocation definitions make explicit the use of the historical lookup function when representing an accounts code? Currently it looks like S_c is used as if it were intended to be the code preimage itself, rather than the code hash.

<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/2fa9002fac00?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/2fa9002fac00?v=0.6.4</a></div>
<div class='msg'><time>2025-03-27 23:13</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: within the accumulate pvm invocation, is flushing S back to the partial state after read-only host functions intentional? (read, lookup, info). Seems like it should be moot.

<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/2ebb022ebb02?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/2ebb022ebb02?v=0.6.4</a></div>
<div class='msg'><time>2025-03-28 08:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: s\_{bold c} is the preimage (s\_{regular c} is the hash) - It is defined in (9.4), and doesn&#x27;t rely on the preimage lookup function. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-28 08:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes it&#x27;s a moot point; I&#x27;m happy to take a PR which simplifies it, though I&#x27;m not sure if that&#x27;s necessarily easy.</div>
<div class='msg'><time>2025-03-28 13:34</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: I see it now, thanks!</div>
<div class='msg'><time>2025-03-28 14:15</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: <a href="https://github.com/gavofyork/graypaper/pull/313" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/313</a></div>
<div class='msg'><time>2025-03-30 08:21</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hi everyone,

I have a question regarding the <em>program metadata introduced in GP</em> 6.3.

If an extrinsic <code>E_P</code> includes a <code>pre_image</code> that do not conform to the expected encoding
<code>Epsilon(double_arrow Epsilon(a_m), a_c)</code>
(as specified here: <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/106c01107101?v=0.6.4):" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/106c01107101?v=0.6.4):</a>


Should we:
- <em>Consider the entire block invalid ?</em>
OR
- *Accept the block*, and allow the service lookup dictionaries to include these entries, with the understanding that invocations of <code>Psi_A, Psi_R, Psi_I, Psi_T</code> for the service of this pre_image would simply fail (by failing I mean that invocations panic thus don&#x27;t change state) ?
 <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-30 11:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: does not conform to the expected encoding of what? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-30 11:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The preimage is determined solely by data encoded as per the GP specification. </div>
<div class='msg'><time>2025-03-30 11:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Either it is requested or it is not. If it is not, then the block is invalid. There’s no room for guesswork here. </div>
<div class='msg'><time>2025-03-30 14:12</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Let me use an example to explain my question more clearly:

Suppose we receive an incoming block with some extrinsics, among which are <code>E_P</code> extrinsics (preimages). Let’s assume one of these preimages is for service <code>s</code> and is encoded as a <code>vertical-double-array p</code>. From the first byte, we determine the length of <code>p</code>, extract the corresponding bytes, and treat that as the preimage.

This preimage <code>p</code> is expected to represent an <code>Epsilon(double_arrow Epsilon(a_m), a_c)</code> structure (<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/106c01107101?v=0.6.4)." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/106c01107101?v=0.6.4).</a>

Now, say <code>p = [129, 2, 4, 5, 6]</code>. Interpreting this:

The metadata slice is supposed to be of length 129, starting right after the first byte.

But the total array doesn&#x27;t even contain 129 elements—so this is clearly an incorrectly encoded preimage.

My question is:
- Should we **reject the entire block** due to this malformed preimage? 
OR
- Should we **accept the block**, include the &quot;bad formed&quot; preimage in the lookup for service <code>s</code>, and simply let the <code>Psi_A</code> panic at execution time (and thus not updating anything) for this service <code>s</code> ?</div>
<div class='msg reply'><time>2025-03-30 14:13</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: The reason I ask is because the current codec test vectors for preimages (<a href="https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/codec/data/preimages_extrinsic.json)" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/codec/data/preimages_extrinsic.json)</a> don’t appear to cover a valid encoding that includes metadata.</div>
<div class='msg'><time>2025-03-30 14:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Preimage extrinsic (E_P) is a sequence of pairs (service index with blob).</div>
<div class='msg'><time>2025-03-30 14:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Implementations can determine it from the (encoded) block.</div>
<div class='msg'><time>2025-03-30 14:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Each other in the preimage extrinsic must be a valid request as per the prior state.</div>
<div class='msg'><time>2025-03-30 14:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: See (12.30) - (12.33) for formal definitions of this.</div>
<div class='msg'><time>2025-03-30 14:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If you are still confused, I suggest you rephrase your query in though terms.</div>
<div class='msg'><time>2025-03-30 14:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I&#x27;m not sure what you&#x27;re really asking, but if the question is &quot;if I receive a block which doesn&#x27;t correctly decode but from which I could make a best guess at imagining some underlying meaning, should I import it as though it was really an encoding of this best guess?&quot; then the answer is OF COURSE NOT! <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-30 14:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Again, this is a consensus protocol. There is no room for error or guesswork.</div>
<div class='msg'><time>2025-03-30 15:43</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: To be &quot;tougher&quot; - and concise:

These <code>preimage</code> test vectors (<a href="https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/codec/data/preimages_extrinsic.json)" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/codec/data/preimages_extrinsic.json)</a> don’t cover a valid encoding that includes metadata. They are 7 months old.

➡️ So if I understand correctly =&gt; **we shouldn’t try to test these <code>preimage</code> test-vectors with the current GP version and just wait for new test vectors for preimages to be published ?**</div>
<div class='msg'><time>2025-03-30 17:31</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: If I understand correctly, what you&#x27;re asking is: if a preimage is requested which will be used as the code blob for a service, must the preimage be a valid &quot;code blob&quot; for it to be includable in a block and integrated into the service storage? Pretty sure the answer to this is no: as long as a preimage has been requested then it can be included in a block. If a service requests a preimage that cannot be decoded or used as a code blob for whatever reason, then attempts to use it as such will fail at the point of use. I&#x27;m not sure it can really work any other way as there is no type/format/whatever associated with preimages in the state; they are opaque binary blobs.</div>
<div class='msg reply'><time>2025-03-30 17:41</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Thanks 🫶! That answers it pretty much

PS: by &quot;valid&quot; I meant only encoded-wise (<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/106c01107101?v=0.6.4)" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/106c01107101?v=0.6.4)</a>

Thanks for the help</div>
<div class='msg'><time>2025-03-30 18:25</time>&ensp;<span class='u' style='color:#b332c3'>rustybot</span>: &gt; &lt;@celadari:matrix.org&gt; To be &quot;tougher&quot; - and concise:
&gt; 
&gt; These <code>preimage</code> test vectors (<a href="https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/codec/data/preimages_extrinsic.json)" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/blob/polkajam-vectors/codec/data/preimages_extrinsic.json)</a> don’t cover a valid encoding that includes metadata. They are 7 months old.
&gt; 
&gt; ➡️ So if I understand correctly =&gt; **we shouldn’t try to test these <code>preimage</code> test-vectors with the current GP version and just wait for new test vectors for preimages to be published ?**

<a href="https://github.com/davxy/jam-test-vectors/tree/polkajam-vectors/codec#semantic-correctness" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/tree/polkajam-vectors/codec#semantic-correctness</a></div>
<div class='msg'><time>2025-03-30 18:26</time>&ensp;<span class='u' style='color:#b332c3'>rustybot</span>: Codec vectors only exercise the codec. Payload is mostly just random data <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-03-30 18:28</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: I agree but since we are talking about encoding I wasn&#x27;t sure to which extend we were supposed to verify or not.

But thanks anyway ✌️</div>
<div class='msg reply'><time>2025-03-30 18:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The Gray Paper is 100% clear on this.</div>
<div class='msg reply'><time>2025-03-30 18:30</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If there was a need to verify, then it would state as much in the Gray Paper. It doesn&#x27;t.</div>
<div class='msg'><time>2025-03-31 15:39</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Has anyone yet taken a serious look at if size-synchrony antagonism has been formalized mathematically? Would be nice to have further validation e.g. that what we’re doing is somewhat optimal </div>
<div class='msg'><time>2025-03-31 15:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There are some quite similar concepts in systems theory.</div>
<div class='msg'><time>2025-03-31 15:55</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: AI answer:
&gt; One relevant concept is &quot;complexity theory,&quot; which posits that as systems grow in size and complexity, the potential for disorder and misalignment among components increases. This can lead to difficulties in achieving coherence. Larger systems may have more diverse elements, which can result in varying goals, behaviors, and interactions that can disrupt overall coherence.
&gt; Another related idea is &quot;Ashby&#x27;s Law of Requisite Variety,&quot; which states that for a system to effectively manage its environment, it must be as diverse as the environment it operates in. In larger systems, the variety of components and interactions can lead to challenges in maintaining coherence unless there are effective mechanisms for integration and coordination.
</div>
<div class='msg'><time>2025-03-31 15:56</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: However the strict trilemma of Scale, Speed and Coherence doesn&#x27;t seem to be established. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-31 15:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It seems to me, at least, quite demonstrable given real systems have causality bound by speed and component-distances.</div>
<div class='msg'><time>2025-03-31 15:58</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: CAP comes to mind, sort of a cousin principle if you will</div>
<div class='msg'><time>2025-03-31 16:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Coherence -&gt; degree of causality across all pairwise pieces of system state
Speed -&gt; bound as the time that it would take light to effect a causal resolution across the two most distant causally entangled parts of state
Size -&gt; Given some maximal density of system state, the maximum distance between causally entangled state-components of the system <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-31 16:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It seems pretty trivial to show that If you increase any of these you must reduce one or both of the others.</div>
<div class='msg'><time>2025-03-31 16:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So if you make a system bigger (add more state components and therefore make things farther apart) you either need to accept causal resolution will be slower because at least some portions of state are farther apart (and light only travels at a certain speed) or you have to limit what parts are causally entangled, limiting distances travelled for resolution and thus reduce coherence. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-31 16:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: CAP is somehow related, but it&#x27;s binary (select any two). It also doesn&#x27;t deal with size of speed but only &quot;correctness&quot; properties. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-31 16:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But yes, is a related trilemma/antagonism applicable to (distributed) systems.</div>
<div class='msg'><time>2025-03-31 16:54</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@gav:polkadot.io&gt; So if you make a system bigger (add more state components and therefore make things farther apart) you either need to accept causal resolution will be slower or you have to limit what parts are causally entangled and thus reduce coherence.

distance = rate * time in some sense?</div>
<div class='msg'><time>2025-03-31 16:55</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Maybe that’s generalized too much</div>
<div class='msg'><time>2025-03-31 17:00</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Distance ~ size
Rate ~ speed
Time ~ coherence

So roughly size = speed*coherence <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-03-31 17:21</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: If a single global coherent state is the design goal (which it is) you can can play/design around different types of decoherence. Eg spatial decoherence (shards), temporal decoherence (ordered accumulation / asynchrony). You can allow for certain types of decoherence and still have a fully coherent global state sufficiently oftentimes to allow for the emergent abstraction of the Cloud layer. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 06:01</time>&ensp;<span class='u' style='color:#4772c5'>faiz_871</span>: Could somebody please explain the meaning of variable δ here in Refine invocation function PsiR <a href="https://graypaper.fluffylabs.dev/#/5f542d7/2d65002d0e01?v=0.6.2" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/5f542d7/2d65002d0e01?v=0.6.2</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 11:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: size = time_taken / coherence</div>
<div class='msg'><time>2025-04-01 11:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: or speed <em> size </em> coherence = 1</div>
<div class='msg'><time>2025-04-01 11:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: you can make a system go fast, go big, or stay fully coherent but not all of them.</div>
<div class='msg'><time>2025-04-01 11:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: decentralisation implies size, but not the other way around.</div>
<div class='msg'><time>2025-04-01 11:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: so, if you keep a system small (in order to keep it fast and coherent we might presume), you&#x27;ll not be able to decentralise nor will you be able to scale out. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 11:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: i&#x27;d argue that by introducing such decoherence you do not have a fully coherent state.</div>
<div class='msg'><time>2025-04-01 11:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: however there may be ways to make the system <em>apparently</em> coherent, or dynamically rebalance the speed and/or coherence in order to optimise all three at any given time. </div>
<div class='msg'><time>2025-04-01 11:35</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@gav:polkadot.io&gt; or speed <em> size </em> coherence = 1

Or size*coherence ~ speed, with more speed of info travel you can get bigger or more coherent, no?</div>
<div class='msg'><time>2025-04-01 11:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: sure.</div>
<div class='msg'><time>2025-04-01 11:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: but there&#x27;s two different speeds here</div>
<div class='msg'><time>2025-04-01 11:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: there&#x27;s the physical limit of speed (speed of light), and the overall speed of the system (one over time to causal resolution)</div>
<div class='msg'><time>2025-04-01 11:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: it probably isn&#x27;t sensible to call both things &quot;speed&quot;. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 11:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: the speed of light determines the upper limit of causal resolution - no system could ever process causal interactions faster than this. but it doesn&#x27;t account for keeping a complex and arbitrary system in coherence. as coherent systems become bigger and more complex, the speed of their overall causality diverges from this universal physical limit. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 11:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: at a basic level, as a coherent system grows, even if all of its internal causality happened at the speed of light, it would still take longer to step through its state transitions becuase it would take light longer to get from the corners of the system to interact and resolve.</div>
<div class='msg'><time>2025-04-01 11:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: so the system - in terms of state transitions per second - would be slower.</div>
<div class='msg'><time>2025-04-01 11:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: this is compounded by complexity, meaning that internal causal entanglements probably resolve slower as the system grows more complex and arbitrary.</div>
<div class='msg'><time>2025-04-01 11:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: light is not just going in a straight line.</div>
<div class='msg'><time>2025-04-01 11:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: of course our systems have a long way to go before the speed of light becomes too important. but still, the principle can serve us well now.</div>
<div class='msg'><time>2025-04-01 11:58</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: basically <code>T=ZX/C</code> where:

- <code>T</code> is time to causal resolution (s - this is the inverse of the system&#x27;s operating speed),
- <code>Z</code> is size of the system (m - the diameter of the system&#x27;s bounding sphere),
- <code>X</code> is complexity factor of the system (no units, but a factor of at least 1 which describes the number of times light must travel back across the diameter of the bounding sphere in order to guarantee a causal resolution of state-transition)
- <code>C</code> is speed of light <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 12:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: a totally trivial system would be a single laser switch in a vacuum with one light emitter transmitting a light signal to some light receiver. in this case Z would be the distance between the emitter and receiver, X would be close to one and T would therefore amount to the time it took light to travel between them.</div>
<div class='msg'><time>2025-04-01 12:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: this wouldn&#x27;t do any processing though. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 12:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: as we introduce the capability of data processing <code>X</code> increases since the round trip of light is much higher as it passes through more gates and it routed around; and as we introduce state (whether intra-transition or inter-transition) <code>Z</code> increases as we need to cover a greater space to hold more information (also a fundamental physical principle as well as intuitively correct). <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 12:27</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: That seems like a good model. as a cool aside maximum info scales with the surface area (not volume) of the bounding sphere, given by the bekenstein bound which black holes are believed to saturate  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-01 12:59</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: My team and I have put some thought into this. I’ll try to digest it into something presentable for our little Lisbon meetup. </div>
<div class='msg'><time>2025-04-01 14:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Ahh yeah the holographic principle iirc</div>
<div class='msg'><time>2025-04-01 18:07</time>&ensp;<span class='u' style='color:#5e86de'>boymaas</span>: Have we considered, as a thought experiment, <a href="https://en.wikipedia.org/wiki/Quantum_entanglement" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Quantum_entanglement</a> as a means to get instant coherence in distributed systems? Going beyond the speed of light ... 😃</div>
<div class='msg'><time>2025-04-01 18:09</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: &gt; &lt;@boymaas:matrix.org&gt; Have we considered, as a thought experiment, <a href="https://en.wikipedia.org/wiki/Quantum_entanglement" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Quantum_entanglement</a> as a means to get instant coherence in distributed systems? Going beyond the speed of light ... 😃

You can&#x27;t communicate any information faster than the speed of light; quantum entanglement doesn&#x27;t do that </div>
<div class='msg'><time>2025-04-01 18:13</time>&ensp;<span class='u' style='color:#5e86de'>boymaas</span>: Too bad, reading it now indeed, would have been an interesting case.</div>
<div class='msg'><time>2025-04-01 18:42</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: is sbrk here to stay? I noticed its being used in the accumulate testvectors.</div>
<div class='msg'><time>2025-04-02 08:24</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Is the <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/1d2d001d3100?v=0.6.4" target="_blank" rel="noopener">28 days that erasure coded chunks need to be held for</a> a minimum or a maximum? </div>
<div class='msg'><time>2025-04-02 08:26</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: minimum. you are not wrong if retained for one more day, but not the case otherwise</div>
<div class='msg'><time>2025-04-02 08:27</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: and I assume storing more data just costs you more?</div>
<div class='msg'><time>2025-04-02 08:27</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: yeah use more disk storage</div>
<div class='msg'><time>2025-04-04 13:02</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: hi there, please correct me if I&#x27;m wrong, a should be encoded right after c in (A.37) (Standard Program Initialization)

<a href="https://github.com/gavofyork/graypaper/pull/323/files#diff-16981432fb50e7e5c3d19d2f40b81e3a14b1c9986de5a179b392b47cd8018383R773" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/323/files#diff-16981432fb50e7e5c3d19d2f40b81e3a14b1c9986de5a179b392b47cd8018383R773</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-04 16:16</time>&ensp;<span class='u' style='color:#6141a6'>yuchun</span>: Hey there,

I have a question regarding the available work-reports 

The **W** available work-reports (defined in equation <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/144601144601?v=0.6.4" target="_blank" rel="noopener">(11.16)</a>) are extracted from <code>rhoDagger</code> using the core index. As I understand it, each core should correspond to only one work-report, is that correct?

However, I’m a bit confused about equation <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/195601195601?v=0.6.4" target="_blank" rel="noopener">(13.10)</a>. It sums the work-reports for a specific core from the set of available work-reports. Does this imply that the same core might appear multiple times in the available work-reports?

Please feel free to let me know if I’ve misunderstood anything.

Thanks
</div>
<div class='msg'><time>2025-04-04 18:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes and no. </div>
<div class='msg'><time>2025-04-04 18:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (In the case of 13.10, sum was simply to ensure that we get zero if the core is empty) </div>
<div class='msg'><time>2025-04-04 22:07</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: In memory accessibility notation, is there any specific reason to use both \subseteq and \subset ? Or is that a typo?
\subset makes more sense to me - some host functions (and sbrk inst) are using \subseteq while others use \subset.

<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/34a90234a902?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/34a90234a902?v=0.6.4</a>
<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/336b00336b00?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/336b00336b00?v=0.6.4</a></div>
<div class='msg'><time>2025-04-05 04:41</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@0xjunha:matrix.org&gt; In memory accessibility notation, is there any specific reason to use both \subseteq and \subset ? Or is that a typo?
&gt; \subset makes more sense to me - some host functions (and sbrk inst) are using \subseteq while others use \subset.
&gt; 
&gt; <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/34a90234a902?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/34a90234a902?v=0.6.4</a>
&gt; <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/336b00336b00?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/336b00336b00?v=0.6.4</a>

Typo. It should all be subseteq</div>
<div class='msg'><time>2025-04-07 04:55</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/09cf0109d301?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/09cf0109d301?v=0.6.4</a>
<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/09e70109e901?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/09e70109e901?v=0.6.4</a>
is the jam common era timestamp annotation wrong? 
1,735,689,600 (0000 UTC on January 1, 2025)
or
1,735,732,800 (1200 UTC on January 1, 2025)</div>
<div class='msg reply'><time>2025-04-07 11:38</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: Probably will be included in the next release?

<a href="https://github.com/gavofyork/graypaper/commit/b16207dc291d343991de2fdfb9aa3feb25927b50" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/commit/b16207dc291d343991de2fdfb9aa3feb25927b50</a></div>
<div class='msg reply'><time>2025-04-07 12:23</time>&ensp;<span class='u' style='color:#5adda3'>shwchg</span>: Thanks!</div>
<div class='msg'><time>2025-04-08 20:08</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I have a question: tecnically speaking is there something preventing the same service to be executed multiple times in the same block? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-08 20:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Not at all. </div>
<div class='msg'><time>2025-04-08 20:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And it can happen due to queuing and earlier work tranches but using all their allotted gas. </div>
<div class='msg'><time>2025-04-08 20:20</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: tkz</div>
<div class='msg'><time>2025-04-14 17:06</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Maybe I missed it but is there anything in the GP that mentions how to validate a justification received by CE 137?? I can generate one using the trace function but am not sure how a receiving node verifys the shard is correct using it.</div>
<div class='msg reply'><time>2025-04-14 17:12</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: In general the GP doesn&#x27;t say how to implement anything, it just defines the required behaviour. The justification is a Merkle proof and can be verified in the usual way. There are lots of blogposts explaining the concept that you can find by googling &quot;merkle proof&quot;</div>
<div class='msg reply'><time>2025-04-15 14:28</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Ok that helped I have the general idea now. One question to everyone, given each value in a justification how do you know if they represent a left or right node to be be able to calculate the right hash?</div>
<div class='msg reply'><time>2025-04-15 15:15</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You can determine the &quot;path&quot; (series of lefts/rights) from the shard index</div>
<div class='msg'><time>2025-04-15 15:13</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: I think some variant of this question has been asked but I didn&#x27;t see a clear answer.

Assuming I want to submit a ticket extrinsic that will be included in the first block of a new epoch. At that point I have the last state of the previous epoch.

1. Do I use eta\_1 from the old state for the ring signature context? Given this will become eta\_2 in the next epoch when the ticket will be verified.
2. What about the y\_z, I only have access to the old y\_z. I don&#x27;t see a way to compute the new one yet. Do I just sign with the old y\_z (and y_k) and hope it doesn&#x27;t change?
3. When importing this first block in the epoch, would I use the prior y\_z or new y\_z to verify tickets? <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/0f59000f5900?v=0.6.4" target="_blank" rel="noopener">6.29 seems to indicate the prior.</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-16 07:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: 1. Yes.
2. I think this is a typo (@davide - wdyt?) - it should read γ&#x27;z, not γz. I&#x27;ll change this.
3. You&#x27;ll need to compute it - you have all the information necessary from the prior state. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-16 07:55</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Thanks!</div>
<div class='msg'><time>2025-04-16 08:58</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@greywolve:matrix.org&gt; Thanks!

Yeah that is a typo</div>
<div class='msg'><time>2025-04-17 16:04</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I have a doubt about core statistics formula:

Formula 13.9 points to w (lowercased) - reports in guarantees extrinsic: <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/190d01190f01?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/190d01190f01?v=0.6.4</a>

Formula 13.10 points to W (uppercase) - available reports:
<a href="https://graypaper.fluffylabs.dev/#/68eaa1f/193e01193f01?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/193e01193f01?v=0.6.4</a>

Is this correct? If so, why is that? Also, in this context, it is very easy to incorrectly use W in the place of w, or vice-versa, since visually the difference is very subtle.</div>
<div class='msg'><time>2025-04-18 15:05</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Just to confirm my understanding- the PVM entry pc is NOT required to be the start of a basic block, correct? Jan Bujak </div>
<div class='msg'><time>2025-04-18 15:11</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Currently, yes (because we need the ability to resume execution after a page fault). <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-18 15:16</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: interesting point about resuming after a nested pvm page fault- thanks for clarifying. Aren&#x27;t the outer invocation entry pcs non-zero though? For example accumulate initial pc is 5 right? <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/2ec1002ec100?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/2ec1002ec100?v=0.6.4</a></div>
<div class='msg'><time>2025-04-18 15:17</time>&ensp;<span class='u' style='color:#4281bb'>jimboj21</span>: I would think the non-zero cases would have to be jumps right?</div>
<div class='msg'><time>2025-04-18 15:18</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Right, sorry, since it&#x27;s late here I had a brainfart there.</div>
<div class='msg'><time>2025-04-18 15:20</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: I suppose technically the outer PVM&#x27;s entry points could end up in the middle of a basic block if you&#x27;d build a particularly cursed blob.</div>
<div class='msg'><time>2025-04-18 15:21</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: No worries, thanks for clarifying. It sounds like it&#x27;s acceptable for an outer entrypoint to be into the middle of a basic block. My apologies for @ing after hours.</div>
<div class='msg'><time>2025-04-18 15:23</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: I have considered disallowing such entry points in the past (basically allow only start-of-basic-block entry points and those needed for hostcall + page fault resumption), but we haven&#x27;t made such change to the GP yet.</div>
<div class='msg'><time>2025-04-18 15:23</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: cursed blob/ an intentional attempt to break consensus 😉</div>
<div class='msg'><time>2025-04-18 15:24</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: That&#x27;s how I approached in my reasoning as well, do you think this change is likely? No worries if its too early to tell- just curious. Might end up tabling this in my impl. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-18 15:30</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Can&#x27;t give you a 100% answer at this point, but it is possible. In general the plan for the final gas cost model is to charge gas only at the beginning of the basic blocks (because charging per instruction is very inefficient), so now if you allow entry points anywhere this potentially complicates the gas metering implementation. Unfortunately disallowing them doesn&#x27;t necessarily alleviate the problem because you still need to allow entry after page faults, and since memory accesses are so common we don&#x27;t want to make memory access instructions into basic block terminators.</div>
<div class='msg'><time>2025-04-18 15:35</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Thanks for clarifying, this is really helpful. I don&#x27;t have enough context yet to form an opinion on the tradeoffs between allowing inner-instances being able to resume right after pageFault vs requiring them to restart/rollback to the start of a basic block. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-18 15:37</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Although we <em>need</em> some limitation when it comes to entry points, because without any restrictions you could e.g. jump into the middle of an instruction, and depending on the particular bytes used that might actually be a valid instruction. Supporting this in practice would be a nightmare in any other implementation that isn&#x27;t a naive slow interpreter, so at very least jumping in the middle of instructions is something that we definitely do <em>not</em> want to support.</div>
<div class='msg'><time>2025-04-18 15:38</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: *context as far as the programs/usage of programs on top of JAM <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-18 15:39</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Unfortunately it&#x27;s impossible to require a restart at the start of a basic block as that&#x27;d screw up the program state.</div>
<div class='msg'><time>2025-04-18 15:39</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The already executed part of the basic block might have modified memory or registers in a way that is irreversible.</div>
<div class='msg'><time>2025-04-18 15:40</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: So a rollback is not possible without taking a snapshot at the start of every basic block which might page fault, and we do not want that as it&#x27;d be abysmally slow.</div>
<div class='msg'><time>2025-04-18 15:40</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: the outer pvm instance would have access to gas host function and could potentially use its own memory as a backup before any unsafe calls right? Although, this gets way complicated fast</div>
<div class='msg'><time>2025-04-18 15:41</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: lol we were thinking the same, yep- agreed <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-18 15:42</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: But at the least, the outer pvm could do gas check to determine if it wants to &#x27;risk&#x27; another inner invocation right? Although being turing complete makes this pretty hard- unless there&#x27;s some well-defined gas-estimate API contract between nested invocations</div>
<div class='msg'><time>2025-04-18 15:43</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: That&#x27;s infeasible; if you could do that you&#x27;d become a very rich person as then it&#x27;d mean you solved the halting problem. :P</div>
<div class='msg'><time>2025-04-18 15:44</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: good point lol, suppose that api idea would be practically useless due to such a small scope of applicability... </div>
<div class='msg'><time>2025-04-18 15:46</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: This discussion has provided a lot of clarity, and given me a few things to think about... Many thanks for your time Jan Bujak  🙏</div>
<div class='msg'><time>2025-04-18 17:05</time>&ensp;<span class='u' style='color:#4281bb'>jimboj21</span>: image.png</div>
<div class='msg'><time>2025-04-18 17:06</time>&ensp;<span class='u' style='color:#4281bb'>jimboj21</span>: image.png</div>
<div class='msg'><time>2025-04-18 17:07</time>&ensp;<span class='u' style='color:#4281bb'>jimboj21</span>: Given the return signature: When 12.17 is called shouldnt the assignment order be o*, t*, b*, u* ?</div>
<div class='msg'><time>2025-04-19 16:18</time>&ensp;<span class='u' style='color:#817ecb'>ycc3741</span>: I just want to confirm something about STF.
Should the dispute when updating ψ′ happen before safrole?
Because based on what I see in this <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/0ea2000ea200?v=0.6.4" target="_blank" rel="noopener">link</a>,
updating gamma_k&#x27; requires ψ′_o.</div>
<div class='msg'><time>2025-04-19 17:23</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@jimboj21:matrix.org&gt; Given the return signature: When 12.17 is called shouldnt the assignment order be o*, t*, b*, u* ?

Yes. I think this is already fixed in main. </div>
<div class='msg'><time>2025-04-19 17:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes pretty much. Order is technically an implementation detail - some languages don’t have the concept of ordering - so I’m not going to tell you any order per se, but your reading is correct - key rotation is dependent on disputes. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-20 14:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes your reading is correct. It is in order to get as much information as possible in statistics, not just reported stuff (which represents the most recent computation work done on cores by guarantors) but also what data - required by each core - has recently been made available through assurers</div>
<div class='msg'><time>2025-04-21 21:25</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I think the GP is not clear on how to serialize elements of N? And therefore, e.g. state serialization (D.2) is not clear on how to serialize the validator statistics component C, which has components in N</div>
<div class='msg reply'><time>2025-04-21 21:47</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: N you mean integers? </div>
<div class='msg reply'><time>2025-04-21 21:49</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Formula C.6 is how you serialize numbers in N</div>
<div class='msg'><time>2025-04-21 21:47</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: 
 bold N , naturals</div>
<div class='msg'><time>2025-04-21 21:53</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Makes sense, wanted to make sure we’re intentionally using the general natural serialization here instead of accidentally not specifying the subscript. Since usually we only use the general one for the length discriminator </div>
<div class='msg'><time>2025-04-21 21:55</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: It’s just not very consistent. Also in C(13) we are clear to use E_4 for pi_V and pi_L which have components in bold N </div>
<div class='msg'><time>2025-04-21 21:55</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: &gt; &lt;@ascriv:matrix.org&gt; Makes sense, wanted to make sure we’re intentionally using the general natural serialization here instead of accidentally not specifying the subscript. Since usually we only use the general one for the length discriminator 

Yes. It is used for the first time in latest version of GP</div>
<div class='msg'><time>2025-04-21 21:56</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: It is used to save storage space, as statistics number can grow indefinetly (or not). <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-21 21:58</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: But couldn’t pi_V and _L also? Yet we implicitly limit them based on the usage of E_4 serializing them</div>
<div class='msg'><time>2025-04-22 11:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The lack of subscript is intentional.</div>
<div class='msg'><time>2025-04-22 11:25</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, the encoding of integers is not presently entirely uniform. Some are encoded for size savings (statistics, where there&#x27;s relatively a lot of data in a place where bandwidth is very tight), others for the ability to swiftly/efficiently decode (e.g. in PVM I/O). It will be reviewed during the 0.6 series under this issue <a href="https://github.com/gavofyork/graypaper/issues/293." target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/293.</a></div>
<div class='msg'><time>2025-04-22 11:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The encoding used for pi\_V and pi\_L might yet be changed, or possibly pi\_C/pi\_S. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-22 11:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Again, the above issue will resolve this.</div>
<div class='msg'><time>2025-04-22 11:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: GP <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.5" target="_blank" rel="noopener">v0.6.5</a> is out.</div>
<div class='msg'><time>2025-04-22 11:29</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;s mostly corrections, with two small protocol alterations:
- There&#x27;s now a gas limit in the accumulation operand tuple.
- There&#x27;s a new host-call to allow services to provide preimages to other services directly without going through the regular off-chain preimage process.</div>
<div class='msg'><time>2025-04-22 12:34</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Got a few small questions about PVM edge cases, to confirm my understanding-&gt;

1. If c\[0\] isn&#x27;t a valid opcode, this would result in a panic, _if and only if_ the program attempts to execute c\[0\], correct?
2. If an instruction (this time corresponding to an index from the bitmask, k) contains an invalid opcode, this would result in a panic, _if and only if_ the program attempts to execute it, correct?
3. if the skip length function doesn&#x27;t find any bitmask-marked opcodes within the subsequent 24 octets, this bumps the pc to current+24. So if there happened to be a valid opcode &amp; args at that new pc, it would continue executing at the new pc in the same manner as if it were marked by the instruction bitmask, correct?

Jan Bujak <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-22 13:00</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Yes, currently &quot;invalid&quot; instructions don&#x27;t make the program invalid, and only have an effect if executed (they&#x27;re effectively treated as a trap). Yes, if there&#x27;s no <code>1</code> found in the bitmask then the skip is assumed to be 24. Note that IIRC currently even if the next instruction has <code>0</code> in its opcode bitmask bit (i.e. the next bit after the last bit that the bitmask scan checks) the instruction will also be executed, but this is not intended behavior and is on my TODO list to add to the GP that every instruction must have a <code>1</code> in the bitmask to be considered valid (otherwise we&#x27;ll run into some nasty corner cases). <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-22 13:04</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Many thanks for the quick response 🙏, your insight on the TODO is much appreciated. enjoy your evening.</div>
<div class='msg'><time>2025-04-22 13:08</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Also, while we&#x27;re at the topic parsing, (this is going to be relevant to people aiming for M3 and M4) in case you&#x27;re wondering why the limit is 24 - it was deliberately picked to allow for fast parsing. To parse a PVM instruction at a given position you need to read only two values from memory: a 128-bit integer from the instructions slice, and a 32-bit integer from the bitmask slice, and then you can easily parse it in an efficient manner with bitshifts etc. (for the bitmask one can use the &quot;leading zeros&quot; intrinsic/method which is a single assembly instruction on modern CPUs to cheaply get the skip to get to the next instruction, hence the maximum is 24)</div>
<div class='msg'><time>2025-04-22 13:10</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: corner case of the corner case might be a  &#x27;greater than 24 octet&#x27; break in instructions after a valid basic block termination instruction-&gt; (ie is the subsequent &#x27;valid&#x27; instruction also a &#x27;valid&#x27; jump target, or is the jump target the &#x27;invalid&#x27; 24th octet)

edit: &#x27;program termination&#x27; -&gt; &#x27;basic block&#x27; (brain fart) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-22 13:12</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: IIRC the jumps actually check that the previous instruction has the <code>1</code> set in its bitmask (because you can only jump either to offset=0 or after block terminators)</div>
<div class='msg'><time>2025-04-22 13:14</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: So with the current way things are you might get a paradoxical block terminator that would execute when you arrive at it from the previous instruction, but the next instruction wouldn&#x27;t be a valid target for a jump. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-22 13:14</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: (again, I want to require all instructions to have 1 set in its bitmask to prevent such potential corner cases)</div>
<div class='msg'><time>2025-04-22 13:20</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: jumps target indexes in w (basic block index set), which is calculated by applying the skip-length function to each opcode index in the k bitmask\*-&gt; so this would result in a jump target of the 24th octet (our &#x27;invalid&#x27; instruction).

edit: *additionally, k always includes offset=0 (c[0]) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-22 13:30</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: actually, looks like both branch &amp; jump use the &#x27;beginning of basic blocks&#x27; collection, <em>w</em> (which itself uses the skip-length).</div>
<div class='msg'><time>2025-04-22 13:37</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Didn&#x27;t intend for this chat to continue into your off-hours, my apologies. Don&#x27;t worry about looking at this tonight especially given its a non-urgent corner case.</div>
<div class='msg'><time>2025-04-22 14:32</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: Here: <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/1bcb011b1702?v=0.6.4" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/1bcb011b1702?v=0.6.4</a>

In Eqn 14.14 and 14.15 we are using s (now b) which is defined as all the segments exported by all work packages, 
and then we are calculating it&#x27;s merkle root and comparing with segment root of some previously exported segments of any work package. 

Is this what it implies? As segments exported from a work package leads to different segment roots, then in that case how can it be same as segment root of all the segments (from all wps)? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-23 16:45</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: David Emett: Can you please clarify on this?</div>
<div class='msg reply'><time>2025-04-23 16:50</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: In S and J, M(s) = L(r) means s is the sequence of segments with the specified root</div>
<div class='msg reply'><time>2025-04-23 16:53</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: but it is specified as all the segments exported by all the work packages exporting a segment. is this right? or this?

&gt; s is the sequence of segments with the specified root

</div>
<div class='msg reply'><time>2025-04-23 16:53</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not sure where you&#x27;re getting that from?</div>
<div class='msg reply'><time>2025-04-23 16:54</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: according to 0.6.5:
</div>
<div class='msg reply'><time>2025-04-23 16:54</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: image.png</div>
<div class='msg reply'><time>2025-04-23 16:54</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: <pre><code class=''>Note that while S and J are both formulated using the
inner term b (all segments exported by all work-packages
exporting a segment to be imported)
</code></pre>
 </div>
<div class='msg reply'><time>2025-04-23 16:59</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Hmm not sure about the wording of that sentence. The point there is that if a work-package A is importing a single segment exported by work-package B, you do not need to fetch _all_ of the segments exported by B</div>
<div class='msg reply'><time>2025-04-23 17:00</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You only need to fetch the segment you care about, plus the corresponding proof segment</div>
<div class='msg reply'><time>2025-04-23 17:00</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: got it. thanks for the clarification. Though I am still not sure about the wordings.</div>
<div class='msg reply'><time>2025-04-23 17:01</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Yeah I think that wording could be improved</div>
<div class='msg reply'><time>2025-04-23 19:42</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: For CE140 justification: j++[b]++T(s,i,H), what exactly does the s in T(s, i, H) denote? Is it really the raw exported segment shards for the entire workpakge at given shard index? Without hashing the s term, the co-path in T(s, i, H) would grow linearly as the number of exports increases &amp; each DA would need to store its sibling&#x27;s entire &quot;raw exported segment shards&quot; as part of the co-path proof? </div>
<div class='msg reply'><time>2025-04-23 19:44</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: Let&#x27;s say there are 100 exported segments for a given workpackage, can you provide an estimated justification size for requesting just one segment?  I&#x27;m estimating the justification to be somewhere around  66~410435 byte in tiny setting(where validator=6, W_P=1026) and around 297~3866 bytes in full setting(where validator=1023, W_P=6). Does my estimate look reasonable to you?</div>
<div class='msg reply'><time>2025-04-23 20:33</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: &quot;s is the full sequence of segment shards with the given shard index.&quot;</div>
<div class='msg reply'><time>2025-04-23 20:33</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: The CE140 justification basically allows you to first calculate the segment root for a given segment index, which is then used to validate the erasure root <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-23 22:02</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: That&#x27;s for the recepient/consumer of a CE140 justification. But the burden of producing such proof seems to fall on DA?

if you were the &quot;generator&quot; of  CE140 justification(i.e someone requested the justification from you), wouldn&#x27;t you also need to fetch the raw &quot;s&quot; from your sibling&#x27;s just to provide a co-path to the segment shard that you are responsible to store?</div>
<div class='msg reply'><time>2025-04-23 22:03</time>&ensp;<span class='u' style='color:#c377dd'>mkchung</span>: I think I&#x27;m confused as why &quot;S&quot; not being hashed before building the segments root</div>
<div class='msg reply'><time>2025-04-24 16:52</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: No you only need to know what was returned from CE137 originally. You are providing a path to a root for a list of shards with an index, not for all shards of a given segment. Refer back to s\_clubs in your availability specifier. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-28 15:46</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Sorry, missed these messages earlier. s is the full sequence of segments shards with the given shard index yes. These are all provided in CE 137 (the <code>[Segment Shard]</code>), you should not need to request data from another node to handle a CE 140 request. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-28 15:47</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: FWIW the segments root is _not_ involved here, the justifications returned by CE 140 are justifications from the returned segment shards to the erasure root</div>
<div class='msg reply'><time>2025-04-28 15:52</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: As Jason says look at s_clubs</div>
<div class='msg reply'><time>2025-04-28 15:53</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I&#x27;ve opened a PR to (hopefully) improve the wording: <a href="https://github.com/gavofyork/graypaper/pull/345" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/345</a></div>
<div class='msg reply'><time>2025-05-09 10:35</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: Hi David Emett ,

Sorry to disturb you again.

<a href="https://graypaper.fluffylabs.dev/#/9a08063/1b33021b3c02?v=0.6.6" target="_blank" rel="noopener">Here</a>, in S function we are fetching all the segments whose root / wp hash is present in imports. Is this function returning segments grouped based on segment root or just simply list of segment?

Coz, current definition implies its just list of segments, however in Refine Invocation, we are passing list of list of segments <a href="https://graypaper.fluffylabs.dev/#/9a08063/2e5f012e6401?v=0.6.6" target="_blank" rel="noopener">here</a>.

if the latter is true, then, I think in eqn itself there must be change for more clarity.

Please correct me if I understand this wrong.</div>
<div class='msg reply'><time>2025-05-09 11:09</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Bold b is the complete list of segments with the given root, or exported by the work-package with the given hash</div>
<div class='msg reply'><time>2025-05-09 11:09</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: This is what the M(b) = L(r) bit means</div>
<div class='msg reply'><time>2025-05-09 11:32</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: that i got, but after that we are picking nth segment from b and building a list. but in psi R list of list of segment is expected. </div>
<div class='msg reply'><time>2025-05-09 12:05</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Ah I see what you mean now, sorry. The refine call for each work item has access to the imports for _all_ work items. So the list-of-list-of-segments is [S(w) for w in p_w]</div>
<div class='msg reply'><time>2025-05-09 12:06</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I believe there is an error in the definition of I(p,j); this says S(w) is passed in rather than the above</div>
<div class='msg reply'><time>2025-05-09 12:07</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: yes </div>
<div class='msg reply'><time>2025-05-09 12:07</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: that&#x27;s confusing</div>
<div class='msg reply'><time>2025-05-09 12:09</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I&#x27;ll push a PR to the GP repo to address this</div>
<div class='msg reply'><time>2025-05-09 12:16</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: Raised <a href="https://github.com/gavofyork/graypaper/issues/377" target="_blank" rel="noopener">Issue #377</a>.</div>
<div class='msg reply'><time>2025-05-09 12:26</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Thanks for reporting, I&#x27;ve pushed a fix here <a href="https://github.com/gavofyork/graypaper/pull/378" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/378</a></div>
<div class='msg'><time>2025-04-22 18:33</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: We have found our development life has improved with the &quot;metadata&quot; attached to preimages, specifically when the preimage is for service code, because we can then have tools show that metadata as strings like &quot;fib&quot; and &quot;gameoflife&quot;.   Can we get the same for workpackages+bundles so that we can attach metadata like &quot;fib(93)&quot;, &quot;gameoflife(314)&quot;, or should that be in the payload as a mere convention?</div>
<div class='msg'><time>2025-04-22 19:56</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Another quick request: Would you mind assigning <code>provide</code> a number like 17 or 27, and perhaps starting historical\_lookup at 32 or 64 or 128? That would leave a bit of space between the two big groups of host functions for &quot;one more&quot;.
 <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-24 03:47</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Found it here -sorry
<a href="https://graypaper.fluffylabs.dev/#/cc517d7/17b00217b002?v=0.6.5" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/cc517d7/17b00217b002?v=0.6.5</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-23 13:24</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Jan Bujak:  I found this very helpful post of yours in a thread from last September. Do you think holding off on implementing sbrk is still relevant advice? Do you have any new thoughts since this message was posted that you can share?</div>
<div class='msg reply'><time>2025-04-23 13:27</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: reposting below for context::

<a href="https://matrix.to/#/!ddsEwXlCWnreEGuqXZ:polkadot.io/$\_RkIlMDNZrROw\_6WDXpbllO2VSbjY1FNTIfDjVZhhdw?via=polkadot.io&amp;via=matrix.org&amp;via=parity.io" target="_blank" rel="noopener">https://matrix.to/#/!ddsEwXlCWnreEGuqXZ:polkadot.io/$\_RkIlMDNZrROw\_6WDXpbllO2VSbjY1FNTIfDjVZhhdw?via=polkadot.io&amp;via=matrix.org&amp;via=parity.io</a>

Memory allocation/deallocation handling is still a work-in-progress, and it&#x27;s possible the sbrk instruction will get modified and/or removed. I&#x27;d suggest you temporarily skip it and focus on other parts of JAM and/or PVM.

If you&#x27;re interested in some history as to why sbrk is there then let me give you some background.

Historically I designed PolkaVM (on which PVM in the GP is based on) to be a VM which is as &quot;powerful&quot; as WASM VMs (so it can completely replace our current WASM-based executor in Polkadot 1.0 and our WASM-based smart contracts VM) while being as simple as possible to implement, and without sacrificing any performance.
So this is where the idea for the sbrk came from (which is similar to what WASM has): the VM maintains a heap pointer, and the guest program can use sbrk to query that pointer and/or to bump it up. And every time it crosses a page boundary the VM allocates new memory for the program.

So this design has numerous benefits. First, it&#x27;s very simple to use as a guest program (pseudo code):

<pre><code class=''>// Get a pointer to the new allocation.
let pointer = sbrk(0);
// Actually allocate it.
if sbrk(size) != 0 {
    // Allocation succeeded.
    // Now `pointer` points to `size` bytes you can use.
}
</code></pre>

This is also great for use cases like e.g. tiny smart contracts which can use this as directly as an allocator without having to bring a heavyweight allocator of their own (which would consume a lot of space).

Secondly, it&#x27;s simple to implement in the VM, something like that (pseudo code again):

<pre><code class=''>fn sbrk(size) -&gt; Pointer {
    if size == 0 {
        // The guest wants to know the current heap pointer.
        return current_heap_pointer;
    }

    // The guest wants to allocate.
    let new_heap_pointer = current_heap_pointer + size;
    if new_heap_pointer &gt; max_heap_pointer {
        // Allocation failed.
        return 0;
    }


    let next_page_boundary = align_to_page_size(current_heap_pointer);
    if new_heap_pointer &gt; next_page_boundary {
        allocate_new_pages(next_page_boundary..align_to_page_size(new_heap_pointer));
    }

    current_heap_pointer += size;
    return current_heap_pointer;
</code></pre>

And this (along with the memory map I came up with, which is what we now call &quot;standard program initialization&quot;) also makes in very easy to write an interpreter for this, because when handling loads/stores from memory you only have to do something like this:

<pre><code class=''>fn load_value32(address) -&gt; value {
    if address &gt;= stack_address &amp;&amp; address + 4 &lt;= stack_address_end {
        return stack[address - stack_address];
    } else if address &gt;= rw_data_address &amp;&amp; address + 4 &lt;= align_to_page_size(current_heap_pointer) {
        return rw_data[address - stack_address];
    } else if address &gt;= ro_data_address &amp;&amp; address + 4 &lt;= ro_data_address_end {
        return ro_data[address - stack_address];
    } else {
        // Address is inaccessible.
        return Err;
    }
}
</code></pre>

It&#x27;s cheap, fast, and doesn&#x27;t require any crazy data structures and doesn&#x27;t require any handling of corner cases (for example, accesses which could read both from the stack and from RW data don&#x27;t have to be handled, because they&#x27;re impossible by definition; the interpreter can just keep them in separate arrays, and call it a day).

So that&#x27;s how (any why) it was originally designed, but then came JAM and changed things. (: (Again, remember, I started working on this before JAM, and some things were just grandfathered into JAM.)

What JAM introduces is a concept of inner VMs (see machine, peek, poke, invoke and expunge host functions in section B.8 of the GP) where one VM can spawn another VM, and as it is currently designed those inner VMs are extremely flexible and have completely free-form memories and are dynamically paged.
What this essentially means is that all of those nice properties of sbrk that I&#x27;ve listed - simple and easy to implement, fast, doesn&#x27;t require fancy data structures - they all now go out of the window!

So we will probably be replacing sbrk with something else that&#x27;s more appropriate for the more flexible inner VM model. And unfortunately also most likely orders of magnitude harder to implement (at least if you want to reach at least the half-speed milestone), but it is what it is. I&#x27;m still finishing some other stuff up, but I&#x27;ll most likely be working on this soon-ish. (If any of you have any good and/or crazy ideas feel free to message me!) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-23 15:22</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: Hello,
I have a question regarding the eject host function, specifically about the condition described here: <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/328e03329103?v=0.6.4." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/68eaa1f/328e03329103?v=0.6.4.</a>
I want to confirm my understanding:
Does it mean that in order for a caller s to successfully eject account d, the codeHash of account d must be equal to the (hash) service index of the caller s ?
Thanks in advance for the clarification!
 <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-23 15:23</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: To be more precise:
</div>
<div class='msg reply'><time>2025-04-23 15:23</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: image.png</div>
<div class='msg reply'><time>2025-04-24 13:47</time>&ensp;<span class='u' style='color:#4a49d8'>haikoschol</span>: sourabhniyogi: was that reaction a &quot;yes&quot; or a &quot;i&#x27;m wondering about that too&quot; or a &quot;yay, equations!!1!&quot;? 🤔 </div>
<div class='msg reply'><time>2025-04-24 15:12</time>&ensp;<span class='u' style='color:#4a49d8'>haikoschol</span>: KwickBit - Charles-Edouard LADARI: it&#x27;s not the hash though, it&#x27;s the (32 octet) encoding of the service index, right?</div>
<div class='msg reply'><time>2025-04-24 15:14</time>&ensp;<span class='u' style='color:#db4dca'>celadari</span>: By 32 octet i meaning we add 0s before the last 4 octets of the service index ? 🤔</div>
<div class='msg reply'><time>2025-04-24 15:44</time>&ensp;<span class='u' style='color:#4a49d8'>haikoschol</span>: i think so</div>
<div class='msg reply'><time>2025-04-24 15:45</time>&ensp;<span class='u' style='color:#4a49d8'>haikoschol</span>: it won&#x27;t incidentally turn out to be the hash of some code, so the code hash field needs to have been set with <code>upgrade</code> to this value before i reckon</div>
<div class='msg'><time>2025-04-23 18:58</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Hello. Two questions about availability assurances.

1. Should these be sent out every slot even if the bitfield didn’t change from the previous distribution?
2. For an assurer to say a core is available in their assurance bitfield, does that mean they have access to just the shards matching their validator index, or are they saying they have access to ALL shards for a given core? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-23 19:02</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: 1. Yes, its critical that they are since assurances are anchored to the immediate parent header hash. The only exception is if the entire bitfield is zero, in which case I don&#x27;t believe there is a point to submitting an assurance unless some reward exists for liveness when all cores are idle (which would be sad ... but possible!)
2. Just their shards matching their validator index.  If they had access to ALL the shards, that would be too much in the large!  But of course they can do whatever they want, and they might be one of the guarantors. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-23 19:04</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Hi, question about the accumulate <code>transfer = 11</code> function.

When Service A sends an amount X to Service B, a deferred transfer (i.e. <code>s: A, d: B, a: X, m: ..., g: ...</code>) is created and the amount to be sent <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/325702325b02?v=0.6.4" target="_blank" rel="noopener">is substracted</a> from the Service&#x27;s A balance.

But I cannot find in the GP where it says to update the balance of the receiver (service B).

I thought that it was done when <a href="https://graypaper.fluffylabs.dev/#/68eaa1f/17a00417a004?v=0.6.4" target="_blank" rel="noopener">all the deferred effects of the transfers are applied</a>, but the <code>on_transfer</code> functions only modify the subject&#x27;s account storage. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-23 19:21</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: <a href="https://graypaper.fluffylabs.dev/#/cc517d7/2fe2002fe200?v=0.6.5" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/cc517d7/2fe2002fe200?v=0.6.5</a></div>
<div class='msg reply'><time>2025-04-23 19:28</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: Thanks! ☺️ </div>
<div class='msg'><time>2025-04-24 04:40</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: We are going to remove the sbrk instruction and replace it with a hostcall soon.</div>
<div class='msg'><time>2025-04-24 17:28</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: How is the serialization of the storage dictionary (a_s) of a service account in (D.2) not lossy? The key (I thought) is not the hash of the value unlike the preimage lookup. I’m definitely missing something or we are losing the last 4 bytes of the keys <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-24 17:53</time>&ensp;<span class='u' style='color:#cb735c'>prasad-kumkar</span>: I think the point is we don’t need to store the full a_s keys, they’re only used to look up values when the key is already known</div>
<div class='msg reply'><time>2025-04-24 18:43</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: keys are hash, a collision is very unlikely</div>
<div class='msg'><time>2025-04-24 18:30</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: hello all, I&#x27;ve created hosted archives of the JAM and graypaper chats with plaintext versions also available at <a href="https://paritytech.github.io/matrix-archiver/" target="_blank" rel="noopener">https://paritytech.github.io/matrix-archiver/</a>

there are a few quality of life improvements still to be done but any feedback or comments are welcome if you find this useful. This is also now linked on the jamcha.in site.

These are updated daily at ~3am UTC.
Other JAM-related channels are welcome to be archived - they need to be unencrypted and world-readable (history available to &quot;Anyone&quot;). Please open an issue <a href="https://github.com/paritytech/matrix-archiver" target="_blank" rel="noopener">here</a> with the internal room ID if you wish to archive a channel. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-24 18:41</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@prasad-kumkar:matrix.org&gt; I think the point is we don’t need to store the full a_s keys, they’re only used to look up values when the key is already known

I don’t completely follow, should we just be comparing first 28 bytes when doing lookups? What about when two keys only differ in the last 4 bytes?</div>
<div class='msg'><time>2025-04-24 18:46</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: erin: would you consider adding <code>&amp;lt;a name=&amp;quot;{element-msg-id}&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;</code> to the <code>&amp;lt;time&amp;gt;</code> in html mode? That would allow linking to a specific message, which I think would be pretty cool. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-24 18:46</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: yeah, that&#x27;s one of the QoL features in the pipeline :)</div>
<div class='msg reply'><time>2025-04-24 18:47</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: others may include &quot;jump to bottom&quot; and perhaps pagination, though i kinda like the big raw log style (feedback again welcome here).</div>
<div class='msg reply'><time>2025-04-24 18:54</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: afaict it&#x27;s 220kB gzipped for 1y+ worth of content. My guess is that adding JS pagination to this with a modern framework would start to pay off only after 2 more years :D <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-24 18:55</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: i&#x27;ll worry about it later then 😂</div>
<div class='msg reply'><time>2025-04-24 18:55</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: it&#x27;s just static html generated by a python script at the moment</div>
<div class='msg reply'><time>2025-04-25 12:21</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: tomusdrw: the timestamps are now links to the messages</div>
<div class='msg reply'><time>2025-04-25 13:49</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Cool  if we had discord rooms with content, should we put them in this repo so its not a matrix-archiver but a gp-archive?</div>
<div class='msg reply'><time>2025-04-25 16:04</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: there should be an automated script to grab the content daily unless they&#x27;re dead/archived channels. the script/rendering right now is very matrix-specific. it would be best to have a matrix bridge or something regardless</div>
<div class='msg'><time>2025-04-24 18:54</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@dakkk:matrix.org&gt; keys are hash, a collision is very unlikely

So state serialization being lossless isn’t important, it just needs to be extremely unlikely to collide </div>
<div class='msg'><time>2025-04-25 13:02</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Hi I have a timing question. Segments are kept in the DA for 28 day, but it seems SegmentRootLookupItem&#x27;s in work package bundles must be recent (exist in beta or extrinsic). Does that mean we store segments for 28 days, but they can only be used as import segments for 8 days? </div>
<div class='msg'><time>2025-04-25 13:03</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The segment root lookup stuff is for when you import using a work-package hash</div>
<div class='msg'><time>2025-04-25 13:03</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: This is only supported for recent work-packages, for older packages you should use the segment-root directly</div>
<div class='msg'><time>2025-04-25 13:08</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: Thank you. Didn&#x27;t realize an ImportSpec could be a export root OR a work package hash.</div>
<div class='msg'><time>2025-04-25 16:02</time>&ensp;<span class='u' style='color:#5dd07c'>knight1205</span>: Does anyone know how is shard index determined from validator index? Like which particular validator requests for which particular shard index as in CE 137?

Here in <a href="https://graypaper.fluffylabs.dev/#/cc517d7/1c32011c3801?v=0.6.5" target="_blank" rel="noopener">GP</a>: 
 It is just mentioned that 
&gt;chunks are distributed to each validator whose keys are together with similarly corresponding chunks for imported, extrinsic and exported segments data, such that
&gt; each validator can justify completeness according to the
&gt; work-report’s erasure-root.


I am not sure what it is trying to imply.</div>
<div class='msg reply'><time>2025-04-25 16:13</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: See my reply in the &quot;Let&#x27;s JAM&quot; channel.</div>
<div class='msg'><time>2025-04-26 17:40</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: For the function definition (D.4), it seems like k could  have (much) fewer than 248 bits, e.g. in the case where there are many elements of the preimage lookup for any service account. Since in this case the keys for all of these in the serialized state will have the same first 8 bytes, so by the time we are computing the leaf value for one of these keys we will have cleaved off at least 64 bits, leaving fewer than 192 bits for k, if I understand correctly  </div>
<div class='msg'><time>2025-04-26 17:40</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Should we be padding with zeroes in such cases to compute bits(k)…248?</div>
<div class='msg'><time>2025-04-26 17:47</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Ah, nevermind. This is why we also have the key in the rhs of the map, so we remember the original non-cleaved key</div>
<div class='msg'><time>2025-04-28 07:58</time>&ensp;<span class='u' style='color:#ad33c0'>kianenigma</span>: I noticed from (latex) comments in <a href="https://github.com/gavofyork/graypaper/pull/285" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/285</a> that the encoding of the new statistics state components vary between u16, u32, and u64. Yet, in the state serialization section, they are not covered: <a href="https://graypaper.fluffylabs.dev/#/cc517d7/39dd0139e901?v=0.6.5" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/cc517d7/39dd0139e901?v=0.6.5</a> 

Is this something that is not finalized yet, or are they mentioned in another section and I am missing it? 

For example, I could guess that gas always serialized as u64 but didn&#x27;t have a prior reference to know e.g. extrinsic count is encoded as u16.</div>
<div class='msg'><time>2025-04-28 09:31</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The state serialisation for the latter two components is the general (variable size integer) encoding.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-28 16:07</time>&ensp;<span class='u' style='color:#cb735c'>prasad-kumkar</span>: Should argument <code>a</code> from <a href="https://graypaper.fluffylabs.dev/#/cc517d7/2c05022c0702?v=0.6.5" target="_blank" rel="noopener">argument invocation function</a> be encoded with p before passing in <a href="https://graypaper.fluffylabs.dev/#/cc517d7/2b64022b6402?v=0.6.5" target="_blank" rel="noopener">program initialization function</a>, as its being decoding from <code>p</code> as described in <a href="https://graypaper.fluffylabs.dev/#/cc517d7/2bb1022bc102?v=0.6.5" target="_blank" rel="noopener">A.37</a> ? As noted:

&gt; Given some p which is appropriately encoded together with some argument data a, we can define program code c, registers ω and ram μ through the standard initialization decoder function Y <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-28 19:14</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Should we expect to be able to handle bad blocks for M1? Or are all blocks presumed valid?</div>
<div class='msg reply'><time>2025-04-28 19:25</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: +&quot;handle forks&quot; to this question <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-28 21:07</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: IMO M1 is just STF, state in, new state out. there is no concept of a block chain to be considered</div>
<div class='msg reply'><time>2025-04-28 21:10</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: so you should detect if a block is bad (purely using the provided input state), but no need to care about forks because it is stateless</div>
<div class='msg'><time>2025-04-28 21:09</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@ascriv:matrix.org&gt; Should we expect to be able to handle bad blocks for M1? Or are all blocks presumed valid?

Be prepared for bad blocks. A lot of bad blocks :)</div>
<div class='msg'><time>2025-04-29 13:22</time>&ensp;<span class='u' style='color:#95c05f'>qinwenwang</span>: JAM Gray Paper Chinese Version has been updated to 0.6.5 accordingly <a href="https://www.lollipop.builders/JAM-Graypaper-Chinese.pdf" target="_blank" rel="noopener">https://www.lollipop.builders/JAM-Graypaper-Chinese.pdf</a></div>
<div class='msg'><time>2025-04-29 18:41</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Curious why the state serialization of preimage availabilities specifies that the preimage hash should be hashed? Instead of serializing the preimage hash itself, like in the preimage serialization?

<a href="https://graypaper.fluffylabs.dev/#/cc517d7/397202397202?v=0.6.5" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/cc517d7/397202397202?v=0.6.5</a>

Edit: wording <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-30 02:39</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Maybe for super extra care in having no collisions?</div>
<div class='msg'><time>2025-04-30 02:44</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: I asked the same question before</div>
<div class='msg'><time>2025-04-30 02:45</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I have a question also about state serialization:

For pending reports serialization, is it the case that the segment count in (11.5) should be serialized using the general natural number encoding? In fact , since E is not subscripted in C(10), shouldn’t all naturals in the work report be encoded in the general way?</div>
<div class='msg'><time>2025-04-30 02:51</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: But, if we’re going with naturals that are subscripted (like gas values) should always be encoded in the non general way (that seems to be convention?), does that mean the gas values in core and service statistics should not be generally encoded? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-30 10:01</time>&ensp;<span class='u' style='color:#4281bb'>jimboj21</span>: I see in 12.20 that P is a return value. From what I can see it is not defined here but is a returned by the accumulation invokable pvm instance. However it does not appear that psi_a function signature has been updated to reflect this </div>
<div class='msg'><time>2025-04-30 10:07</time>&ensp;<span class='u' style='color:#4281bb'>jimboj21</span>: </div>
<div class='msg'><time>2025-04-30 12:47</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: Anyone else having trouble with the archives site? Only seeing the title: &quot;Archived Rooms&quot;

light inspection reveals the following warning: Error with Permissions-Policy header: Unrecognized feature: &#x27;interest-cohort&#x27;.

<a href="https://paritytech.github.io/matrix-archiver/" target="_blank" rel="noopener">https://paritytech.github.io/matrix-archiver/</a> </div>
<div class='msg'><time>2025-04-30 12:48</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: ah thanks for flagging, I&#x27;ll check on it right away</div>
<div class='msg'><time>2025-04-30 12:58</time>&ensp;<span class='u' style='color:#787fdf'>erin</span>: It&#x27;s now fixed - sorry about that. Looks like the archival process timed out, could have been due to a slow github runner. I&#x27;ve increased the timeout to something quite high now so it should (hopefully) not happen again.</div>
<div class='msg'><time>2025-04-30 13:15</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: &lt;del&gt;Validators won&#x27;t be able to get the preimage hash itself from the serialized state-&gt; Instead they will need to refer to the block extrinsics right? (for any newly-requested, not yet provided preimage).&lt;/del&gt;

What if instead of hashing, we stack the length octets on top of our preimage hash octets? Basically instead of concatenating bytes, we add each of the 4 length octets to each of the first 4 hash octets, and use the result as our state-key?

I&#x27;m thinking if we can avoid the hash operation while meeting the same requirements- we can lessen our perf overhead

edit: wording (duplication)
edit: strikethrough not-really-relevent edge case of validator requesting state from another validator for reconstruction <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-04-30 13:16</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: For context, this was the post from David Emett in Oct 2024:

2024-10-31 22:29 dave: The preimage hash is passed in to eg solicit directly, it&#x27;s trivial to pass in almost-colliding hashes. As the trie key construction function doesn&#x27;t preserve all hash bits, these almost-colliding hashes could actually collide in the trie if they are not hashed beforehand
</div>
<div class='msg reply'><time>2025-04-30 13:23</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &gt; &lt;@jay_ztc:matrix.org&gt; Validators won&#x27;t be able to get the preimage hash itself from the serialized state-&gt; Instead they will need to refer to the block extrinsics right? (for any newly-requested, not yet provided preimage).
&gt; 
&gt; What if instead of hashing, we stack the length octets on top of our preimage hash octets? Basically instead of concatenating bytes, we add each of the 4 length octets to each of the first 4 hash octets, and use the result as our state-key?
&gt; 
&gt; I&#x27;m thinking if we can avoid the hash operation while meeting the same requirements- we can lessen our perf overhead
&gt; 
&gt; edit: wording (duplication)

Maybe I&#x27;m not understanding but it seems trivial to generate collisions with this scheme. The requested hash and length are almost unconstrained (the length is somewhat constrained by required deposit I think)</div>
<div class='msg reply'><time>2025-04-30 13:24</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: doh! of course, thank you</div>
<div class='msg'><time>2025-04-30 13:24</time>&ensp;<span class='u' style='color:#825bc4'>jay_ztc</span>: </div>
<div class='msg'><time>2025-04-30 14:20</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: has anyone passes the latest accumulate test vector <code>same_code_different_services-1</code>

in the <code>pre-state</code> there are 2 services: 1729, 1730
1730 has no &quot;blob&quot; i.e service code

in the <code>post-state</code> service 1730 is removed, only service 1729 remains

i am currently clueless as to how that might have happend

- it could not have ejected itself - since it has no code
- as far as i can tell, it is not removed from <code>d&amp;#x27;</code>  in <a href="https://graypaper.fluffylabs.dev/#/cc517d7/17fe01170102?v=0.6.5" target="_blank" rel="noopener">12.17</a>

how else can it be removed?

davxy  could you advise? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-30 14:21</time>&ensp;<span class='u' style='color:#4281bb'>jimboj21</span>: Luke | Jamixir: I am also stuck trying to get this working currently</div>
<div class='msg'><time>2025-04-30 14:21</time>&ensp;<span class='u' style='color:#4281bb'>jimboj21</span>: and dont see why it is happening yet</div>
<div class='msg'><time>2025-04-30 14:22</time>&ensp;<span class='u' style='color:#72c147'>luke_fishman</span>: good to know I&#x27;m not alone on this</div>
<div class='msg'><time>2025-04-30 15:45</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: Seems to be addressed in <a href="https://github.com/gavofyork/graypaper/pull/348" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/348</a>
And thus likely published in next release of GP (0.6.6).</div>
<div class='msg'><time>2025-04-30 15:46</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: Minor text change near equation: 12.20: change p -&gt; i
PR: <a href="https://github.com/gavofyork/graypaper/pull/351" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/351</a></div>
<div class='msg'><time>2025-04-30 15:48</time>&ensp;<span class='u' style='color:#a23bc7'>emielsebastiaan</span>: Some suggested changes to the provide host function: <a href="https://github.com/gavofyork/graypaper/pull/352" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/352</a>
Fixes: 1) setting registers, 2) setting bold_d (service dictionary)

</div>
<div class='msg'><time>2025-04-30 18:04</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: The new 0.6.5 gas parameter x\_g in the operand is serialized in <a href="https://graypaper.fluffylabs.dev/#/cc517d7/385f02385f02?v=0.6.5" target="_blank" rel="noopener">C.29</a> not with E\_8 but with <a href="https://graypaper.fluffylabs.dev/#/cc517d7/37a10037a100?v=0.6.5" target="_blank" rel="noopener">C.6</a>, unlike the others that use E\_8 (see C.23, C.26, C.28) -- is this a typo or intended?  Why not make them consistent in one direction or the other? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-04-30 19:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: All these encodings will be revisited in due course before 0.7.0 (there’s an issue on the 0.6 milestone page) but until then assume your reading is correct.</div>
<div class='msg'><time>2025-04-30 20:21</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@luke_fishman:matrix.org&gt; has anyone passes the latest accumulate test vector <code>same_code_different_services-1</code>
&gt; 
&gt; in the <code>pre-state</code> there are 2 services: 1729, 1730
&gt; 1730 has no &quot;blob&quot; i.e service coed
&gt; 
&gt; 
&gt; in the <code>post-state</code> service 1730 is removes, only service 1729 remains
&gt; 
&gt; i am currently clueless to how that might have happend
&gt; - it could not have ejected itself - since it has no code
&gt; - as far as i can tell, it is not removed from <code>d&amp;#x27;</code>  in <a href="https://graypaper.fluffylabs.dev/#/cc517d7/17fe01170102?v=0.6.5" target="_blank" rel="noopener">12.17</a>
&gt; 
&gt; how else can it be removed?
&gt; 
&gt; davxy  could you advice?
&gt; 

I&#x27;ll have a look</div>
<div class='msg'><time>2025-05-01 04:23</time>&ensp;<span class='u' style='color:#30c84d'>clw0908</span>: Some questions about <a href="https://graypaper.fluffylabs.dev/#/cc517d7/2b63022b6302?v=0.6.5" target="_blank" rel="noopener">A.36</a>, <a href="https://graypaper.fluffylabs.dev/#/cc517d7/2bc1022bc102?v=0.6.5" target="_blank" rel="noopener">A.37</a>, and <a href="https://graypaper.fluffylabs.dev/#/cc517d7/2cb8012cb801?v=0.6.5" target="_blank" rel="noopener">A.43</a>:  
 
In A.43, **p** is the program blob of a service, and **a** is the serialized arguments from <code>refine</code> or <code>accumulate</code> (on-transfer).  
 
So how can **p** include **a** in A.37?  
 
Since A.36 only checks whether there exists a **c**, **o**, **w**, <code>z</code>, <code>s</code> (excluding **a**) that satisfies A.37, does this mean we don’t have to care whether **a** exists in **p**?</div>
<div class='msg'><time>2025-05-01 07:54</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Bold a should be in that list</div>
<div class='msg reply'><time>2025-05-01 07:59</time>&ensp;<span class='u' style='color:#cb735c'>prasad-kumkar</span>: Should a be concatenated to p before passing in A36 ? <a href="https://github.com/gavofyork/graypaper/pull/350" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/350</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-01 08:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: </div>
<div class='msg'><time>2025-05-01 08:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Hmm. Looks like bold a getting added into that concatenation is a typo. </div>
<div class='msg'><time>2025-05-01 08:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Bold a is not a part of the program blob </div>
<div class='msg'><time>2025-05-01 08:06</time>&ensp;<span class='u' style='color:#cb735c'>prasad-kumkar</span>: then shall **a** be passed as a function argument to Y?</div>
<div class='msg'><time>2025-05-01 08:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes indeed. </div>
<div class='msg reply'><time>2025-05-01 08:16</time>&ensp;<span class='u' style='color:#cb735c'>prasad-kumkar</span>: Okay thank you! I’ll update #350 (<a href="https://github.com/gavofyork/graypaper/pull/350)" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/350)</a> to reflect the change if that’s okay 🙂</div>
<div class='msg'><time>2025-05-01 20:01</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: For instruction 104, doesn’t this actually get the trailing (not leading) zeros as it’s defined? For example if wA is 0x1, B_8 will be 1 followed by 0s, and so the formula will evaluate to 0, when it should be 63 <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-01 20:06</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: We should be using the big endian representation of wA in 104-107 unless I’m mistaken </div>
<div class='msg'><time>2025-05-01 22:48</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Made a pr www.github.com/gavofyork/graypaper/pull/357 <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-02 08:51</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Merged a fix</div>
<div class='msg'><time>2025-05-02 11:16</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: I am a bit confused about the terminology used in CE 139/140 (<a href="https://docs.jamcha.in/knowledge/advanced/simple-networking/spec#ce-139140-segment-shard-request):" target="_blank" rel="noopener">https://docs.jamcha.in/knowledge/advanced/simple-networking/spec#ce-139140-segment-shard-request):</a>
the GP specifies very well the concept of &quot;segment&quot;. It doesn&#x27;t use the word &quot;shard&quot; - are they the same concept? Also, CE139 define 12 bytes segment shards. But the GP segment sizes are 684 bytes. Where do 12 comes from? Where are shards defined in the GP? </div>
<div class='msg'><time>2025-05-02 11:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: segments are 4104 bytes and can be reconstructed by 342 validators each presenting their 12 byte <em>shard</em> (and its index)</div>
<div class='msg'><time>2025-05-02 12:29</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: &gt; &lt;@gav:polkadot.io&gt; segments are 4104 bytes and can be reconstructed by 342 validators each presenting their 12 byte <em>shard</em> (and its index)

Thanks. Then In tiny testnets (6 nodes, 2 cores) each shard has 2052 bytes? So shard size is 4104 / [number of cores]?</div>
<div class='msg'><time>2025-05-02 12:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes indeed. </div>
<div class='msg'><time>2025-05-02 15:51</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: image.png</div>
<div class='msg'><time>2025-05-02 15:52</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: You might find the above useful (if you spot an error, please advise!)</div>
<div class='msg'><time>2025-05-02 17:21</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Hey all. With having M2 pretty much complete at this point I&#x27;m now trying to wrap my head around how to build the required  recompiler. Based on my research so far, it looks like I could generate RISC-V machine code, add an ELF header, then use a linker to produce the final ELF file, and finally execute that ELF (somehow) as a background process. Am I heading in the right direction, or am I way off and should just wait for Jan’s talk?</div>
<div class='msg'><time>2025-05-02 17:23</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Nope. My talk next week should contain the bare basics that should let you get started on writing one.</div>
<div class='msg'><time>2025-05-02 17:25</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Alright I&#x27;ll hold off for now. I&#x27;m no longer going to be able to make it to jam experience so I really hope this is available to watch online afterwards</div>
<div class='msg'><time>2025-05-02 17:26</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: I will also share the slides so even if you can&#x27;t watch the talk they should be useful.</div>
<div class='msg'><time>2025-05-02 17:26</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Thanks!</div>
<div class='msg'><time>2025-05-03 17:09</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: State serialization is lossy, specifically in regards to the keys of the storage dictionary of service accounts. I’m a bit confused why this isn’t important. Are we not expected to be able to fully recover a serialized state in the case that the storage dictionary is non empty? State serialization is lossless everywhere else, so it seems odd. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-03 17:47</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: I don’t think it’s something really meant to be reversed. Also storage items are not the only thing suffering from this. There are cases where preimage lookups are also not recoverable (if the preimage isn’t known). If it’s just been solicited through a host call and not included in a block yet you wouldn’t know the full hash of it either by looking at the lookup state key <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-03 20:02</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: As I wrote in the GH discussion. Storage keys are lossy from the host perspective. When a service requires to read (or write) a service key it gives to the host the full unhashes key. The host then computes the state key (as per D.2) and gives (or writes) the data. Host doesn&#x27;t need to keep track of the full key as it doesn&#x27;t need it <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-03 20:19</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: I understand the process you suggested, but doesn&#x27;t it go against the GP? It defines the preimage and storage lookup dictionaries as having 32 byte keys with a key format of H(E4(s∗)⌢ µko ⋅⋅⋅+kz). If we were to support state keys instead for these since they are not all reversible the logic in the GP is invalid in a few spots</div>
<div class='msg'><time>2025-05-03 20:22</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: 31 bytes <a href="https://github.com/gavofyork/graypaper/pull/356" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/356</a></div>
<div class='msg'><time>2025-05-03 20:24</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I think Jason is talking about the definition in the service account (9.3), but I think it’s still correct, however implementations will likely not have an actual struct which maps 32 octet strings to blobs, and instead opt for 31 octet strings (the state key) </div>
<div class='msg'><time>2025-05-03 20:25</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: But even  that implementation would still follow gp, functionally </div>
<div class='msg'><time>2025-05-03 20:26</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: To process our vectors you need to support construction of the state using state keys</div>
<div class='msg reply'><time>2025-05-03 22:30</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Ok thank you. Will make the updates to be able to support this</div>
<div class='msg'><time>2025-05-03 20:27</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: &gt; &lt;@davxy:matrix.org&gt; 31 bytes <a href="https://github.com/gavofyork/graypaper/pull/356" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/356</a>

I was referring to the preimage lookup dictionary and storage dictionary in delta. GP shows key is H.</div>
<div class='msg'><time>2025-05-03 20:31</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: That’s still true, it’s just to process davxys test vectors you can’t have an implementation which works with the full storage keys, instead working with the state key versions of the storage keys. GP doesn’t say your internal representation of service accounts must match the one in (9.3)  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-03 20:32</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: An implementation might has a_s mapping 31 byte strings to blobs and still be faithful to gp </div>
<div class='msg'><time>2025-05-03 20:33</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Just need to make sure it serializes correctly, does key existence checks correctly, etc </div>
<div class='msg'><time>2025-05-03 20:35</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: But correct me if I’m wrong @davxy </div>
<div class='msg'><time>2025-05-03 20:43</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: I see your problem. IIUC you are talking about constructing the Dictionaries with the preimage full hash from the raw KV state.
- For the preimage you can. Just hash the value.
- For the preimage lookup dictionary you can just if you already have the corresponding preimage in the KV
- For services you can&#x27;t recover the unhashed service key

Yeah, the vectors assume that you use the state keys as your dictionary keys <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-03 20:58</time>&ensp;<span class='u' style='color:#5cdeb7'>cisco</span>: I&#x27;m also really confused by this. I guess the encodings will be revised in 0.7.0 but I would like to know how they are right now if possible</div>
<div class='msg'><time>2025-05-03 21:04</time>&ensp;<span class='u' style='color:#b332c3'>rustybot</span>: &gt; &lt;@davxy:matrix.org&gt; I see your problem. IIUC you are talking about construct some Dictionary with the preimage full hash from the raw KV state.
&gt; - For the preimage you can. Just hash the value.
&gt; - For the preimage lookup dictionary you can just if you already have the corresponding preimage in the KV
&gt; - For services you can&#x27;t recover the unhashed service key
&gt; 
&gt; Yeah, the vectors assume that you use the state keys as your dictionary keys

I’d also like to add that, to support warp sync (i.e., syncing from a finalized state rather than from genesis), you&#x27;ll receive the raw key-value state keys. Not sure if this is already specified by JAM SNP</div>
<div class='msg'><time>2025-05-03 21:21</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@davxy:matrix.org&gt; I see your problem. IIUC you are talking about construct some Dictionary with the preimage full hash from the raw KV state.
&gt; - For the preimage you can. Just hash the value.
&gt; - For the preimage lookup dictionary you can just if you already have the corresponding preimage in the KV
&gt; - For services you can&#x27;t recover the unhashed service key
&gt; 
&gt; Yeah, the vectors assume that you use the state keys as your dictionary keys

I think (very) technically speaking, an implementation which relies on state keys for storage does not actually implement the gp, because of the extraordinarily unlikely outcome of a state key collision when checking existence of a key. this is probably not even worth mentioning due to the likelihood but thought it was interesting </div>
<div class='msg'><time>2025-05-04 09:33</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: In the last point, do you mean for storage keys you can&#x27;t recover the unhashed storage key? It&#x27;s only the storage dict that would have state keys? (since we can recover the rest) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-04 13:09</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@cisco:parity.io&gt; I&#x27;m also really confused by this. I guess the encodings will be revised in 0.7.0 but I would like to know how they are right now if possible

If you look at (C.24) it explains how to serialize work reports which I previously overlooked</div>
<div class='msg'><time>2025-05-05 09:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The segment-count field (in the availability specifier set) is encoded as a 2-byte fixed length integer.</div>
<div class='msg'><time>2025-05-05 10:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This is missing the point.</div>
<div class='msg'><time>2025-05-05 10:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Nowhere in the GP does it tell you (how) to store the state. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 10:01</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It only specifies how to <em>recognise</em> a valid state. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 10:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And in fact this is done via the Merkle root, which (under reasonable assumptions) identifies a single state. But (obviously) it&#x27;s lossy in so much as it impossible to reconstruct a potentially multi-gigabyte state from a 32 byte quantity. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 10:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Implementations are free to store state however they choose. GP takes pains not to specify this; it&#x27;s one of the very many implementation details. GP only specifies how to recognise a valid block. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 10:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Of course when we want to provide test vectors for incomplete portions of the protocol, then we may need to make judgement calls on exactly what data an implementation has available. That&#x27;s a bit unfortunate and may coerce implementations into particular design patterns. Note that __implementations need not be able to pass the test vectors__. They must only pass the conformance tests, which will test in line with the GP not any internal data structures we might assume implementations have within.</div>
<div class='msg'><time>2025-05-05 10:07</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Test vectors are provided only in so much as they might <em>help</em> teams.</div>
<div class='msg'><time>2025-05-05 10:08</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If you&#x27;re talking about a possible collision of the 32nd byte of a hash (or even the 27th byte), then the GP implicitly assumes it is impossible. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 10:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Always remember: GP only specifies behaviour, not mechanism. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 10:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The change made to characterise state keys as 31 bytes in the GP should make no practical difference to behaviour; it&#x27;s there to ensure that W3F&#x27;s test vectors have something concrete to point at in the GP.</div>
<div class='msg'><time>2025-05-05 11:21</time>&ensp;<span class='u' style='color:#b332c3'>rustybot</span>: Since GP defines the service storage dictionary key as the full hash, an implementation is free to use the full hash (9.3) as the dictionary key. If this implementation supports warp sync, as outlined in CE129, it receives a sequence of KV items with 31-byte state keys (as per D.1). But now this implementation cannot construct its service dictionary properly (as it uses full hashes), and may fail to process subsequent blocks. This happens because host calls will pass full hashes, but they&#x27;ve  padded the keys received from another node, causing mismatches. The likelihood of such a mismatch is pretty high.

Doesn&#x27;t this suggest that implementations aiming to support warp sync need to use 31-byte state keys for their dictionaries? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 11:41</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: This is my understanding as well, but interested to hear others opinions  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 11:43</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: The last few bytes of the keys are not present in the serialized state so warp sync and full storage key implementations must not be compatible  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 14:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, warp-sync is not (yet) within the behavioural description of the GP. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 14:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.6" target="_blank" rel="noopener">GP v0.6.6</a> is released.</div>
<div class='msg reply'><time>2025-05-06 00:56</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: There might be a typo in I(p,j) where it checks the output size of the refine calls. I&#x27;m assuming it should be checking if the size is greater then WR rather then smaller</div>
<div class='msg'><time>2025-05-05 14:16</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;s not quite the 0.7.0 I had wanted prior to the JAM XP, but it&#x27;s now getting <a href="https://github.com/gavofyork/graypaper/milestone/3" target="_blank" rel="noopener">quite close</a>.</div>
<div class='msg'><time>2025-05-05 14:17</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There are a few small changes here in line with the 0.6 milestone, but the most impactful is the alteration to <code>fetch</code>, which now works across the different invocations and averts the need for unavoidable unbounded RAM allocations. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-05 14:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <code>fetch</code> also changed to allow on-chain entropy to be inspected in Accumulate/OnTransfer, and, in the future, off-chain entropy to be inspected in Refinement.</div>
<div class='msg'><time>2025-05-05 14:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is now possible to introspect the chain&#x27;s parameters, allowing for chain-agnostic PVM code.</div>
<div class='msg'><time>2025-05-07 17:30</time>&ensp;<span class='u' style='color:#d163c7'>sigsigsigsigsig</span>: hi gang</div>
<div class='msg'><time>2025-05-07 17:30</time>&ensp;<span class='u' style='color:#d163c7'>sigsigsigsigsig</span>: coming back to jam, struggling to find the black on white version of the updated pdf could anyone help?</div>
<div class='msg'><time>2025-05-07 17:31</time>&ensp;<span class='u' style='color:#d163c7'>sigsigsigsigsig</span>: this one is gnarly to print 😁</div>
<div class='msg'><time>2025-05-07 17:31</time>&ensp;<span class='u' style='color:#d163c7'>sigsigsigsigsig</span>: would be most grateful 🙏</div>
<div class='msg'><time>2025-05-07 17:31</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: there are three versions here <a href="https://jamcha.in/spec" target="_blank" rel="noopener">https://jamcha.in/spec</a></div>
<div class='msg'><time>2025-05-07 17:32</time>&ensp;<span class='u' style='color:#d163c7'>sigsigsigsigsig</span>: Oliver Tale-Yazdi: amazing, thankyou!! 😍</div>
<div class='msg'><time>2025-05-07 17:33</time>&ensp;<span class='u' style='color:#d163c7'>sigsigsigsigsig</span>: will think of you while i&#x27;m enjoying reading it in the uk sun 😁 💕</div>
<div class='msg'><time>2025-05-07 17:33</time>&ensp;<span class='u' style='color:#d163c7'>sigsigsigsigsig</span>: gotta get it while it&#x27;s hot here! ☔️</div>
<div class='msg'><time>2025-05-08 14:32</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: The fifth component of the yield invocation in (B.2) should be a hash but it’s a work package. Assuming that’s a typo?</div>
<div class='msg'><time>2025-05-09 09:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes. <a href="https://github.com/gavofyork/graypaper/pull/376" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/376</a></div>
<div class='msg'><time>2025-05-09 16:14</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: The third state key constructor in (D.1) only uses the first 27 bytes of h, but each usage of that constructor sends 31 bytes. I think e.g. for the storage dictionary we should use k0…23, and similar the next 2. This wouldn’t change functionality but as far as I can tell we are sending 4 extraneous bytes in each of them  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-10 01:15</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: also I saw that we changed the arguments for the argument invocation in the accumulation definition (B.9) to include just the length of operand tuples array, instead of the full array. is this intentional? is it also intentional that we&#x27;ve left off any subscript for E, and thus we use the general natural encoding for t and s?</div>
<div class='msg'><time>2025-05-10 13:47</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: <a href="https://github.com/gavofyork/graypaper/pull/380" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/380</a>
<a href="https://github.com/gavofyork/graypaper/pull/381" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/381</a>

draft fixes for the above two issues <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-11 17:10</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; also I saw that we changed the arguments for the argument invocation in the accumulation definition (B.9) to include just the length of operand tuples array, instead of the full array. is this intentional? is it also intentional that we&#x27;ve left off any subscript for E, and thus we use the general natural encoding for t and s?

All intentional </div>
<div class='msg'><time>2025-05-11 17:11</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Passing the whole vector will become unsound when gas cost inflates with accessible memory. The point of these changes is to support sound service code and thus ensure that baseline gas costs are fixed over all inputs. Memos and work results must now be <code>fetch</code>ed as needed.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-11 19:08</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: To expand on the rationale here - we&#x27;ve been doing research/running experiments on how to come up with a secure gas cost model we can use in a permissionless environment like JAM, and it has been increasingly clear that minimizing the amount of memory that is accessible to the programs is important to keep the gas costs of the memory instructions in check. In general the more memory you have accessible the easier it gets to trigger cache misses, which makes the the worst case, well, worse, for memory access instructions, potentially up to <em>several hundred times</em> more costly (compared to the average case) if you can access the whole ~4GB worth of address space. So if we can do something while needing less memory, even if that ends up being slightly more computationally inefficient, it will still be a net win considering the gas costs.</div>
<div class='msg'><time>2025-05-12 01:56</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: <a href="https://github.com/gavofyork/graypaper/pull/387" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/387</a>

various fetch nits</div>
<div class='msg'><time>2025-05-12 19:56</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: For this message, can we assume that (w_s)_l is added for each r in w_r ? so if len(w_r) = 2, the b component for R(c) is 2 * (w_s)_l ?</div>
<div class='msg'><time>2025-05-12 19:57</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: For this equation *</div>
<div class='msg'><time>2025-05-12 19:58</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: (assuming there&#x27;s one work report for that core)</div>
<div class='msg'><time>2025-05-12 21:22</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No, this is an oversight. (w_s)_l should only be counted once. Feel free to open an issue.</div>
<div class='msg'><time>2025-05-13 10:34</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: For the <a href="https://graypaper.fluffylabs.dev/#/9a08063/3bb2023bb802?v=0.6.6" target="_blank" rel="noopener">service storage keys state serialization</a>, should the truncated key not be the encoded service id + k0..23 (23 bytes), given that the C function <a href="https://graypaper.fluffylabs.dev/#/9a08063/3b39003b4300?v=0.6.6" target="_blank" rel="noopener">accepts 27 bytes</a>?  </div>
<div class='msg'><time>2025-05-13 10:35</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Also applies the the preimages/preimage lookups, 4 bytes less</div>
<div class='msg'><time>2025-05-13 10:49</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Ahh someone already opened a <a href="https://github.com/gavofyork/graypaper/pull/380/files" target="_blank" rel="noopener">PR</a> for this :)</div>
<div class='msg'><time>2025-05-13 14:34</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Yes me 👋</div>
<div class='msg'><time>2025-05-14 14:06</time>&ensp;<span class='u' style='color:#6f63cc'>decentration</span>: Are there existing conformance vectors available for validating the entire serialized state, including all chapters, after it has been merkleized into a single state root?</div>
<div class='msg reply'><time>2025-05-15 12:53</time>&ensp;<span class='u' style='color:#6f63cc'>decentration</span>: (just realised i asked this in GP not Lets Jam group), i found these shared by Jamduna, and will use these for now. 

<a href="https://github.com/jam-duna/jamtestnet/blob/main/data/generic/state_transitions/00000012.json" target="_blank" rel="noopener">https://github.com/jam-duna/jamtestnet/blob/main/data/generic/state_transitions/00000012.json</a></div>
<div class='msg reply'><time>2025-05-15 13:10</time>&ensp;<span class='u' style='color:#6f63cc'>decentration</span>: though these would be slightly outdated </div>
<div class='msg'><time>2025-05-15 13:19</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Yes I find they are not up to date with 0.6.6 yet @sourabhniyogi FYI</div>
<div class='msg'><time>2025-05-15 18:44</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: Reading the GP a falltrought instruction is like a nop, right? It only do nothing and the program counter goes to the next instruction? </div>
<div class='msg'><time>2025-05-15 18:55</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: This is off-topic for this channel, but for fallback/safrole you can definitely use this
<a href="https://github.com/davxy/jam-test-vectors/pull/45" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/pull/45</a> 
and you can attempt the &quot;reports&quot; as well, which I imagine we&#x27;ll get team convergence on very soon...</div>
<div class='msg'><time>2025-05-15 20:35</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: The primary function of the <code>fallthrough</code> instruction is to allow jumps into code which otherwise you wouldn&#x27;t be able to jump into, as it starts a new basic block, and only jumps to the beginning of basic blocks are allowed. But otherwise yes, it just goes to the next instruction.</div>
<div class='msg'><time>2025-05-16 21:05</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: In the state <a href="https://graypaper.fluffylabs.dev/#/9a08063/3b5d003b6400?v=0.6.6" target="_blank" rel="noopener">constructor function for service account state keys</a> wouldn&#x27;t a representation like  \[i, 0, n0, 0, n1, 0, n2, 0, n3, 0, 0 ... \] make identifying the different types of keys more robust? In that case the second byte would be unique for each of them. (regular, service, preimage, preimage lookup, storage)

(note, assuming preimage lookup lengths are &gt; 0 and \&lt; max(uint32) -1, but it&#x27;s still unique for the other four at least) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-20 04:51</time>&ensp;<span class='u' style='color:#4ab863'>jtxmp</span>: </div>
<div class='msg'><time>2025-05-20 09:19</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Not sure how you mean &quot;more robust&quot; - could you give an example of it not being robust? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-20 20:28</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Maybe more robust was the wrong way to phrase it, more like make a collision impossible, though that&#x27;s just a nit since right now it&#x27;s quite unlikely there would ever be a collision.

I just meant with that representation, service state keys and preimage meta state keys have the second byte as always 0, and always &gt; 1  respectively, so they can never collide then.

Eg. if x can be any byte.

<pre><code class=''>[255,  0   ...] // service keys
[x,   &gt;1   ...] // preimage meta keys  
</code></pre>

But this probably doesn&#x27;t make much difference in practice I guess. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-21 11:02</time>&ensp;<span class='u' style='color:#4772c5'>faiz_871</span>: </div>
<div class='msg'><time>2025-05-23 22:23</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-05-23 at 11.23.50 PM.png</div>
<div class='msg'><time>2025-05-23 22:24</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: for sbrk, if wA happens to be 0, then N_x..+wA = {}, which is a subset of every set. so there is no x which satisfies the conditions, meaning sbrk is undefined</div>
<div class='msg'><time>2025-05-23 22:24</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: should we define sbrk for the case when wA = 0?</div>
<div class='msg'><time>2025-05-24 16:53</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Well remove <code>sbrk</code> pretty soon I believe, wdyt <a href="https://matrix.to/#/@jan:parity.io" target="_blank" rel="noopener">Jan Bujak</a>?</div>
<div class='msg'><time>2025-05-24 20:31</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Indeed. We will be removing <code>sbrk</code> and replacing it with a host call, so I wouldn&#x27;t waste any effort on handling corner cases with the current <code>sbrk</code>.</div>
<div class='msg'><time>2025-05-27 15:23</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: Screenshot 2025-05-27 at 16.23.14.png</div>
<div class='msg'><time>2025-05-27 15:23</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: How should I interpret host call &quot;read&quot; and o = 0 and l = 0? </div>
<div class='msg'><time>2025-05-27 15:24</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: is this a panic?</div>
<div class='msg'><time>2025-05-29 09:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No.</div>
<div class='msg'><time>2025-05-29 09:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: \&lt;anything&gt; ...+ 0 is the empty range <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-29 09:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: So N_{anything ...+ 0} is {}</div>
<div class='msg'><time>2025-05-29 09:28</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: And {} is the subset-or-equal of all sets. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-29 09:34</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: @room <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.6.7" target="_blank" rel="noopener">GP version 0.6.7</a> released</div>
<div class='msg'><time>2025-05-29 09:35</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Several smaller alterations here. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-29 09:36</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This completes almost all of the 0.6 milestone, with the rest just being the sweep of numeric encodings and some tidying to the underlying latex. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-29 09:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There could be some additional corrections/tweaks once we see this stuff implemented, so there will likely be one or two more releases on the 0.6 series before we move to 0.7. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-29 09:38</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: One interesting thing which was added is <a href="https://github.com/gavofyork/graypaper/pull/393" target="_blank" rel="noopener">the ability for cores to be owned by services</a></div>
<div class='msg'><time>2025-05-29 12:23</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-05-29 at 1.23.45 PM.png</div>
<div class='msg'><time>2025-05-29 12:24</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I think 12.22 in 0.6.7 needs to pass the additional 3 U parameters we added <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-29 12:27</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: from privileged services (chi) presumably</div>
<div class='msg'><time>2025-05-29 12:29</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: oh nevermind, actually chi just needs to be expanded and placed at the end <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-29 12:31</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: </div>
<div class='msg'><time>2025-05-29 12:32</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: </div>
<div class='msg'><time>2025-05-29 14:07</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-05-29 at 3.07.37 PM.png</div>
<div class='msg'><time>2025-05-29 14:09</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: this part of bless in 0.6.7 should probably be E^-1_4#([u_a+4i...+4] for i in N_C) ? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-29 14:12</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: and I guess now we don&#x27;t need to validate that each of them is in the range of a valid service index, because they&#x27;re limited to 4 bytes <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-30 00:38</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Is there any documentation on the extra RPC methods that jamt uses? I noticed it uses a couple additional things on top of JIP-2, like a subscribeSyncStatus method and expects a few extra variables in the parameters object for example. I&#x27;m trying to make it work with one of my nodes.</div>
<div class='msg'><time>2025-05-30 10:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/413" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/413</a></div>
<div class='msg'><time>2025-05-30 11:14</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/pull/415" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/415</a></div>
<div class='msg'><time>2025-05-30 11:34</time>&ensp;<span class='u' style='color:#8dbe5c'>arkadiy</span>: <a href="https://github.com/polkadot-fellows/JIPs/pull/7" target="_blank" rel="noopener">https://github.com/polkadot-fellows/JIPs/pull/7</a>
As for the chain parameters, these will most likely be changed to match the on-chain data return by the <code>fetch</code> function here:
<a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/32f800324e01?v=0.6.7" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/32f800324e01?v=0.6.7</a></div>
<div class='msg'><time>2025-05-30 11:55</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: &gt; &lt;@arkadiy:parity.io&gt; <a href="https://github.com/polkadot-fellows/JIPs/pull/7" target="_blank" rel="noopener">https://github.com/polkadot-fellows/JIPs/pull/7</a>
&gt; As for the chain parameters, these will most likely be changed to match the on-chain data return by the <code>fetch</code> function here:
&gt; <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/32f800324e01?v=0.6.7" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/32f800324e01?v=0.6.7</a>

Thank you.</div>
<div class='msg'><time>2025-05-30 16:47</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: Sorry, if this is trivial. The GP mentions an explicit halt instruction <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/0acc010ad001?v=0.6.7" target="_blank" rel="noopener">here</a>, which I don&#x27;t see defined in Appendix A. Am I missing something?</div>
<div class='msg'><time>2025-05-30 16:49</time>&ensp;<span class='u' style='color:#bcd429'>subotic</span>: ah, brain fog. the djump thingy. sorry for the noise. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-05-30 19:44</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: From the jamt source code I noticed that for the statistics and service related rpc subscriptions that it expects their responses to always first include the header hash and slot #. I don&#x27;t think this is mentioned anywhere in JIP-2. For example under subscribeStatistics it just says &quot;Notification type: Blob&quot;, but in reality it looks like the notifications need to include Header hash, slot and then the blob. Are you able to confirm?</div>
<div class='msg'><time>2025-05-30 19:49</time>&ensp;<span class='u' style='color:#8dbe5c'>arkadiy</span>: Yes, I guess we need to update the spec here David Emett </div>
<div class='msg'><time>2025-05-30 19:53</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Yeah I think there are a few updates needed to JIP-2, will review and update next week</div>
<div class='msg'><time>2025-05-31 22:08</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: For the disputes extrinsic verdict&#x27;s age, does using the prior state&#x27;s slot, active and archived validators imply that in the first block of a new epoch a verdict can have an age of 2 epochs back? Eg, we&#x27;re in the first slot of epoch 3 (slot 36), at that point the prior state is in epoch 2 (slot 35), and our verdict has an age of 1 which is valid. 2 is also valid, but we couldn&#x27;t at this point have an age of 3. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-01 14:20</time>&ensp;<span class='u' style='color:#994dd2'>tvvkk7</span>: Hello,
I would like to double-check a question regarding the recompiler.
Is the implementation language restricted to JAM, to the same language set, or are other programming languages also permitted?</div>
<div class='msg'><time>2025-06-01 19:25</time>&ensp;<span class='u' style='color:#7875cf'>charliewinston14</span>: For the wonky disputes, is it exactly 1/3 or 1/3+?</div>
<div class='msg'><time>2025-06-02 06:48</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@charliewinston14:matrix.org&gt; For the wonky disputes, is it exactly 1/3 or 1/3+?

Exactly . Otherwise, it would logically include the 2V/3 + 1 case - which isn&#x27;t wonky, but rather the good case</div>
<div class='msg'><time>2025-06-02 07:14</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@davxy:matrix.org&gt; Exactly . Otherwise, it would logically include the 2V/3 + 1 case - which isn&#x27;t wonky, but rather the good case

Just to elaborate. The purpose of this expression is to concisely capture the condition in which a supermajority cannot be reached for either outcome</div>
<div class='msg'><time>2025-06-02 11:47</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-06-02 at 2.47.21 PM.png</div>
<div class='msg'><time>2025-06-02 11:48</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: for the state serialization, can&#x27;t we get away with omitting a_o and a_i since they are derivable from other components of the serialized state?</div>
<div class='msg'><time>2025-06-03 11:35</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Doesn&#x27;t changing storage keys <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/103301103301?v=0.6.7" target="_blank" rel="noopener">here</a> from H -&gt; Y mean that implementers are not free to choose how they represent storage keys in the storage dict? Ie we&#x27;d have to ensure that we all have the same length for our chosen key representation.

Seems to contradict <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/3b1f033b2403?v=0.6.7" target="_blank" rel="noopener">with the new paragraph</a> in the state serialization section. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 11:48</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The change from H-&gt;Y was just to avoid hashing the keys twice. They are still hashed by the C function (see <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/3b6c003b7d00?v=0.6.7)." target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/3b6c003b7d00?v=0.6.7).</a></div>
<div class='msg'><time>2025-06-03 11:51</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: But does that mean you&#x27;re forced to use the C function as your representation?</div>
<div class='msg'><time>2025-06-03 11:51</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Yes, this is pretty much required anyway to implement warp sync</div>
<div class='msg'><time>2025-06-03 12:00</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: I wonder if that wouldn&#x27;t make more sense as Y_31 then since you&#x27;re pretty much forced to have that key length to get the same footprint</div>
<div class='msg'><time>2025-06-03 12:02</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The output of the C function is now Y_31, maybe I&#x27;m misunderstanding</div>
<div class='msg'><time>2025-06-03 12:03</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: I mean for the storage keys definition. Y -&gt; Y , vs Y\_31 -&gt; Y , since you&#x27;re forced to use C <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 12:06</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not sure I understand. The service storage stuff is only one part of the trie</div>
<div class='msg'><time>2025-06-03 12:10</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Sorry I&#x27;m probably not being clear.

For <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/103301103301?v=0.6.7" target="_blank" rel="noopener">this definition.</a> Y\_31 -&gt; Y .

Wouldn&#x27;t you dict always have 31 byte keys? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 12:12</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Or does Y there represent the original key. Ie the f<a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/117b01117b01?v=0.6.7" target="_blank" rel="noopener">ootprint for storage</a> is done based on the length of the original key <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 12:37</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Seems like this is the case if I&#x27;m reading this correctly, so to calculate the balance now you need to know the length of the original raw key</div>
<div class='msg'><time>2025-06-03 13:01</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Yes for the footprint calculation the original key is used. This is intentional even though the storage backend should really only store the 31-byte output of the C function</div>
<div class='msg'><time>2025-06-03 13:03</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Note that you should always have the original key at hand when inserting/removing/updating such a value, even if the original key is not kept in the underlying storage (which it really shouldn&#x27;t be)</div>
<div class='msg'><time>2025-06-03 13:05</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Re accessing the service storage see the read/write host calls, which no longer hash the key: <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/333800331602?v=0.6.7" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/333800331602?v=0.6.7</a></div>
<div class='msg'><time>2025-06-03 13:05</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Thanks! That clears it up :)</div>
<div class='msg'><time>2025-06-03 13:54</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I&#x27;ve a question about 0.6.7. I noticed storage keys for service account changed in type from hash to generic &quot;blob&quot;. the read and write host calls still refer/use hashes so is it an overlook or is it really meant to be generic blob? </div>
<div class='msg'><time>2025-06-03 14:01</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: If you read just above I asked a similar question, and those host calls no longer hash the key it seems.</div>
<div class='msg'><time>2025-06-03 14:02</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: ha</div>
<div class='msg'><time>2025-06-03 14:02</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Could you link the relevant bit of the GP? Possibly something was missed in the update.</div>
<div class='msg'><time>2025-06-03 14:03</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: i was looking at 0.6.6 for the host calls </div>
<div class='msg'><time>2025-06-03 14:03</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: my bad</div>
<div class='msg'><time>2025-06-03 14:26</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: So if I understand properly warp supporting implmenetations should be a bit offspec compared to GP&#x27;s write and read and use the <code>C</code> key instead of &quot;plain&quot; </div>
<div class='msg'><time>2025-06-03 14:29</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Given <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/3b1f033b2403?v=0.6.7" target="_blank" rel="noopener">this</a>, I guess maybe not off spec per say. Ie it&#x27;s better to not store plain keys. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 14:30</time>&ensp;<span class='u' style='color:#bc4a3e'>basedafdev</span>: </div>
<div class='msg'><time>2025-06-03 14:31</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: yeah I read that. but on the other side the read host call (for example) math says that **k** should be \in K(a_s)</div>
<div class='msg'><time>2025-06-03 14:31</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Yeah I guess it&#x27;s not clear to me that you&#x27;re forced to use C, and that in the service account footprint calculation the storage key is actually the original key <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 14:32</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: but actually we would need to do C(s*, E4(2**232-1) ^ k) \in K(a_s**)</div>
<div class='msg'><time>2025-06-03 14:32</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: well thanks formatting :)</div>
<div class='msg'><time>2025-06-03 14:33</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: yeah basically read and write imply you have access to original keys</div>
<div class='msg'><time>2025-06-03 14:33</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: but on the other side that paragraph somehow says &quot;well yeah you can use <code>C</code> hashes instead of original keys&quot;</div>
<div class='msg'><time>2025-06-03 14:35</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: but if this is the way it was conceived. And it looks like it is... It bugs me cause <code>C(....)</code> is a subset of <code>Y</code> so not exactly the same </div>
<div class='msg'><time>2025-06-03 14:36</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: couldnt we just use Y31 like you suggested  as keys in storage and go through <code>C</code> in read and write?</div>
<div class='msg'><time>2025-06-03 14:38</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: I don&#x27;t think you can use Y_31 as the key in the service definition because that definition is referring to the original key, not C(original_key)</div>
<div class='msg'><time>2025-06-03 14:38</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: (i.e the footprint now uses the original key length, so it&#x27;s gone from stateless to stateful)</div>
<div class='msg'><time>2025-06-03 14:39</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: so it&#x27;s a bit fiddly I guess to express</div>
<div class='msg'><time>2025-06-03 14:40</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: For footprint calculation purposes it&#x27;s Y -&gt; Y, but for the purpose of storing the key in state it&#x27;s Y_31 -&gt; Y <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 14:43</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: well apart to know the length is the original really needed?</div>
<div class='msg'><time>2025-06-03 14:43</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Doesn&#x27;t seem like it</div>
<div class='msg'><time>2025-06-03 15:05</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: No. Practically speaking all implementations should support warp sync. For the later milestones, particularly the ones involving networking, this will be required. This is effectively required by some of the current test vectors I believe, though I don&#x27;t know if it will be required for M1 conformance testing. There is an implicit assumption here that the C function is injective, which it obviously isn&#x27;t really. In _practice_ it is because it is impractical to find a collision.</div>
<div class='msg'><time>2025-06-03 15:08</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: So while you could argue that an implementation which only stores the output of the C function and not the original keys is not really compliant with the GP, we explicitly allow and will ultimately require this behaviour</div>
<div class='msg'><time>2025-06-03 15:10</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: thanks for clarifying. I was just wondering why not using C directly in read and write instead  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 15:10</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The service storage stuff is only one part of the trie</div>
<div class='msg'><time>2025-06-03 15:11</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not sure it would make sense to use C there</div>
<div class='msg'><time>2025-06-03 15:13</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The keys would go through C again as part of State Merklization</div>
<div class='msg'><time>2025-06-03 15:26</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Wouldn&#x27;t there still be a problem with warp sync and preimage meta keys, since you can only reconstruct those completely if you have the preimage extrinsics that are going to be solicited aswell? Are details on that still being worked out? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 15:27</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You are not intended to reconstruct anything. This is why I said &quot;the storage backend should really only store the 31-byte output of the C function&quot;</div>
<div class='msg'><time>2025-06-03 15:30</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: So the same principle should apply to all the service dicts in theory for warp sync?</div>
<div class='msg'><time>2025-06-03 15:31</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: (ie , storage, preimage lookup, preimage meta)</div>
<div class='msg'><time>2025-06-03 15:32</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: So the bottom layer of your storage stack should probably have get/set functions which take a 31-byte key. Warp sync, which will use the state request protocol defined here <a href="https://github.com/zdave-parity/jam-np/blob/main/simple.md#ce-129-state-request," target="_blank" rel="noopener">https://github.com/zdave-parity/jam-np/blob/main/simple.md#ce-129-state-request,</a> should just fill in the bottom layer with the exact keys/values received over the network. That layer shouldn&#x27;t care what bits of state these keys/values correspond to <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-03 15:33</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Completely understood for storage, just wondering about preimage meta in particular</div>
<div class='msg'><time>2025-06-03 15:33</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not sure I understand the question, sorry. There&#x27;s nothing special about that vs any other bit of state really</div>
<div class='msg'><time>2025-06-03 15:37</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: For Merklization there is just one Y_31 -&gt; Y dictionary. All the various bits of state get placed into this single dictionary in accordance with the C function.</div>
<div class='msg'><time>2025-06-03 15:37</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: I think this <a href="https://github.com/davxy/jam-test-vectors/pull/45#issuecomment-2848736219" target="_blank" rel="noopener">comment from davxy</a> sums it up.</div>
<div class='msg'><time>2025-06-03 15:38</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: In practice you should store this single dictionary rather than the nicely structured state as otherwise you will be unable to implement warp sync</div>
<div class='msg'><time>2025-06-03 15:41</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I don&#x27;t think you should be doing any &quot;deserialization&quot; as Davide calls it. I think the point of his comment is that in some cases doing such deserialization is somewhat possible, but it really should not be necessary. If you find yourself needing to do it then either you are misunderstanding something or there is an issue with the GP that needs to be fixed.</div>
<div class='msg'><time>2025-06-03 15:42</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Right rereading it now I understand your point more</div>
<div class='msg'><time>2025-06-03 15:43</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &quot;Deserialization&quot; might be useful for tooling of course, the current stance is that it is just not in general possible</div>
<div class='msg'><time>2025-06-03 15:45</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: We do need to deserialize the other parts of the merkilized state though for warp sync right?</div>
<div class='msg'><time>2025-06-03 15:45</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: No!</div>
<div class='msg'><time>2025-06-03 15:46</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: I&#x27;m also a bit confused because how would you update your state then if you don&#x27;t deserialize it?</div>
<div class='msg'><time>2025-06-03 15:46</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: I understand the dicts, sure</div>
<div class='msg'><time>2025-06-03 15:46</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Warp sync should just be a case of taking the Y_31 -&gt; Y dictionary you get using the State request protocol and sticking that as-is into the bottom layer of your storage stack</div>
<div class='msg'><time>2025-06-03 15:47</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You can read/write bits of state by computing C(...) and then using this as a key into the underlying storage dictionary</div>
<div class='msg'><time>2025-06-03 15:47</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: At no point do you need an inverse of C</div>
<div class='msg'><time>2025-06-03 15:49</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: But to do the operations in the GP we need to have a representation of state that is not just key-&gt;bytes no?</div>
<div class='msg'><time>2025-06-03 15:50</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: We are talking about. eg 1-16</div>
<div class='msg'><time>2025-06-03 15:50</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Fully understand that you won&#x27;t need to deserialize any of the service dicts</div>
<div class='msg'><time>2025-06-03 15:51</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: No, all operations in the GP should be expressible in terms of get/set on the state. This is what this paragraph <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/3b1f033b2403?v=0.6.7" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/3b1f033b2403?v=0.6.7</a> is talking about; enumeration of dictionaries for example is not required anywhere in the GP</div>
<div class='msg'><time>2025-06-03 15:52</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Ahh I guess there&#x27;s a difference between deserialize, and decode?</div>
<div class='msg'><time>2025-06-03 15:52</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: You don&#x27;t mean you don&#x27;t need to decode the other parts of the state, naturally</div>
<div class='msg'><time>2025-06-03 15:53</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You are of course free to deserialize bits of the underlying dictionary if you think this will for example help with performance. In general you can do whatever you like in your implementation provided the observed behaviour is the same. The point here is more that a compliant implementation will not need to perform any deserialization.</div>
<div class='msg'><time>2025-06-03 15:54</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Yes I&#x27;m just talking about the keys here. You will need to decode the values. Sorry if I caused any confusion with that.</div>
<div class='msg'><time>2025-06-03 15:55</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The value decoding should be trivial</div>
<div class='msg'><time>2025-06-03 15:55</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Yeah that makes complete sense</div>
<div class='msg'><time>2025-06-03 15:55</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Oh. Yeah not the keys </div>
<div class='msg'><time>2025-06-03 15:55</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: You shouldn&#x27;t ever need to deserialize keys , 100%</div>
<div class='msg'><time>2025-06-04 15:27</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: I came across two related definitions:

B, defined as <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/178300178300?v=0.6.7" target="_blank" rel="noopener">a service-indexed commitment to the accumulation output</a>, and

θ ( theta ), currently defined as <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/0f08020f2102?v=0.6.7" target="_blank" rel="noopener">the block’s accumulation-output sequence</a>.

I initially thought they referred to the same thing( sequence ), but I noticed that B is defined as a set while θ is defined as a sequence.

Am I missing some distinction here, or are they meant to serve different purposes despite the similarity?</div>
<div class='msg'><time>2025-06-05 10:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Theta is presently defined as being an item within the set B, effectively making it a set. This doesn’t quite work since Theta is elsewhere defined to be a sequence. B should in fact be a sequence and the combinator in Delta_+ should be concatenation rather than union.</div>
<div class='msg'><time>2025-06-05 10:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Feel free to make an issue or a PR. </div>
<div class='msg'><time>2025-06-05 13:39</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: typo? <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/33cc0233cc02?v=0.6.7" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/33cc0233cc02?v=0.6.7</a></div>
<div class='msg'><time>2025-06-05 13:40</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: (the <code>v</code> part)</div>
<div class='msg'><time>2025-06-06 11:03</time>&ensp;<span class='u' style='color:#73caa8'>dvladco</span>: In the <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/2fdb012fdb01?v=0.6.7" target="_blank" rel="noopener">accumulate invocation</a> we pass the new timeslot <code>τ′</code> which according to eq. 6.1 is equivalent to <code>H_t</code> however later in the accumulation invocation we use <code>H_t</code> explicitly. Is there any reason for that? and why not use <code>t</code> which in equivalent to <code>H_t</code>?</div>
<div class='msg'><time>2025-06-06 11:21</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/37f70137fc01?v=0.6.7" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/37f70137fc01?v=0.6.7</a> can someone help me understand the last part of the check where codehash (d_c -&gt;32bytes) is compared to a 32  bit number (x_s -&gt; Service Index ) encoded into 32 byte? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-06 11:22</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: how is that suppoused to work in a real scenario</div>
<div class='msg'><time>2025-06-06 11:55</time>&ensp;<span class='u' style='color:#48d03d'>tomusdrw</span>: &gt; &lt;@prematurata:matrix.org&gt; <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/37f70137fc01?v=0.6.7" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/37f70137fc01?v=0.6.7</a> can someone help me understand the last part of the check where codehash (d_c -&gt;32bytes) is compared to a 32  bit number (x_s -&gt; Service Index ) encoded into 32 byte?

The service updates it code hash to this value, which indicates it&#x27;s ready to be ejected. There can be only one preimage left for the ejected account, presumably some kind of tombstone.</div>
<div class='msg'><time>2025-06-06 12:31</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: ah ok</div>
<div class='msg'><time>2025-06-06 12:31</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: tkz</div>
<div class='msg'><time>2025-06-06 18:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@tomusdrw:matrix.org&gt; The service updates it code hash to this value, which indicates it&#x27;s ready to be ejected. There can be only one preimage left for the ejected account, presumably some kind of tombstone.

They preimage with be the most recent code since the new code hash has no preimage it cannot possibly be removed after the upgrade to a zombie (or, obviously, before)</div>
<div class='msg'><time>2025-06-06 22:06</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-06-07 at 1.06.27 AM.png</div>
<div class='msg'><time>2025-06-06 22:06</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: for 0.6.7 I noticed that we have serialization components for theta and beta_B in C(16) and C(3) respectively, but the state definition only has B_H and no theta <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-06 22:08</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: why does it seem that we are storing some things which aren&#x27;t considered part of the state?</div>
<div class='msg'><time>2025-06-07 15:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes indeed - that’s a typo and should be beta and theta. </div>
<div class='msg'><time>2025-06-08 19:48</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: can we please reconsider adding storage key length inside the state merklization value ? It should make the &quot;restore from merklized state&quot; easier. like massively easier to implement.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-09 08:42</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-06-09 at 11.42.47 AM.png</div>
<div class='msg'><time>2025-06-09 08:43</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-06-09 at 11.43.00 AM.png</div>
<div class='msg'><time>2025-06-09 08:43</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: What is the utility of having item markers like E_4(2^32-1) if we set fire to it with a hash when making the state key?</div>
<div class='msg'><time>2025-06-09 08:47</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I thought they were useful for prefix search too</div>
<div class='msg'><time>2025-06-09 11:59</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: none i can see indeed </div>
<div class='msg'><time>2025-06-09 15:59</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: Looking at the <a href="https://gist.github.com/zdave-parity/72eb9cfe07756d2c0c13c3064600190d" target="_blank" rel="noopener"><code>dev-spec.json</code></a> from David Emett makes me think that something is off:  
There is a key <code>00fe00ff00ff00ff93528801297aa9d5702c0d1b92efacb77f07cddd9edd28</code>, which <em>looks</em> like the preimage key for Service 0, but without that hash function applied. Otherwise this key must be an opaque service key, which would be odd to exactly collide with this pattern. </div>
<div class='msg'><time>2025-06-09 16:00</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: That <code>dev-spec.json</code> doesn&#x27;t have these latest state changes applied, they&#x27;re not implemented in PolkaJam yet</div>
<div class='msg'><time>2025-06-09 16:01</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Re this, it&#x27;s still important to not have the different C(s, ...) cases collide</div>
<div class='msg'><time>2025-06-09 16:02</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: I think it&#x27;s assumed impossible to request a preimage of length eg 2^32-1 as AIUI you need a deposit proportional to the requested length</div>
<div class='msg'><time>2025-06-09 16:04</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: I think not having this hash function makes the keys easier understandable, as you can prefix-match on them. I added some tool for this here <a href="https://docs.jamcha.in/advanced/storage/keys" target="_blank" rel="noopener">https://docs.jamcha.in/advanced/storage/keys</a> , but it fails for <code>C(s, ..)</code> because of that hash function.  
So there is no way to determine whether something is a Service Preimage, Service Storage or Service Preimage Lookup key. All the other C 1-16 and C(255, s) work fine.</div>
<div class='msg'><time>2025-06-09 16:04</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The hash was added/moved to improve the security margin, see <a href="https://github.com/gavofyork/graypaper/issues/403" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/403</a></div>
<div class='msg'><time>2025-06-09 16:06</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: It&#x27;s true that you can&#x27;t currently reverse the key mapping done by the C() function</div>
<div class='msg'><time>2025-06-09 16:13</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@dave:parity.io&gt; Re this, it&#x27;s still important to not have the different C(s, ...) cases collide

If it’s just about collisions, we could make the item marker only 1 byte instead of 4. But I think more importantly we can no longer do nice prefix search as @[Oliver Tale-Yazdi] pointed out </div>
<div class='msg'><time>2025-06-09 16:15</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I presumed that was exactly why we had 4 byte long item markers, so that, interleaved with the 4 byte service index, we have a prefix we can search with </div>
<div class='msg'><time>2025-06-09 16:23</time>&ensp;<span class='u' style='color:#788ad5'>yu2c</span>: Does <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/3b40013b5801?v=0.6.7" target="_blank" rel="noopener">\\mathcal{E}\_M</a>, serialization of merkle mountain range, have a formal definition somewhere in the graypaper? I couldn’t find where this notation is explicitly defined. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-09 20:01</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: See equation E.9 :)</div>
<div class='msg'><time>2025-06-10 11:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It is about collisions.</div>
<div class='msg'><time>2025-06-10 11:44</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Some care is needed; at present it should be secure and I see little opportunity to &quot;optimize&quot; here. a\_s and a\_l are relatively unconstrained, giving an attacker a vector for engineering a collision. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-10 11:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: In particular, if only a single byte were used for the discriminator for a\_s, then a key could conceivably be engineered within a\_s which caused a collision with a properly chosen hash of economically feasible length in a\_l. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-10 11:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This would then need to be managed by altering the key-formula for a_l (e.g. by adding an additional discriminator).</div>
<div class='msg'><time>2025-06-10 11:49</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Right now we avoid this extra discriminator by ensuring that there can be no engineered collisions between a_s &amp; a_l by effectively namespacing through those first four bytes of the key-formulae.</div>
<div class='msg'><time>2025-06-10 11:50</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I don&#x27;t have an especially strong preference for this though - design-wise it&#x27;s a bit of a hangover from when we didn&#x27;t do the hashing at all and it made sense to make the database keys easily reversible. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-10 11:52</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: (To make this truly secure we should really add a requirement that no entries in a\_l may have lengths &gt;= 2^32-2 - without this then we rely solely on economic properties to avoid a collision, and while such properties are reasonable to assume on a public mainnet, they may not be on e.g. a testnet or a permissioned network) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-11 09:48</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Does the cleanroom rule apply also to all things related to networking, or not since it’s sort of external to GP?</div>
<div class='msg'><time>2025-06-11 10:05</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Networking stuff will eventually be included in the GP so I assume the clean room rule applies</div>
<div class='msg'><time>2025-06-11 23:52</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Should the first sentence of 11.3 <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/14f70114f701?v=0.6.7" target="_blank" rel="noopener">here</a> be &quot;Every slot, each core has 3 validators.. &quot; rather than &quot;Every block, each core has 3 validators ..&quot;</div>
<div class='msg'><time>2025-06-12 03:20</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: not every slot have a block, and a slot could have multiple blocks </div>
<div class='msg'><time>2025-06-13 13:31</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: We would like to see <a href="https://github.com/gavofyork/graypaper/issues/97" target="_blank" rel="noopener">Provide a more optimal EC parameterization for work bundles</a> get moved up to 0.7 (so we can work on it this summer rather than the fall) -- as we are finding that erasure encoding / decoding with 1K-3K imported/exported segments is disruptively time-consuming.  Possible?

Or, I&#x27;m missing something basic <a href="https://github.com/jam-duna/jamtestnet/blob/main/erasurecoding/src/lib.rs#L29-L44" target="_blank" rel="noopener">here</a> to match up with davxy &#x27;s new <a href="https://github.com/davxy/jam-test-vectors/pull/74" target="_blank" rel="noopener">Erasure coding test vectors</a> and would like someone to provide the trick to get the efficiency of just having <a href="https://github.com/davxy/jam-test-vectors/pull/74#issuecomment-2962400563" target="_blank" rel="noopener">1 encode call rather than k</a>? <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-06-13 13:43</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: I remember parity has this erasure-coding repo <a href="https://github.com/paritytech/erasure-coding," target="_blank" rel="noopener">https://github.com/paritytech/erasure-coding,</a> wouldn&#x27;t this be helpful? since in the jam prize page it says we can use erasure-coding library as primitives directly</div>
<div class='msg reply'><time>2025-06-13 14:32</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: If theres no way to reduce the k encode calls to just one, you can try doing them in parallel rather than sequentially. It significantly reduced encoding time for me after doing that. Although would be faster still to just do a single call if possible.</div>
<div class='msg reply'><time>2025-06-13 16:36</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: The efficiency we want is that encoding+decoding of 3072 segments coming back from 342+ CE138 responses form 12MB+ work package bundle is done in well under 1s using up 1/16 of resources as aimed for here 
<a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/202501202501?v=0.6.7" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/7e6ff6a/202501202501?v=0.6.7</a>

It is surely doable, we just have to actually do it.  I think a solution between &quot;tiny&quot; (V=6, C=2) and &quot;full&quot; (V=1023, C=341) should be pursued so that N teams can pursue parallelization of requests/responses ( and various politeness concerns ) within the Toaster in pairs or something like that. <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-06-13 16:46</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: FWIW the full network protocol will provide a way of fetching bundles/segments directly from guarantors, as a fast path. The less fast path which is possible now is to request the shards containing original data, in which case reconstruction is just concatenation. If you need to do full reconstruction of segments it should still be possible to have only a single call into the EC library _if_ the shard indices are the same for every segment. If they&#x27;re not then I&#x27;m not sure how efficiently reconstruction can be done.</div>
<div class='msg reply'><time>2025-06-16 17:35</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: just stepped in this part, if I&#x27;m not mistaken, isn&#x27;t the <code>k</code> params for memory safe and scalability, I think the problem is the word size is too small in the tests, and <code>k !=1 </code> allows us to encode the data in parallel indeed <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-15 07:15</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: The header has a parent hash and prior state root. We need to guarantee the posterior state root of the parent block equals this prior state root. Does this mean implementations must also keep track of the posterior state roots along with headers? Otherwise it seems naively that an incoming header could point to any ancestral header as its parent </div>
<div class='msg'><time>2025-06-15 08:59</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Implementations will need to be able to determine the posterior state root for any block they retain in their chain which could serve as a parent. </div>
<div class='msg'><time>2025-06-15 09:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The fork-choice rule and finality ensure that this set cannot grow indefinitely (and thus that a new block cannot have a non-recent parent).  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-16 15:58</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I hate restarting the discussion on the topic again but i think the C function used in merklization should be changed. ( and maybe the T fn as well)

I wrote a rationale issue on the topic <a href="https://github.com/gavofyork/graypaper/issues/436" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/436</a>  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-16 20:00</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Replied. </div>
<div class='msg'><time>2025-06-17 11:44</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: What is the new state serialization for privileged services? I see this isn&#x27;t yet updated in the <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/3b4e023b5302?v=0.6.7" target="_blank" rel="noopener">GP</a>.

Is it reasonable to assume it&#x27;s going to be something like:

<pre><code class=''>E4(χm, χv) ⌢ E(χa) ⌢ E(χg) 
</code></pre>

</div>
<div class='msg'><time>2025-06-17 14:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes something like this. </div>
<div class='msg'><time>2025-06-17 15:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Is it not?</div>
<div class='msg'><time>2025-06-17 15:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: image.png</div>
<div class='msg'><time>2025-06-17 15:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This is in equation D.2, GP <code>main</code></div>
<div class='msg'><time>2025-06-17 15:46</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: X\_a is a list, so D.2 is wrong <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-17 15:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: No it&#x27;s not:)</div>
<div class='msg'><time>2025-06-17 15:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: See equation C.15</div>
<div class='msg'><time>2025-06-17 15:51</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: The equation defining X_a is 9.9, and it says X_a is a list; I don&#x27;t understand why C.15 should be involved</div>
<div class='msg'><time>2025-06-17 16:26</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: chi_a is indeed a sequence. The serialisation function used is defined in multiple parts, depending on the domain.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-17 16:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If the domain is a sequence, then C.15 comes into effect. </div>
<div class='msg'><time>2025-06-17 16:59</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: E_4 doesn&#x27;t rewrite to E, so if the argument is a sequence, it shouldn&#x27;t be rewritten as E_4(a1) ^ E_4(a2) ...; btw it&#x27;s just a matter of formalism</div>
<div class='msg'><time>2025-06-17 17:02</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Not sure what you mean. </div>
<div class='msg'><time>2025-06-17 17:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: E_4 indeed is not expressed in terms of E under any argument domain.</div>
<div class='msg'><time>2025-06-17 17:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Regardless it is well defined for sequence domains, multiple arguments and tuples (all of them in terms of itself).  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-17 20:17</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Does that mean the <code>#</code> <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/357001357701?v=0.6.7" target="_blank" rel="noopener">here for E_8</a> is redundant ?</div>
<div class='msg'><time>2025-06-18 05:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yes, not just the hash but also the concatenation operator above. Feel free to make a PR or issue.</div>
<div class='msg'><time>2025-06-18 10:38</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Does the <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/36ad0336b903?v=0.6.7" target="_blank" rel="noopener">new service host call</a> imply that no service id, even genesis services, should be less than 256?</div>
<div class='msg'><time>2025-06-18 10:46</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It implies that no new services can be less than 256 (or greater than 2^32-256)</div>
<div class='msg'><time>2025-06-18 10:47</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Genesis state is necessarily trusted and so doesn’t have these constraints.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-18 10:48</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: However the state merklisation is done to allow a genesis service at 0. </div>
<div class='msg'><time>2025-06-18 11:02</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: State serialization question: How does one tell the difference between a preimage meta state key for a freshly solicited preimage, and a storage state key?

I know the preimage meta value will be the encoded empty list, ie 0, but a storage key could have the same value. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-18 11:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Who says you can?</div>
<div class='msg'><time>2025-06-18 11:03</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The only thing which we aim to achieve with Merklisation is security (non-collision) and speed.</div>
<div class='msg'><time>2025-06-18 11:04</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The ability to introspect/interpret merklised keys is not a priority. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-18 11:05</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: I understand that, but I surely need to know which map to put a given key in when I import a trace, for example <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-18 11:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Nope.</div>
<div class='msg'><time>2025-06-18 11:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: That&#x27;s simply not a given.</div>
<div class='msg'><time>2025-06-18 11:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It would imply requiring that which I&#x27;ve already said isn&#x27;t a priority.</div>
<div class='msg'><time>2025-06-18 11:06</time>&ensp;<span class='u' style='color:#bc5896'>greywolve</span>: Ah right</div>
<div class='msg'><time>2025-06-18 11:07</time>&ensp;<span class='u' style='color:#cdc232'>oliver.tale-yazdi</span>: I think many implementations use KV lookup, in which case you dont need to invert them. IMHO it is still possible to not use KV Db by inverting all keys that can be inverted and then doing some special handling for the service keys that cannot be inverted. Also since only three key kinds cannot be inverted and they are used from host-calls that tell you the kind of the key. You can check this unofficial key table here <a href="https://docs.jamcha.in/advanced/storage/keys" target="_blank" rel="noopener">https://docs.jamcha.in/advanced/storage/keys</a></div>
<div class='msg'><time>2025-06-18 11:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: If the lack of merklised-key-interpretability turns out to be an issue in usage, it&#x27;s something fairly easy to fix (by including metadata in the value).</div>
<div class='msg'><time>2025-06-18 11:09</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: But right now the assumption is that it&#x27;s an unneeded pessimisation.</div>
<div class='msg'><time>2025-06-20 07:40</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: I&#x27;m feeling it&#x27;s necessary to weaken the usage of chain parameters, since in the context of jam, the parameters should be the same in the stable production network finally if I&#x27;m not mistaken, that the parameters is more like for the node development usage, it should not trouble the app/service developers of jam, ideally, they will never reach this concept since it increases the complexity of their development

EDITED: just got the purpose via <a href="https://github.com/gavofyork/graypaper/issues/186" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/issues/186</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-20 09:21</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: (C.16) says that the validator index for each credential in the guarantees extrinsic (11.23) should be generically serialized, but in order to comply with the test vectors (for condition (5.4)), I had to serialize the validator indices with E_2. Which is correct? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-20 10:05</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@ascriv:matrix.org&gt; (C.16) says that the validator index for each credential in the guarantees extrinsic (11.23) should be generically serialized, but in order to comply with the test vectors (for condition (5.4)), I had to serialize the validator indices with E_2. Which is correct?

The GP should be corrected so that the term <code>a</code> (credential) is serialized with a fixed-length validator index.</div>
<div class='msg'><time>2025-06-20 10:06</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Feel free to make an issue or a PR.</div>
<div class='msg'><time>2025-06-20 20:14</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: </div>
<div class='msg'><time>2025-06-20 20:19</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: &gt; &lt;@gav:polkadot.io&gt; Feel free to make an issue or a PR.

<a href="https://github.com/gavofyork/graypaper/pull/440" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/440</a></div>
<div class='msg'><time>2025-06-21 09:35</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: For handling time, a naive approach which pings ntp servers during block validation will probably take &gt;10ms on average which is too long. Could do periodic syncing during downtime but I feel like that technically wouldn’t be gp compliant. Could rely on system time but also prob not gp compliant  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-21 09:38</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Should we have a recommended configuration or should we leave solving this problem up to the implementers? </div>
<div class='msg'><time>2025-06-21 10:37</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: There’s nothing uncompliant about periodic time syncing providing you have good reason to believe the machine’s internal clock isn’t going to be totally mad. </div>
<div class='msg'><time>2025-06-21 10:40</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: The GP assumes common-clock - it makes no assertions about how this is achieved. I’d have thought impls will generally expect system clock to be correct and the problem will thus generally be left to the node’s sysadmin. </div>
<div class='msg'><time>2025-06-21 18:19</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: Nitpick suggestion: make fetch case 8 <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/32a50132a501?v=0.6.7" target="_blank" rel="noopener">here</a> match up exactly with the implied authorizer p\_a preimage <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/1bad011bad01?v=0.6.7" target="_blank" rel="noopener">here</a> -- prefer 14.10 change instead of fetch. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-22 16:21</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: As those who follow the GP will have seen, the last few days has seen both major refactoring of the Latex and some pretty heavy changes to the terms used to try to make things a lot easier for newcomers. I expect to finish the <a href="https://github.com/gavofyork/graypaper/issues/266" target="_blank" rel="noopener">final 0.6 series issue</a> imminently, after which 0.7.0 can, in principle, be released. Before I put out 0.7.0 I&#x27;ll leave it for a few days to settle as no doubt there will be some errors from the huge refactoring/renaming: **If you do happen to be looking at GP-<code>main</code> and see any regressions the refactor introduced, do please point them out**.</div>
<div class='msg'><time>2025-06-25 10:32</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Nobody reported any issues, so here it is: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.7.0" target="_blank" rel="noopener">GP 0.7.0</a></div>
<div class='msg'><time>2025-06-25 10:33</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: I did a sweep of integer encodings, but may have missed some; if you feel that there are still encodings which are variable and shouldn&#x27;t be (or which are fixed and should be variable), do feel free to mention it.</div>
<div class='msg'><time>2025-06-25 10:35</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: when will the network protocol being embedded in GP?</div>
<div class='msg'><time>2025-06-25 10:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It&#x27;s not a big priority.</div>
<div class='msg'><time>2025-06-25 10:42</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It might not happen even before 1.0 - it could just be done as a JIP/RFC. <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-25 10:43</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Biggest priority is to get the core protocol secure, fast and functional.</div>
<div class='msg'><time>2025-06-25 13:55</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: <pre><code class=''>spacejam    WARN ticket{attempt=0}: failed to open bi-stream: eecgwpgwq3noky4ijm4jmvjtmuzv44qvigciusxakq5epnrfj2utb@127.0.0.1:40000
spacejam    DEBUG ticket{attempt=0}:disconnect{peer=&quot;eecgwpgwq3noky4ijm4jmvjtmuzv44qvigciusxakq5epnrfj2utb&quot;}: failed to open bi-stream
spacejam    WARN ticket{attempt=0}: failed to open bi-stream: ekwmt37xecoq6a7otkm4ux5gfmm4uwbat4bg5m223shckhaaxdpqa@127.0.0.1:40002
spacejam    DEBUG ticket{attempt=0}:disconnect{peer=&quot;ekwmt37xecoq6a7otkm4ux5gfmm4uwbat4bg5m223shckhaaxdpqa&quot;}: failed to open bi-stream
polkajam-3  tokio-runtime-worker WARN authoring  Error processing incoming ticket: finality lagging (final: 2520995, curr: 2520999)
polkajam-4  tokio-runtime-worker WARN authoring  Error processing incoming ticket: finality lagging (final: 2520995, curr: 2520999)
polkajam-1   tokio-runtime-worker WARN authoring  Error processing incoming ticket: finality lagging (final: 2520995, curr: 2520999)
spacejam     TRACE ce132::recv: ticket#0@cdf12f for epoch: 210083
spacejam     TRACE up0{peer=en5ejs5b2tybkfh4ym5vpfh7nynby73xhtfzmazumtvcijpcsz6ma}:recv: block#2521000@0x4ed2f0, grandpa#2520998@0x961299, remote#2520996@0xdd6fa0
</code></pre>

I can reach this finality lagging problem frequently from <code>polkajam</code>, at the last line we can see spacejam still receives block#2521000 from a polkajam node, while seems other 3 neighbors are at 2520995 that they reject <code>spacejam</code>&#x27;s ticket and close the connection, I expect the correct behavior should be like, on receiving a ticket from future blocks, we cache the ticket, and verify it on finalizing that new block instead of closing the connection immediately

our testnet (<code>0.6.5</code>) configuration is 5 <code>polkajam</code> node + 1 <code>spacejam</code> node and <code>spacejam</code> can work with <code>polkajam</code> nodes with around 30mins then get broken on inconsistent blocks <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-27 13:42</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I&#x27;ve a question in 10.5 <code>f \in bold_k</code> but that bold_k can&#x27;t come from 10.3 which needs <code>a</code> from EV. is it a typo? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-06-27 14:09</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: lol i am totally blind sorry :(</div>
<div class='msg'><time>2025-07-14 14:10</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: when computing the work report for a work package, i&#x27;m a bit confused how GP is specifying how to compute the segment root dictionary. It seems like we should rely on the segment-roots in the recent blocks component in the current state according to (11.41). But also 11.41 says the segment-roots might be in the guarantees extrinsic itself. that seems to imply we should wait for all the work reports in E_G before computing it, which seems to imply the author should be computing the segment root dictionaries. what am I missing?</div>
<div class='msg reply'><time>2025-07-14 14:17</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: 11.41 is a validity condition for a block, it doesn&#x27;t say how the reports should be computed</div>
<div class='msg reply'><time>2025-07-14 14:18</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The WP hash -&gt; segments-root map in a report has to be computed by the report&#x27;s guarantors as it is signed by them</div>
<div class='msg reply'><time>2025-07-14 14:20</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: It is expected to be computed by the &quot;primary&quot; guarantor, who received the work-package from the builder. When the work-package is shared with a secondary guarantor, this mapping is sent in the first message (see CE 134)</div>
<div class='msg reply'><time>2025-07-14 14:21</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The author of a block should only include guarantees where this mapping is valid as per 11.41</div>
<div class='msg reply'><time>2025-07-14 14:25</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Exactly how guarantors compute the mapping is up to them. They may optimistically include work-packages that have not yet been reported on-chain. Guarantors won&#x27;t be slashed for including an invalid mapping in a report, but they also won&#x27;t be paid for these reports as it won&#x27;t be possible to include them on chain</div>
<div class='msg'><time>2025-07-14 14:27</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Got it. So could a naive guarantor could compute it by looking at the recent blocks component in the current state and that would suffice but possibly not be optimal? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-07-14 14:37</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Should we not also include optimal guarantor behavior in the gp? Or is it not well defined?</div>
<div class='msg reply'><time>2025-07-14 14:42</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: To some extent this may need to be defined for guarantors assigned to the same core to work well together. I think we&#x27;d generally like to allow validators to have their own strategies for things though</div>
<div class='msg reply'><time>2025-07-14 14:44</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: eg It wouldn&#x27;t be great if the mappings computed by one guarantor were always rejected by the other two assigned to the core <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-07-14 14:44</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Builders will also need to know generally what to expect from guarantors</div>
<div class='msg reply'><time>2025-07-14 14:46</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: So I expect we will define some of this stuff, but probably not until after performance testing etc has happened on the toaster, as I don&#x27;t think we will understand things well enough until then</div>
<div class='msg'><time>2025-07-16 10:22</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-07-16 at 12.22.13 PM.png</div>
<div class='msg'><time>2025-07-16 10:22</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Screenshot 2025-07-16 at 12.22.44 PM.png</div>
<div class='msg'><time>2025-07-16 10:23</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: is there a discrepancy between GP and <a href="https://github.com/zdave-parity/jam-np/blob/main/simple.md" target="_blank" rel="noopener">https://github.com/zdave-parity/jam-np/blob/main/simple.md</a> ? 139/140 require the erasure root to reconstruct the imported segments but GP says the segments root is what&#x27;s needed</div>
<div class='msg reply'><time>2025-07-16 20:55</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The erasure root is used in SNP as the distributed shards are proven only to this, it is not possible to (efficiently) prove a segment shard to a segments-root</div>
<div class='msg reply'><time>2025-07-16 20:59</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Of course for an imported segment you start with a segments-root, not an erasure-root. The guarantor fetching the segment is expected to map one to the other, based on previously observed work-reports <span class="edited">(edited)</span></div>
<div class='msg reply'><time>2025-07-16 21:05</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Not sure the network protocol can sensibly work any other way, could be wrong about this though</div>
<div class='msg'><time>2025-07-16 21:12</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I guess this would be in the availability spec. How long should a guarantor keep work report availability specs? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-07-16 21:14</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Should keep mappings for as long as the data is available, 28 days is what&#x27;s currently specified I believe</div>
<div class='msg'><time>2025-07-17 09:21</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Can guarantors assume that each imported data segment for the work items is exported by one of the prerequisite work packages? (Unless perhaps the imported segment is identified by work package hash)</div>
<div class='msg reply'><time>2025-07-17 09:24</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: No</div>
<div class='msg'><time>2025-07-18 14:54</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: The JNP seems pretty clear about how guarantors should get segment shards for reconstruction, but aren’t segment justifications also in D3L? There doesn’t seem to be a way to get those that I can tell. The justifications sent in 140 are justifications for shards, not segments, no?</div>
<div class='msg reply'><time>2025-07-18 14:55</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You should also use 139/140 to request proof page shards</div>
<div class='msg reply'><time>2025-07-18 14:56</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: You need to reconstruct proof pages in the same way that you reconstruct import segments</div>
<div class='msg reply'><time>2025-07-18 14:58</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: The justifications returned by CE 140 are for shards yes. As the SNP doc says you generally should only use CE 140 if your first attempt to fetch shards and reconstruct segments using CE 139 fails</div>
<div class='msg'><time>2025-07-18 15:22</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Ok think I get it, looking at 14.16, we can reuse the same erasure roots but use different indices to get paged proof shards using 139/140 <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-07-22 13:28</time>&ensp;<span class='u' style='color:#4977cf'>danicuki</span>: </div>
<div class='msg'><time>2025-07-23 10:15</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: Is there a proposal for the format of the metadata in the last 128 octets of the validator keys somewhere? I can infer from the various examples floating around but would be nice if it was written down somewhere (to infer the IP address/port, e.g.) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-07-23 12:24</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: IDK if this is specified anywhere, but PolkaJam currently assumes first 16 bytes are an IPv6 address and next 2 bytes are a port</div>
<div class='msg'><time>2025-07-23 12:25</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Remaining metadata bytes are currently ignored</div>
<div class='msg'><time>2025-07-23 12:27</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: This ought to fit nicely in the networking spec <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-07-23 12:28</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Ah, it is there already actually: <a href="https://github.com/zdave-parity/jam-np/blob/main/simple.md#required-connectivity" target="_blank" rel="noopener">https://github.com/zdave-parity/jam-np/blob/main/simple.md#required-connectivity</a></div>
<div class='msg'><time>2025-07-23 12:28</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: &quot;The validators&#x27; IP-layer endpoints are given as IPv6/port combinations, to be found in the first 18 bytes of validator metadata, with the first 16 bytes being the IPv6 address and the latter 2 being a little endian representation of the port&quot;</div>
<div class='msg'><time>2025-07-23 15:03</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: should a valid ipv6/port be enforced before incorporation on chain?</div>
<div class='msg'><time>2025-07-23 15:21</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: Could plausibly be sanity checked by the delegator service, GP does not have any such logic though</div>
<div class='msg'><time>2025-07-25 00:33</time>&ensp;<span class='u' style='color:#5bdb7f'>r2rtnl</span>: I&#x27;m observing a possible inconsistency in instruction decoding between the Gray Paper and the official PolkaVM implementation:

1. According to (A.16) of the Gray Paper, any signed extension must produce a 64-bit value:
<a href="https://graypaper.fluffylabs.dev/#/9a08063/25e30225e302?v=0.6.6" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/9a08063/25e30225e302?v=0.6.6</a>
2. In (A.26), the immediate (nu\_x) for the branch\_ge\_u\_imm instruction must be sign-extended from 32 bits or less (as the immediate size is up to 4 bytes) to 64 bits, using the signed extension defined in (A.16).
<a href="https://graypaper.fluffylabs.dev/#/9a08063/27e70227e702?v=0.6.6" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/9a08063/27e70227e702?v=0.6.6</a>
3. When decoding the following argument octets for a branch\_ge\_u\_imm (opcode 85):
0x17 0xf7 0xf4 0x1,
the official PolkaVM implementation logs this as:
&quot;jump 70519 if a0 &gt;=u 4294967287&quot; (the instruction starts at offset 70019).
This suggests that the signed extension applied to an 8-bit value (0xf7) resulted in a 32-bit value 0xfffffff7 = 4294967287, rather than a 64-bit value as implied by (A.26).

Could you please clarify the intended behavior in this case?

P.S. This observation comes from analyzing the following PolkaVM trace:
<a href="https://github.com/davxy/jam-stuff/blob/main/pvm-traces/0.6.6/reports-l0-00000005.log" target="_blank" rel="noopener">https://github.com/davxy/jam-stuff/blob/main/pvm-traces/0.6.6/reports-l0-00000005.log</a>
that was provided in this task:
<a href="https://github.com/davxy/jam-test-vectors/issues/83" target="_blank" rel="noopener">https://github.com/davxy/jam-test-vectors/issues/83</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-07-26 00:57</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: <a href="https://github.com/gavofyork/graypaper/releases/tag/v0.7.1" target="_blank" rel="noopener">Gray Paper version 0.7.1 is out</a>. This one contains most of the pre-planned 0.7 series changes already. The rest of the changes may be dropped or postponed to 0.8; we&#x27;ll see once we have vaguely real services running on the Toaster.

The biggest change with this release is to combine <code>on_transfer</code> with <code>accumulate</code>, actually reducing the size of the spec and, hopefully, implementation and API complexity. Also introduced is a new privilege, the Registrar, which is able to name the index of newly created services in a newly cordoned AccountId space (the lower 16 bits). <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-07-30 09:01</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: I&#x27;ve a question about B.11. what is bold_o in the fetch? I can&#x27;t seem to find a reference </div>
<div class='msg reply'><time>2025-07-30 10:04</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: Good catch - that should be bold_i for accumulate input, I updated that from bold_o to bold_i but missed updating FETCH <a href="https://github.com/gavofyork/graypaper/pull/465" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/465</a></div>
<div class='msg reply'><time>2025-07-30 10:04</time>&ensp;<span class='u' style='color:#4068cd'>0xjunha</span>: Opened a PR to fix it - <a href="https://github.com/gavofyork/graypaper/pull/479" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/479</a></div>
<div class='msg reply'><time>2025-07-30 11:21</time>&ensp;<span class='u' style='color:#5c84c9'>prematurata</span>: thanks!!</div>
<div class='msg'><time>2025-07-30 23:08</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: In comparing PVM gas vs EVM gas (and for a bit more than funsies, throwing geth&#x27;s evm interpreter into our implementation and wiring up Go StateDB interface) and seeing how modular JAM is in its PVM invocations to refine/accumulate, it&#x27;s clear that JAM can totally support other VMs besides PVM -- so long as JAM guarantors+auditors/validators measure gas/work the exact same way and take in argument inputs/outputs according to whatever the VM&#x27;s interfaces are, I think we can transplant multiple non-PVM VMs into JAM -- good idea or no?

In principle, GP could split off Appendix A (the PVM) from GP (and like grandpa/bls/bandersnatch) incorporate by reference and make JAM agnostic to its VM, and describe JAM VM-specific interfaces in separate JAM+PVM, JAM+EVM, JAM+whatever VM papers (or JIPs).   You could have CorePVM service running PVM refine/accumulate, CoreEVM running EVM refine/accumulate, Core{whatever}VM running whateverVM refine/accumulate.  Instead of &quot;JAM can run any VM that people want so long as it’s PVM” 😀   it can be &quot;JAM can run any VM people so long as it runs on gas&quot;.

The reason _against_ doing so is that PVM&#x27;s recompilation and RISC-V choice is technically the best option!   Having done a basic recompiler, we now see directly how recompiling PVM to X86 (and surely, ARM) wins a truly massive performance gain over the PVM interpreter -- so no debate there!

But other VMs can also map into X86 (or ARM) in the same way and get similar truly massive performance gains: <code>revmc</code> does it for EVM, and its clear a non-PVM JAM path could be based on that or something similar for EVM (and probably other non-PVM VMs).  Once we compare X86 to X86 wall clock times, the differences between these VMs are bound to be more like the difference between QWERTY vs non-QWERTY keyboards: people will use Solidity/Remix/solc over Rust/polkatool/revive just because its familiar, not because its actually the best option.

What is the reason for tying JAM solely to PVM?  Could we chart a more open course?  If not, what did I miss? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-07-30 23:27</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: I think too many translations are over complicating the problem and endless of maintenance, if I&#x27;m not mistaken, we can simply run a VM in builders and wrap the result to the extrinsic data of work packages</div>
<div class='msg'><time>2025-07-30 23:29</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: the main thing is actually working gas model. PVM is designed in such way that the gas consumption actually reflect the resource usage. EVM gas is not the case</div>
<div class='msg'><time>2025-07-30 23:37</time>&ensp;<span class='u' style='color:#be2950'>clearloop</span>: my idea is that builders holding VMs for executing any programs, host a service for charging fees, users can get the execution data from refine context and doing pending stuffs, the translation solutions are more like for non-JAM arch, e.g. PVM out of JAM</div>
<div class='msg'><time>2025-07-30 23:46</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: I probably learned the wrong lesson here from the 3 snippets <a href="https://forum.polkadot.network/t/announcing-polkavm-a-new-risc-v-based-vm-for-smart-contracts-and-possibly-more/3811#appendix-bonus-section-or-why-does-it-smell-like-gas-here-18" target="_blank" rel="noopener">here</a> where Jan&#x27;s point in 
<pre><code class=''>Snippet 1: 6ms
Snippet 2: 114ms
Snippet 3: 10ms
</code></pre>  
was that not even PVM can get it right -- thus we need to have a new mechanism considering whether observed wall clock times are close to expected &quot;average&quot; times to steer away from &quot;Snippet 2&quot; situations.   You appear to believe PVM has it right, and I don&#x27;t know about that...</div>
<div class='msg'><time>2025-07-30 23:51</time>&ensp;<span class='u' style='color:#4cbfa8'>xlchen</span>: the whole point is accurate gas measuring is hard. but that&#x27;s the exact reason why pvm gas system is not yet out</div>
<div class='msg'><time>2025-07-31 00:47</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: I believe the solution, whenever it comes out, will be at the JAM level rather than VM-specific, which is a happy outcome because I think JAM&#x27;s innovations here are not wholly dependent on PVM at all.</div>
<div class='msg'><time>2025-07-31 14:17</time>&ensp;<span class='u' style='color:#6247cb'>bamzedev</span>: Equation 10.2 defines the verdict age as an element of N₂ (i.e., {0, 1}), and equation 10.3 determines which validator set to use based on comparing the age to ⌊τ/E⌋.
At epoch transitions (e.g., slot 600 transitioning from epoch 0 to epoch 1), this appears to create a one-slot delay before new validators can have their judgments included in verdicts:
At slot 600: τ = 599, so ⌊τ/E⌋ = 0
Valid ages are {0, 1}
Age 0 → uses κ (epoch 0 validators from prior state)
Age 1 → uses λ (validators from before epoch 0)
No age value allows referencing κ&#x27; (the new epoch 1 validators)
Does this mean:
Slot 600 might have no verdicts at all, OR
Epoch 0 validators continue sending judgments into the first slot of epoch 1 (and these can be included with age=0)?
</div>
<div class='msg reply'><time>2025-07-31 14:59</time>&ensp;<span class='u' style='color:#c65779'>dave</span>: This sounds like a misunderstanding of the auditing system. Verdicts/judgments are posted on-chain only if there is a dispute, ie at least one validator thinks a report is faulty. This should be extremely rare, and is likely to happen at least a couple of slots after the disputed report is made available. The first block the epoch 1 validators are responsible for auditing is the one in slot 601, so it doesn&#x27;t matter if they can&#x27;t include a verdict before this.</div>
<div class='msg reply'><time>2025-07-31 15:19</time>&ensp;<span class='u' style='color:#6247cb'>bamzedev</span>: thanks</div>
<div class='msg'><time>2025-08-01 04:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: &gt; &lt;@sourabhniyogi:matrix.org&gt; I believe the solution, whenever it comes out, will be at the JAM level rather than VM-specific, which is a happy outcome because I think JAM&#x27;s innovations here are not wholly dependent on PVM at all.

PVM provides a number of key innovations for JAM:
1. An execution and gas model which we expect to get much closer to metering at native speed than anything before.
2. A well supported ISA, allowing a host of compilation tooling to be used, including LLVM.
3. A stack and memory model which allows for easy consensus-sensitive program suspension and restoration. This opens the doors to things like CoreVM and “native speed” smart contract execution (rather than executing the smart contract as a second interpreter within the VM).  </div>
<div class='msg'><time>2025-08-01 04:15</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Using EVM or Wasm instead of PVM is technically possible, but would increase workload and maintenance for all JAM implementation teams and would mean hard-forking to keep up with any EVM changes which we wanted to support (forcing a choice of outdated tooling or being subject to other peoples’ hard fork schedule). Neither Wasm nor EVM have particular good gas models. Polkadot works around this with a special wall-clock time consensus protocol but this approach is insecure outside of Polkadot 1. Realistically it may be end up being faster to recompile EVM into PVM and execute “natively” than build in a specialist EVM protocol with a crappy gas models. I wouldn’t necessarily say never, but I won’t be adding it to 1.0.  <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-08-01 10:08</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: davxy: after finishing tests for 0.6.7, will you go ahead implementing those for 0.7.1 or you will do 0.7.0 first? I&#x27;m asking since in Jampy I&#x27;m maintaining branches for every gp versions from 0.6.7 to latest, and I&#x27;m doing it only for being able to run your tests in the future</div>
<div class='msg'><time>2025-08-01 10:43</time>&ensp;<span class='u' style='color:#b332c3'>rustybot</span>: </div>
<div class='msg'><time>2025-08-01 10:44</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: &gt; &lt;@dakkk:matrix.org&gt; davxy: after finishing tests for 0.6.7, will you go ahead implementing those for 0.7.1 or you will do 0.7.0 first? I&#x27;m asking since in Jampy I&#x27;m maintaining branches for every gp versions from 0.6.7 to latest, and I&#x27;m doing it only for being able to run your tests in the future

Probably we&#x27;ll ship 0.7.0 first.
Side note, are you aware of  this: <a href="https://github.com/davxy/jam-stuff/tree/main/fuzz-reports/0.6.6/jampy/jampy-0.6.6_GP-0.6.6/1753810654" target="_blank" rel="noopener">https://github.com/davxy/jam-stuff/tree/main/fuzz-reports/0.6.6/jampy/jampy-0.6.6_GP-0.6.6/1753810654</a> ?</div>
<div class='msg'><time>2025-08-01 10:57</time>&ensp;<span class='u' style='color:#bfaf39'>dakkk</span>: ok (y) No, I wasn&#x27;t aware; I will have a look</div>
<div class='msg'><time>2025-08-01 11:33</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: For the engineering of a whateverVM byte code to PVM byte code (and winning gas metering closer to wall clock times [but by no means perfect, as Jan&#x27;s Snippet 1/2/3 illustrates super well]), this makes a lot of sense!  Do you believe it should be done 
(a) in a performance-based way like PVM byte code is being mapped to X86 (or ___) now,
(b) according to a spec, or
(c) with one good FFI [like most of us are all treating the W3F bls+bandersnatch libs + erasure encoding]
?  

If there is a difference between engineering the mapping between (1) whateverVM to PVM and (2) PVM to X86, what is it?

Based on the very long history of dozens-to-hundreds of smart contract compiler bugs (which get a lot of press!), I&#x27;m far more concerned about buggy polkatool or problems in one actually-not-so-good FFI (for EVM=&gt;PVM or PVM=&gt;X86) than I am of crappy gas models being the source of severe security problems.  What should people like me read to rebalance their security concerns and develop a better appreciation of how severely crappy the gas models are?  </div>
<div class='msg'><time>2025-08-01 11:57</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Unless I misunderstood it, your question doesn&#x27;t really make sense. Translating one bytecode into another must always be done according to the spec, otherwise you&#x27;ll get diverging semantics and the translated program won&#x27;t do what it&#x27;s supposed to do. Of course 1-to-1 <em>exact</em> translation isn&#x27;t always possible - e.g. in case of EVM you can do things like inspect the current gas, so if you&#x27;d translate this to PVM you&#x27;d either have to implement very expensive emulation to fake EVM&#x27;s gas, or just accept that programs which depend on this will be incompatible. Nevertheless, PVM&#x27;s gas metering itself (which you cannot turn off) will ensure that the guest program can be safely run.; we care about how PVM instructions map to native AMD64 code because this <em>is</em> security sensitive; we don&#x27;t care how EVM instructions map to PVM instructions because the PVM layer below it already provides the security it needs.</div>
<div class='msg'><time>2025-08-01 12:20</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: Anyway, JAM using a different VM would be possible, but unless you don&#x27;t care about performance <em>or</em> you don&#x27;t care about security then it would be <em>much</em> harder, precisely because of the gas cost model.

Let&#x27;s say, for example, we want to use WASM. Okay. So first, we absolutely need O(n) recompilation support in the VM, otherwise it&#x27;s trivial to DoS our chain. But WASM wasn&#x27;t designed with this in mind, so we eat 2x performance cost to use a single-pass WASM VM even before any other consideration.
Then, we need a gas cost model. WASM bytecode is relatively high level and doesn&#x27;t map to native instructions 1-to-1, so this makes coming up with a secure optimal gas cost model even harder. But okay, let&#x27;s give up on the &quot;optimal&quot; part. This means you need to overestimate your gas model costs by quite a lot, even <em>more</em> than we have to do with PVM.
And you <em>still</em> need to do the legwork and come up with the gas cost model yourself, because WASM itself doesn&#x27;t come with one!

Of course there&#x27;s still the YOLO option of just.... not having a secure gas cost model (without any backup mechanism like Polkadot 1). I know of at least one chain which picked this option (whether deliberately or accidentally), and they&#x27;re doing fine because no one really cares to actually attack them. :P But I can&#x27;t in good conscience recommend this option, for obvious reasons.</div>
<div class='msg'><time>2025-08-01 12:29</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: JAM would most likely look very different without PVM. In the gas cost model that I&#x27;m working on I&#x27;m already pretty much pushing the absolute limits of what can be practically modeled; to do significantly better you&#x27;d need to either a) skimp on security, or b) gimp the chain&#x27;s capabilities and make it <em>not</em> a general-purpose, permissionless-chain (which is JAM&#x27;s killer feature in my opinion).</div>
<div class='msg'><time>2025-08-01 17:41</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: We will need to study what is missing in revmc&#x27;s EVM-to-X86 implementation (which is obviously as performance oriented as JAM&#x27;s PVM-to-X86)  a bit more to understand what it is missing there that is present in the PVM-to-X86 architecture that gives the latter better security outside of gas semantics alone.

Obviously, its missing a dozen or two teams competing in 2026 in a performance-based way.   Otherwise, I think you can redo a gas model for most (but not all) EVM op codes based on typical revmc typical X86 measurement, give up on legacy gas model and get &quot;almost compatibility&quot; -- using host function calls for any and all op codes that need them.  

You would then have two modern paths for 2 different types of teams/implementations:

- DVORAK teams/implementations:  evm =TBD=&gt; pvm =M3/M4 impl=&gt; x86 \[with a pvm gas model based on x86\]
- QWERTY teams/implementations:  evm =revmc \[or similar/better\]=&gt; x86 \[with a non-legacy gas model based on x86\]

Augmenting Current Teams with DVORAK teams and/or QWERTY teams is better than the current path of

- Current Teams: Rust/Solidity =\[revive/polkatool\]=&gt; pvm =&gt; x86 \[with a pvm gas model based on x86\]

_alone_ because, simply put, there are basically a O(10^4)-O(10^6) times fewer people who have dogfooded polkatool with the above path (we&#x27;re trying our best, its just ... not ready yet =) ).  We want security, performance and **impact**.

JAM&#x27;s path to max impact probably should involve DVORAK teams, is what I&#x27;m hearing, informed by the predicted failures of QWERTY teams.

Do you have a prediction on how QWERTY teams will fail? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-08-02 01:18</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: While i appreciate the desire to create impact, as I already stated the GP will definitely not see EVM in it before 1.0, and probably never. I’d suggest you instead focus your efforts on comparison (perhaps putting your various benchmarking code through both revmc and Rust/PolkaVM) and compilation of Solidity to PVM (or perhaps even recompilation of EVM to PVM). </div>
<div class='msg'><time>2025-08-02 15:09</time>&ensp;<span class='u' style='color:#da5c80'>jan</span>: If you&#x27;re paranoid about using my linker for translating RISC-V code to PVM you can always either disable my linker&#x27;s optimizations (in which case it does very little changes to the original RISC-V bytecode, besides translating it to equivalent PVM instructions and relocating the code and data like any other linker does to fit with the PVM memory map), or you can just write your own independent RISC-V -&gt; PVM translator and end-to-end fuzz it against mine. And of course you can also try to do formal verification of the resulting PVM bytecode of your program, but the tooling for that is as of yet still missing (you&#x27;re welcome to contribute though if you have the manpower, as that would actually be useful).</div>
<div class='msg'><time>2025-08-03 00:37</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: clever ok!</div>
<div class='msg'><time>2025-08-07 10:38</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: <a href="https://graypaper.fluffylabs.dev/#/1c979cb/308a01308a01?v=0.7.1" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/1c979cb/308a01308a01?v=0.7.1</a></div>
<div class='msg'><time>2025-08-07 10:39</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: I don&#x27;t think any impls are doing the g-10 in the default case for the mutator here? Should we remove?</div>
<div class='msg'><time>2025-08-07 10:40</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: also if we keep it, shouldn&#x27;t we do an out of gas check in case g &lt; 10 ?</div>
<div class='msg'><time>2025-08-07 10:45</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: It shouldn’t be removed, and yes an OOG check should be assumed. Feel free to make a PR stating this explicitly. </div>
<div class='msg'><time>2025-08-07 11:35</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: <a href="https://github.com/gavofyork/graypaper/pull/482" target="_blank" rel="noopener">https://github.com/gavofyork/graypaper/pull/482</a></div>
<div class='msg'><time>2025-08-08 15:54</time>&ensp;<span class='u' style='color:#4036ac'>ascriv</span>: <a href="https://graypaper.fluffylabs.dev/#/1c979cb/2c57022c6102?v=0.7.1" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/1c979cb/2c57022c6102?v=0.7.1</a>

host functions returning a page fault is only theoretical at this point, right? Couldn&#x27;t find any that actually return this exit reason</div>
<div class='msg'><time>2025-08-12 13:37</time>&ensp;<span class='u' style='color:#7bdab2'>ge0321</span>: Hi Gavin, I was wondering if there’s been any thought given to updating the original Polkadot whitepaper. With Polkadot 1.0 now fully delivered, the original vision has essentially been realized. Now that we have JAM, the Gray Paper does an excellent job explaining the technical details, but it’s quite dense for a general audience. Do you think there’s value in producing an updated whitepaper or equivalent that frames Polkadot’s vision and architecture from the JAM perspective for a broader audience?</div>
<div class='msg'><time>2025-08-12 15:12</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Yeah perhaps that could be interesting. </div>
<div class='msg'><time>2025-08-12 15:13</time>&ensp;<span class='u' style='color:#cd8957'>gav</span>: Question is whether I can find the time:)</div>
<div class='msg'><time>2025-08-12 16:00</time>&ensp;<span class='u' style='color:#7bdab2'>ge0321</span>: :)</div>
<div class='msg'><time>2025-08-12 17:04</time>&ensp;<span class='u' style='color:#c67452'>sourabhniyogi</span>: What are the primary reasons for _not_ having <code>refine</code>&#x27;s { <code>machine</code>, <code>poke</code>, <code>invoke</code>, <code>peek</code>, <code>pages</code>, <code>expunge</code> } host functions available as invokable <code>accumulate</code> host functions as well?   If these are &quot;expensive&quot; (or worth discouraging) why not just gas price them as such?

As far as we can see, there is no constraint on a child VM&#x27;s available gas in <code>invoke</code> from the parent VM -- is that correct?  If the parent has 2B gas allocated, the <code>machine</code>-generated child VM could have 3B, or 3 <code>machine</code> generated child VMs could have 1B (or 1T).  What did I miss on how <code>invoke</code> is constrained so that a <code>refine</code> invocation has the child VM not using more gas than was allocated to the parent?

I&#x27;m taking a good look at <code>invoke</code> to tackle the EVM-to-PVM gas comparison problem seriously with some fraction of Ethereum legacy tests -- where I think if the EVM contract-related family of opcodes (CALL/STATICCALL/DELEGATECALL/...) is mapped into PVM refine+accumulate machinery &quot;correctly&quot;, it can be a good source of dogfooding.  This is almost certainly a non-trivial undertaking to do right but a PoC seems tractable especially if the goal is &quot;just&quot; to compare gas models for &quot;pure&quot; computations.   How would you constrain or order the execution of this?  Or, should this be avoided completely?  It sure seems that refines child VM <code>invoke</code>/<code>machine</code>/... machinery should be adapted for this purpose (and incorporated into accumulate)-- would you agree?

To do a proper precise comparison of gas models and demonstrate the improvements of gas models based on PVM to EVM, it seems an absolute requirement to compare wall clock times between
(1) EVM-to-X86 (with revmc), measuring both:
(a) strawman EVM gas model (whatever the production model is circa 2025) to
(b) &quot;reparameterized&quot; EVM gas model (as informed by X86/.. wall clock times)
(2) EVM-to-PVM-to-X86, with the new PVM gas model (as informed by X86/.. wall clock times)
with the exact same battery of EVM byte code doing the exact same full range of computations (computing with 256-bit with no 64-bit shortcuts) and allowing both (1)+(2) optimizations (e.g. if the 256-bit computation only actually needs 64-bit computation, then take the shortcut).  Am I requiring too much here?  What are legit shortcuts to take?

The primary shortcut I believe is to only measure pure functions (no EVM byte code reading/writing state, or doing any kind of IO), with no use of host functions (except maybe to actually conduct the test).  Are there other shortcuts you would advise, for the goal of doing precise gas model comparison? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-08-12 21:19</time>&ensp;<span class='u' style='color:#5e86de'>boymaas</span>: I am re-reading the accumulated definitions and have a question about a detail in the outer accumulation function which calls the parallelized accumulation function one or more times based on actual gas usage. The parallelized accumulation function takes a set of ( w ) and executes single service invocations in parallel, building, for example, ( B ), the service-indexed commitment.

Now I wonder what would happen if the second invocation included a w with an (s) service\_id which was also present in the first invocation of the parallelized accumulation function. Are we not losing the output from the first parallelized accumulation function invocation for that service in B when we perform the union integrating the results from the second invocation into B?

<a href="https://graypaper.fluffylabs.dev/#/1c979cb/17be0117c101?v=0.7.1" target="_blank" rel="noopener">https://graypaper.fluffylabs.dev/#/1c979cb/17be0117c101?v=0.7.1</a> <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-08-13 18:08</time>&ensp;<span class='u' style='color:#cb735c'>prasad-kumkar</span>: We’ve published some early benchmarks comparing our x86 recompiler vs the Python interpreter for PVM on pure compute programs (with gas computation): 🔗 <a href="https://gist.github.com/prasad-kumkar/7727798f7b06d8ead3e84436e85499f1" target="_blank" rel="noopener">https://gist.github.com/prasad-kumkar/7727798f7b06d8ead3e84436e85499f1</a>

These numbers are super early and there’s a lot of room for improvement.
One thing I noticed - when we integrate it in JAM (with host calls), performance drops quite a bit, even slower than interpreter 🤔 

Sharing here in case anyone wants to reference</div>
<div class='msg'><time>2025-08-14 19:04</time>&ensp;<span class='u' style='color:#c457c5'>vinsystems</span>: When the <a href="https://graypaper.fluffylabs.dev/#/7e6ff6a/36b50136b501?v=0.6.7" target="_blank" rel="noopener">designate hostcall</a> is called and the next\_validators are updated, should we also update the safrole&#x27;s pending validators, recompute the epoch root and empty the tickets accumulator? <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-08-14 19:23</time>&ensp;<span class='u' style='color:#d470bf'>jaymansfield</span>: Results of designate go into iota prime (see 12.25). Ring root and next validators come from the original iota (6.13) <span class="edited">(edited)</span></div>
<div class='msg'><time>2025-08-14 19:39</time>&ensp;<span class='u' style='color:#c9419d'>davxy</span>: The designate validator is stored in iota and remains there until the next epoch change.  
When the epoch changes, iota enters the safrole state, and the ring root (commitment) is recomputed for the new validator set.  

The designate host call can be invoked multiple times during an epoch to update iota, but only the last value written before the epoch change is used to recompute the safrole ring root.</div>
